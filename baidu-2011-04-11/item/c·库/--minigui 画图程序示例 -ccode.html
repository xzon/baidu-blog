<html><head><title>//minigui 画图程序示例 -ccode</title></head><body><div id='tit'>//minigui 画图程序示例 -ccode</div><div id='cate'>c&middot;库</div><div id='date'>2010年03月10日 星期三 05:31 P.M.</div><div id='page'>18</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/5b4570c6730d3f109c163dfd.html'>http://hi.baidu.com/hxzon/blog/item/5b4570c6730d3f109c163dfd.html</a><div id='cnt'><p>//minigui 画图程序示例 -ccode</p> 
<p>/* <br /> ** $Id: painter.c,v 1.9 2006/05/10 09:51:33 xwyan Exp $<br /> **<br /> ** Listing 15.1<br /> **<br /> ** painter.c: Sample program for MiniGUI Programming Guide<br /> **&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Painting by using mouse.<br /> **<br /> ** Copyright (C) 2004 ~ 2006 Feynman Software.<br /> **<br /> ** License: GPL<br /> */</p> 
<p>#include &lt;minigui/common.h&gt;<br /> #include &lt;minigui/minigui.h&gt;<br /> #include &lt;minigui/gdi.h&gt;<br /> #include &lt;minigui/window.h&gt;<br /> #include &lt;minigui/control.h&gt;</p> 
<p><br /> static int PainterWinProc(HWND hWnd, int message, WPARAM wParam, LPARAM lParam)<br /> {<br /> &nbsp;&nbsp;&nbsp; HDC hdc;<br /> &nbsp;&nbsp;&nbsp; static BOOL bdraw = FALSE;<br /> &nbsp;&nbsp;&nbsp; static int pre_x, pre_y;</p> 
<p>&nbsp;&nbsp;&nbsp; switch (message) {<br /> &nbsp;&nbsp;&nbsp; //hxzon:left button down<br /> &nbsp;&nbsp;&nbsp; case MSG_LBUTTONDOWN:<br /> &nbsp;&nbsp;&nbsp; //hxzon:This function sets the mouse capture to the specified window hWnd.<br /> &nbsp;&nbsp;&nbsp; //Once a window has captured the mouse, all mouse input is directed to that window,<br /> &nbsp;&nbsp;&nbsp; //regardless of whether the cursor is within the borders of that window.<br /> &nbsp;&nbsp;&nbsp; //Only one window at a time can capture the mouse.<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetCapture(hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bdraw = TRUE;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pre_x = LOWORD (lParam);//hxzon:Returns the low word of the double word .<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pre_y = HIWORD (lParam);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</p> 
<p>&nbsp;&nbsp;&nbsp; case MSG_MOUSEMOVE:<br /> &nbsp;&nbsp;&nbsp; {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int x = LOWORD (lParam);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int y = HIWORD (lParam);</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bdraw) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //hxzon:This function converts the screen coordinates of<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //the specified point (*x,*y) to client coordinates of the specified window hWnd.<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScreenToClient(hWnd, &amp;x, &amp;y);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hdc = GetClientDC(hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPenColor(hdc, PIXEL_red);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MoveTo(hdc, pre_x, pre_y);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LineTo(hdc, x, y);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReleaseDC(hdc);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pre_x = x;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pre_y = y;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp; case MSG_LBUTTONUP:<br /> &nbsp;&nbsp;&nbsp; {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int x = LOWORD (lParam);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int y = HIWORD (lParam);</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bdraw) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScreenToClient(hWnd, &amp;x, &amp;y);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hdc = GetClientDC(hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetPixel (hdc, x, y, PIXEL_red);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReleaseDC(hdc);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bdraw = FALSE;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //hxzon:This function releases the mouse capture from a window and<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //restores normal mouse input processing. A window that has captured<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //the mouse receives all mouse input, regardless of the position of the cursor.<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReleaseCapture();<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp; case MSG_RBUTTONDOWN:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InvalidateRect(hWnd, NULL, TRUE);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</p> 
<p>&nbsp;&nbsp;&nbsp; case MSG_CLOSE:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DestroyAllControls (hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DestroyMainWindow (hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PostQuitMessage (hWnd);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp; return DefaultMainWinProc (hWnd, message, wParam, lParam);<br /> }</p> 
<p>int MiniGUIMain (int args, const char* arg[])<br /> {<br /> &nbsp;&nbsp;&nbsp; MSG Msg;<br /> &nbsp;&nbsp;&nbsp; HWND hMainWnd;<br /> &nbsp;&nbsp;&nbsp; MAINWINCREATE CreateInfo;</p> 
<p>#ifdef _MGRM_PROCESSES<br /> &nbsp;&nbsp;&nbsp; JoinLayer(NAME_DEF_LAYER , &quot;painter&quot; , 0 , 0);<br /> #endif<br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; CreateInfo.dwStyle = WS_VISIBLE | WS_BORDER | WS_CAPTION;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.dwExStyle = WS_EX_NONE;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.spCaption = &quot;Painter&quot;;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.hMenu = 0;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.hCursor = GetSystemCursor(0);<br /> &nbsp;&nbsp;&nbsp; CreateInfo.hIcon = 0;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.MainWindowProc = PainterWinProc;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.lx = 0;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.ty = 0;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.rx = 240;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.by = 320;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.iBkColor = COLOR_lightwhite;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.dwAddData = 0;<br /> &nbsp;&nbsp;&nbsp; CreateInfo.hHosting = HWND_DESKTOP;<br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; hMainWnd = CreateMainWindow (&amp;CreateInfo);<br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; if (hMainWnd == HWND_INVALID)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -1;</p> 
<p>&nbsp;&nbsp;&nbsp; ShowWindow(hMainWnd, SW_SHOWNORMAL);</p> 
<p>&nbsp;&nbsp;&nbsp; while (GetMessage(&amp;Msg, hMainWnd)) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TranslateMessage(&amp;Msg);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DispatchMessage(&amp;Msg);<br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp; MainWindowThreadCleanup (hMainWnd);</p> 
<p>&nbsp;&nbsp;&nbsp; return 0;<br /> }</p> 
<p>#ifndef _LITE_VERSION<br /> #include &lt;minigui/dti.c&gt;<br /> #endif</p> 
<p> </p></div></body></html>