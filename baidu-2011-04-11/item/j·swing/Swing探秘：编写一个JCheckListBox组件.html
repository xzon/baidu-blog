<html><head><title>Swing探秘：编写一个JCheckListBox组件</title></head><body><div id='tit'>Swing探秘：编写一个JCheckListBox组件</div><div id='cate'>j&middot;swing</div><div id='date'>2011年02月15日 星期二 10:23 P.M.</div><div id='page'>1</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/9105a20f09d412feab645789.html'>http://hi.baidu.com/hxzon/blog/item/9105a20f09d412feab645789.html</a><div id='cnt'><p></p>
<p>Swing探秘：编写一个JCheckListBox组件</p> 
<p><span>2010年4月23日</span></p> 
<p>http://twaver.servasoft.com/?p=177</p> 
<p>记得Delphi里面有一个TCheckListBox控件，是一个可打勾的列表。但是这个东西在Swing里面并没有现成的。如今，我们就一起动手制作一个。根据Java的管理，就叫JCheckListBox吧。</p> 
<p>写代码之前，先考虑以下问题：</p> 
<p>继承：当然是从Swing的JList继承。数据扩充：对于JList来说，它是显示了一系列Object。无论其类型如何，都用一个默认的渲染器 （DefaultListCellRenderer，从JLabel继承而来）来画，每个条目的文字用Object.toString()来设置。但是对 于JCheckListBox来说，除了显示文本外，还要考虑每个条目是否被选中，如果选中，要显示“打勾”。所以，JList需要维护“每一个条目是否 选中”的状态信息。我们放在一个boolean数组中。渲染器：默认的Renderer肯定是不行了，无法显示打勾。自然想到用JCheckBox来重新 做一个渲染器，设置到JCheckListBox中。鼠标监听器：现在可以画每个条目了，但还不够，必须能响应鼠标的点击以便Check/UnCheck 才行。所以要在JCheckListBox上加一个鼠标监听器来响应鼠标事件。当然，如果你想让它相应键盘输入（例如Ctrl+A全选）也可如法炮制。 CheckListBoxModel：为了操作方便，这里还从AbstractListModel扩充一个CheckListBoxModel，它能在条 目Check变化时发送事件。 </p> 
<p>好了，由于代码和原理都比较简单，不再赘述，直接给出代码，以及简单注释。</p> 
<pre>import java.awt.*;<br />import java.awt.event.*;<br />import javax.swing.*;<br />import javax.swing.event.*;<br /><br />public class JCheckListBox extends JList {<br />    //这个boolean数组装载所有item是否被check的信息。<br /><br />    private boolean[] checkedItems = null;<br /><br />    /**<br />     * 定义一个简单的ListModel,它可以发送check变化事件。<br />     */<br />    class CheckListBoxModel extends AbstractListModel {<br /><br />        private Object[] items = null;<br /><br />        CheckListBoxModel(Object[] items) {<br />            this.items = items;<br />        }<br /><br />        public int getSize() {<br />            return items.length;<br />        }<br /><br />        public Object getElementAt(int i) {<br />            return items[i];<br />        }<br /><br />        protected void fireCheckChanged(Object source, int index) {<br />            fireContentsChanged(source, index, index);<br />        }<br /><br />        public Object getItem(int index) {<br />            return items[index];<br />        }<br />    }<br /><br />    /**<br />     * 这里就覆盖了一个构造函数。其他JList你自己覆盖吧，反正super一下再init就OK了。<br />     * @param items Object[]<br />     */<br />    public JCheckListBox(Object[] items) {<br />        setModel(new CheckListBoxModel(items));<br />        init();<br />    }<br /><br />    /**<br />     * 初始化控件。包括初始化boolean数组、安装一个渲染器、安装一个鼠标监听器。<br />     */<br />    protected void init() {<br />        checkedItems = new boolean[this.getModel().getSize()];<br />        class MyCellRenderer extends JCheckBox implements ListCellRenderer {<br /><br />            public MyCellRenderer() {<br />                setOpaque(true);<br />            }<br /><br />            public Component getListCellRendererComponent(<br />                    JList list,<br />                    Object value,<br />                    int index,<br />                    boolean isSelected,<br />                    boolean cellHasFocus) {<br />                //这点代码基本上从DefaultListCellRenderer.java中抄袭的。<br />                setComponentOrientation(list.getComponentOrientation());<br />                if (isSelected) {<br />                    setBackground(list.getSelectionBackground());<br />                    setForeground(list.getSelectionForeground());<br />                } else {<br />                    setBackground(list.getBackground());<br />                    setForeground(list.getForeground());<br />                }<br /><br />                if (value instanceof Icon) {<br />                    setIcon((Icon) value);<br />                    setText(&quot;&quot;);<br />                } else {<br />                    setIcon(null);<br />                    setText((value == null) ? &quot;&quot; : value.toString());<br />                }<br />                setEnabled(list.isEnabled());<br />                setFont(list.getFont());<br /><br />                //虽然抄袭，可这里别忘了设置check信息。<br />                this.setSelected(isChecked(index));<br />                return this;<br />            }<br />        }<br /><br />        this.setCellRenderer(new MyCellRenderer());<br />        //定义一个鼠标监听器。如果点击某个item，翻转其check状态。<br />        class CheckBoxListener extends MouseAdapter {<br /><br />            @Override<br />            public void mouseClicked(MouseEvent e) {<br />                int index = locationToIndex(e.getPoint());<br />                invertChecked(index);<br />            }<br />        }<br /><br />        this.addMouseListener(new CheckBoxListener());<br />    }<br /><br />    /**<br />     * 翻转指定item的check状态。<br />     * @param index int<br />     */<br />    public void invertChecked(int index) {<br />        checkedItems[index] = !checkedItems[index];<br />        //别忘了发送event。<br />        CheckListBoxModel model = (CheckListBoxModel) getModel();<br />        model.fireCheckChanged(this, index);<br />        this.repaint();<br />    }<br /><br />    /**<br />     * 是否指定item被check。<br />     * @param index int<br />     * @return boolean<br />     */<br />    public boolean isChecked(int index) {<br />        return checkedItems[index];<br />    }<br /><br />    /**<br />     * 获得选中的item个数<br />     */<br />    public int getCheckedCount() {<br />        int result = 0;<br />        for (int i = 0; i &lt; checkedItems.length; i++) {<br />            if (checkedItems[i]) {<br />                result++;<br />            }<br />        }<br />        return result;<br />    }<br /><br />    /**<br />     * 所有选中item索引的数组。<br />     */<br />    public int[] getCheckedIndices() {<br />        int[] result = new int[getCheckedCount()];<br />        int index = 0;<br />        for (int i = 0; i &lt; checkedItems.length; i++) {<br />            if (checkedItems[i]) {<br />                result[index] = i;<br />                index++;<br />            }<br />        }<br />        return result;<br />    }<br /><br />    public static void main(String[] args) throws Exception {<br /><br />        Font font = new Font(&quot;微软雅黑&quot;, Font.PLAIN, 12);<br /><br />        JFrame frame = new JFrame(&quot;TWaver中文社区之Swing探秘&quot;);<br /><br />        final JCheckListBox list = new JCheckListBox(new Object[]{&quot;张三&quot;, &quot;李四&quot;, &quot;王二麻子&quot;, &quot;木头六&quot;,&quot;小七子&quot;});<br />        list.setFont(font);<br />        frame.getContentPane().add(new JScrollPane(list), BorderLayout.CENTER);<br />        JButton button = new JButton(&quot;OK&quot;);<br />        button.addActionListener(new ActionListener() {<br /><br />            public void actionPerformed(ActionEvent e) {<br />                System.exit(0);<br />            }<br />        });<br />        frame.getContentPane().add(button, BorderLayout.SOUTH);<br />        final JLabel label = new JLabel(&quot;当前没有选择。&quot;);<br />        label.setFont(font);<br />        list.getModel().addListDataListener(new ListDataListener() {<br /><br />            public void intervalAdded(ListDataEvent e) {<br />            }<br /><br />            public void intervalRemoved(ListDataEvent e) {<br />            }<br /><br />            public void contentsChanged(ListDataEvent e) {<br />                if (list.getCheckedCount() == 0) {<br />                    label.setText(&quot;当前没有选择。&quot;);<br />                } else {<br />                    String text = &quot;当前选择:&quot;;<br />                    int[] indices = list.getCheckedIndices();<br />                    for (int i = 0; i &lt; indices.length; i++) {<br />                        text += ((CheckListBoxModel) list.getModel()).getItem(indices[i]).toString() + &quot;,&quot;;<br />                    }<br />                    label.setText(text);<br />                }<br />            }<br />        });<br />        frame.getContentPane().add(label, BorderLayout.NORTH);<br />        frame.setBounds(300, 300, 400, 200);<br />        frame.setVisible(true);<br />    }<br />}</pre>
<p>运行效果如下图：<br /><img src="image/Swing探秘：编写一个JCheckLi.ca433f01ec8b515c7aec2cd6.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/ca433f01ec8b515c7aec2cd6.jpg</p></p> 
<p>&nbsp;</p> 
<p>&nbsp;</p></div></body></html>