<html><head><title>Struts 2 REST Plugin</title></head><body><div id='tit'>Struts 2 REST Plugin</div><div id='cate'>j&middot;web</div><div id='date'>2009年03月31日 星期二 02:17 A.M.</div><div id='page'>59</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/9f4d30d15e71f3309a502776.html'>http://hi.baidu.com/hxzon/blog/item/9f4d30d15e71f3309a502776.html</a><div id='cnt'><p> </p> 
<p>Struts 2 REST Plugin</p> 
<div style="margin: 0px 10px" class="smalltext">
 Apache Struts 2 Documentation
</div> 
<div style="margin: 0px 10px 8px" class="pagetitle"> 
 <p>REST Plugin</p> 
 <p>The REST Plugin simplifies REST-style resources to be consumed by both human and machine clients. The goals are to 100% follow Ruby on Rails-style REST URL conventions and enable XML-free resource development. It builds on the <a title="Convention Plugin" href="http://struts.apache.org/2.1.6/docs/convention-plugin.html">Convention Plugin</a> to support automatic configuration of both actions and results.</p> 
 <p>This Restful action mapper enforces Ruby-On-Rails Rest-style mappings. If the method is not specified (via '!' or 'method:' prefix), the method is &quot;guessed&quot; at using ReST-style conventions that examine the URL and the HTTP method. Special care has been given to ensure this mapper works correctly with the codebehind plugin so that XML configuration is unnecessary.</p> 
 <p> </p> 
 <p>This mapper supports the following parameters:</p> 
 <ul> 
  <li><code><font face="新宋体">struts.mapper.idParameterName</font></code> - If set, this value will be the name of the parameter under which the id is stored. The id will then be removed from the action name. Whether or not the method is specified, the mapper will try to truncate the identifier from the url and store it as a parameter.</li> 
  <li><code><font face="新宋体">struts.mapper.indexMethodName</font></code> - The method name to call for a GET request with no id parameter. Defaults to 'index'.</li> 
  <li><code><font face="新宋体">struts.mapper.getMethodName</font></code> - The method name to call for a GET request with an id parameter. Defaults to 'show'.</li> 
  <li><code><font face="新宋体">struts.mapper.postMethodName</font></code> - The method name to call for a POST request with no id parameter. Defaults to 'create'.</li> 
  <li><code><font face="新宋体">struts.mapper.putMethodName</font></code> - The method name to call for a PUT request with an id parameter. Defaults to 'update'.</li> 
  <li><code><font face="新宋体">struts.mapper.deleteMethodName</font></code> - The method name to call for a DELETE request with an id parameter. Defaults to 'destroy'.</li> 
  <li><code><font face="新宋体">struts.mapper.editMethodName</font></code> - The method name to call for a GET request with an id parameter and the 'edit' view specified. Defaults to 'edit'.</li> 
  <li><code><font face="新宋体">struts.mapper.newMethodName</font></code> - The method name to call for a GET request with no id parameter and the 'new' view specified. Defaults to 'editNew'.</li> 
 </ul> 
 <p>The following URL's will invoke its methods:</p> 
 <ul> 
  <li><code><font face="新宋体">GET: /movies =&gt; method=&quot;index&quot;</font></code></li> 
  <li><code><font face="新宋体">GET: /movies/Thrillers =&gt; method=&quot;show&quot;, id=&quot;Thrillers&quot;</font></code></li> 
  <li><code><font face="新宋体">GET: /movies/Thrillers;edit =&gt; method=&quot;edit&quot;, id=&quot;Thrillers&quot;</font></code></li> 
  <li><code><font face="新宋体">GET: /movies/Thrillers/edit =&gt; method=&quot;edit&quot;, id=&quot;Thrillers&quot;</font></code></li> 
  <li><code><font face="新宋体">GET: /movies/new =&gt; method=&quot;editNew&quot;</font></code></li> 
  <li><code><font face="新宋体">POST: /movies =&gt; method=&quot;create&quot;</font></code></li> 
  <li><code><font face="新宋体">PUT: /movies/Thrillers =&gt; method=&quot;update&quot;, id=&quot;Thrillers&quot;</font></code></li> 
  <li><code><font face="新宋体">DELETE: /movies/Thrillers =&gt; method=&quot;destroy&quot;, id=&quot;Thrillers&quot;</font></code></li> 
 </ul> 
 <p>To simulate the HTTP methods PUT and DELETE, since they aren't supported by HTML, the HTTP parameter &quot;_method&quot; will be used.</p> 
 <p>Or, expressed as a table:</p> 
 <p> </p>
 <table class="confluenceTable FCK__ShowTableBorders"> 
  <tbody> 
   <tr> 
    <th class="confluenceTh">HTTP method</th> 
    <th class="confluenceTh">URI</th> 
    <th class="confluenceTh">Class.method</th> 
    <th class="confluenceTh">parameters</th> 
   </tr> 
   <tr> 
    <td class="confluenceTd">GET</td> 
    <td class="confluenceTd">/movie</td> 
    <td class="confluenceTd">Movie.index</td> 
    <td class="confluenceTd"> </td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">POST</td> 
    <td class="confluenceTd">/movie</td> 
    <td class="confluenceTd">Movie.create</td> 
    <td class="confluenceTd"> </td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">PUT</td> 
    <td class="confluenceTd">/movie/Thrillers</td> 
    <td class="confluenceTd">Movie.update</td> 
    <td class="confluenceTd">id=&quot;Thrillers&quot;</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">DELETE</td> 
    <td class="confluenceTd">/movie/Thrillers</td> 
    <td class="confluenceTd">Movie.destroy</td> 
    <td class="confluenceTd">id=&quot;Thrillers&quot;</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">GET</td> 
    <td class="confluenceTd">/movie/Thrillers</td> 
    <td class="confluenceTd">Movie.show</td> 
    <td class="confluenceTd">id=&quot;Thrillers&quot;</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">GET</td> 
    <td class="confluenceTd">/movie/Thrillers/edit</td> 
    <td class="confluenceTd">Movie.edit</td> 
    <td class="confluenceTd">id=&quot;Thrillers&quot;</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd">GET</td> 
    <td class="confluenceTd">/movie/new</td> 
    <td class="confluenceTd">Movie.editNew</td> 
    <td class="confluenceTd"> </td> 
   </tr> 
  </tbody> 
 </table>  
 <p>In addition to being a REST-style URL mapper, this plugin provides built-in support for multiple content types, switchable through the URL extension. In this way, a single resource can be exposed as multiple content types without any extra work.</p> 
 <p>For example, by exposing an &quot;orders&quot; resource, clients can immediately access it via:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-java">http:<span class="code-comment">//my.company.com/myapp/orders/1
</span>http:<span class="code-comment">//my.company.com/myapp/orders/1.xml
</span>http:<span class="code-comment">//my.company.com/myapp/orders/1.xhtml
</span>http:<span class="code-comment">//my.company.com/myapp/orders/1.json</span></pre> 
  </div> 
 </div> 
 <p>The REST plugin automatically handles serialization to, and deserialization from, each format.</p> 
 <h2><a name="RESTPlugin-Features"></a>Features</h2> 
 <ul> 
  <li>Fully implements Ruby on Rails REST-style URLs</li> 
  <li>Supports XML-free development, without requiring annotations</li> 
  <li>Built-in serialization and deserialization support for XML and JSON</li> 
  <li>Automatic error handling</li> 
  <li>Type-safe configuration of the HTTP response</li> 
  <li>Automatic conditional GET support</li> 
 </ul> 
 <h2><a name="RESTPlugin-Usage"></a>Usage</h2> 
 <p>Create Java objects ending in &quot;Controller&quot; in the configured package. The &quot;Controller&quot; suffix is used to distinguish REST action resources from regular Struts 2 actions, although it is completely optional and they are functionally the same. Now, add in methods to handle the various requests. For example, the following resource action will support <tt><font face="新宋体">/orders/34</font></tt> GET and PUT requests:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-java"><span class="code-keyword">package</span> org.apache.struts2.<span class="code-keyword">rest</span>.example;

<span class="code-keyword">public</span> class OrdersController <span class="code-keyword">implements</span> ModelDriven&lt;Order&gt; {

    <span class="code-keyword">private</span> OrderManager orderManager;
    <span class="code-keyword">private</span> <span class="code-object">String</span> id;
    <span class="code-keyword">private</span> Order model;

    <span class="code-comment">// Handles /orders/{id} GET requests
</span>    <span class="code-keyword">public</span> HttpHeaders show() {
        model = orderManager.findOrder(id);
        <span class="code-keyword">return</span> <span class="code-keyword">new</span> DefaultHttpHeaders(<span class="code-quote">&quot;show&quot;</span>)
            .withETag(model.getUniqueStamp())
            .lastModified(model.getLastModified());
    }

    <span class="code-comment">// Handles /orders/{id} PUT requests
</span>    <span class="code-keyword">public</span> <span class="code-object">String</span> update() {
        orderManager.updateOrder(model);
        <span class="code-keyword">return</span> <span class="code-quote">&quot;update&quot;</span>;
    }

    <span class="code-comment">// getters and setters
</span>}</pre> 
  </div> 
 </div> 
 <p>In this example, the <tt><font face="新宋体">ModelDriven</font></tt> interface is used to ensure that only my model, the Order object in this case, is returned to the client, otherwise, the whole <tt><font face="新宋体">OrdersController</font></tt> object would be serialized.</p> 
 <p>You may wonder why the <tt><font face="新宋体">show()</font></tt> method returns a <tt><font face="新宋体">HttpHeaders</font></tt> object and the <tt><font face="新宋体">update()</font></tt> method returns the expected result code String. The REST Plugin adds support for action methods that return <tt><font face="新宋体">HttpHeaders</font></tt> objects as a way for the action to have more control over the response. In this example, we wanted to ensure the response included the ETag header and a last modified date so that the information will be cached properly by the client. The <tt><font face="新宋体">HttpHeaders</font></tt> object is a convenient way to control the response in a type-safe way.</p> 
 <p>Also, notice we aren't returning the usual &quot;success&quot; result code in either method. This allows us to use the special features of the <a title="Codebehind Plugin" href="http://struts.apache.org/2.1.6/docs/codebehind-plugin.html">Codebehind Plugin</a> to intuitively select the result template to process when this resource is accessed with the <tt><font face="新宋体">.xhtml</font></tt> extension. In this case, we can provide a customized XHTML view of the resource by creating <tt><font face="新宋体">/orders-show.jsp</font></tt> and <tt><font face="新宋体">/orders-update.jsp</font></tt> for the respective methods.</p> 
 <h4><a name="RESTPlugin-CustomContentTypeHandlers"></a>Custom ContentTypeHandlers</h4> 
 <p>If you need to handle extensions that aren't supported by the default handlers, you can create your own <tt><font face="新宋体">ContentTypeHandler</font></tt> implementation and define it in your <tt><font face="新宋体">struts.xml</font></tt>:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-xml"><span class="code-tag">&lt;bean name=<span class="code-quote">&quot;yaml&quot;</span> type=<span class="code-quote">&quot;org.apache.struts2.rest.handler.ContentTypeHandler&quot;</span> class=<span class="code-quote">&quot;com.mycompany.MyYamlContentHandler&quot;</span> /&gt;</span></pre> 
  </div> 
 </div> 
 <p>If the built-in content type handlers don't do what you need, you can override the handling of any extension by providing an alternate handler. First, define your own <tt><font face="新宋体">ContentTypeHandler</font></tt> and declare with its own alias. For example:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-xml"><span class="code-tag">&lt;bean name=<span class="code-quote">&quot;myXml&quot;</span> type=<span class="code-quote">&quot;org.apache.struts2.rest.handler.ContentTypeHandler&quot;</span> class=<span class="code-quote">&quot;com.mycompany.MyXmlContentHandler&quot;</span> /&gt;</span></pre> 
  </div> 
 </div> 
 <p>Then, tell the REST Plugin to override the handler for the desired extension with yours. In <tt><font face="新宋体">struts.properties</font></tt>, it would look like this:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-java">struts.<span class="code-keyword">rest</span>.handlerOverride.xml=myXml</pre> 
  </div> 
 </div> 
 <h4><a name="RESTPlugin-struts.xml"></a>struts.xml</h4> 
 <p>Because the REST plugin uses the Convention plugin, some settings need to be set in struts.xml:</p> 
 <div class="code"> 
  <div class="codeContent"> 
   <pre class="code-xml"><span class="code-tag">&lt;constant name=<span class="code-quote">&quot;struts.convention.action.suffix&quot;</span> value=<span class="code-quote">&quot;Controller&quot;</span>/&gt;</span>
<span class="code-tag">&lt;constant name=<span class="code-quote">&quot;struts.convention.action.mapAllMatches&quot;</span> value=<span class="code-quote">&quot;true&quot;</span>/&gt;</span>
<span class="code-tag">&lt;constant name=<span class="code-quote">&quot;struts.convention.default.parent.package&quot;</span> value=<span class="code-quote">&quot;rest-default&quot;</span>/&gt;</span>
<span class="code-tag">&lt;constant name=<span class="code-quote">&quot;struts.convention.package.locators&quot;</span> value=<span class="code-quote">&quot;example&quot;</span>/&gt;</span></pre> 
  </div> 
 </div> 
 <h2><a name="RESTPlugin-Example"></a>Example</h2> 
 <p>The plugin ships with a <tt><font face="新宋体">struts2-rest-showcase</font></tt> application that demonstrates a simple REST web program.</p> 
 <h2><a name="RESTPlugin-Settings"></a>Settings</h2> 
 <p>The following settings can be customized. See the <span class="nobr"><a title="Visit page outside Confluence" rel="nofollow" href="http://struts.apache.org/2.1.6/docs/configuration-files.html">developer guide<sup><img class="rendericon" border="0" align="absMiddle" width="7" height="7" src="image/Struts 2 REST Plugin.linkext7.gif" /><p class="origImg">http://cwiki.apache.org/confluence/images/icons/linkext7.gif</p></sup></a></span>.<br /> For more configuration options see the <a title="Convention Plugin" href="http://struts.apache.org/2.1.6/docs/convention-plugin.html">Convention Plugin Documentation</a></p> 
 <p> </p>
 <table class="confluenceTable FCK__ShowTableBorders"> 
  <tbody> 
   <tr> 
    <th class="confluenceTh">Setting</th> 
    <th class="confluenceTh">Description</th> 
    <th class="confluenceTh">Default</th> 
    <th class="confluenceTh">Possible Values</th> 
   </tr> 
   <tr> 
    <td class="confluenceTd"><tt><font face="新宋体">struts.rest.handlerOverride.EXTENSION</font></tt></td> 
    <td class="confluenceTd">The alias for the <tt><font face="新宋体">ContentTypeHandler</font></tt> implementation that handles the EXTENSION value</td> 
    <td class="confluenceTd">N/A</td> 
    <td class="confluenceTd">Any declared alias for a <tt><font face="新宋体">ContentTypeHandler</font></tt> implementation</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd"><tt><font face="新宋体">struts.rest.defaultExtension</font></tt></td> 
    <td class="confluenceTd">The default extension to use when none is explicitly specified in the request</td> 
    <td class="confluenceTd"><tt><font face="新宋体">xml</font></tt></td> 
    <td class="confluenceTd">Any extension</td> 
   </tr> 
   <tr> 
    <td class="confluenceTd"><tt><font face="新宋体">struts.rest.validationFailureStatusCode</font></tt></td> 
    <td class="confluenceTd">The HTTP status code to return on validation failure</td> 
    <td class="confluenceTd"><tt><font face="新宋体">400</font></tt></td> 
    <td class="confluenceTd">Any HTTP status code as an integer</td> 
   </tr> 
  </tbody> 
 </table>  
 <h2><a name="RESTPlugin-Installation"></a>Installation</h2> 
 <p>This plugin can be installed by copying the plugin jar into your application's <tt><font face="新宋体">/WEB-INF/lib</font></tt> directory. The REST plugin is dependent on the <a title="Convention Plugin" href="http://struts.apache.org/2.1.6/docs/convention-plugin.html">Convention Plugin</a>, so if aren't using a build system that supports transitive dependencies like Maven 2, you will need to add that plugin as well.</p> 
 <h2><a name="RESTPlugin-Resources"></a>Resources</h2> 
 <ul> 
  <li><span class="nobr"><a title="Visit page outside Confluence" rel="nofollow" href="http://www.b-simple.de/documents">http://www.b-simple.de/documents<sup><img class="rendericon" border="0" align="absMiddle" width="7" height="7" src="image/Struts 2 REST Plugin.linkext7.gif" /><p class="origImg">http://cwiki.apache.org/confluence/images/icons/linkext7.gif</p></sup></a></span> - Short RESTful Rails tutorial (PDF, multiple languages)</li> 
  <li><span class="nobr"><a title="Visit page outside Confluence" rel="nofollow" href="http://www.amazon.com/RESTful-Web-Services-Leonard-Richardson/dp/0596529260">RESTful Web Services<sup><img class="rendericon" border="0" align="absMiddle" width="7" height="7" src="image/Struts 2 REST Plugin.linkext7.gif" /><p class="origImg">http://cwiki.apache.org/confluence/images/icons/linkext7.gif</p></sup></a></span> - Highly recommend book from O'Reilly</li> 
  <li><span class="nobr"><a title="Visit page outside Confluence" rel="nofollow" href="http://raibledesigns.com/rd/entry/go_light_with_apache_struts">Go Light with Apache Struts 2 and REST<sup><img class="rendericon" border="0" align="absMiddle" width="7" height="7" src="image/Struts 2 REST Plugin.linkext7.gif" /><p class="origImg">http://cwiki.apache.org/confluence/images/icons/linkext7.gif</p></sup></a></span> - Presentation by Don Brown at ApacheCon US 2008</li> 
 </ul> 
 <h2><a name="RESTPlugin-VersionHistory"></a>Version History</h2> 
 <p>From Struts 2.1.1+</p> 
</div></div></body></html>