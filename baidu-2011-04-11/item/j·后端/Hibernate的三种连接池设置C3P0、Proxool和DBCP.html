<html><head><title>Hibernate的三种连接池设置C3P0、Proxool和DBCP</title></head><body><div id='tit'>Hibernate的三种连接池设置C3P0、Proxool和DBCP</div><div id='cate'>j&middot;后端</div><div id='date'>2009年04月22日 星期三 10:00 P.M.</div><div id='page'>55</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/db925543e79e32199213c67b.html'>http://hi.baidu.com/hxzon/blog/item/db925543e79e32199213c67b.html</a><div id='cnt'><h2>数据库连接池的选型：DBCP vs C3P0</h2> 
<p><span class="postbody"><font size="2">早上在JavaEye看到Robbin说： <br /> </font></span> </p>
<table class="FCK__ShowTableBorders" border="0" cellspacing="1" cellpadding="3" width="90%" align="center"> 
 <tbody> 
  <tr> 
   <td><span class="genmed"><strong><font size="2">引用:</font></strong></span></td> 
  </tr> 
  <tr> 
   <td class="quote"><br /> DBCP的bug非常多，因此Hibernate3已经不再支持DBCP连接池，而推荐使用C3PO。建议你更换数据库连接池。</td> 
  </tr> 
 </tbody> 
</table> 
<span class="postbody"><br /> <br /> <font size="2">然后跑去Hibernate官方论坛看，果然，在</font><a class="postlink" target="_blank" href="http://forum.hibernate.org/viewtopic.php?t=931132"><font color="#5493b4" size="2">Please migrate away from DBCP</font></a><font size="2">看到Gavin说： <br /> </font></span> 
<table class="FCK__ShowTableBorders" border="0" cellspacing="1" cellpadding="3" width="90%" align="center"> 
 <tbody> 
  <tr> 
   <td><span class="genmed"><strong><font size="2">引用:</font></strong></span></td> 
  </tr> 
  <tr> 
   <td class="quote">Guys, after many problems with DBCP, I have decided to remove built-in support for DBCP from Hibernate3, and deprecate DBCP in Hibernate 2.1. I advise everyone to migrate away from DBCP to something that actually works, like C3P0 or Proxool. <br /> <br /> (If you /must/ use DBCP, you can always write your own connection provider.) <br /> <br /> Actually, it is probably about time we remove any remaining dependencies to Apache commons stuff, since historically they have caused just /so/ much trouble. The only Apache things that do seem to work very well are Ant and log4j. Even commons-logging is a PIA, especially in Tomcat.</td> 
  </tr> 
 </tbody> 
</table> 
<span class="postbody"><br /> <br /> <font size="2">这个台湾Guy也是如此</font><a class="postlink" target="_blank" href="http://www.softleader.com.tw:8668/space/2003-08-28"><font color="#5493b4" size="2">建议</font></a><font size="2">： <br /> </font></span> 
<table class="FCK__ShowTableBorders" border="0" cellspacing="1" cellpadding="3" width="90%" align="center"> 
 <tbody> 
  <tr> 
   <td><span class="genmed"><strong><font size="2">引用:</font></strong></span></td> 
  </tr> 
  <tr> 
   <td class="quote">挑選觀念: 是否認為 jakarta 是唯一選擇 <br /> 是的話, 採用 commons-dbcp ; 不是的話, 採用 proxool / c3p0</td> 
  </tr> 
 </tbody> 
</table> 
<span class="postbody"><br /> <br /> <span class="postbody"><font size="2">Jakarta-commons社区对Hibernate官方不支持DBCP的应对： <br /> </font><a class="postlink" target="_blank" href="http://wiki.apache.org/jakarta-commons/DBCP/Hibernate"><font color="#5493b4" size="2">http://wiki.apache.org/jakarta-commons/DBCP/Hibernate</font></a><br /> ==========================<br /> <a href="http://bbs.tech.ccidnet.com/simple/index.php?t230170.html"><strong>Hibernate的三种连接池设置C3P0、Proxool和DBCP</strong></a></span></span> 
<span class="postbody"><span class="postbody"> <p>以下三种连接都是以连接MySQl为例。 <br /> <br /> &lt;!-- JDBC驱动程序 --&gt; <br /> &lt;property name=&quot;connection.driver_class&quot;&gt;com.mysql.jdbc.Driver&lt;/property&gt; &lt;property name=&quot;connection.url&quot;&gt;jdbc:mysql://localhost:3306/struts?useUnicode=true&amp;characterEncoding=GBK&lt;/property&gt; &lt;!-- 数据库用户名 --&gt; <br /> &lt;property name=&quot;connection.username&quot;&gt;root&lt;/property&gt; &lt;!-- 数据库密码 --&gt; <br /> &lt;property name=&quot;connection.password&quot;&gt;8888&lt;/property&gt; <br /> <br /> 上 面的一段配置，在c3p0和dbcp中，都是必需的，因为hibernate会根据上述的配置来生成connections，再交给c3p0或dbcp管 理.但是，proxool则不能，虽然说服文档上说proxool也可以和hibernate结合,但我按照官方文档上的说明怎么配也出错，而且，到了 sun和hibernat有的官方网站上问了几天，都没有一个人回复。后来我只能让proxool自身来生成连接，这在下面再讲。 <br /> <br /> <br /> 1 C3P0 <br /> <br /> 只需在hibernate.cfg.xml中加入 <br /> &lt;property name=&quot;c3p0.min_size&quot;&gt;5&lt;/property&gt; <br /> &lt;property name=&quot;c3p0.max_size&quot;&gt;30&lt;/property&gt; <br /> &lt;property name=&quot;c3p0.time_out&quot;&gt;1800&lt;/property&gt; <br /> &lt;property name=&quot;c3p0.max_statement&quot;&gt;50&lt;/property&gt; <br /> <br /> 还有在classespath中加入c3p0-0.8.4.5.jar <br /> <br /> <br /> 2 dbcp <br /> <br /> 在hibernate.cfg.xml中加入 <br /> <br /> &lt;property name=&quot;dbcp.maxActive&quot;&gt;100&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.whenExhaustedAction&quot;&gt;1&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.maxWait&quot;&gt;60000&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.maxIdle&quot;&gt;10&lt;/property&gt; <br /> <br /> &lt;property name=&quot;dbcp.ps.maxActive&quot;&gt;100&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.ps.whenExhaustedAction&quot;&gt;1&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.ps.maxWait&quot;&gt;60000&lt;/property&gt; <br /> &lt;property name=&quot;dbcp.ps.maxIdle&quot;&gt;10&lt;/property&gt; <br /> <br /> 还有在classespath中加入commons-pool-1.2.jar 和commons-dbcp-1.2.1.jar. <br /> <br /> <br /> 3 proxool <br /> <br /> 由于数据库connection在较长时间没有访问下会自动断开连接，导致浏览出错，增加proxool作为数据库pool。它有自动连接功能。 <br /> 1)、从<a href="http://proxool.sourceforge.net/">http://proxool.sourceforge.net/</a>下载proxool，释放proxool.jar到WEB-INF/lib <br /> <br /> 2)、在hibernate.cfg.xml中增加： <br /> &lt;property name=&quot;hibernate.proxool.pool_alias&quot;&gt;dbpool&lt;/property&gt; <br /> &lt;property name=&quot;hibernate.proxool.xml&quot;&gt;proxool.xml&lt;/property&gt; <br /> &lt;property name=&quot;connection.provider_class&quot;&gt;org.hibernate.connection.ProxoolConnectionProvider&lt;/property&gt; <br /> <br /> 3)、在与hibernate.cfg.xml同级目录（src根目录下）增加proxool.xml文件： <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; <br /> &lt;!-- the proxool configuration can be embedded within your own application's. <br /> Anything outside the &quot;proxool&quot; tag is ignored. --&gt; <br /> &lt;something-else-entirely&gt; <br /> &lt;proxool&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;alias&gt;dbpool&lt;/alias&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;!--proxool只能管理由自己产生的连接--&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;driver-url&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jdbc:mysql://127.0.0.1:3306/wlsh?characterEncoding=GBK&amp;useUnicode=true&amp;autoReconnect=true&nbsp;&nbsp;&nbsp;&nbsp; &lt;/driver-url&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;driver-properties&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;user&quot; value=&quot;root&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/driver-properties&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;!-- proxool自动侦察各个连接状态的时间间隔(毫秒),侦察到空闲的连接就马上回收,超时的销毁--&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;house-keeping-sleep-time&gt;90000&lt;/house-keeping-sleep-time&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;!-- 最少保持的空闲连接数--&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;prototype-count&gt;5&lt;/prototype-count&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;!-- 允许最大连接数,超过了这个连接，再有请求时，就排在队列中等候，最大的等待请求数由maximum-new-connections决定--&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;maximum-connection-count&gt;100&lt;/maximum-connection-count&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;!-- 最小连接数--&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;minimum-connection-count&gt;10&lt;/minimum-connection-count&gt; <br /> &lt;/proxool&gt; <br /> &lt;/something-else-entirely&gt; <br /> <br /> 4)、重起tomcat <br /> <br /> 在 hibernate3.0中，已经不再支持dbcp了，hibernate的作者在hibernate.org中，明确指出在实践中发现dbcp有 BUG,在某些种情会产生很多空连接不能释放，所以抛弃了对dbcp的支持。proxool不少行家推荐使用.c3p0占用资源比较大，效率也不高.</p> </span></span></div></body></html>