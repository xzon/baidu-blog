<html><head><title>16.1 jasperReports初探 -jasperReports学习笔记 -gcode</title></head><body><div id='tit'>16.1 jasperReports初探 -jasperReports学习笔记 -gcode</div><div id='cate'>j&middot;通用</div><div id='date'>2008年10月18日 星期六 04:32 P.M.</div><div id='page'>90</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/7bfbfe19d898d17cdbb4bd56.html'>http://hi.baidu.com/hxzon/blog/item/7bfbfe19d898d17cdbb4bd56.html</a><div id='cnt'><div>
 16.1 jasperReports初探 -jasperReports学习笔记 -gcode
</div> 
<div>
 --
</div> 
<div>
 jasperReports开源，但是文档收费。
 <br /> jasperReports由一份xml格式的报表设计文件开始，经编译，填充数据，最后导出各种格式的报表文件或预览。
 <br /> iReport.exe能以所见即所得方式制作报表定义文件。
 <br /> ===========================
 <br /> 一，报表定义文件（这里为静态文件）.jrxml
 <br /> 二，编译成二进制文件.jasper（JasperCompileManager）
 <br /> 三，填充.jsprint（JasperFillManager）
 <br /> 四，生成的.jsprint可以用JRViewer浏览报表，JRViewer继承了JPanel，包含了报表打印按钮
 <br /> 五，导出为各种格式（JasperExportManager）
 <br /> 导出生成excel文件，需要使用poi项目。
 <br /> 导出生成pdf文件，需要使用iText项目。
 <br /> =================================
 <br /> 一，static.jrxml--
 <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;GB2312&quot;?&gt;
 <br /> &lt;!-- Created with iReport - A designer for JasperReports --&gt;
 <br /> &lt;!DOCTYPE jasperReport PUBLIC &quot;//JasperReports//DTD Report Design//EN&quot; &quot;http://jasperreports.sourceforge.net/dtds/jasperreport.dtd&quot;&gt;
 <br /> &lt;jasperReport
 <br /> &nbsp;&nbsp; name=&quot;static&quot;
 <br /> &nbsp;&nbsp; columnCount=&quot;1&quot;
 <br /> &nbsp;&nbsp; printOrder=&quot;Vertical&quot;
 <br /> &nbsp;&nbsp; orientation=&quot;Portrait&quot;
 <br /> &nbsp;&nbsp; pageWidth=&quot;595&quot;
 <br /> &nbsp;&nbsp; pageHeight=&quot;842&quot;
 <br /> &nbsp;&nbsp; columnWidth=&quot;535&quot;
 <br /> &nbsp;&nbsp; columnSpacing=&quot;0&quot;
 <br /> &nbsp;&nbsp; leftMargin=&quot;30&quot;
 <br /> &nbsp;&nbsp; rightMargin=&quot;30&quot;
 <br /> &nbsp;&nbsp; topMargin=&quot;20&quot;
 <br /> &nbsp;&nbsp; bottomMargin=&quot;20&quot;
 <br /> &nbsp;&nbsp; whenNoDataType=&quot;NoPages&quot;
 <br /> &nbsp;&nbsp; isTitleNewPage=&quot;false&quot;
 <br /> &nbsp;&nbsp; isSummaryNewPage=&quot;false&quot;&gt;
 <br /> &lt;property name=&quot;ireport.scriptlethandling&quot; value=&quot;0&quot; /&gt;
 <br /> &lt;property name=&quot;ireport.encoding&quot; value=&quot;GB2312&quot; /&gt;
 <br /> &lt;import value=&quot;java.util.*&quot; /&gt;
 <br /> &lt;import value=&quot;net.sf.jasperreports.engine.*&quot; /&gt;
 <br /> &lt;import value=&quot;net.sf.jasperreports.engine.data.*&quot; /&gt;
</div> 
<div> 
</div> 
<div>
 <br /> &lt;background&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;0&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/background&gt;
 <br /> &lt;title&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;50&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/title&gt;
 <br /> &lt;pageHeader&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;50&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/pageHeader&gt;
 <br /> &lt;columnHeader&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;53&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;staticText&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;reportElement
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x=&quot;44&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; y=&quot;20&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; width=&quot;165&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; height=&quot;22&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&quot;staticText-2&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;box topBorder=&quot;None&quot; topBorderColor=&quot;#000000&quot; leftBorder=&quot;None&quot; leftBorderColor=&quot;#000000&quot; rightBorder=&quot;None&quot; rightBorderColor=&quot;#000000&quot; bottomBorder=&quot;None&quot; bottomBorderColor=&quot;#000000&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;textElement&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;font pdfFontName=&quot;STSong-Light&quot; size=&quot;14&quot; isBold=&quot;true&quot; pdfEncoding =&quot;UniGB-UCS2-H&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;/textElement&gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;text&gt;&lt;![CDATA[作者已经出版的图书：]]&gt;&lt;/text&gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;/staticText&gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/columnHeader&gt;
 <br /> &lt;detail&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;100&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;staticText&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;reportElement
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x=&quot;44&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; y=&quot;0&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; width=&quot;301&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; height=&quot;100&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forecolor=&quot;#0000CC&quot;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&quot;staticText-1&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;box topBorder=&quot;None&quot; topBorderColor=&quot;#000000&quot; leftBorder=&quot;None&quot; leftBorderColor=&quot;#000000&quot; rightBorder=&quot;None&quot; rightBorderColor=&quot;#000000&quot; bottomBorder=&quot;None&quot; bottomBorderColor=&quot;#000000&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;textElement&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;font fontName=&quot;幼圆&quot; pdfFontName=&quot;STSong-Light&quot; size=&quot;24&quot; isPdfEmbedded =&quot;true&quot; pdfEncoding =&quot;UniGB-UCS2-H&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;/textElement&gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;text&gt;&lt;![CDATA[Spring2.0宝典
 <br /> 轻量级J2EE企业应用实战
 <br /> 基于J2EE的Ajax宝典
</div> 
<div> 
</div> 
<div>
 ]]&gt;&lt;/text&gt;
 <br /> &nbsp;&nbsp;&nbsp; &lt;/staticText&gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/detail&gt;
 <br /> &lt;columnFooter&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;30&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/columnFooter&gt;
 <br /> &lt;pageFooter&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;50&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/pageFooter&gt;
 <br /> &lt;lastPageFooter&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;50&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/lastPageFooter&gt;
 <br /> &lt;summary&gt;
 <br /> &nbsp;&nbsp; &lt;band height=&quot;50&quot; isSplitAllowed=&quot;true&quot; &gt;
 <br /> &nbsp;&nbsp; &lt;/band&gt;
 <br /> &lt;/summary&gt;
 <br /> &lt;/jasperReport&gt;
 <br /> ------------------------
 <br /> 二，MyCompile.java--
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
</div> 
<div> 
</div> 
<div>
 public class MyCompile
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JasperCompileManager.compileReportToFile(&quot;static.jrxml&quot; , &quot;static.jasper&quot;);
 <br /> System.out.println(&quot;成功编译成JasperReport文件(*.jasper)&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> -------------------
 <br /> 三，MyFill.java--
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
</div> 
<div> 
</div> 
<div>
 public class MyFill
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> //填充时，即使没有使用数据源，也必须指定一个新建的JREmptyDataSource实例，而不能直接使用null
 <br /> JasperFillManager.fillReportToFile(&quot;static.jasper&quot; , null , new JREmptyDataSource());
 <br /> System.out.println(&quot;成功填充了一个报表文件(*.jrprint)&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> ---------------------
 <br /> 四，MyJRViewer.java--
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
 <br /> import net.sf.jasperreports.view.*;
</div> 
<div> 
</div> 
<div>
 import javax.swing.JFrame;
 <br /> import java.awt.*;
</div> 
<div> 
</div> 
<div>
 public class MyJRViewer
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JRViewer jr = new JRViewer(&quot;static.jrprint&quot; , false);
 <br /> JFrame jf = new JFrame(&quot;报表预览&quot;);
 <br /> jf.add(jr);
 <br /> jf.pack();
 <br /> jf.setVisible(true);
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> ------------------------------
 <br /> 五1，生成excel--
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
 <br /> import net.sf.jasperreports.engine.export.*;
 <br /> import net.sf.jasperreports.engine.util.*;
</div> 
<div> 
</div> 
<div>
 public class MyExportExcel
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JasperPrint jasperPrint = (JasperPrint)JRLoader.loadObject(&quot;static.jrprint&quot;);
 <br /> JRXlsExporter exporter = new JRXlsExporter();
 <br /> //设置要导出的jasperPrint
 <br /> exporter.setParameter(JRExporterParameter.JASPER_PRINT, jasperPrint);
 <br /> exporter.setParameter(JRExporterParameter.OUTPUT_FILE_NAME, &quot;static.xls&quot;);
 <br /> exporter.setParameter(JRXlsExporterParameter.IS_ONE_PAGE_PER_SHEET, Boolean.TRUE);
 <br /> 
 <br /> exporter.exportReport();
</div> 
<div> 
</div> 
<div>
 System.out.println(&quot;成功创建了一个XML文档&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> -----------------------
 <br /> 五2，生成pdf--
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
</div> 
<div> 
</div> 
<div>
 public class MyExportPdf
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JasperExportManager.exportReportToPdfFile(&quot;static.jrprint&quot; , &quot;static.pdf&quot;);
 <br /> System.out.println(&quot;成功创建了一个PDF文档&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> ------------------------
 <br /> 五3，生成xml
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
</div> 
<div> 
</div> 
<div>
 public class MyExportXml
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JasperExportManager.exportReportToXmlFile(&quot;static.jrprint&quot; , &quot;static.xml&quot; , true);
 <br /> System.out.println(&quot;成功创建了一个XML文档&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> ---------------------------
 <br /> 五4，直接从.jasper生成.pdf
 <br /> package lee;
</div> 
<div> 
</div> 
<div>
 import net.sf.jasperreports.engine.*;
</div> 
<div> 
</div> 
<div>
 public class Jasper2Pdf
 <br /> {
 <br /> &nbsp;&nbsp;&nbsp; public static void main(String[] args) throws Exception
 <br /> &nbsp;&nbsp;&nbsp; {
 <br /> JasperRunManager.runReportToPdfFile(&quot;static.jasper&quot; , &quot;static.pdf&quot; , null , new JREmptyDataSource());
 <br /> System.out.println(&quot;直接从Jasper文件创建一个PDF文档&quot;);
 <br /> System.exit(0);
 <br /> &nbsp;&nbsp;&nbsp; }
 <br /> }
 <br /> ====================================
 <br /> 1，各种文件导出器
 <br /> JRCsvExporter，JRHtmlExporter，JRPdfExporter，JRRtfExporter，JRTextExporter，JRXmlExporter。
 <br /> 2，还有一个导出管理器JasperExportManager，它提供多个静态方法，可以直接导出各种格式。
 <br /> exportReportToHtmlFile，exportReportToPdfFile，exportReportToPdfStream，
 <br /> exportReportToXmlFile，exportReportToXmlStream。
 <br /> 3，还有一个JasperRunManager，可以直接将一个JasperReport实例（内存中）导出生成各种格式文件。
 <br /> 提供如下静态方法。
 <br /> runReportToHtmlFile，runReportToPdfFile，runReportToPdfStream。
 <br /> 4，JasperPrintManager，用于将一个.jrprint文件完成打印。
 <br /> 5，JasperDesign，对应报表定义文件在内存中的形式.jrxml。
 <br /> JasperReport，对应二进制报表文件在内存中的形式.jasper。
 <br /> JasperPrint，对应可显示报表文件在内存中的形式.jrprint。
 <br /> ====================================
 <br /> 中文问题。本例可以正常显示中文，但事实上iText默认不支持中文。我们需要增加iText的亚洲字符支持，即下载iTextAsian.jar，然后在有中文的地方设置中文所使用的Pdf编码，以及pdf字体，如果不设置或设置出错这两个参数，则不能得到含中文的pdf报表。
 <br /> 在static.jrxml中每次中文字符前添加下面的参数设置。
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;textElement&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;font pdfFontName=&quot;STSong-Light&quot; size=&quot;14&quot; isBold=&quot;true&quot; pdfEncoding =&quot;UniGB-UCS2-H&quot;/&gt;
 <br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;/textElement&gt;
 <br /> --
</div></div></body></html>