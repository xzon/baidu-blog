<html><head><title>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</title></head><body><div id='tit'>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</div><div id='cate'>出错&middot;经验</div><div id='date'>2011年01月13日 星期四 11:54 A.M.</div><div id='page'>3</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/9228b4b70b28c2e630add12c.html'>http://hi.baidu.com/hxzon/blog/item/9228b4b70b28c2e630add12c.html</a><div id='cnt'><p></p>
<p>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</p>
<p>tapestry5.2.4</p>
<p>1，定义自己的数据类型名称，如</p>
<pre>package org.hxzon.tapestry5.util;<br /><br />public class TapestryEx {<br /> public static final String DataType_currency = &quot;currency&quot;;<br /> public static final String DataType_day = &quot;date_day&quot;;<br /> public static final String DataType_time = &quot;date_time&quot;;<br /> public static final String DataType_daytime = &quot;date_daytime&quot;;<br /> public static final String DataType_nanotime = &quot;date_nanotime&quot;;<br /><br /> public static String UnitePattern_day = &quot;yyyy-MM-dd&quot;;<br /> public static String UnitePattern_minute = &quot;yyyy-MM-dd, HH:mm&quot;;<br /> public static String UnitePattern_second = &quot;yyyy-MM-dd, HH:mm:ss&quot;;<br /> public static String UnitePattern_nano = &quot;yyyy-MM-dd, HH:mm:ss.SSS&quot;;<br /> public static String UnitePattern_time = UnitePattern_nano;<br />}<br /></pre>
<p>2，在对应的域上用注解表明数据类型</p>
<pre>@DataType(TapestryEx.DataType_currency)
    private BigDecimal totalPrice = BigDecimalUtil.Int0;// 总价

    @DataType(TapestryEx.DataType_currency)
    private BigDecimal accountPaid = BigDecimalUtil.Int0;// 已付款

    @DataType(TapestryEx.DataType_currency)
    private BigDecimal invoicePaid = BigDecimalUtil.Int0;
</pre>
<p>3，注册自己的数据类型，在AppModule.java中添加如下代码</p>
<p>&nbsp;&nbsp;&nbsp; @Contribute(BeanBlockSource.class)<br />&nbsp;&nbsp;&nbsp; public static void provideDefaultBeanBlocks(Configuration&lt;BeanBlockContribution&gt; configuration) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_currency);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_day);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_time);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_daytime);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_nanotime);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; private static void addExDisplayBlock(Configuration&lt;BeanBlockContribution&gt; configuration, String name) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; configuration.add(new DisplayBlockContribution(name, ExPropertyDisplayBlocks.class.getSimpleName(), name));<br />&nbsp;&nbsp;&nbsp; }</p>
<p>4，页面类，只是作为一个block的容器而已。</p>
<pre>package org.hxzon.tapestry5.pages;<br /><br />import java.math.BigDecimal;<br /><br />import org.apache.tapestry5.annotations.Environmental;<br />import org.apache.tapestry5.annotations.Property;<br />import org.apache.tapestry5.services.PropertyOutputContext;<br />import org.hxzon.tapestry5.util.TapestryEx;<br /><br />public class ExPropertyDisplayBlocks {<br /> @Property<br /> @Environmental<br /> private PropertyOutputContext context;<br /><br /> public BigDecimal getCurrencyValue() {<br />  return (BigDecimal) context.getPropertyValue();<br /> }<br /><br /> private String subStringValue(int start, int end) {<br />  try {<br />   String value = (String) context.getPropertyValue();<br />   value = value.substring(start, end);<br />   return value;<br />  } catch (Exception e) {<br />   return &quot;&quot;;<br />  }<br /> }<br /><br /> public String getDayValue() {<br />  return subStringValue(0, TapestryEx.UnitePattern_day.length());<br /> }<br /><br /> public String getTimeValue() {<br />  return subStringValue(TapestryEx.UnitePattern_day.length() + 1, TapestryEx.UnitePattern_second.length());<br /> }<br /><br /> public String getDaytimeValue() {<br />  return subStringValue(0, TapestryEx.UnitePattern_second.length());<br /> }<br /><br /> public String getNanotimeValue() {<br />  return (String) context.getPropertyValue();<br /> }<br />}<br /><br />
</pre>
<pre>&lt;t:container<br />&nbsp;&nbsp;&nbsp; xmlns:t=&quot;http://tapestry.apache.org/schema/tapestry_5_1_0.xsd&quot;&gt;<br /><br />&nbsp;&nbsp;&nbsp; &lt;t:block id=&quot;currency&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;span class=&quot;red&quot;&gt; &lt;t:numberFormatter value=&quot;currencyValue&quot; /&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/span&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br /><br />&nbsp;&nbsp;&nbsp; &lt;t:block id=&quot;date_day&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;t:textoutput value=&quot;dayValue&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br /><br />&nbsp;&nbsp;&nbsp; &lt;t:block id=&quot;date_time&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value=&quot;timeValue&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br /><br />&nbsp;&nbsp;&nbsp; &lt;t:block id=&quot;date_daytime&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value=&quot;daytimeValue&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br /><br />&nbsp;&nbsp;&nbsp; &lt;t:block id=&quot;date_nanotime&quot;&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value=&quot;nanotimeValue&quot;/&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br /><br />&lt;/t:container&gt;

</pre>
<p>&nbsp;</p>
<p>&nbsp;</p></div></body></html>