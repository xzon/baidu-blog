<html><head><title>FCK中文图片上传乱码问题解决办法</title></head><body><div id='tit'>FCK中文图片上传乱码问题解决办法</div><div id='cate'>动手</div><div id='date'>2008年09月25日 星期四 10:09 P.M.</div><div id='page'>96</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/46ba07e9c6249739b80e2db3.html'>http://hi.baidu.com/hxzon/blog/item/46ba07e9c6249739b80e2db3.html</a><div id='cnt'><div class="postTitle">
 <a class="postTitle2" href="http://www.blogjava.net/zhip/archive/2008/07/30/218575.html">FCK中文图片上传乱码问题解决办法</a>
</div> 
<p>在使用FCKeditor2.4.3时若上传的图片或者flash的文件名为中文时，发现一下情况： <br /> 问题1： <br /> 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中选择上传按钮，如果上传的文件名为中文时会出现乱码。 <br /> 解决办法： <br /> 把SimpleUploaderServlet.java做如下修改： <br /> 找到该程序中DiskFileUpload upload = new DiskFileUpload()，然后在该行下面添加 <br /> upload.setHeaderEncoding(&quot;UTF-8&quot;) <br /> 问题2： <br /> 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中使用浏览 <br /> 服务器按钮上传中文文件时会出现乱码。 <br /> 解决办法： <br /> 和问题1的解决办法基本一样，只不过需要在ConnectorServlet.java中添加 <br /> upload.setHeaderEncoding(&quot;UTF-8&quot;)便可。 <br /> 问题3： <br /> 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中点击浏览 <br /> 服务器按钮，会弹出“浏览服务器”页面，如果想在该页面中使用Create New Folder按钮 <br /> 来创建一个中文目录时，会出现中文目录乱码。 <br /> 解决办法： <br /> web容器的编码要与FCKeditor默认的编码UTF-8一致，如果使用的是Tomcat，需修改 <br /> tomcat服务器中conf目录下的server.xml。如下： <br /> &lt;Connector port=&quot;8080&quot; maxHttpHeaderSize=&quot;8192&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; acceptCount=&quot;100&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connectionTimeout=&quot;20000&quot; disableUploadTimeout=&quot;true&quot; URIEncoding=&quot;utf-8&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;Connector port=&quot;8009&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; protocol=&quot;AJP/1.3&quot; URIEncoding=&quot;utf-8&quot;/&gt; <br /> 其实就是在原来的基础上添加URIEncoding的属性值为utf-8。</p> 
<p>在使用FCKeditor2.4.3时若上传的图片或者flash的文件名为中文时，发现一下情况：<br /> 问题1：<br /> 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中选择上传按钮，如果上传的文件名为中文时会出现乱码。<br /> 解决办法：<br /> &nbsp;&nbsp; 找到FCKeditor.java解压包中的src目录下SimpleUploaderServlet.java做如下修改：<br /> &nbsp;&nbsp; 找到该程序中DiskFileUpload upload = new DiskFileUpload()，然后在该行下面添加<br /> upload.setHeaderEncoding(&quot;UTF-8&quot;)，重新编译成class文件并利用WinRAR把该class文件<br /> 添加到FCKeditor-2.3.jar中相应的位置，然后覆盖你的web项目中原来的jar包便可。<br /> 问题2：<br /> &nbsp;&nbsp; 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中使用浏览<br /> 服务器按钮上传中文文件时会出现乱码。<br /> 解决办法：<br /> &nbsp;&nbsp; 和问题1的解决办法基本一样，只不过需要在ConnectorServlet.java中添加<br /> upload.setHeaderEncoding(&quot;UTF-8&quot;)便可。<br /> 问题3：<br /> &nbsp;&nbsp; 当点击“插入/编辑图像”或者“插入/编辑Flash”按钮时，在弹出的对话框中点击浏览<br /> 服务器按钮，会弹出“浏览服务器”页面，如果想在该页面中使用Create New Folder按钮<br /> 来创建一个中文目录时，会出现中文目录乱码。<br /> 解决办法：<br /> &nbsp;&nbsp; web容器的编码要与FCKeditor默认的编码UTF-8一致，如果使用的是Tomcat，需修改<br /> tomcat服务器中conf目录下的server.xml。如下：<br /> &nbsp;&nbsp; &lt;Connector port=&quot;8080&quot; maxHttpHeaderSize=&quot;8192&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; acceptCount=&quot;100&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connectionTimeout=&quot;20000&quot; disableUploadTimeout=&quot;true&quot; URIEncoding=&quot;utf-8&quot; /&gt;<br /> &nbsp;&nbsp;&nbsp; &lt;Connector port=&quot;8009&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; protocol=&quot;AJP/1.3&quot; URIEncoding=&quot;utf-8&quot;/&gt;<br /> 其实就是在原来的基础上添加URIEncoding的属性值为utf-8。<br /> 注：对于问题3，这种解决办法不可取，最好不要去修改服务器的编码，否则会影响到服务器上其它的工程。解决这个编码的问题可以修改源代码或者从新编写一个类来处理。通过观察打开的上传浏览对话框可以找对对应的htm页面和负责处理上传文件名称的com.fredck.FCKeditor.uploader. ConnectorServlet这个类，然后找到对应的参数，转换编码便可。如：String newFolderStr=request.getParameter(&quot;NewFolderName&quot;);</p> 
<p>newFolderStr=new String(newFolderStr.getBytes(&quot;iso8859-1&quot;),&quot;utf-8&quot;);<br /> =================================================================================</p> 
<p>fckeditor如果大家搞定啦1！那一定想到他是没有提供删除功能的！！ <br /> 以下是一段js，放在调用feckeditor的jsp页面 <br /> function FCKeditor_OnComplete( editorInstance ) <br /> { <br /> editorInstance.Events.AttachEvent( 'OnBlur', onEditorBlur ); <br /> }</p> 
<p>function onEditorBlur(){ <br /> var imgs = FCKeditorAPI.GetInstance('EditorDefault').EditorDocument.body.all.tags(&quot;img&quot;); <br /> for(var i=0; i &lt; imgs.length; i++){ <br /> alert(imgs[i].src); <br /> //这里你可以用一个隐匿域来接收这些路径信息 <br /> } <br /> } <br /> 把这些路径信息放置于数据库是的一个字段，删除文档时一起删除，就可以解决图片存留问题 <br /> ========================================================================================<br /> 避免上下滚动条的出现:</p> 
<p><br /> 在fckconfig.js中加入下列2句:</p> 
<p>FCKConfig.Plugins.Add(&nbsp;&nbsp; 'autogrow '&nbsp;&nbsp; )&nbsp;&nbsp; ; <br /> FCKConfig.AutoGrowMax&nbsp;&nbsp; =&nbsp;&nbsp; 4000&nbsp;&nbsp; ;&nbsp;&nbsp; //这是允许自动增长的最大高度限制</p> 
<p>同时请确认fckeditor\editor\plugins\autogrow有这个目录存在，没有的话到官网下载最新版FCK。</p> 
<p><br /> 另外注意FCKConfig.PluginsPath的路径你设置对了没有。<br /> ===========================================================================<br /> FCKConfig.PluginsPath&nbsp;&nbsp; =&nbsp;&nbsp; FCKConfig.BasePath&nbsp;&nbsp; +&nbsp;&nbsp; 'plugins/ '&nbsp;&nbsp; ;</p> 
<p>这个是对的，系统默认的路径，FCK使用也没问题</p> 
<p>就是不能自动调整高度<br /> =============================================================================<br /> FCKConfig.PluginsPath&nbsp;&nbsp; =&nbsp;&nbsp; FCKConfig.BasePath&nbsp;&nbsp; +&nbsp;&nbsp; 'plugins/ '&nbsp;&nbsp; ; <br /> 这是js里的语句。BasePath不是在这设的，是在php里调用FCK时设置的。</p> 
<p>========================================================================<br /> 不行的话是不是你曾经改过FCK的源码。 <br /> 你重新下载文件，只改动这2行测试一下就知道了。别的什么都不用改就可以实现你所说的要求。</p> 
<p>FCKConfig.Plugins.Add(&nbsp;&nbsp; 'autogrow '&nbsp;&nbsp; )&nbsp;&nbsp; ; <br /> FCKConfig.AutoGrowMax&nbsp;&nbsp; =&nbsp;&nbsp; 4000&nbsp;&nbsp; ; <br /> </p> 
<p> </p></div></body></html>