<html><head><title>//ApacheZipUtil ; apache.commons.compress.zip</title></head><body><div id='tit'>//ApacheZipUtil ; apache.commons.compress.zip</div><div id='cate'>复用代码</div><div id='date'>2010年09月02日 星期四 11:18 A.M.</div><div id='page'>9</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/7794b735f29fa585a71e127a.html'>http://hi.baidu.com/hxzon/blog/item/7794b735f29fa585a71e127a.html</a><div id='cnt'><pre>//ApacheZipUtil ; apache.commons.compress.zip<br />//Winzip use ASCII encoding but JDK force UTF8 encoding make Chinese file name wrong,<br />//ZipArchiveOutputStream.setEncoding(&quot;GBK&quot;);以及new ZipFile(zipFilename, &quot;GBK&quot;);<br />//*compress* is a stream based API. It's original code in this component <br />//came from Avalon's Excalibur, but originally from Ant, as far as life in Apache goes. <br />//It has migrated via: Ant -&gt; Avalon-Excalibur -&gt; Commons-IO -&gt; Commons-Compress.<br />package org.hxzon.util;<br /><br />import java.io.File;<br />import java.io.FileInputStream;<br />import java.io.FileOutputStream;<br />import java.io.IOException;<br />import java.io.InputStream;<br />import java.io.OutputStream;<br />import java.util.Enumeration;<br /><br />import org.apache.commons.compress.archivers.ArchiveOutputStream;<br />import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;<br />import org.apache.commons.compress.archivers.zip.ZipArchiveOutputStream;<br />import org.apache.commons.compress.archivers.zip.ZipFile;<br />import org.apache.commons.compress.utils.IOUtils;<br /><br />public class ApacheZipUtil {<br /> public final static String encoding = &quot;GBK&quot;;<br /><br /> public static void zip(String outputFileName, String inputDirectory) {<br />  ZipArchiveOutputStream out;<br />  try {// will create output parent directory<br />   File file = new File(outputFileName);<br />   if (file.exists()) {<br />    if (file.isDirectory()) {<br />     throw new IOException(&quot;File '&quot; + file + &quot;' exists but is a directory&quot;);<br />    }<br />    if (file.canWrite() == false) {<br />     throw new IOException(&quot;File '&quot; + file + &quot;' cannot be written to&quot;);<br />    }<br />   } else {<br />    File parent = file.getParentFile();<br />    if (parent != null &amp;&amp; parent.exists() == false) {<br />     if (parent.mkdirs() == false) {<br />      throw new IOException(&quot;File '&quot; + file + &quot;' could not be created&quot;);<br />     }<br />    }<br />   }<br />   out = new ZipArchiveOutputStream(new FileOutputStream((file)));<br />   out.setEncoding(encoding);<br />   doZip(out, new File(inputDirectory), &quot;&quot;);<br />   out.close();<br />  } catch (Exception e) {<br />   e.printStackTrace();<br />  }<br /> }<br /><br /> public static void zip(String inputDirectory) {<br />  zip(inputDirectory + &quot;.zip&quot;, inputDirectory);<br /> }<br /><br /> private static void doZip(ArchiveOutputStream out, File f, String base) throws Exception {<br />  if (f.isDirectory()) {<br />   File[] fl = f.listFiles();<br />   out.putArchiveEntry(new ZipArchiveEntry(base + &quot;/&quot;));<br />   base = base.length() == 0 ? &quot;&quot; : base + &quot;/&quot;;<br />   for (int i = 0; i &lt; fl.length; i++) {<br />    doZip(out, fl[i], base + fl[i].getName());<br />   }<br />  } else {<br />   out.putArchiveEntry(new ZipArchiveEntry(base));<br />   IOUtils.copy(new FileInputStream(f), out);<br />   out.closeArchiveEntry();<br />  }<br /> }<br /><br /> public static void unzip(String inputFileName) {<br />  int index = inputFileName.lastIndexOf(&quot;.&quot;);<br />  String outputDirectory = inputFileName.substring(0, index);<br />  unzip(inputFileName, outputDirectory);<br /> }<br /><br /> public static void unzip(String outputDirectory, String zipFilename) {<br />  try {<br />   File outFile = new File(outputDirectory);<br />   if (!outFile.exists()) {<br />    outFile.mkdirs();<br />   }<br />   ZipFile zipFile = new ZipFile(zipFilename, encoding);<br />   Enumeration&lt;?&gt; en = zipFile.getEntries();<br />   ZipArchiveEntry zipEntry = null;<br />   while (en.hasMoreElements()) {<br />    zipEntry = (ZipArchiveEntry) en.nextElement();<br />    if (zipEntry.isDirectory()) {<br />     // mkdir directory<br />     String dirName = zipEntry.getName();<br />     dirName = dirName.substring(0, dirName.length() - 1);<br />     File f = new File(outFile.getPath() + &quot;/&quot; + dirName);<br />     f.mkdirs();<br />    } else {<br />     // unzip file<br />     File f = new File(outFile.getPath() + &quot;/&quot; + zipEntry.getName());<br />//     f.createNewFile();<br />     InputStream in = zipFile.getInputStream(zipEntry);<br />     OutputStream out = new FileOutputStream(f);<br />     IOUtils.copy(in, out);<br />     out.close();<br />     in.close();<br />    }<br />   }<br />   zipFile.close();<br />  } catch (Exception e) {<br />   e.printStackTrace();<br />  }<br /> }<br /><br /> public static void main(String[] temp) {<br />  ApacheZipUtil.zip(&quot;d:/mkys/byy.zip&quot;, &quot;D:/export&quot;);// 你要压缩的文件夹<br />  ApacheZipUtil.unzip(&quot;d:/ddds/byy&quot;, &quot;d:/mkys/byy.zip&quot;);<br /> }<br />}</pre> 
<p> </p></div></body></html>