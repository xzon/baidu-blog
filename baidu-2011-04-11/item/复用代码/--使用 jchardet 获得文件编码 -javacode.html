<html><head><title>//使用 jchardet 获得文件编码 -javacode</title></head><body><div id='tit'>//使用 jchardet 获得文件编码 -javacode</div><div id='cate'>复用代码</div><div id='date'>2009年09月08日 星期二 00:41 A.M.</div><div id='page'>31</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/f2b8b51bfa5101108618bfd1.html'>http://hi.baidu.com/hxzon/blog/item/f2b8b51bfa5101108618bfd1.html</a><div id='cnt'><p> </p> 
<p>//使用 jchardet 获得文件编码 -javacode<br /> //当含中文的文件用ANSI编码保存时，检测还是出错。</p> 
<p>package org.mozilla.intl.chardet;</p> 
<p>import java.io.BufferedInputStream;<br /> import java.io.File;<br /> import java.io.FileInputStream;<br /> import java.io.FileNotFoundException;<br /> import java.io.IOException;</p> 
<p>/**<br /> * 借助JCharDet获取文件字符集<br /> * @author icer<br /> * PS:<br /> * JCharDet 是mozilla自动字符集探测算法代码的java移植，其官方主页为：<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://jchardet.sourceforge.net/">http://jchardet.sourceforge.net/</a><br /> * @date 2008/11/13 <br /> */<br /> public class FileCharsetDetector {</p> 
<p> private boolean found = false;</p> 
<p> /**<br /> * 如果完全匹配某个字符集检测算法, 则该属性保存该字符集的名称. 否则(如二进制文件)其值就为默认值 null, 这时应当查询属性 <br /> */<br /> private String encoding = null;</p> 
<p> public static void main(String[] argv) throws Exception {<br /> &nbsp;&nbsp; if (argv.length != 1 &amp;&amp; argv.length != 2) {</p> 
<p>&nbsp;&nbsp;&nbsp; System.out<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .println(&quot;Usage: FileCharsetDetector &lt;path&gt; [&lt;languageHint&gt;]&quot;);</p> 
<p>&nbsp;&nbsp;&nbsp; System.out.println(&quot;&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;Where &lt;path&gt; is d:/demo.txt&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;For optional &lt;languageHint&gt;. Use following...&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 1 =&gt; Japanese&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 2 =&gt; Chinese&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 3 =&gt; Simplified Chinese&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 4 =&gt; Traditional Chinese&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 5 =&gt; Korean&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;&nbsp;&nbsp; 6 =&gt; Dont know (default)&quot;);</p> 
<p>&nbsp;&nbsp;&nbsp; return;<br /> &nbsp;&nbsp; } else {<br /> &nbsp;&nbsp;&nbsp; String encoding = null;<br /> &nbsp;&nbsp;&nbsp; if (argv.length == 2) {<br /> &nbsp;&nbsp;&nbsp;&nbsp; encoding = new FileCharsetDetector().guestFileEncoding(argv[0],<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integer.valueOf(argv[1]));<br /> &nbsp;&nbsp;&nbsp; } else {<br /> &nbsp;&nbsp;&nbsp;&nbsp; encoding = new FileCharsetDetector().guestFileEncoding(argv[0]);<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;文件编码:&quot; + encoding);<br /> &nbsp;&nbsp; }<br /> }</p> 
<p> /**<br /> * 传入一个文件(File)对象，检查文件编码<br /> * <br /> * @param file<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File对象实例<br /> * @return 文件编码，若无，则返回null<br /> * @throws FileNotFoundException<br /> * @throws IOException<br /> */<br /> public String guestFileEncoding(File file) throws FileNotFoundException,<br /> &nbsp;&nbsp;&nbsp; IOException {<br /> &nbsp;&nbsp; return geestFileEncoding(file, new nsDetector());<br /> }</p> 
<p> /**<br /> * 获取文件的编码<br /> * <br /> * @param file<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File对象实例<br /> * @param languageHint<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 语言提示区域代码 eg：1 : Japanese; 2 : Chinese; 3 : Simplified Chinese;<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 : Traditional Chinese; 5 : Korean; 6 : Dont know (default)<br /> * @return 文件编码，eg：UTF-8,GBK,GB2312形式，若无，则返回null<br /> * @throws FileNotFoundException<br /> * @throws IOException<br /> */<br /> public String guestFileEncoding(File file, int languageHint)<br /> &nbsp;&nbsp;&nbsp; throws FileNotFoundException, IOException {<br /> &nbsp;&nbsp; return geestFileEncoding(file, new nsDetector(languageHint));<br /> }</p> 
<p> /**<br /> * 获取文件的编码<br /> * <br /> * @param path<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 文件路径<br /> * @return 文件编码，eg：UTF-8,GBK,GB2312形式，若无，则返回null<br /> * @throws FileNotFoundException<br /> * @throws IOException<br /> */<br /> public String guestFileEncoding(String path) throws FileNotFoundException,<br /> &nbsp;&nbsp;&nbsp; IOException {<br /> &nbsp;&nbsp; return guestFileEncoding(new File(path));<br /> }</p> 
<p> /**<br /> * 获取文件的编码<br /> * <br /> * @param path<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 文件路径<br /> * @param languageHint<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 语言提示区域代码 eg：1 : Japanese; 2 : Chinese; 3 : Simplified Chinese;<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 : Traditional Chinese; 5 : Korean; 6 : Dont know (default)<br /> * @return<br /> * @throws FileNotFoundException<br /> * @throws IOException<br /> */<br /> public String guestFileEncoding(String path, int languageHint)<br /> &nbsp;&nbsp;&nbsp; throws FileNotFoundException, IOException {<br /> &nbsp;&nbsp; return guestFileEncoding(new File(path), languageHint);<br /> }</p> 
<p> /**<br /> * 获取文件的编码<br /> * <br /> * @param file<br /> * @param det<br /> * @return<br /> * @throws FileNotFoundException<br /> * @throws IOException<br /> */<br /> private String geestFileEncoding(File file, nsDetector det)<br /> &nbsp;&nbsp;&nbsp; throws FileNotFoundException, IOException {<br /> &nbsp;&nbsp; // Set an observer...<br /> &nbsp;&nbsp; // The Notify() will be called when a matching charset is found.<br /> &nbsp;&nbsp; det.Init(new nsICharsetDetectionObserver() {<br /> &nbsp;&nbsp;&nbsp; public void Notify(String charset) {<br /> &nbsp;&nbsp;&nbsp;&nbsp; found = true;<br /> &nbsp;&nbsp;&nbsp;&nbsp; encoding = charset;<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp; });</p> 
<p>&nbsp;&nbsp; BufferedInputStream imp = new BufferedInputStream(new FileInputStream(<br /> &nbsp;&nbsp;&nbsp;&nbsp; file));</p> 
<p>&nbsp;&nbsp; byte[] buf = new byte[1024];<br /> &nbsp;&nbsp; int len;<br /> &nbsp;&nbsp; boolean done = false;<br /> &nbsp;&nbsp; boolean isAscii = true;</p> 
<p>&nbsp;&nbsp; while ((len = imp.read(buf, 0, buf.length)) != -1) {<br /> &nbsp;&nbsp;&nbsp; // Check if the stream is only ascii.<br /> &nbsp;&nbsp;&nbsp; if (isAscii)<br /> &nbsp;&nbsp;&nbsp;&nbsp; isAscii = det.isAscii(buf, len);</p> 
<p>&nbsp;&nbsp;&nbsp; // DoIt if non-ascii and not done yet.<br /> &nbsp;&nbsp;&nbsp; if (!isAscii &amp;&amp; !done)<br /> &nbsp;&nbsp;&nbsp;&nbsp; done = det.DoIt(buf, len, false);<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp; det.DataEnd();</p> 
<p>&nbsp;&nbsp; if (isAscii) {<br /> &nbsp;&nbsp;&nbsp; encoding = &quot;ASCII&quot;;<br /> &nbsp;&nbsp;&nbsp; found = true;<br /> &nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp; if (!found) {<br /> &nbsp;&nbsp;&nbsp; String prob[] = det.getProbableCharsets();<br /> &nbsp;&nbsp;&nbsp; if (prob.length &gt; 0) {<br /> &nbsp;&nbsp;&nbsp;&nbsp; // 在没有发现情况下，则取第一个可能的编码<br /> &nbsp;&nbsp;&nbsp;&nbsp; encoding = prob[0];<br /> &nbsp;&nbsp;&nbsp; } else {<br /> &nbsp;&nbsp;&nbsp;&nbsp; return null;<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp; return encoding;<br /> }<br /> }</p></div></body></html>