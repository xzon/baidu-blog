<html><head><title>[编译原理课程设计]程序示例一、词法分析器-编译原理实验-C++源代码</title></head><body><div id='tit'>[编译原理课程设计]程序示例一、词法分析器-编译原理实验-C++源代码</div><div id='cate'>存档&middot;垃圾</div><div id='date'>2008年03月12日 星期三 04:02 P.M.</div><div id='page'>159</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/33b38018b3ea1bb04bedbc24.html'>http://hi.baidu.com/hxzon/blog/item/33b38018b3ea1bb04bedbc24.html</a><div id='cnt'><p>[编译原理课程设计]程序示例一、词法分析器-编译原理实验-C++源代码</p> 
<p>#include&lt;string.h&gt;<br /> #include&lt;stdio.h&gt;<br /> #define&nbsp;&nbsp; MAX 22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*分析表的最大容量*/<br /> #define&nbsp;&nbsp; RES_MAX&nbsp;&nbsp; 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*关键字的最大长度*/<br /> #define&nbsp;&nbsp; MAXBUF 255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*缓冲区的大小*/<br /> char&nbsp;&nbsp; ch =' ';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*存放读入当前的输入字符*/<br /> int Line_NO;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*纪录行号*/</p> 
<p>struct reserve&nbsp;&nbsp;&nbsp; /*关键字*/<br /> {<br /> char lexptr[MAXBUF];<br /> int token;<br /> };</p> 
<p>struct reserve symtable[MAX];<br /> char str[MAX][10]={&quot;program&quot;,&quot;begin&quot;,&quot;end&quot;,&quot;var&quot;,&quot;integer&quot;,&quot;real&quot;, &quot;for&quot;,&quot;if&quot;,&quot;then&quot;,&quot;else&quot;,&quot;do&quot;,&quot;while&quot;,&quot;array&quot;,&quot;procedure&quot;, &quot;function&quot;,&quot;of&quot;,&quot;boolean&quot;,&quot;const&quot;,&quot;div&quot;,&quot;mod&quot;,&quot;and&quot;,&quot;or&quot;};</p> 
<p><br /> void init()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*对关键字表进行初始化，div,mod,and,or也作为关键字处理*/<br /> {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*最小的token是program：3，最大的token是or：24*/<br /> int j;<br /> for(j=0; j&lt;MAX; j++)<br /> {<br /> &nbsp;&nbsp; strcpy(symtable[j].lexptr,str[j]);<br /> &nbsp;&nbsp; symtable[j].token=j+3;&nbsp;&nbsp;&nbsp;<br /> }<br /> }</p> 
<p>/***************对关键字进行搜索**************/<br /> int se_res(char * is_res){<br /> &nbsp;&nbsp; int i;<br /> &nbsp;&nbsp; for(i=0;i&lt;MAX;i++){<br /> &nbsp;&nbsp;&nbsp;&nbsp; if((strcmp(symtable[i].lexptr,is_res))==0) break;<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp; if(i&lt;MAX) return&nbsp;&nbsp; symtable[i].token;<br /> &nbsp;&nbsp; else return 0;<br /> }</p> 
<p>/*****************判断是否为字母*****************/<br /> int IsLetter(char c)<br /> {<br /> &nbsp;&nbsp;&nbsp; if(((c&lt;='z')&amp;&amp;(c&gt;='a'))||((c&lt;='Z')&amp;&amp;(c&gt;='A'))) return 1;<br /> &nbsp;&nbsp;&nbsp; else return 0;<br /> }<br /> /*************判断是否为数字**************/<br /> int IsDigit(char c){<br /> &nbsp;&nbsp; if(c&gt;='0'&amp;c&lt;='9') return 1;<br /> &nbsp;&nbsp; else return 0;<br /> }</p> 
<p>/***************分析程序**************/<br /> void analyse(FILE *fpin,FILE *fpout){<br /> &nbsp;&nbsp;&nbsp; char arr[MAXBUF];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* 输入缓冲区，存放一个单词符号 */<br /> &nbsp;&nbsp;&nbsp; int j=0;</p> 
<p>&nbsp;&nbsp;&nbsp; while((ch=fgetc(fpin))!=EOF){<br /> &nbsp;&nbsp;&nbsp; if(ch==' '||ch=='\t'){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*碰到空格、tab则跳过*/<br /> &nbsp;&nbsp;&nbsp; else if(ch=='\n'){Line_NO++;}<br /> /*************************字符串的处理****************************/<br /> &nbsp;&nbsp; else if(IsLetter(ch)){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(IsLetter(ch)|IsDigit(ch)){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if((ch&lt;='Z')&amp;&amp;(ch&gt;='A'))&nbsp;&nbsp;&nbsp;&nbsp; ch=ch+32;&nbsp;&nbsp; /*忽略大小写*/<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arr[j]=ch;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j++;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fseek(fpin,-1L,SEEK_CUR);&nbsp;&nbsp; /*输入指针回退一个字符*/<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arr[j]='\0';<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j=0;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (se_res(arr)){&nbsp;&nbsp; /*如果是关键字*/<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fprintf(fpout,&quot;%s\t\t%d\n&quot;,arr,se_res(arr));<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }else&nbsp;&nbsp; fprintf(fpout,&quot;%s\t\t%d\n&quot;,arr,1);&nbsp;&nbsp;&nbsp; /*普通标识符*/<br /> /*************************数字的处理****************************/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp; }else if(IsDigit(ch)){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(IsDigit(ch)){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arr[j]=ch;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j++;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fseek(fpin,-1L,SEEK_CUR);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arr[j]='\0';<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j=0;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fprintf(fpout,&quot;%s\t\t%d\n&quot;,arr,2) ;&nbsp;&nbsp;&nbsp;&nbsp; /*无符号整数*/<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }else switch(ch){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'+' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;+&quot;,41);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'-' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;-&quot;,42);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'*' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;*&quot;,43);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'(' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;(&quot;,25);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case')' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;)&quot;,26);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'[' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;[&quot;,27);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case']' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;]&quot;,28);break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case';' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;;&quot;,36);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'=' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;=&quot;,38);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'.' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;.&quot;,39);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case',' :fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;,&quot;,40);break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case':' :{ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(ch=='=') fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;:=&quot;,29);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;:&quot;,30);fseek(fpin,-1L,SEEK_CUR);}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }break;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'&gt;' :{ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(ch=='=') fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;&gt;=&quot;,30);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;&gt;&quot;,31);fseek(fpin,-1L,SEEK_CUR);}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }break;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'&lt;' :{ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(ch=='=') fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;&lt;=&quot;,34);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if(ch=='&gt;') fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;&lt;&gt;&quot;,35);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else{fprintf(fpout,&quot;%s\t\t%d\n&quot;,&quot;&lt;&quot;,33);fseek(fpin,-1L,SEEK_CUR);}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }break;</p> 
<p>&nbsp;&nbsp; /***************出现在{ }之间的全部作为注释部分处理*******************/&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case'{' :{ch=fgetc(fpin);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(ch!='}'&amp;&amp;ch!=EOF)&nbsp;&nbsp; {ch=fgetc(fpin);}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(ch==EOF) fprintf(fpout,&quot;缺少一个'}'&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }break; <br /> &nbsp;&nbsp; /***************非法字符*******************/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default :fprintf(fpout,&quot;在第%d行无法识别的字符\t%c\n&quot;,Line_NO,ch);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp; }<br /> }</p> 
<p><br /> /**********主程序中完成对输入输出文件的读写***********/<br /> void main(){<br /> &nbsp;&nbsp; char in_fn[25],out_fn[25];<br /> &nbsp;&nbsp; FILE * fpin,* fpout;<br /> &nbsp;&nbsp; printf(&quot;//////////////chi fa fen xi qi////////////////\n&quot;);<br /> &nbsp;&nbsp; printf(&quot;input the input file exmaple:fin.txt:\n&quot;);<br /> &nbsp;&nbsp; scanf(&quot;%s&quot;,in_fn);<br /> &nbsp;&nbsp; printf(&quot;input the output file exmaple:fout.txt:\n&quot;);<br /> &nbsp;&nbsp; scanf(&quot;%s&quot;,out_fn);<br /> &nbsp;&nbsp; fpin=fopen(in_fn,&quot;r&quot;);<br /> &nbsp;&nbsp; fpout=fopen(out_fn,&quot;w&quot;);<br /> &nbsp;&nbsp; init();<br /> &nbsp;&nbsp; analyse(fpin,fpout);<br /> &nbsp;&nbsp; fclose(fpin);<br /> &nbsp;&nbsp; fclose(fpout);<br /> }</p> 
<p>#</p></div></body></html>