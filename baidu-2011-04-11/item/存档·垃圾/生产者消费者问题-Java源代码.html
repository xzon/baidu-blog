<html><head><title>生产者消费者问题-Java源代码</title></head><body><div id='tit'>生产者消费者问题-Java源代码</div><div id='cate'>存档&middot;垃圾</div><div id='date'>2008年02月20日 星期三 08:52 A.M.</div><div id='page'>170</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/ea95be0e5cecc5e336d122cb.html'>http://hi.baidu.com/hxzon/blog/item/ea95be0e5cecc5e336d122cb.html</a><div id='cnt'><p><font color="#0000ff" size="3">package a;<br /> import java.awt.*;<br /> import java.io.*;<br /> public class ModelShengXiao{<br /> <br /> public static void main(String args[])throws Exception{<br /> &nbsp;&nbsp; Stack stack=new Stack(&quot;stack&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(true){<br /> &nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;\n&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot; Welcome to our Factory!&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println();<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;***************************&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1:procedure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:consumer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit:others&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;***************************&quot;);<br /> &nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InputStreamReader reader=new InputStreamReader(System.in);<br /> &nbsp;&nbsp;&nbsp;&nbsp; BufferedReader br=new BufferedReader(reader);<br /> &nbsp;&nbsp;&nbsp;&nbsp; String data=&quot;&quot;;<br /> &nbsp;&nbsp;&nbsp; if((data=br.readLine())!=null){<br /> &nbsp;&nbsp;&nbsp;&nbsp; int n=Integer.parseInt(data);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (n){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 1:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;生产者线程正在启动，请稍候！&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;\n&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Producer producer=new Producer(stack,&quot;producer&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(10000);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 0:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;消费者线程正在启动，请稍候！&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;\n&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Consumer consumer=new Consumer(stack,&quot;consumer&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(10000);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;无效命令！退出！&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.exit(-1);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> &nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp;<br /> }<br /> }<br /> /*生产者线程**/<br /> class Producer extends Thread {<br /> private Stack theStack;<br /> <br /> public Producer(Stack s,String name){<br /> &nbsp;&nbsp; super(name);<br /> &nbsp;&nbsp; theStack=s;<br /> &nbsp;&nbsp; start();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //启动自身线程<br /> }<br /> public void run() {<br /> &nbsp;&nbsp; try{<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;请输入您想要生产产品的数目：&quot;);<br /> &nbsp;&nbsp;&nbsp; InputStreamReader reader=new InputStreamReader(System.in);<br /> &nbsp;&nbsp;&nbsp; BufferedReader br=new BufferedReader(reader);<br /> &nbsp;&nbsp;&nbsp; String data=null;<br /> &nbsp;&nbsp;&nbsp; if((data=br.readLine())!=null){<br /> &nbsp;&nbsp;&nbsp;&nbsp; int n=Integer.parseInt(data);<br /> &nbsp;&nbsp;&nbsp;&nbsp; String goods;<br /> &nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;生产过程中...&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp; for(int i=0;i&lt;n;i++){<br /> &nbsp;&nbsp;&nbsp;&nbsp; synchronized(theStack){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goods=&quot;goods&quot;+(theStack.getPoint()+1);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; theStack.push(goods);<br /> &nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp; System.out.println(getName()+&quot;:push &quot;+goods+&quot; to &quot;+theStack.getName());<br /> &nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(500);<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;\n&quot;);<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;此次生产过程已经结束，请选择下一步操作！&quot;);<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp; }catch(Exception e){<br /> &nbsp;&nbsp;&nbsp; e.toString();<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;<br /> }<br /> }<br /> /**消费者线程*/<br /> class Consumer extends Thread{<br /> private Stack theStack;<br /> <br /> public Consumer(Stack s,String name){<br /> &nbsp;&nbsp; super(name);<br /> &nbsp;&nbsp; theStack=s;<br /> &nbsp;&nbsp; start();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //启动自身消费者线程<br /> }<br /> public void run(){<br /> &nbsp;&nbsp; try{<br /> &nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;请输入您想要生产产品的数目：&quot;);<br /> &nbsp;&nbsp;&nbsp; InputStreamReader reader=new InputStreamReader(System.in);<br /> &nbsp;&nbsp;&nbsp; BufferedReader br=new BufferedReader(reader);<br /> &nbsp;&nbsp;&nbsp; String data=null;<br /> &nbsp;&nbsp;&nbsp; if((data=br.readLine())!=null){<br /> &nbsp;&nbsp;&nbsp;&nbsp; int n=Integer.parseInt(data);<br /> &nbsp;&nbsp;&nbsp;&nbsp; String goods;<br /> &nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;消费进行中...&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp;&nbsp; for(int i=0;i&lt;n;i++){<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized(theStack){<br /> &nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goods=theStack.pop();<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(getName()+&quot;:pop &quot;+goods+&quot; from &quot;+theStack.getName());<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(500);<br /> &nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;\n&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;此次消费过程已经结束，请选择接下来的操作！&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;<br /> &nbsp;&nbsp; }catch(Exception e){<br /> &nbsp;&nbsp;&nbsp; System.out.println(&quot;产品不足！&quot;);<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp;<br /> }<br /> }<br /> /**堆栈*/<br /> class Stack{<br /> private String name;<br /> private String buffer[]=new String[100];<br /> int point=-1;<br /> boolean sFull=false;<br /> <br /> public Stack(String name){<br /> &nbsp;&nbsp; this.name=name;<br /> }<br /> public String getName(){<br /> &nbsp;&nbsp; return name;<br /> }<br /> <br /> public synchronized int getPoint(){<br /> &nbsp;&nbsp; return point;<br /> }<br /> <br /> public synchronized void push(String goods){<br /> &nbsp;&nbsp; //this.notifyAll();<br /> &nbsp;&nbsp;<br /> &nbsp;&nbsp; while(point&gt;buffer.length-1){<br /> &nbsp;&nbsp;&nbsp; System.out.println(Thread.currentThread().getName()+&quot;:wait&quot;);<br /> &nbsp;&nbsp;&nbsp; try{<br /> &nbsp;&nbsp;&nbsp;&nbsp; this.wait();<br /> &nbsp;&nbsp;&nbsp; }catch(InterruptedException e){<br /> &nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(e);<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp; }<br /> &nbsp;&nbsp; point++;<br /> &nbsp;&nbsp; Thread.yield();<br /> &nbsp;&nbsp; buffer[point]=goods;<br /> }<br /> <br /> public synchronized String pop(){<br /> &nbsp;&nbsp; //this.notifyAll();<br /> &nbsp;&nbsp;<br /> &nbsp;&nbsp; while(point&gt;=buffer.length-1){<br /> &nbsp;&nbsp;&nbsp; System.out.println(Thread.currentThread().getName()+&quot;:wait&quot;);<br /> &nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp; try{<br /> &nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);<br /> &nbsp;&nbsp;&nbsp;&nbsp; this.wait();<br /> &nbsp;&nbsp;&nbsp; }catch(InterruptedException e){<br /> &nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(e);<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp; }</font></p> 
<p><font color="#0000ff" size="3">&nbsp;&nbsp; String goods=buffer[point];<br /> &nbsp;&nbsp; buffer[point]=null;<br /> &nbsp;&nbsp; Thread.yield();<br /> &nbsp;&nbsp; point--;<br /> &nbsp;&nbsp; return goods;<br /> }<br /> }</font></p></div></body></html>