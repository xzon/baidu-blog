<html><head><title>词法分析（字符串分析）</title></head><body><div id='tit'>词法分析（字符串分析）</div><div id='cate'>算法&middot;数学</div><div id='date'>2008年04月22日 星期二 11:41 P.M.</div><div id='page'>135</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/ff31053b3043edef14cecbc2.html'>http://hi.baidu.com/hxzon/blog/item/ff31053b3043edef14cecbc2.html</a><div id='cnt'><p><u><font color="#810081">词法分析（字符串分析）</font></u></p> 
<div class="postText"> 
 <p>词法分析是编译器实现的第一步。主要是分析输入的源程序（字符串），输出该字符串中出现的所有的合法的单词。例如：int a = 3 + 5;经过词法分析会输出 int,a,=,3,+,5和;这七个单词。实现词法分析器的官方做法是：<br /> &nbsp;&nbsp;&nbsp; 1.写出各个单词的正规式（正则表达式）；<br /> &nbsp;&nbsp;&nbsp; 2.根据正规式构造NFA（不确定的有限自动机）；<br /> &nbsp;&nbsp;&nbsp; 3.将NFA转换DFA（确定的有限自动机）；<br /> &nbsp;&nbsp;&nbsp; 4.根据DFA就可以实现词法分析器，写出程序。<br /> <br /> 下面用实例来说明上面的各个步骤：<br /> &nbsp;&nbsp;&nbsp; 假设我们要实现一个很简单的脚本，该脚本中只有两种类型的单词，一种就是变量，变量名的规则就是以字母开头后面紧跟0个或多个字母或数字的的字符串，如 a 和 a12d3 等；另一种就是操作符，很简单只有 &amp;,|,~,(,),==,!= 这几个。给出几个脚本的实例：result1 &amp; result2，rst1&amp;(rst2|rst3)，answer1 | (~answer2)。<br /> <br /> 按照上面的步骤，让我们来看一下如何实现这个词法分析器：<br /> 第一步：写出正规式<br /> &nbsp;&nbsp;&nbsp; 变量的正规式是：letter(letter|digit)<sup>*<br /> </sup>&nbsp;&nbsp;&nbsp; 操作符的正规式：&amp;,|,~,(,)。由于操作符都是固定字符的，所以正规式就是它本身。<br /> 第二步：根据正规式构造NFA<br /> &nbsp;&nbsp;&nbsp; 正规式构造NFA的基础是先构造正规式中每个字符的NFA，如变量的正规式中只有两个字符 letter 和 digit,他们的正规式分别是：<br /> <img width="232" height="50" src="image/词法分析（字符串分析）.html.fdd0dcb49dee5f398bd4b29d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/fdd0dcb49dee5f398bd4b29d.jpg</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img width="232" height="50" src="image/词法分析（字符串分析）.html.d272ba3ec73642b0828b139c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/d272ba3ec73642b0828b139c.jpg</p><br /> 根据构造|形式的NFA的公式可以构造 letter|digit 的NFA如下图：<br /> <img src="image/词法分析（字符串分析）.html.4921a01ed2d08c554134179c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/4921a01ed2d08c554134179c.jpg</p><br /> (letter|digit)<sup>*</sup>的NFA为：<br /> <img src="image/词法分析（字符串分析）.html.407eb51c5c02d0c187d6b69d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/407eb51c5c02d0c187d6b69d.jpg</p><br /> letter(letter|digit)<sup>*</sup>的NFA为：<br /> <img src="image/词法分析（字符串分析）.html.6379fb1f3d37e640304e159c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/6379fb1f3d37e640304e159c.jpg</p><br /> 第三步：将NFA转换为DFA<br /> &nbsp;&nbsp;&nbsp; 先是将所有通过<span>ε可以到达的状态合并，由上图NFA可以看出1,2,3,4,6,9都是通过</span><span>ε可以直接用箭头连接的，以此类推5,8,9,3,4,6和7,8,9,3,4,6都是可以合并称一个状态的，</span>如下图：<br /> <span><img src="image/词法分析（字符串分析）.html.e39219300a27c9d3a9018e9d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/e39219300a27c9d3a9018e9d.jpg</p><br /> 此图用新的DFA表示如下：<br /> <img src="image/词法分析（字符串分析）.html.fbe4231f15c9a082a786699c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/fbe4231f15c9a082a786699c.jpg</p><br /> &nbsp;&nbsp; 由于生成的DFA的状态过多，需要将上面的DFA最小化，生成状态数最少的DFA，最小化DFA的过程就是将那些无论怎样转换都仍然转换到本组合内部的状态组合合并，如上图{B,C,D}这三个状态组合称状态组无论经过letter还是digit转换都仍然转换到该组合，那么就可以将这三个状态合并，如下图：<br /> <img width="251" height="119" src="image/词法分析（字符串分析）.html.5e60d7c82585b85d7f3e6f9c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/5e60d7c82585b85d7f3e6f9c.jpg</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用新状态表示为：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="image/词法分析（字符串分析）.html.6c2ccf17fb3d1643c93d6d9c.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/6c2ccf17fb3d1643c93d6d9c.jpg</p><br /> <br /> 脚本中变量的DFA已经构造好了。<br /> 由于操作符都是固定字符，所以DFA比较简单，下面给出几个的图示例子：<br /> <img src="image/词法分析（字符串分析）.html.a5ac1b95e37873427bf4809d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/a5ac1b95e37873427bf4809d.jpg</p><br /> <br /> <img width="351" height="50" src="image/词法分析（字符串分析）.html.b05e0cd18fda8399572c849d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/b05e0cd18fda8399572c849d.jpg</p><br /> <br /> 现在我们将各个单词的DFA组合在一起，大致类似下图：<br /> <img src="image/词法分析（字符串分析）.html.a973f4d3b82f6095a9ec9a9d.jpg" /><p class="origImg">http://hiphotos.baidu.com/hxzon/pic/item/a973f4d3b82f6095a9ec9a9d.jpg</p><br /> 实际上，由于这种很简单的例子不必套用这种正规的步骤来得到DFA，可以直接把图画出来。首先画一个开始状态(Start)和一个结束状态(Done),然后再考虑各个单词之间的关系将其分类，这种分类的过程就看你的经验了，依据各个单词挨个字符被识别的过程即可画出类似上图的DFA，然后再根据这个DFA写出词法分析的程序来就非常的简单了。<br /> 下面给出根据这个DFA的写出的大概程序，这段代码可执行，但是没有考虑各种意外、出错以及相关优化处理等，所以仅供参考，请斟酌使用：<br /> </span></p> 
 <p><span>1 <br /> 2 public class ScriptScanner<br /> 3 {<br /> 4&nbsp;&nbsp; private String scriptInput = null;<br /> 5 <br /> 6&nbsp;&nbsp; /**<br /> 7&nbsp;&nbsp;&nbsp; * @param scriptInput<br /> 8&nbsp;&nbsp;&nbsp; */<br /> 9&nbsp;&nbsp; public ScriptScanner(String scriptInput)<br /> 10&nbsp;&nbsp; {<br /> 11&nbsp;&nbsp;&nbsp;&nbsp; this.scriptInput = scriptInput;<br /> 12&nbsp;&nbsp; }<br /> 13 <br /> 14&nbsp;&nbsp; /** 标记当前读取段的开始位置 */<br /> 15&nbsp;&nbsp; private int start_read_pos = 0;<br /> 16 <br /> 17&nbsp;&nbsp; /** 当前位置 */<br /> 18&nbsp;&nbsp; private int current_pos = 0;<br /> 19 <br /> 20&nbsp;&nbsp; private char readChar()<br /> 21&nbsp;&nbsp; {<br /> 22&nbsp;&nbsp;&nbsp;&nbsp; if (scriptInput == null || current_pos &gt;= scriptInput.length())<br /> 23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return EOF;<br /> 24 <br /> 25&nbsp;&nbsp;&nbsp;&nbsp; return scriptInput.charAt(current_pos);<br /> 26&nbsp;&nbsp; }<br /> 27 <br /> 28&nbsp;&nbsp; public Token getNextToken()<br /> 29&nbsp;&nbsp; {<br /> 30&nbsp;&nbsp;&nbsp;&nbsp; Token currentToken = null;<br /> 31 <br /> 32&nbsp;&nbsp;&nbsp;&nbsp; int state = STATE_START;<br /> 33 <br /> 34&nbsp;&nbsp;&nbsp;&nbsp; start_read_pos = current_pos;<br /> 35 <br /> 36&nbsp;&nbsp;&nbsp;&nbsp; while (state != STATE_DONE)<br /> 37&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char ch = readChar();<br /> 39 <br /> 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (state)<br /> 41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case STATE_START:<br /> 43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (Character.isLetter(ch))<br /> 45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_IN_VAR;<br /> 47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (ch == '=')<br /> 49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_IN_EQUAL;<br /> 51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 52&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (ch == '&lt;')<br /> 53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_IN_NOTEQUAL;<br /> 55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br /> 57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_DONE;<br /> 59 <br /> 60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (ch)<br /> 61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case EOF:<br /> 63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.EOF);<br /> 64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 65 <br /> 66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '&amp;':<br /> 67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.AND);<br /> 68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 69 <br /> 70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '|':<br /> 71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.OR);<br /> 72&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 73 <br /> 74&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '~':<br /> 75&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.NOT);<br /> 76&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 77 <br /> 78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '(':<br /> 79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.LPAREN);<br /> 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 81 <br /> 82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case ')':<br /> 83&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.RPAREN);<br /> 84&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 85 <br /> 86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<br /> 87&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.ERROR, &quot;无法识别的字符&quot;);<br /> 88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 90 <br /> 91&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: else<br /> 92 <br /> 93&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current_pos ++; // 开始状态下除 EOF 外都需要将位置后移<br /> 94 <br /> 95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 96 <br /> 97&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: case STATE_START<br /> 98 <br /> 99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case STATE_IN_EQUAL:<br /> 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_DONE;<br /> 102 <br /> 103&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ch == '=')<br /> 104&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 105&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.EQUAL);<br /> 106&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 107&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br /> 108&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 109&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.ERROR, &quot;错误的运算符&quot;);<br /> 110&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 111 <br /> 112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current_pos ++;<br /> 113 <br /> 114&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 115 <br /> 116&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: case STATE_IN_EQUAL<br /> 117 <br /> 118&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case STATE_IN_NOTEQUAL:<br /> 119&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 120&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_DONE;<br /> 121 <br /> 122&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ch == '&gt;')<br /> 123&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 124&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.NOTEQUAL);<br /> 125&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 126&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br /> 127&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.ERROR, &quot;错误的运算符&quot;);<br /> 129&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 130 <br /> 131&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current_pos ++;<br /> 132 <br /> 133&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 134 <br /> 135&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: case STATE_IN_NOTEQUAL<br /> 136 <br /> 137&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case STATE_IN_VAR:<br /> 138&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 139&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (! Character.isLetterOrDigit(ch))<br /> 140&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 141&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_DONE;<br /> 142 <br /> 143&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String value = scriptInput.substring(start_read_pos, current_pos);<br /> 144 <br /> 145&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.ID, value);<br /> 146&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 147&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br /> 148&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 149&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current_pos ++;<br /> 150&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 151 <br /> 152&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br /> 153 <br /> 154&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: case STATE_IN_VAR<br /> 155 <br /> 156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<br /> 157&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /> 158&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state = STATE_DONE;<br /> 159 <br /> 160&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentToken = new Token(TokenType.ERROR);<br /> 161&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 162&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } // End: switch (state)<br /> 163&nbsp;&nbsp;&nbsp;&nbsp; }<br /> 164 <br /> 165&nbsp;&nbsp;&nbsp;&nbsp; return currentToken;<br /> 166&nbsp;&nbsp; }<br /> 167 <br /> 168&nbsp;&nbsp; public final static char EOF = '\0';<br /> 169 <br /> 170&nbsp;&nbsp; /*<br /> 171&nbsp;&nbsp;&nbsp; * 定义 DFA 的状态。<br /> 172&nbsp;&nbsp;&nbsp; */<br /> 173 <br /> 174&nbsp;&nbsp; /** 开始状态 */<br /> 175&nbsp;&nbsp; public final static int STATE_START = 0;<br /> 176 <br /> 177&nbsp;&nbsp; /** 当前 Token 是变量 */<br /> 178&nbsp;&nbsp; public final static int STATE_IN_VAR = 1;<br /> 179 <br /> 180&nbsp;&nbsp; /** 当前 Token 是 &quot;==&quot; */<br /> 181&nbsp;&nbsp; public final static int STATE_IN_EQUAL = 2;<br /> 182 <br /> 183&nbsp;&nbsp; /** 当前 Token 是 &quot;&lt;&gt;&quot; */<br /> 184&nbsp;&nbsp; public final static int STATE_IN_NOTEQUAL = 3;<br /> 185 <br /> 186&nbsp;&nbsp; /** 当前 Token 结束 */<br /> 187&nbsp;&nbsp; public final static int STATE_DONE = 4;<br /> 188 }<br /> 189 </span></p> 
 <p><span>从代码中可以看出，预先根据DFA定义了5个状态：</span><span><span style="color: #000000">STATE_START，</span></span><span><span style="color: #000000">STATE_IN_VAR，</span></span><span><span style="color: #000000">STATE_IN_EQUAL，</span></span><span><span style="color: #000000">STATE_IN_NOTEQUAL，</span></span><span><span style="color: #000000">STATE_DONE，然后每个记号（Token）都是从</span></span><span><span style="color: #000000">STATE_START开始到</span></span><span><span style="color: #000000">STATE_DONE结束，中间根据输入字符的不同在各个状态中不断的转换，直到识别出记号或者错误为止。由此可见只要画好DFA写代码就简单多了。<br /> &nbsp;&nbsp;&nbsp; 有兴趣的朋友可以研究一下语法分析，生成语法树，根据语法树求值；也可以研究一下利用中缀表达式求值。<br /> <br /> <a title="http://www.blogjava.net/qujinlong123/" href="http://www.blogjava.net/qujinlong123/"><font color="#000080">http://www.blogjava.net/qujinlong123/</font></a><br /> </span></span></p> 
</div> 
<p> </p></div></body></html>