<html><head><title>128位分组对称加密算法：AES</title></head><body><div id='tit'>128位分组对称加密算法：AES</div><div id='cate'>计算机&middot;功课</div><div id='date'>2007年11月12日 星期一 06:14 P.M.</div><div id='page'>207</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/c17b64d94e50f42f10df9b56.html'>http://hi.baidu.com/hxzon/blog/item/c17b64d94e50f42f10df9b56.html</a><div id='cnt'><h2>128位分组对称加密算法：AES</h2> 
<p>AES是美国高级加密标准算法,将在未来几十年里代替DES在各个领域中得到广泛应用。本文在研究分析AES加密算法原理的基础上，着重说明算法的实现步骤，并结合AVR汇编语言完整地实现AES加密和解密。根据AES原理，提出几种列变化的优化算法，并根据实验结果分析和比较它们的优缺点。 关键词：AES算法 DES AVR汇编语言 加密算法 解密算法</p> 
<p align="left">引 言<br /> <br /> <br /> 随着对称密码的发展,DES数据加密标准算法由于密钥长度较小(56位),已经不适应当今分布式开放网络对数据加密安全性的要求，因此1997年NIST公开征集新的数据加密标准,即AES[1]。经过三轮的筛选,比利时Joan Daeman和Vincent Rijmen提交的Rijndael算法被提议为AES的最终算法。此算法将成为美国新的数据加密标准而被广泛应用在各个领域中。尽管人们对AES还有不同的看法,但总体来说,AES作为新一代的数据加密标准汇聚了强安全性、高性能、高效率、易用和灵活等优点。AES设计有三个密钥长度:128,192,256位，相对而言，AES的128密钥比DES的56密钥强1021倍[2]。AES算法主要包括三个方面：轮变化、圈数和密钥扩展。本文以128为例，介绍算法的基本原理；结合AVR汇编语言，实现高级数据加密算法AES。<br /> <br /> 1 AES加密、解密算法原理和AVR实现<br /> <br /> AES是分组密钥，算法输入128位数据，密钥长度也是128位。用Nr表示对一个数据分组加密的轮数（加密轮数与密钥长度的关系如表1所列）。每一轮都需要一个与输入分组具有相同长度的扩展密钥Expandedkey(i)的参与。由于外部输入的加密密钥K长度有限,所以在算法中要用一个密钥扩展程序(Keyexpansion)把外部密钥K扩展成更长的比特串,以生成各轮的加密和解密密钥。<br /> <br /> 1.1圈变化<br /> AES每一个圈变换由以下三个层组成:<br /> 非线性层——进行Subbyte变换；<br /> 线行混合层——进行ShiftRow和MixColumn运算；<br /> 密钥加层——进行AddRoundKey运算。<br /> <br /> ① Subbyte变换是作用在状态中每个字节上的一种非线性字节转换,可以通过计算出来的S盒进行映射。<br /> Schange:<br /> ldi zh,＄01;将指针指向S盒的首地址<br /> mov zl,r2；将要查找的数据作为指针低地址<br /> ldtemp,z+；取出这个对应的数据<br /> mov r2,temp；交换数据完成查表<br /> .<br /> .<br /> . <br /> ret<br /> <br /> ② ShiftRow是一个字节换位。它将状态中的行按照不同的偏移量进行循环移位，而这个偏移量也是根据Nb的不同而选择的[3]。<br /> shiftrow:;这是一个字节换位的子程序<br /> mov temp,r3;因为是4&times;4<br /> mov r3,r7; r2 r6 r10 r14 r2 r6 r10 r14 <br /> mov r7,r11; r3 r7 r11 r15---r7 r11 r15 r3<br /> mov r11,r15; r4 r8 r12 r17 r12 r17 r4 r8<br /> mov r15,temp; r5 r9 r13 r18 r18 r5 r9 r13<br /> mov temp,r4<br /> mov temp1,r8<br /> mov r4,r12<br /> mov r8,r17<br /> mov r12,temp<br /> mov r17,temp1<br /> mov temp,r18<br /> mov r18,r13<br /> mov r13,r9<br /> mov r9,r5<br /> mov r5,temp<br /> ret<br /> <br /> ③ 在MixColumn变换中,把状态中的每一列看作GF(28)上的多项式a(x)与固定多项式c(x)相乘的结果。b(x)=c(x)*a(x)的系数这样计算:*运算不是普通的乘法运算,而是特殊的运算，即<br /> b(x)=c(x)&middot;a(x)(mod x4+1)<br /> 对于这个运算<br /> b0=02。a0+03。a1+a2+a3<br /> 令xtime(a0)=02。a0<br /> 其中，符号“。”表示模一个八次不可约多项式的同余乘法[3]。<br /> mov temp,a0;这是一个mixcolimn子程序<br /> rcall xtime;调用xtime程序<br /> mov a0,temp<br /> mov temp,a1<br /> rcall xtime<br /> eor a0,a1<br /> eor a0,temp<br /> eor a0,a2<br /> eor a0,a3;完成b(x)的计算<br /> . <br /> .<br /> . <br /> xtime:;这是一个子程序<br /> ldi temp1,＄1b <br /> lsl temp<br /> brcs next1;如果最高位是1,则转移<br /> next: ret;否则什么也不变化<br /> next1:eor temp,temp1 <br /> rjmp next<br /> <img style="cursor: pointer" width="198" src="image/128位分组对称加密算法：AES.htm.151201340.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201340.jpg</p></p> 
<p> 对于逆变化,其矩阵C要改变成相应的D,即b(x)=d(x)＊a(x)。<br /> <br /> ④ 密钥加层运算(addround)是将圈密钥状态中的对应字节按位“异或”。<br /> <br /> ⑤ 根据线性变化的性质[1],解密运算是加密变化的逆变化。这里不再详细叙述。<br /> <br /> 1.2轮变化<br /> <br /> 对不同的分组长度，其对应的轮变化次数是不同的,如表1所列。<br /> <img style="cursor: pointer" width="294" src="image/128位分组对称加密算法：AES.htm.151201341.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201341.jpg</p> <br /> 1.3密钥扩展<br /> AES算法利用外部输入密钥K(密钥串的字数为Nk),通过密钥的扩展程序得到共计4(Nr+1)字的扩展密钥。它涉及如下三个模块:<br /> <br /> ① 位置变换(rotword)——把一个4字节的序列[A,B,C,D]变化成[B,C,D,A]；<br /> <br /> ② S盒变换(subword)——对一个4字节进行S盒代替；<br /> <br /> ③ 变换Rcon[i]——Rcon[i]表示32位比特字[xi-1,00,00,00]。这里的x是（02），如<br /> Rcon[1]=[01000000]；Rcon[2]=[02000000]；Rcon[3]=[04000000]……<br /> <br /> 扩展密钥的生成：扩展密钥的前Nk个字就是外部密钥K；以后的字W[[ｉ]]等于它前一个字W[[i-1]]与前第Nk个字W[[i-Nk]]的“异或”,即W[[ｉ]]=W[[i-1]] W[[ｉ- Nk]]。但是若ｉ为Nk的倍数,则W[ｉ]=W[i-Nk] Subword(Rotword(W[[ｉ-1]])) Rcon[i/Nk]。<br /> <br /> 程序执行的时候,主要调用以上几个子程序，具体实现如下：<br /> Keyexpansion:<br /> rcall rotwoed<br /> rcall subword<br /> rcall Rcon<br /> .<br /> .<br /> . <br /> AES的加密与解密流程如图1所示。<br /> <img style="cursor: pointer" width="343" src="image/128位分组对称加密算法：AES.htm.151201342.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201342.jpg</p> <br /> 图1AES的加密和解密流程<br /> <br /> 2 AES加密、解密算法的优化<br /> <br /> 由以上算法的流程中可以清楚地看到，整个算法中程序耗时最多的就是圈变化部分，因此对于算法的优化也就在此；而圈变化部分可以优化的也就是列变化。因为列变化是一个模乘同余规则。由于AES加密和解密是不对称的,如果不对其进行优化,会使算法的解密速度远远大于加密的速度[1]。<br /> <br /> ① 加密运算。对列变换（Mixcolumn）可以通过调用xtime子程序进行优化。具体算法[1]实现如下:<br /> <img style="cursor: pointer" width="325" src="image/128位分组对称加密算法：AES.htm.151201413.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201413.jpg</p> <br /> <br /> 另一种有效的优化方法就是离线构造一个表格，即列变化表格。这样只要通过查表的方式就可以提高加密速度。<br /> <br /> ② 解密算法的优化。由于解密的列变换的系数分别是09、0E、0B和0D。在AVR单片机上实现以上的乘法显然是需要很多的时间,从而导致了解密的性能降低。<br /> <br /> 优化方法一：对列变化进行分解使倍乘次数降低。<br /> <br /> 仔细研究解密矩阵的系数，不难发现解密矩阵和加密矩阵有着一定的联系，即解密矩阵等于加密矩阵和一个矩阵的相乘。通过这样的联系，就可以对算法进行优化：<br /> <img style="cursor: pointer" width="273" src="image/128位分组对称加密算法：AES.htm.151201414.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201414.jpg</p></p> 
<p> 这样一来,只用几个简单的“异或”就可以实现列变化，使倍乘的次数降低,提高解密的速度。<br /> 优化方法二：构造表格。<br /> <br /> 同加密构造方法一样，可以构造四个表格T[ea]=e&times;a; T[9a]=9&times;a;T[9a]=9&times;a;T[ba]=b&times;a。这样一来，也只需要进行查表和简单的异或就可以完成解密的任务。虽然这种方法将增加额外的开销,但是它却是一种有效的方法。<br /> <br /> 3 AES加密与解密的实验仿真<br /> <br /> 根据以上实验步骤和优化方法得出表2、3所列实验结果。<br /> <img style="cursor: pointer" width="367" src="image/128位分组对称加密算法：AES.htm.151201425.jpg" /><p class="origImg">http://www.utf.com.cn/article/UploadFile/200703/151201425.jpg</p> <br /> 设主密钥为:000102030405060708090a0b0c0d0e0f(128bit)。<br /> 加密明文:00112233445566778899AABBCCDDEEFF。<br /> 密文:69C4E0D86A7B0430D8CDB78070B4C55A。<br /> 解密密文:69C4E0D86A7B0430D8CDB78070B4C55A。<br /> 明文:00112233445566778899AABBCCDDEEFF。<br /> <br /> 总之,AES密码是一个非对称密码体制，它的解密要比加密复杂和费时。解密优化算法没有增加存储空间的基础上,以列变化为基础进行处理，程序比原始的要小，而且节约了时间。解密优化方法速度最快，效率最高，但要增加系统的存储空间,因此它的程序也是最大的一个。<br /> <br /> 注：AES128数据加密解密程序见本刊网站(www.dpj.com.cn)。<br /> <br /> 结语<br /> <br /> AES高级数据加密算法不管是从安全性、效率，还是密钥的灵活性等方面都优于DES数据加密算法,在今后将逐步代替DES而被广泛应用。本文基于AVR的高速计算性能实现了AES算法,并结合汇编语言进行了算法的优化。根据实际应用的具体需要，可以选用相应的方法。<br /> <br /> 参考文献<br /> 1 宋震，等. 密码学. 北京：中国水利水电出版社，2002<br /> 2 杨义先.现代密码新理论.北京：科学出版社，2002<br /> 3 谷大武,等.高级加密标准（AES）算法—Rijndael的设计.北京：清华大学出版社，2003<br /> 4 耿德根,等.AVR单片机应用技术.北京：北京航空航天大学出版社，2002<br /> 5 宋建国,等.AVR高速嵌入式单片机原理与应用.北京：北京航空航天大学出版社，2001<br /> 6 NIST. Advanced Encryption Standard (AES) .Federal Information Processing Standards Publication,2001</p></div></body></html>