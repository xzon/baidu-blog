<html><head><title>.NET设计模式（7）：创建型模式专题总结（Creational Pattern）</title></head><body><div id='tit'>.NET设计模式（7）：创建型模式专题总结（Creational Pattern）</div><div id='cate'>设计方案</div><div id='date'>2008年04月09日 星期三 07:39 P.M.</div><div id='page'>140</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/39b5b809103cf2216a60fb6b.html'>http://hi.baidu.com/hxzon/blog/item/39b5b809103cf2216a60fb6b.html</a><div id='cnt'><p><a href="http://www.cnblogs.com/Terrylee/archive/2006/01/16/318285.html"><font color="#e58712">.NET设计模式（7）：创建型模式专题总结（Creational Pattern）</font></a></p> 
<h3 style="margin: 0cm 0cm 0pt; line-height: normal; text-align: center" align="center"><span style="color: red">创建型模式专题总结（</span><span style="color: red">Creational Pattern</span><span style="color: red">）</span></h3> 
<p class="MsoNormal" style="text-align: right" align="right"><span style="font-size: 10pt">——.NET设计模式系列之七</span></p> 
<p class="MsoNormal" style="text-align: right" align="right"><span style="font-size: 10pt">Terrylee</span><span style="font-size: 10pt">，</span><span style="font-size: 10pt">2006</span><span style="font-size: 10pt">年</span><span style="font-size: 10pt">1</span><span style="font-size: 10pt">月</span></p> 
<p class="MsoNormal" style="line-height: 150%"><strong style="mso-bidi-font-weight: normal"><span style="font-size: 10pt; color: #006699; line-height: 150%">概述</span></strong></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">创建型模式，就是用来创建对象的模式，抽象了实例化的过程。它帮助一个系统独立于如何创建、组合和表示它的那些对象。本文对五种常用创建型模式进行了比较，通过一个游戏开发场景的例子来说该如何使用创建型模式。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><strong style="mso-bidi-font-weight: normal"><span style="font-size: 10pt; color: #006699; line-height: 150%">为什么需要创建型模式</span></strong></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">所有的创建型模式都有两个永恒的主旋律：第一，它们都将系统使用哪些具体类的信息封装起来；第二，它们隐藏了这些类的实例是如何被创建和组织的。外界对于这些对象只知道它们共同的接口，而不清楚其具体的实现细节。正因如此，创建型模式在创建什么（</span><span style="font-size: 10pt; line-height: 150%">what</span><span style="font-size: 10pt; line-height: 150%">），由谁（</span><span style="font-size: 10pt; line-height: 150%">who</span><span style="font-size: 10pt; line-height: 150%">）来创建，以及何时（</span><span style="font-size: 10pt; line-height: 150%">when</span><span style="font-size: 10pt; line-height: 150%">）创建这些方面，都为软件设计者提供了尽可能大的灵活性。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">假定在一个游戏开发场景中，会用到一个现代风格房屋的对象，按照我们的一般想法，既然需要对象就创建一个：</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">ModernRoom room <span style="color: fuchsia">=</span> <span style="color: blue">new</span> ModernRoom();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">好了，现在现代风格房屋的对象已经有了，如果这时房屋的风格变化了，需要的是古典风格的房屋，修改一下：</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">Classical</span><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">Room room <span style="color: fuchsia">=</span> <span style="color: blue">new</span> </span><span style="font-size: 10pt; line-height: 150%">Classical</span><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">Room();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">试想一下，在我们的程序中有多少处地方用到了这样的创建逻辑，而这里仅仅是房屋的风格变化了，就需要修改程序中所有的这样的语句。现在我们封装对象创建的逻辑，把对象的创建放在一个工厂方法中：</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">ModernFactory factory <span style="color: fuchsia">=</span> <span style="color: blue">new</span> ModernFactory();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">ModernRoom room <span style="color: fuchsia">=</span> factory<span style="color: fuchsia">.</span>Create();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">当房屋的风格变化时，只需要修改</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt">Classical</span><span style="font-size: 10pt; mso-hansi-: 0pt">Factory factory <span style="color: fuchsia">=</span> <span style="color: blue">new</span> </span><span style="font-size: 10pt">Classical</span><span style="font-size: 10pt; mso-hansi-: 0pt">Factory();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">Classical</span><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">Room room <span style="color: fuchsia">=</span> factory<span style="color: fuchsia">.</span>Create();</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">而其它的用到</span><span style="font-size: 10pt; line-height: 150%">room</span><span style="font-size: 10pt; line-height: 150%">的地方仍然不变。这就是为什么需要创建型模式了。创建者模式作用可以概括为如下两点：</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">1</span><span style="font-size: 10pt; line-height: 150%">．封装创建逻辑，绝不仅仅是</span><span style="font-size: 10pt; line-height: 150%">new</span><span style="font-size: 10pt; line-height: 150%">一个对象那么简单。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">2</span><span style="font-size: 10pt; line-height: 150%">．封装创建逻辑变化，客户代码尽量不修改，或尽量少修改。</span></p> 
<p class="MsoNormal" style="line-height: 150%"> </p> 
<p class="MsoNormal" style="line-height: 150%"><strong style="mso-bidi-font-weight: normal"><span style="font-size: 10pt; color: #006699; line-height: 150%">常见的五种创建型模式</span></strong></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; color: red; line-height: 150%">单件模式</span><span style="font-size: 10pt; line-height: 150%">（</span><span style="font-size: 10pt; line-height: 150%">Singleton Pattern</span><span style="font-size: 10pt; line-height: 150%">）解决的是实体对象的个数问题，其他的都是解决</span><span style="font-size: 10pt; line-height: 150%">new</span><span style="font-size: 10pt; line-height: 150%">所带来的耦合关系问题。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; color: red; line-height: 150%">工厂方法模式</span><span style="font-size: 10pt; line-height: 150%">（</span><span style="font-size: 10pt; line-height: 150%">Factory Pattern</span><span style="font-size: 10pt; line-height: 150%">）在工厂方法中，工厂类成为了抽象类，其实际的创建工作将由其具体子类来完成。工厂方法的用意是定义一个创建产品对象的工厂接口，将实际创建工作推迟到子类中去，强调的是“单个对象”的变化。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; color: red; line-height: 150%">抽象工厂模式</span><span style="font-size: 10pt; line-height: 150%">（</span><span style="font-size: 10pt; line-height: 150%">Abstract Factory</span><span style="font-size: 10pt; line-height: 150%">）抽象工厂是所有工厂模式中最为抽象和最具有一般性的一种形态。抽象工厂可以向客户提供一个接口，使得客户可以在不必指定产品的具体类型的情况下，创建多个产品族中的产品对象，强调的是“系列对象”的变化。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; color: red; line-height: 150%">生成器模式</span><span style="font-size: 10pt; line-height: 150%">（</span><span style="font-size: 10pt; line-height: 150%">Builder Pattern</span><span style="font-size: 10pt; line-height: 150%">）把构造对象实例的逻辑移到了类的外部，在这个类的外部定义了这个类的构造逻辑。他把一个复杂对象的构造过程从对象的表示中分离出来。其直接效果是将一个复杂的对象简化为一个比较简单的目标对象。他强调的是产品的构造过程。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; color: red; line-height: 150%">原型模式</span><span style="font-size: 10pt; line-height: 150%">（</span><span style="font-size: 10pt; line-height: 150%">Prototype Pattern</span><span style="font-size: 10pt; line-height: 150%">）和工厂模式一样，同样对客户隐藏了对象创建工作，但是，与通过对一个类进行实例化来构造新对象不同的是，原型模式是通过拷贝一个现有对象生成新对象的。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><strong style="mso-bidi-font-weight: normal"><span style="font-size: 10pt; color: #006699; line-height: 150%">如何选择使用创建型模式</span></strong></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">继续考虑上面提到的游戏开发场景，假定在这个游戏场景中我们使用到的有墙（</span><span style="font-size: 10pt; line-height: 150%">Wall</span><span style="font-size: 10pt; line-height: 150%">），屋子（</span><span style="font-size: 10pt; line-height: 150%">Room</span><span style="font-size: 10pt; line-height: 150%">），门（</span><span style="font-size: 10pt; line-height: 150%">Door</span><span style="font-size: 10pt; line-height: 150%">）几个部件。在这个过程中，同样是对象的创建问题，但是会根据所要解决的问题不同而使用不同的创建型模式。</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">如果在游戏中，一个屋子只允许有一个门存在，那么这就是一个使用</span><span style="font-size: 10pt; line-height: 150%">Signleton</span><span style="font-size: 10pt; line-height: 150%">模式的例子，确保只有一个</span><span style="font-size: 10pt; line-height: 150%">Door</span><span style="font-size: 10pt; line-height: 150%">类的实例被创建。解决的是对象创建个数的问题。</span></p> 
<p class="MsoNormal" style="line-height: 150%; text-align: center" align="center"><span style="font-size: 10pt; line-height: 150%"><img height="55" hspace="0" width="113" src="image/.NET设计模式（7）：创建型模式专题总.PIC081.jpg" /><p class="origImg">http://terrylee.cnblogs.com/images/cnblogs_com/terrylee/PIC081.jpg</p></span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">示例代码：</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">using</span><span style="font-size: 10pt; mso-hansi-: 0pt"> System;</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">public</span><span style="font-size: 10pt; mso-hansi-: 0pt"> <span style="color: blue">sealed</span> <span style="color: blue">class</span> SigletonDoor</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">static</span> <span style="color: blue">readonly</span> SigletonDoor instance<span style="color: fuchsia">=</span><span style="color: blue">new</span> SigletonDoor();</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">static</span> SigletonDoor()</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">public</span> <span style="color: blue">static</span> SigletonDoor Instance</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">get</span></span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">return</span> instance;</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>}</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">}</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">在游戏中需要创建墙，屋子的实例时，为了避免直接对构造器的调用而实例化类，这时就是工厂方法模式了，每一个部件都有它自己的工厂类。解决的是“单个对象”的需求变化问题。</span></p> 
<p class="MsoNormal" style="line-height: 150%; text-align: center" align="center"><span style="font-size: 10pt; line-height: 150%"><img height="168" hspace="0" width="323" src="image/.NET设计模式（7）：创建型模式专题总.PIC082.jpg" /><p class="origImg">http://terrylee.cnblogs.com/images/cnblogs_com/terrylee/PIC082.jpg</p></span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%">示例代码：</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">using</span><span style="font-size: 10pt; mso-hansi-: 0pt"> System;</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">public</span><span style="font-size: 10pt; mso-hansi-: 0pt"> <span style="color: blue">abstract</span> <span style="color: blue">class</span> Wall</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">public</span> <span style="color: blue">abstract</span> <span style="color: blue">void</span> Display();</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">public</span><span style="font-size: 10pt; mso-hansi-: 0pt"> <span style="color: blue">class</span> ModernWall:Wall</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">void</span> Display()</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Console<span style="color: fuchsia">.</span>WriteLine(<span style="color: maroon">&quot;ModernWall Builded&quot;</span>);</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">public</span><span style="font-size: 10pt; mso-hansi-: 0pt"> <span style="color: blue">abstract</span> <span style="color: blue">class</span> WallFactory</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">public</span> <span style="color: blue">abstract</span> Wall Create();</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">}</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; color: blue; mso-hansi-: 0pt">public</span><span style="font-size: 10pt; mso-hansi-: 0pt"> <span style="color: blue">class</span> ModernFactory:WallFactory</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt">{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">public</span> <span style="color: blue">override</span> Wall Create()</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>{</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">return</span> <span style="color: blue">new</span> ModernWall();;</span></p> 
<p class="MsoNormal" style="text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 10pt; mso-hansi-: 0pt"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </span>}</span></p> 
<p class="MsoNormal" style="line-height: 150%"><span style="font-size: 10pt; line-height: 150%; mso-hansi-: 0pt">}</span></p> 
<p class="MsoNormal" style="line-height: 150%"> </p></div></body></html>