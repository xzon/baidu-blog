<html><head><title><div class="tit">
  函数指针 (*(void (*)( ) )0)( ) 解析
</div></title></head><body><div id='tit'>函数指针 (*(void (*)( ) )0)( ) 解析</div><div id='cate'>c&middot;基础</div><div id='date'>2009年08月06日 星期四 09:47 P.M.</div><div id='page'>38</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/4a613fdbceb6ce6fd0164e9b.html'>http://hi.baidu.com/hxzon/blog/item/4a613fdbceb6ce6fd0164e9b.html</a><div id='cnt'><h1>函数指针 (*(void (*)( ) )0)( ) 解析</h1> 
<p>概述<br /> <br /> 在很多情况下，尤其是读别人所写代码的时候，对 C语言声明的理解能力变得非常重要，而C语言本身的凝练简约也使得C语言的声明常常会令人感到非常困惑，因此，在这里我用一篇的内容来集中阐述一下这个问题。<br /> <br /> 问题：声明与函数<br /> <br /> 有一段程序存储在起始地址为 0的一段内存上，如果我们想要调用这段程序，请问该如何去做？<br /> <br /> 答案<br /> <br /> 答案是 (*(void (*)( ) )0)( )。看起来确实令人头大，那好，让我们知难而上，从两个不同的途径来详细分析这个问题。<br /> <br /> 答案分析：从尾到头<br /> <br /> 首先，最基本的函数声明： void function (paramList);<br /> <br /> 最基本的函数调用： function(paramList);<br /> <br /> 鉴于问题中的函数没有参数，函数调用可简化为 function();<br /> <br /> 其次，根据问题描述，可以知道 0是这个函数的入口地址，也就是说，0是一个函数的指针。使用函数指针的函数声明形式是：void (*pFunction)()，相应的调用形式是： (*pFunction)()，则问题中的函数调用可以写作：(*0)( )。<br /> <br /> 第三，大家知道，函数指针变量不能是一个常数，因此上式中的 0必须要被转化为函数指针。<br /> <br /> 我们先来研究一下，对于使用函数指针的函数：比如 void (*pFunction)( )，函数指针变量的原型是什么？这个问题很简单，pFunction函数指针原型是( void (*)( ) )，即去掉变量名，清晰起见，整个加上（）号。<br /> <br /> 所以将 0强制转换为一个返回值为void，参数为空的函数指针如下：( void (*)( ) )。<br /> <br /> OK，结合2)和3)的分析，结果出来了，那就是：(*(void (*)( ) )0)( ) 。<br /> <br /> 答案分析：从头到尾理解答案<br /> <br /> (void (*)( )) ，是一个返回值为void，参数为空的函数指针原型。<br /> (void (*)( ))0，把0转变成一个返回值为void，参数为空的函数指针，指针指向的地址为0.<br /> *(void (*)( ))0，前面加上*表示整个是一个返回值为void的函数的名字<br /> (*(void (*)( ))0)( )，这当然就是一个函数了。<br /> <br /> 我们可以使用 typedef清晰声明如下：<br /> <br /> typedef void (*pFun)( );<br /> <br /> 这样定义之后，pFun就是一个返回类型为void无参数的函数指针变量了。<br /> <br /> 这样函数变为 (*(pFun)0 )( );<br /> <br /> 问题：三个声明的分析<br /> <br /> 对声明进行分析，最根本的方法还是类比替换法，从那些最基本的声明上进行类比，简化，从而进行理解，下面通过分析三个例子，来具体阐述如何使用这种方法。<br /> <br /> ＃ 1：int* (*a[5])(int, char*);<br /> <br /> 首先看到标识符名 a，&quot;[]&quot;优先级大于&quot;*&quot;，a与&quot;[5]&quot;先结合。所以a是一个数组，这个数组有5个元素，每一个元素都是一个指针，指针指向&quot;(int, char*)&quot;，很明显，指向的是一个函数，这个函数参数是&quot;int, char*&quot;，返回值是&quot;int*&quot;。OK，结束了一个。：）<br /> <br /> ＃ 2：void (*b[10]) (void (*)());<br /> <br /> b是一个数组，这个数组有10个元素，每一个元素都是一个指针，指针指向一个函数，函数参数是&quot;void (*)()&quot;【注10】，返回值是&quot;void&quot;。完毕！<br /> <br /> 注意：这个参数又是一个指针，指向一个函数，函数参数为空，返回值是 &quot;void&quot;。<br /> <br /> ＃ 3. doube(*)() (*pa)[9];<br /> <br /> pa是一个指针，指针指向一个数组，这个数组有9个元素，每一个元素都是&quot;doube(*)()&quot;（也即一个函数指针，指向一个函数，这个函数的参数为空，返回值是&quot;double&quot;）。<br /> <br /> C语言中的函数指针<br /> <br /> 函数在内存中有一个物理位置，而这个位置是可以赋给一个指针的。一零点函数的地址就是该函数的入口点。因此，函数指针可被用来调用一个函数。函数的地址是用不带任何括号或参数的函数名来得到的。（这很类似于数组地址的得到方法，即，在只有数组名而无下标是就得到数组地址。）<br /> <br /> 怎样说明一个函数指针变量呢 ?<br /> 为了说明一个变量 fn_pointer 的类型是&quot;返回值为 int 的函数指针&quot;, 你可以使用下面的说明语句:<br /> int (*fn_pointer) ();<br /> 为了让编译器能正确地解释这句语句, *fn_pointer 必须用括号围起来。若漏了这对括号, 则:<br /> int *fn_pointer ();<br /> 的意思完全不同了。fn_pointer 将是一个函数名, 其返回值为 int 类型的指针。<br /> <br /> 函数指针变量 <br /> <br /> 在Ｃ语言中规定，一个函数总是占用一段连续的内存区，&nbsp;&nbsp; 而函数名就是该函数所占内存区的首地址。&nbsp;&nbsp; 我们可以把函数的这个首地址 ( 或称入口地址 ) 赋予一个指针变量，&nbsp;&nbsp; 使该指针变量指向该函数。然后通过指针变量就可以找到并调用这个函数。&nbsp;&nbsp; 我们把这种指向函数的指针变量称为 &quot; 函数指针变量 &quot; 。 <br /> 函数指针变量定义的一般形式为： <br /> 类型说明符 (* 指针变量名 )(); <br /> 其中 &quot; 类型说明符 &quot; 表示被指函数的返回值的类型。 &quot;(* 指针变量名 )&quot; 表示 &quot;*&quot; 后面的变量是定义的指针变量。&nbsp;&nbsp; 最后的空括号表示指针变量所指的是一个函数。 <br /> 例如： int (*pf)(); <br /> 表示 pf 是一个指向函数入口的指针变量，该函数的返回值 ( 函数值 ) 是整型。 <br /> 下面通过例子来说明用指针形式实现对函数调用的方法。 <br /> int max(int a,int b){ <br /> if(a&gt;b)return a; <br /> else return b; <br /> } <br /> main(){ <br /> int max(int a,int b); <br /> int(*pmax)(); <br /> int x,y,z; <br /> pmax=max; <br /> printf(&quot;input two numbers:\n&quot;); <br /> scanf(&quot;%d%d&quot;,&amp;x,&amp;y); <br /> z=(*pmax)(x,y); <br /> printf(&quot;maxmum=%d&quot;,z); <br /> } <br /> 从上述程序可以看出用，函数指针变量形式调用函数的步骤如下：<br /> <br /> 1. 先定义函数指针变量，如后一程序中第 9 行 int (*pmax)(); 定义 pmax 为函数指针变量。 <br /> <br /> 2. 把被调函数的入口地址 ( 函数名 ) 赋予该函数指针变量，如程序中第 11 行 pmax=max; <br /> <br /> 3. 用函数指针变量形式调用函数，如程序第 14 行 z=(*pmax)(x,y); 调用函数的一般形式为： (* 指针变量名 ) ( 实参表 ) 使用函数指针变量还应注意以下两点： <br /> <br /> a. 函数指针变量不能进行算术运算，这是与数组指针变量不同的。数组指针变量加减一个整数可使指针移动指向后面或前面的数组元素，而函数指针的移动是毫无意义的。 <br /> <br /> b. 函数调用中 &quot;(* 指针变量名 )&quot; 的两边的括号不可少，其中的 * 不应该理解为求值运算，在此处它只是一种表示符号。</p></div></body></html>