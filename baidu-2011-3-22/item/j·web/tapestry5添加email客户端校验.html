<html><head><title><div class="tit">
  tapestry5添加email客户端校验
</div></title></head><body><div id='tit'>tapestry5添加email客户端校验</div><div id='cate'>j&middot;web</div><div id='date'>2010年08月26日 星期四 04:03 P.M.</div><div id='page'>9</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/f12def50b34bd4521138c27e.html'>http://hi.baidu.com/hxzon/blog/item/f12def50b34bd4521138c27e.html</a><div id='cnt'><p>tapestry5添加email客户端校验</p> 
<p>hxzon:ok.</p> 
<p>1，服务端覆盖email校验器</p> 
<pre>public static void contributeFieldValidatorSource(MappedConfiguration&lt;String, Validator&gt; configuration) {<br />  configuration.override(&quot;email&quot;, new org.hxzon.tapestry5.validator.Email());<br /> }</pre> 
<p>email校验器发送客户端校验代码</p> 
<pre>package org.hxzon.tapestry5.validator;<br /><br />import org.apache.tapestry5.Field;<br />import org.apache.tapestry5.MarkupWriter;<br />import org.apache.tapestry5.ioc.MessageFormatter;<br />import org.apache.tapestry5.services.FormSupport;<br /><br />public class Email extends org.apache.tapestry5.validator.Email {<br /> public void render(Field field, Void constraintValue, MessageFormatter formatter, MarkupWriter markupWriter,<br />   FormSupport formSupport) {<br /><br />  formSupport.addValidation(field, &quot;email&quot;, buildMessage(formatter, field), null);<br /> }<br /><br /> private String buildMessage(MessageFormatter formatter, Field field) {<br />  return formatter.format(field.getLabel());<br /> }<br />}</pre> 
<p>2，添加客户端email校验器</p> 
<pre>Tapestry.Validator.isRFC822ValidEmail = function(sEmail) {<br />        <br />        var sQtext = '[^\\x0d\\x22\\x5c\\x80-\\xff]';<br />        var sDtext = '[^\\x0d\\x5b-\\x5d\\x80-\\xff]';<br />        var sAtom = '[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+';<br />        var sQuotedPair = '\\x5c[\\x00-\\x7f]';<br />        var sDomainLiteral = '\\x5b(' + sDtext + '|' + sQuotedPair + ')*\\x5d';<br />        var sQuotedString = '\\x22(' + sQtext + '|' + sQuotedPair + ')*\\x22';<br />        var sDomain_ref = sAtom;<br />        var sSubDomain = '(' + sDomain_ref + '|' + sDomainLiteral + ')';<br />        var sWord = '(' + sAtom + '|' + sQuotedString + ')';<br />        var sDomain = sSubDomain + '(\\x2e' + sSubDomain + ')*';<br />        var sLocalPart = sWord + '(\\x2e' + sWord + ')*';<br />        var sAddrSpec = sLocalPart + '\\x40' + sDomain; // complete RFC822 email address spec<br />        var sValidEmail = '^' + sAddrSpec + '$'; // as whole string<br />          <br />        var reValidEmail = new RegExp(sValidEmail);<br />          <br />        if (reValidEmail.test(sEmail)) {<br />          return true;<br />        }<br />          <br />        return false;<br />};<br /><br />Tapestry.Validator.email=function(field, message) {<br />    field.addValidator(function(value) {<br />        if (!Tapestry.Validator.isRFC822ValidEmail(value)) {<br />                throw message;<br />        }<br />//     var regexp = /^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/; <br />//     if (! regexp.test(value)) throw message;<br />    });<br />};</pre> 
<p>===========================</p> 
<p>参考</p> 
<p>tapestry-validator</p> 
<p>http://code.google.com/p/tapestry-validator/</p> 
<p>http://code.google.com/p/tapestry-validator/source/browse/trunk/tapestry-validator/tapestry-validator-hibernate/src/main/resources/com/googlecode/tapestry5validator/tapestry-validator.js?r=16</p> 
<p> </p></div></body></html>