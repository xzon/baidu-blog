<html><head><title><div class="tit">
  JNDI配置原理详解
</div></title></head><body><div id='tit'>JNDI配置原理详解</div><div id='cate'>j&middot;入门</div><div id='date'>2007年11月25日 星期日 04:36 P.M.</div><div id='page'>203</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/78b681012b8444d5277fb5da.html'>http://hi.baidu.com/hxzon/blog/item/78b681012b8444d5277fb5da.html</a><div id='cnt'><div class="tit"> 
 <p>JNDI配置原理详解</p> 
 <p>2006年10月11日 星期三 下午 06:04</p> 
</div> 
<table style="table-layout: fixed" class="FCK__ShowTableBorders"> 
 <tbody> 
  <tr> 
   <td> 
    <div class="cnt"> 
     <div style="clear: both"> 
     </div> 
     <div class="post"> 
      <div class="postTitle">
       最近写书，写到JNDI，到处查资料，发现所有的中文资料都对JNDI解释一通，配置代码也是copy的，调了半天也没调通，最后到SUN的网站参考了一下他的JNDI tutorial，终于基本上彻底明白了
      </div> 
      <div class="postText"> 
       <p>和多数java服务一样，SUN对JNDI也只提供接口，使用JNDI只需要用到JNDI接口而不必关心具体实现：</p> 
       <p>private static Object jndiLookup() throws Exception {<br /> InitialContext ctx = new InitialContext();<br /> return ctx.lookup(&quot;java:comp/env/systemStartTime&quot;);<br /> }</p> 
       <p>上述代码在J2EE服务器环境下工作得很好，但是在main()中就会报一个NoInitialContextException，许多文章会说你创建InitialContext的时候还要传一个Hashtable或者Properties，像这样：</p> 
       <p>Hashtable env = new Hashtable();<br /> env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;weblogic.jndi.WLInitialContextFactory&quot;);<br /> env.put(Context.PROVIDER_URL,&quot;t3://localhost:7001&quot;);<br /> InitialContext ctx = new InitialContext(env);</p> 
       <p>这个在WebLogic环境下是对的，但是换到JBoss呢？再用JBoss的例子？</p> 
       <p>其实之所以有NoInitialContextException是因为无法从System.properties中获得必要的JNDI参数，在服务器环境下，服务器启动时就把这些参数放到System.properties中了，于是直接new InitialContext()就搞定了，不要搞env那么麻烦，搞了env你的代码还无法移植，弄不好管理员设置服务器用的不是标准端口还照样抛异常。</p> 
       <p>但是在单机环境下，可没有JNDI服务在运行，那就手动启动一个JNDI服务。我在JDK 5的rt.jar中一共找到了4种SUN自带的JNDI实现：</p> 
       <p>LDAP，CORBA，RMI，DNS。</p> 
       <p>这4种JNDI要正常运行还需要底层的相应服务。一般我们没有LDAP或CORBA服务器，也就无法启动这两种JNDI服务，DNS用于查域名的，以后再研究，唯一可以在main()中启动的就是基于RMI的JNDI服务。</p> 
       <p>现在我们就在main()中启动基于RMI的JNDI服务并且绑一个Date对象到JNDI上：</p> 
       <p>LocateRegistry.createRegistry(1099);<br /> System.setProperty(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);<br /> System.setProperty(Context.PROVIDER_URL, &quot;rmi://localhost:1099&quot;);<br /> InitialContext ctx = new InitialContext();<br /> class RemoteDate extends Date implements Remote {};<br /> ctx.bind(&quot;java:comp/env/systemStartTime&quot;, new RemoteDate());<br /> ctx.close();</p> 
       <p>注意，我直接把JNDI的相关参数放入了System.properties中，这样，后面的代码如果要查JNDI，直接new InitialContext()就可以了，否则，你又得写Hashtable env = ...</p> 
       <p>在RMI中绑JNDI的限制是，绑定的对象必须是Remote类型，所以就自己扩展一个。</p> 
       <p>其实JNDI还有两个Context.SECURITY_PRINCIPAL和Context.SECURITY_CREDENTIAL，如果访问JNDI需要用户名和口令，这两个也要提供，不过一般用不上。</p> 
       <p>在后面的代码中查询就简单了：</p> 
       <p>InitialContext ctx = new InitialContext();<br /> Date startTime = (Date) ctx.lookup(&quot;java:comp/env/systemStartTime&quot;);</p> 
       <p>在SUN的JNDI tutorial中的例子用的com.sun.jndi.fscontext.RefFSContextFactory类，但是我死活在JDK 5中没有找到这个类，也就是NoClassDefFoundError，他也不说用的哪个扩展包，我也懒得找了。</p> 
      </div> 
     </div> 
    </div> </td> 
  </tr> 
 </tbody> 
</table></div></body></html>