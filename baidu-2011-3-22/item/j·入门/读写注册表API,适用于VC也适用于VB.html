<html><head><title><div class="tit">
  读写注册表API,适用于VC也适用于VB
</div></title></head><body><div id='tit'>读写注册表API,适用于VC也适用于VB</div><div id='cate'>j&middot;入门</div><div id='date'>2008年02月25日 星期一 11:08 P.M.</div><div id='page'>173</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/06bb748b26102616c8fc7acb.html'>http://hi.baidu.com/hxzon/blog/item/06bb748b26102616c8fc7acb.html</a><div id='cnt'><div>
 <font size="3">读写注册表API,适用于VC也适用于VB</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">下面先来看一下这些和操作注册表相关的API函数。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">为了方便下面的函数声明以及函数原型都是用C写的，如果要把这些API函数用于VB，只需要把函数名复制到VB带的API文本浏览器里面生成对应于VB的函数声明即可。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">1、RegCloseKey()<br /> 原型：RegCloseKey(HKEY hKey)</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：关闭指定的注册表键，释放句柄。当对一个或多个键或值操作完成以后，需要关闭其键来进行保存操作结果，关闭一个键后，句柄变为非法，此时应释放句柄。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">2、RegCreateKeyEx()<br /> 原型：LONG RegCreateKeyEx( HKEY hKey, LPCTSTR lpSubKey, DWORD Reserved,<br /> LPTSTR lpClass, DWORD dwOptions, REGSAM samDesired, LPSECURITY_ATTRIBUTES lpSecurityAttributes,<br /> PHKEY phkResult, LPDWORD lpdwDisposition );</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：打开指定的键或子键。如果要打开的键不存在的话，本函数会试图建立它。提供该函数是为了向后兼容。所有的WIN32应用程序应使用函数RegCreateKeyEx（）。 各参数及返回值的含义如下：<br /> &middot;hKey为主键值，可以取下面的一些数值：HKEY_CLASSES_ROOT、HKEY_CURRENT_CONFIG、 HKEY_CURRENT_USER、HKEY_LOCAL_MACHINE、HKEY_USER、HKEY_PERFORMANCE_DATA(WINNT操作系统)、HKEY_DYN_DATA（WIN9X操作系统）；&middot;参数lpSubKey为一个指向以零结尾的字符串的指针，其中包含将要创建或打开的子键的名称。子键不可以用反斜线（\）开始。该参数可以为NULL；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数Reserved为保留值，必须设置为0；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数lpClass为一个指向包含键类型的字符串。如果该键已经存在，则忽略该参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数dwOptions为新创建的键设置一定的属性。可以取下面的一些数值： REG_OPTION_NON_VOLATILE ，表示新创建的键为一个非短暂性的键（数据信息保存在文件中，当系统重新启动时，数据信息恢复）；REG_OPTION_VOLATILE，表示新创建的键为一个短暂性的键（数据信息保存在内存中），Windows95忽略该数值；REG_OPTION_BACKUP_RESTORE 仅在WINNT中支持，可以提供优先级支持；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数dwOptions为新创建的键设置一定的属性。可以取下面的一些数值： REG_OPTION_NON_VOLATILE ，表示新创建的键为一个非短暂性的键（数据信息保存在文件中，当系统重新启动时，数据信息恢复）；REG_OPTION_VOLATILE，表示新创建的键为一个短暂性的键（数据信息保存在内存中），Windows95忽略该数值；REG_OPTION_BACKUP_RESTORE 仅在WINNT中支持，可以提供优先级支持；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数samDesired用来设置对键访问的权限，可以取下面的一些数值：KEY_CREATE_LINK，表示准许生成符号键；KEY_CREATE_SUB_KEY 表示准许生成子键；KEY_ENUMERATE_SUB_KEYS 表示准许生成枚举子键；KEY_EXECUTE 表示准许进行读操作；KEY_NOTIFY表示准许更换通告； KEY_QUERY_VALUE 表示准许查询子键；KEY_ALL_ACCESS 提供完全访问，是上面数值的组合；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> KEY_READ 是下面数值的组合：KEY_QUERY_VALUE、KEY_ENUMERATE_SUB_KEYS、KEY_NOTIFY； KEY_SET_VALUE 表示准许设置子键的数值；KEY_WRITE 是下面数值的组合：KEY_SET_VALUE、KEY_CREATE_SUB_KEY；<br /> &middot;参数lpSecurityAttributes为一个指向SECURITY_ATTRIBUTES结构的指针，确定返回的句柄是否被子处理过程继承。如果该参数为NULL，则句柄不可以被继承。在WINNT中，该参数可以为新创建的键增加安全的描述；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数phkResult为一个指向新创建或打开的键的句柄的指针；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpdwDispition指明键是被创建还是被打开的，可以是下面的一些数值： REG_CREATE_NEW_KEY 表示键先前不存在，现在被创建；REG_OPENED_EXISTING_KEY 表示键先前已存在，现在被打开。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 如果该函数调用成功，则返回ERROR_SUCCESS。否则，返回值为文件WINERROR.h中定义的一个非零的错误代码，可以通过设置FORMAT_MESSAGE_FROM_SYSTEM标识调用FormatMessage()函数来获取一个对错误的总体描述。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">3、RegOpenKeyEx（）<br /> 原型：LONG RegOpenKeyEx(HKEY hKey, LPCTSTR lpSubKey, DWORD ulOptions,<br /> REGSAM samDesired, PHKEY phkResult );</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：打开一个指定的键，并返回打开键的句柄。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">各参数及返回值的含义如下：<br /> &middot;参数hKey的含义同RegCreateKeyEx函数中的hKey参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数lpSubKey为一个指向以零结尾的字符串的指针，其中包含子键的名称，可以利用反斜线（\）分隔不同的子键名。如果字符串为空，则根据hKey参数创建一个新的句柄。在这种情况下，并不关闭先前打开的句柄；&middot;参数ulOption保留，通常必须设置为0；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数samDesired的含义同RegCreateKeyEx函数中的samDesired参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;参数phkResult为一个指针，用来指向打开的键的句柄。可以通过RegCloseKey函数关闭这个句柄；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">&middot;函数的返回值同RegCreateKeyEx函数的返回值。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">4、查询某一个键值：RegQueryValueEx（）</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 原型：LONG RegQueryValueEx(HKEY hKey, LPCTSTR lpValueName, LPDWORD pReserved, LPDWORD lpType,<br /> LPBYTE lpData, LPDWORD lpcbData );</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：根据要查询的键的句柄，要返回的查询的数据。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 各个参数及返回值的含义如下：</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数hKey为当前的一个打开的键的句柄，具体数值同RegCreateKeyEx函数的hKey参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpVauleName为一个指向非空的包含查询值的名称的字符串指针；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpReserved保留，必须为NULL；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpType为一个指向数据类型的指针，数据类型为下列类型之一：REG_BINARY 二进制数据、REG_DWORD 32位整数、REG_DWORD_LITTLE_ENDIAN little－endian格式的数据，例如0X12345678以（0X78 0X56 0X34 0X12）方式保存、REG_DWORD_BIG_ENDIAN big－endian格式的数据，例如0X12345678以（0X12 0X34 0X56 0X78）方式保存、REG_EXPAND_SZ 一个包含未扩展环境变量的字符串、REG_LINK 一个Unicode类型的链接、REG_MULIT_SZ 以两个零结尾的字符串、REG_NONE 无类型数值、REG_RESOURCE_LIST 设备驱动资源列表、REG_SZ 一个以零结尾的字符串根据函数使用的字符集类型的不同而设置为Unicode或ANSI类型的字符串；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpData为一个指向保存返回值的变量的指针。如果不需要返回值，该参数可以为NULL；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpcbData为一个指向保存返回值长度的变量的指针。其中长度以字节为单位。如果数据类型为REG_SZ、REG_MULTI_SZ或REG_EXPAND_SZ，那么长度也包括结尾的零字符，只有在参数lpData为NULL时，参数lpcbData才可以为NULL；返回值同RegCreateKeyEx函数的返回值；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">5、RegSetValueEx（）</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 原型：LONG RegSetValueEx(HKEY hKey, LPCTSTR lpValueName, LPDWORD lpReserved, DWORD dwType,<br /> const BYTE *lpData, DWORD cbData);</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：设置注册表中的一个键值。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 各个参数及返回值的含义如下：</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数hKey的含义同RegCreateKeyEx函数中的hKey参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpValueName为一个指向包含值名的字符串指针；Reserved保留，通常必须设置为0；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数dwType确定了设置的值的类型同RegQueryValueKeyEx的lyType参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpData为一个指向包含数据的缓冲区的指针；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数cbData以字节为单位，指定数据的长度；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 返回值同RegCreateKeyEx函数的返回值。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">6、RegDeketeKey（）</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 原型：LONG RegDeleteKey（HKEY hKey，LPCTSTR lpSubKEY）；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 解释：函数RegDeketeKey删除一个键及所有的子键。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> 各个参数及返回值的含义如下：</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数hKey的含义同RegCreateKeyEx函数中的hKey参数；</font>
</div> 
<div> 
</div> 
<div>
 <font size="3"> &middot;参数lpSubKey的含义同RegCreateKeyEx函数中的lpSubKey参数</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">上面的这些函数组合使用就可以轻松的操作注册表了。</font>
</div> 
<div> 
</div> 
<div>
 <font size="3">(转载请注明来自编程世界</font>
 <a href="http://www.ibiancheng.cn/"><font size="3">http://www.ibiancheng.cn</font></a>
 <font size="3">)<br /> 更新时间：2008-1-12&nbsp;&nbsp;&nbsp; </font>
</div></div></body></html>