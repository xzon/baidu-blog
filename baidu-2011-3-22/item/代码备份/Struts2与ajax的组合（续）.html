<html><head><title><div class="tit">
  Struts2与ajax的组合（续）
</div></title></head><body><div id='tit'>Struts2与ajax的组合（续）</div><div id='cate'>代码备份</div><div id='date'>2008年09月25日 星期四 09:55 A.M.</div><div id='page'>97</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/c8915db51553a1c837d3ca0f.html'>http://hi.baidu.com/hxzon/blog/item/c8915db51553a1c837d3ca0f.html</a><div id='cnt'><p> </p> 
<p>Struts2与ajax的组合（续）</p> 
<p>&nbsp;&nbsp;&nbsp; &lt;body&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tree <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div style=&quot;float:left; margin-right: 50px;&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:tree label=&quot;parent&quot; id=&quot;parentId&quot; theme=&quot;ajax&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; templateCssPath=&quot;/struts/tree.css&quot; showRootGrid=&quot;true&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showGrid=&quot;true&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;child1&quot; id=&quot;child1Id&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;grandchild1&quot; id=&quot;grandchild1Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;grandchild2&quot; id=&quot;grandchild2Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;grandchild3&quot; id=&quot;grandchild3Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/s:treenode&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;child2&quot; id=&quot;child2Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;child3&quot; id=&quot;child3Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;child4&quot; id=&quot;child4Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;child5&quot; id=&quot;child5Id&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;gChild1&quot; id=&quot;gChild1Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:treenode theme=&quot;ajax&quot; label=&quot;gChild2&quot; id=&quot;gChild2Id&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/s:treenode&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/s:tree&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/body&gt; <br /> &lt;/html&gt; <br /> 清单10 WebContent/Tree.jsp</p> 
<p>因为Dojo的树控件，即使在没有设定“selector”情况下，也会自动生成一个默认的Selector，所以只要将其事件绑定到特定的事件处理函数即可。 <br /> 打开<a href="http://localhost:8080/Struts2_Ajax/Tree.jsp">http://localhost:8080/Struts2_Ajax/Tree.jsp</a>，点击任一树节点，页面如下图所示：</p> 
<p><br /> 图3 Tree.jsp页面输出 <br /> 更多&lt;s:tree /&gt; <br /> 在Struts 2的showcase中有两个&lt;s:tree /&gt;的例子，分别是静态树与动态树。所谓的静态树即是在编写JSP代码时通过&lt;s:treenode /&gt;生成树节点。我的上一篇文章的例子就是一个典型的静态树。而动态树则是在程序运行期间，Struts 2 运行时（Runtime）根据程序中的数据动态创建树节点。虽然在两个例子中&lt;s:tree /&gt;的theme属性都为“ajax”，但是从严格意义上来说，这两种树都不属于AJAX树，因为它们都是在输出页面时将全部节点加载到其中，而不是在父节点展开时通过XHR（XMLHttpRequest）获取节点数据。 <br /> 动态树 <br /> 下面我们先看一下动态树的例子，接着再一步步地将其改造为名副其实的AJAX 树。下例将会把WEB应用程序的目录树展现在JSP页面中。因此，我需要先包装一下java.io.File 类，代码如下： <br /> package tutorial;</p> 
<p>import java.io.File;</p> 
<p>public class FileWrapper { <br /> &nbsp;&nbsp;&nbsp; private File file;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp; public FileWrapper(String path) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file = new File(path); <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public FileWrapper(File file) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.file = file; <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public String getId() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;file_&quot; + file.hashCode(); <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public String getName() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return file.getName(); <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public String getAbsolutePath() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return file.getAbsolutePath(); <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public FileWrapper[] getChildren() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File[] files = file.listFiles(); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(files != null &amp;&amp; files.length &gt; 0) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int length = files.length; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileWrapper[] wrappers = new FileWrapper[length]; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(int i = 0; i &lt; length; ++i) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappers[i] = new FileWrapper(files[i]); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return wrappers; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new FileWrapper[0]; <br /> &nbsp;&nbsp;&nbsp; } <br /> } <br /> 清单1 src/tutorial/FileWrapper.java <br /> 之所以需要对File类进行如此包装，是因为&lt;s:tree /&gt;用于动态树时，rootNode、nodeIdProperty、nodeTitleProperty 和 childCollectionProperty等属性都必填的。 <br /> 然后是Action类的代码如下： <br /> package tutorial;</p> 
<p>import javax.servlet.http.HttpServletRequest;</p> 
<p>import org.apache.struts2.interceptor.ServletRequestAware;</p> 
<p>import com.opensymphony.xwork2.ActionSupport;</p> 
<p>public class DynamicTreeAction extends ActionSupport implements ServletRequestAware { <br /> &nbsp;&nbsp;&nbsp; private static final long serialVersionUID = 1128593047269036737L; <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; private HttpServletRequest request; <br /> &nbsp;&nbsp;&nbsp; private FileWrapper root;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp; public void setServletRequest(HttpServletRequest request) {&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.request = request; <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public FileWrapper getRoot() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return root; <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; @Override <br /> &nbsp;&nbsp;&nbsp;&nbsp; public String execute() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root = new FileWrapper(request.getSession().getServletContext().getRealPath(&quot;/&quot;));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return SUCCESS; <br /> &nbsp;&nbsp;&nbsp; } <br /> } <br /> 清单2 src/tutorial/DynamicTreeAction.java <br /> 上述代码取得WEB应用程序的根目录的绝对路径后，初始化FileWrapper对象root。该对象将为JSP页面的&lt;s:tree /&gt;的根节点。如下代码所示： <br /> &lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot; <br /> &nbsp;&nbsp;&nbsp; pageEncoding=&quot;utf-8&quot;%&gt; <br /> &lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</p> 
<p>&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt; <br /> &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;head&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Struts 2 AJAX - More Tree&lt;/title&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:head theme=&quot;ajax&quot; debug=&quot;true&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;script type=&quot;text/javascript&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* &lt;![CDATA[ */ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function treeNodeSelected(arg) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(arg.source.title + ' selected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function treeNodeExpanded(arg) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(arg.source.title + ' expanded'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function treeNodeCollapsed(arg) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(arg.source.title + ' collapsed'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.addOnLoad(function() {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var t = dojo.widget.byId('appFiles'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.event.topic.subscribe(t.eventNames.expand, treeNodeExpanded);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.event.topic.subscribe(t.eventNames.collapse, treeNodeCollapsed); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var s = t.selector;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.event.connect(s, 'select', 'treeNodeSelected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* ]]&gt; */&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/script&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/head&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;body&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dynamic Tree Example <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div style=&quot;float:left; margin-right: 50px;&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:tree id=&quot;appFiles&quot; theme=&quot;ajax&quot; rootNode=&quot;root&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodeTitleProperty=&quot;name&quot; nodeIdProperty=&quot;id&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; childCollectionProperty=&quot;children&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/body&gt; <br /> &lt;/html&gt; <br /> 清单3 WebContent/Tree.jsp <br /> 因为&lt;s:tree /&gt;的treeCollapsedTopic和treeExpandedTopic属性都没有起作用，所以如果我们想要监听这两个事件，就必须使用上述代码的方法。 <br /> 最后是struts.xml配置文件： <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p> 
<p>&lt;!DOCTYPE struts PUBLIC <br /> &nbsp;&nbsp;&nbsp; &quot;-//Apache Software Foundation//DTD Struts Configuration 2.0//EN&quot; <br /> &nbsp;&nbsp;&nbsp; &quot;http://struts.apache.org/dtds/struts-2.0.dtd&quot;&gt;</p> 
<p>&lt;struts&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;package name=&quot;Struts2_AJAX_DEMO&quot; extends=&quot;struts-default&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;action name=&quot;DynamicTree&quot; class=&quot;tutorial.DynamicTreeAction&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;result&gt;Tree.jsp&lt;/result&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/action&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/package&gt; <br /> &lt;/struts&gt; <br /> 清单4 src/struts.xml <br /> 发布运行应用程序，在浏览器地址栏中键入http://localhost:8080/Struts2_Ajax2/DynamicTree.action，有如下图所示页面：</p> 
<p>图1 动态树示例 <br /> AJAX 树 <br /> 正如我在文章开头所说，Struts 2所提供的静态树和动态树都不是严格意义上的AJAX树。下面就让我们来实现一个如假包换的AJAX树。首先要说明的是，Struts 2的&lt;s:tree /&gt;默认是不支持这种按需加载数据的AJAX树。不过因为它是基于Dojo的树控件（Widget）所以要扩展也很方便。 <br /> Dojo 通过名为“TreeRPCController”的控件实现 AJAX 树，它会监听被控制树的事件。当发生展开节点的事件时，TreeRPCController就会向URL发送XHR请求，该URL由TreeRPCController的RPCUrl 属性定义。XHR请求格式类似如下格式： <br /> http://localhost:8080/Struts2_Ajax2/AjaxTree.action?action=getChildren&amp;data={&quot;node&quot;:{&quot;widgetId&quot;:&quot;file_226092423&quot;,&quot;objectId&quot;:&quot;C:\\Program Files\\Tomcat 5.5\\webapps\\Struts2_Ajax2&quot;,&quot;index&quot;:0,&quot;isFolder&quot;:true},&quot;tree&quot;:{&quot;widgetId&quot;:&quot;appFiles&quot;,&quot;objectId&quot;:&quot;&quot;}}&amp;dojo.preventCache=1182913465392 <br /> 清单5 XHR样本 <br /> 显而易见，请求中包含三个参数，分别是action为“getChildren”（固定值），data一个包含当前节点与树信息的JSON串和dojo.preventCache随机串，用于缓存不同节点的请求响应（父节点只会在第一次被展开时到服务器端加载数据，之后都是从浏览器的缓存中读取数据，可以提高应用程序性能）。 <br /> 首先我要先写一个加载树节点数据的Action类，代码如下： <br /> package tutorial;</p> 
<p>import java.util.Map;</p> 
<p>import com.googlecode.jsonplugin.JSONExeption; <br /> import com.googlecode.jsonplugin.JSONUtil;</p> 
<p>public class AjaxTreeAction extends DynamicTreeAction { <br /> &nbsp;&nbsp;&nbsp; private static final long serialVersionUID = 3970019751740942311L;</p> 
<p>&nbsp;&nbsp;&nbsp; private String action; <br /> &nbsp;&nbsp;&nbsp; private String data; <br /> &nbsp;&nbsp;&nbsp; private FileWrapper[] wrappers;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp; public void setAction(String action) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.action = action; <br /> &nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp; public void setData(String data) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.data = data; <br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp; public FileWrapper[] getWrappers() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return wrappers; <br /> &nbsp;&nbsp;&nbsp; }</p> 
<p>&nbsp;&nbsp;&nbsp; @Override <br /> &nbsp;&nbsp;&nbsp;&nbsp; public String execute() { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(&quot;getChildren&quot;.equals(action)) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object o = JSONUtil.deserialize(data); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String path = ((Map) ((Map) o).get(&quot;node&quot;)).get(&quot;objectId&quot;).toString(); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappers = new FileWrapper(path).getChildren(); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (JSONExeption e) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;ajax&quot;; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return super.execute(); <br /> &nbsp;&nbsp;&nbsp; } <br /> } <br /> 清单6 src/tutorial/AjaxTreeAction.java <br /> 上述代码可能需要解释一下： <br /> 1. action属性对应于XHR中的action，如果它为“getChildren”时，则需要进行加载子节点操作。否则，会读取树的根节点，并返回JSP页面； <br /> 2. 通过上面XHR的分析，大家可以知道data是代表树和当前节点的JSON串，故应将其反串行化为Map对象，并将其 objectId属性取出。通常情况下，Dojo树的objectId属性代表服务器端的对象的标识，在本例中为文件夹的绝对路径； <br /> 3. wrappers属性表示当前文件夹下的文件数组，它被传送到Freemarker页面，翻译为Dojo树节点数组的JSON串。 <br /> 下面是Freemarker页面的代码： <br /> [ <br /> &lt;#list wrappers as r&gt; <br /> &nbsp;&nbsp;&nbsp; { &quot;title&quot;: &quot;${r.name}&quot;, &quot;isFolder&quot;: &lt;#if r.children?size gt 0&gt;true&lt;#else&gt;false&lt;/#if&gt;, &quot;id&quot;: &quot;${r.id}&quot;, &quot;objectId&quot;: &quot;${r.absolutePath?js_string}&quot; }&lt;#if r_has_next&gt;,&lt;/#if&gt; <br /> &lt;/#list&gt; <br /> ] <br /> 清单7 WebContent/AjaxTree.ftl <br /> 以上代码中&lt;#list&gt;&lt;/#lsit&gt;的写法是Freemarker中遍历集合的写法；而&lt;#if r.children?size gt 0&gt;判断“r”对象的children属性是否为空；r.absolutePath?js_string 就是将“r”的absolutePath属性的值输出为Javascript 的字串符形式；&lt;#if r_has_next&gt;&lt;/#if&gt;判断集合是否有下一项数据。如果希望更详细地了解Freemarker的使用，请参考该手册。 <br /> 接下来，让我们看看Action的配置代码片段： <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;action name=&quot;AjaxTree&quot; class=&quot;tutorial.AjaxTreeAction&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;result&gt;AjaxTree.jsp&lt;/result&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;result name=&quot;ajax&quot; type=&quot;freemarker&quot;&gt;AjaxTree.ftl&lt;/result&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/action&gt; <br /> 清单8 src/struts.xml配置片段 <br /> 最后是JSP页面代码： <br /> &lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot; <br /> &nbsp;&nbsp;&nbsp; pageEncoding=&quot;utf-8&quot;%&gt; <br /> &lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</p> 
<p>&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt; <br /> &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;head&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Struts 2 AJAX - More Tree&lt;/title&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:head theme=&quot;ajax&quot; debug=&quot;true&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;script type=&quot;text/javascript&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* &lt;![CDATA[ */ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function treeNodeSelected(arg) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(arg.source.title + ' selected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.addOnLoad(function() {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var t = dojo.widget.byId('appFiles');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var s = t.selector;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.event.connect(s, 'select', 'treeNodeSelected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* ]]&gt; */&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/script&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/head&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;body&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AJAX Tree Example <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div style=&quot;float:left; margin-right: 50px;&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;script type=&quot;text/javascript&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* &lt;![CDATA[ */ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.lang.*&quot;); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.*&quot;); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.Tree&quot;); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.TreeRPCController&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* ]]&gt; */ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/script&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div dojoType=&quot;TreeRPCController&quot; widgetId=&quot;treeController&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DNDcontroller=&quot;create&quot; RPCUrl=&quot;&lt;s:url /&gt;&quot;&gt;&lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div dojoType=&quot;Tree&quot; widgetId=&quot;appFiles&quot; toggle=&quot;fade&quot; controller=&quot;treeController&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div dojoType=&quot;TreeNode&quot; title='&lt;s:property value=&quot;root.name&quot; /&gt;' <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; widgetId='&lt;s:property value=&quot;root.id&quot; /&gt;' <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isFolder='&lt;s:property value=&quot;root.children.length &gt; 0&quot; /&gt;' <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectId='&lt;s:property value=&quot;root.absolutePath&quot; /&gt;'&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/body&gt; <br /> &lt;/html&gt; <br /> 清单9 WebContent/AjaxTree.jsp <br /> 由于上面所提及的原因，我在上述的代码中并没有使用&lt;s:tree /&gt;标志，而是使用了Dojo的写法——创建 widgetId 为“treeController”的 TreeRPCController 并将设为树的控制器。 <br /> 发布运行应用程序，在浏览器地址栏中键入http://localhost:8080/Struts2_Ajax2/AjaxTree.action，点开某个节点，在节点加载的过程中，加号图标变成时钟状图标，如下图所示页面：</p> 
<p>图2 AJAX树示例 <br /> 自定义&lt;s:tree /&gt;的AJAX的主题（theme） <br /> Struts 2的标志过人之外在于它允许开发人员自定义标志的页面输出。要做到这一点，你所需要做的只是创建一个自定义的theme并将其应用到相应标志。下面就让我自定义一个真正的AJAX的&lt;s:tree/&gt;的theme。 <br /> 首先，你的源文件的根目录下新建包“template.realajax”。 <br /> 然后，在上一步所建的包中新建“tree.ftl”文件，内容如下： <br /> &lt;script type=&quot;text/javascript&quot;&gt; <br /> /* &lt;![CDATA[ */ <br /> &nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.lang.*&quot;); <br /> &nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.*&quot;); <br /> &nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.Tree&quot;); <br /> &nbsp;&nbsp;&nbsp; dojo.require(&quot;dojo.widget.TreeRPCController&quot;);&nbsp;&nbsp;&nbsp; &lt;#-- Added by Max --&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> /* ]]&gt; */ <br /> &lt;/script&gt;&nbsp;&nbsp;&nbsp; <br /> &lt;#-- Added by Max --&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &lt;div dojoType=&quot;TreeRPCController&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp; widgetId=&quot;${parameters.id?html}_controller&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp; DNDcontroller=&quot;create&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp; RPCUrl=&quot;&lt;@s.url /&gt;&quot;&gt; <br /> &lt;/div&gt; <br /> &lt;#-- End --&gt;&nbsp;&nbsp;&nbsp; <br /> &lt;div dojoType=&quot;Tree&quot;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.blankIconSrc?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcT=&quot;&lt;@s.url value='${parameters.blankIconSrc}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcL?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcL=&quot;&lt;@s.url value='${parameters.gridIconSrcL}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcV?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcV=&quot;&lt;@s.url value='${parameters.gridIconSrcV}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcP?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcP=&quot;&lt;@s.url value='${parameters.gridIconSrcP}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcC?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcC=&quot;&lt;@s.url value='${parameters.gridIconSrcC}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcX?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcX=&quot;&lt;@s.url value='${parameters.gridIconSrcX}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcY?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcY=&quot;&lt;@s.url value='${parameters.gridIconSrcY}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.gridIconSrcZ?exists&gt; <br /> &nbsp;&nbsp;&nbsp; gridIconSrcZ=&quot;&lt;@s.url value='${parameters.gridIconSrcZ}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.expandIconSrcPlus?exists&gt; <br /> &nbsp;&nbsp;&nbsp; expandIconSrcPlus=&quot;&lt;@s.url value='${parameters.expandIconSrcPlus}' includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.expandIconSrcMinus?exists&gt; <br /> &nbsp;&nbsp;&nbsp; expandIconSrcMinus=&quot;&lt;@s.url value='${parameters.expandIconSrcMinus?html}' includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.iconWidth?exists&gt; <br /> &nbsp;&nbsp;&nbsp; iconWidth=&quot;&lt;@s.url value='${parameters.iconWidth?html}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.iconHeight?exists&gt; <br /> &nbsp;&nbsp;&nbsp; iconHeight=&quot;&lt;@s.url value='${parameters.iconHeight?html}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.toggleDuration?exists&gt; <br /> &nbsp;&nbsp;&nbsp; toggleDuration=${parameters.toggleDuration?c} <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.templateCssPath?exists&gt; <br /> &nbsp;&nbsp;&nbsp; templateCssPath=&quot;&lt;@s.url value='${parameters.templateCssPath}' encode=&quot;false&quot; includeParams='none'/&gt;&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.showGrid?exists&gt; <br /> &nbsp;&nbsp;&nbsp; showGrid=&quot;${parameters.showGrid?default(true)?string}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.showRootGrid?exists&gt; <br /> &nbsp;&nbsp;&nbsp; showRootGrid=&quot;${parameters.showRootGrid?default(true)?string}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.id?exists&gt; <br /> &nbsp;&nbsp;&nbsp; id=&quot;${parameters.id?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.treeSelectedTopic?exists&gt; <br /> &nbsp;&nbsp;&nbsp; publishSelectionTopic=&quot;${parameters.treeSelectedTopic?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.treeExpandedTopic?exists&gt; <br /> &nbsp;&nbsp;&nbsp; publishExpandedTopic=&quot;${parameters.treeExpandedTopic?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.treeCollapsedTopic?exists&gt; <br /> &nbsp;&nbsp;&nbsp; publishCollapsedTopic=&quot;${parameters.treeCollapsedTopic?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.toggle?exists&gt; <br /> &nbsp;&nbsp;&nbsp; toggle=&quot;${parameters.toggle?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; controller=&quot;${parameters.id?html}_controller&quot; &lt;#-- Added by Max --&gt;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; &gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.label?exists&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;div dojoType=&quot;TreeNode&quot; title=&quot;${parameters.label?html}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;#if parameters.nodeIdProperty?exists&gt; <br /> &nbsp;&nbsp;&nbsp; id=&quot;${stack.findValue(parameters.nodeIdProperty)}&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;#else&gt; <br /> &nbsp;&nbsp;&nbsp; id=&quot;${parameters.id}_root&quot; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt; <br /> &nbsp;&nbsp;&nbsp; &gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#elseif parameters.rootNode?exists&gt; <br /> &nbsp;&nbsp;&nbsp; ${stack.push(parameters.rootNode)} <br /> &nbsp;&nbsp;&nbsp; &lt;#-- Edited by Max --&gt;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; &lt;div dojoType=&quot;TreeNode&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title=&quot;${stack.findValue(parameters.nodeTitleProperty)}&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; widgetId=&quot;${stack.findValue(parameters.nodeIdProperty)}&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isFolder=&quot;&lt;#if stack.findValue(parameters.childCollectionProperty)?size gt 0&gt;true&lt;#else&gt;false&lt;/#if&gt;&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectId=&quot;${stack.findValue(parameters.nameValue)}&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;#-- End --&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; &lt;#assign oldNode = stack.pop()/&gt; &lt;#-- pop the node off of the stack, but don't show it --&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/#if&gt;&nbsp;&nbsp;&nbsp; <br /> 清单10 src/template/realajax/tree.ftl <br /> 对上述稍作解释，上述代码主要在原版的src/template/ajax/tree.ftl的基础上添加了TreeRPCController的控件，并只输出根节点。由于&lt;s:tree /&gt;没有类似nodeObjectIdProperty的属性，所以我用了value属性表示objectId对应的属性名称。 <br /> 接着新建tree-close.ftl文件，内容和原版的一样，如下所示： <br /> &lt;#if parameters.label?exists&gt;&lt;/div&gt;&lt;/#if&gt;&lt;/div&gt; <br /> 清单11 src/template/realajax/tree-close.ftl <br /> 再下来就应该是将theme应用到&lt;s:tree /&gt;，如下代码所示： <br /> &lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot; <br /> &nbsp;&nbsp;&nbsp; pageEncoding=&quot;utf-8&quot;%&gt; <br /> &lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</p> 
<p>&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt; <br /> &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;head&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Struts 2 AJAX - More Tree&lt;/title&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:head theme=&quot;ajax&quot; debug=&quot;true&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;script type=&quot;text/javascript&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* &lt;![CDATA[ */ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function treeNodeSelected(arg) { <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(arg.source.title + ' selected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.addOnLoad(function() {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var t = dojo.widget.byId('appFiles');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var s = t.selector;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dojo.event.connect(s, 'select', 'treeNodeSelected'); <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* ]]&gt; */&nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/script&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/head&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;body&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AJAX Tree Example <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h2&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div style=&quot;float:left; margin-right: 50px;&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;s:tree id=&quot;appFiles&quot; theme=&quot;realajax&quot; rootNode=&quot;root&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodeTitleProperty=&quot;name&quot; nodeIdProperty=&quot;id&quot; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; childCollectionProperty=&quot;children&quot; value=&quot;absolutePath&quot; /&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt; <br /> &nbsp;&nbsp;&nbsp; &lt;/body&gt; <br /> &lt;/html&gt; <br /> 清单12 WebContent/AjaxTreeTheme.jsp <br /> 上述代码中&lt;s:tree /&gt;的用法，除了theme改为“realajax”和多了value=&quot;absolutePath&quot;外，几乎和静态树中的一样。 <br /> 为了不影响前一个例子，我们为该JSP文件配置类型相同的Action，如下代码所示： <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;action name=&quot;AjaxTreeTheme&quot; class=&quot;tutorial.AjaxTreeAction&quot;&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;result&gt;AjaxTreeTheme.jsp&lt;/result&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;result name=&quot;ajax&quot; type=&quot;freemarker&quot;&gt;AjaxTree.ftl&lt;/result&gt; <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/action&gt; <br /> 清单13 src/struts.xml配置片段 <br /> 发布运行应用程序，在浏览器地址栏中键入http://localhost:8080/Struts2_Ajax2/AjaxTreeTheme.action，结果如图2所示。 <br /> 总结 <br /> 通过上述例子，大家知道Struts 2 的AJAX 标志是基于Dojo控件开发的，所以如果大家希望熟练地使用这些标志，最好去了解一下Dojo。 <br /> 本来还打算介绍一下Struts 2与DWR，不过看看文章的篇幅似乎足够自成一篇了，因此DWR相关的内容要留待下文继续了。 <br /> http://zhangljerry.javaeye.com/blog/97838</p></div></body></html>