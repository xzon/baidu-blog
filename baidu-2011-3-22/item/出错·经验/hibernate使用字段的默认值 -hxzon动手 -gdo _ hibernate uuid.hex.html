<html><head><title><div class="tit">
  hibernate使用字段的默认值 -hxzon动手 -gdo ; hibernate uuid.hex
</div></title></head><body><div id='tit'>hibernate使用字段的默认值 -hxzon动手 -gdo ; hibernate uuid.hex</div><div id='cate'>出错&middot;经验</div><div id='date'>2008年07月29日 星期二 04:13 P.M.</div><div id='page'>115</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/60ce054f7259d230aec3ab3e.html'>http://hi.baidu.com/hxzon/blog/item/60ce054f7259d230aec3ab3e.html</a><div id='cnt'><div> 
 <p> </p> 
 <p>hibernate将空值插入到表中，而没有使用此字段的默认值 -hxzon动手 -gdo</p> 
 <p>问题描述：<br /> &nbsp;&nbsp;&nbsp;&nbsp; hibernate技术中对应数据库中每一个表，都会有一个映射文件与之对应，此文件描述数据库表中每一个字段的类型、长度、是否可空等属性。在进行表中记录的插入（更新）操作时，hibernate会根据映射文件中的描述自动生成一个包含所有字段的插入（更新）sql语句，此时如果映射文件中某字段的值为空(NULL)而其在数据库表中定义的默认值不为空，hibernate会将空值插入到表中，而不会使用此字段的默认值。<br /> <br /> 解决方法：<br /> &nbsp;&nbsp;&nbsp;&nbsp; 在hibernate映射文件对数据库表的描述中，加入dynamic-insert=&quot;true&quot;和 dynamic-update=&quot;true&quot; 语句，这时hibernate在进行插入（更新）操作时，只会为那些值不为空的字段赋值，而值为空的字段就会使用数据库表中定义的默认值了。<br /> <br /> <br /> 举例说明：<br /> 表person:<br /> CREATE TABLE person (<br /> i_id int(11) NOT NULL auto_increment,<br /> c_name varchar(100) NOT NULL default '张三',<br /> PRIMARY KEY&nbsp;&nbsp;&nbsp; (id)<br /> ) <br /> <br /> person.hbm.xml:<br /> &lt;hibernate-mapping package=&quot;cn.com.lough.model&quot;&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;class<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;Person&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; table=&quot;person&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lazy=&quot;false&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp; &gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta attribute=&quot;sync-DAO&quot;&gt;true&lt;/meta&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;cache usage=&quot;read-write&quot;/&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;id<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;IId&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type=&quot;integer&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; column=&quot;i_id&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;generator class=&quot;native&quot;/&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/id&gt;<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;CName&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; column=&quot;c_name&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type=&quot;string&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; not-null=&quot;false&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; length=&quot;128&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&gt;<br /> &lt;/hibernate-mapping&gt;<br /> <br /> 运行程序<br /> Person p = new Person();<br /> HiFactory.save(p);<br /> <br /> 此时hibernate生成的sql语句为insert into person(c_name) values(null);<br /> <br /> 数据库表结果为<br /> i_id&nbsp;&nbsp;&nbsp;&nbsp; c_name<br /> 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; null<br /> <br /> 修改person.hbm.xml为：<br /> &lt;hibernate-mapping package=&quot;cn.com.lough.model&quot;&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp; &lt;class<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;Person&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; table=&quot;person&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lazy=&quot;false&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dynamic-insert=&quot;true&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp; &gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta attribute=&quot;sync-DAO&quot;&gt;true&lt;/meta&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;cache usage=&quot;read-write&quot;/&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;id<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;IId&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type=&quot;integer&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; column=&quot;i_id&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;generator class=&quot;native&quot;/&gt;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/id&gt;<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name=&quot;CName&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; column=&quot;c_name&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type=&quot;string&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; not-null=&quot;false&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; length=&quot;128&quot;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&gt;<br /> &lt;/hibernate-mapping&gt;<br /> <br /> 再次运行程序，此时hibernate生成的sql语句为 insert into person() values();<br /> 数据库表结果为<br /> i_id&nbsp;&nbsp;&nbsp;&nbsp; c_name<br /> 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; null<br /> 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 张三</p> 
 <p>hxzon：ok</p> 
 <p>===================================================</p> 
 <p>hibernate uuid.hex -hxzon动手</p> 
 <p>1.id类型设置为varchar(32),PRIMARY KEY (id)。<br /> 2.反向工程的第二步，Id Generator选择uuid.hex，第三步点表名，Id Generator选择uuid.hex。</p> 
</div></div></body></html>