<html><head><title><div class="tit">
  帖子置顶代码 -hqlcode -hxzon
</div></title></head><body><div id='tit'>帖子置顶代码 -hqlcode -hxzon</div><div id='cate'>出错&middot;经验</div><div id='date'>2009年03月02日 星期一 01:27 P.M.</div><div id='page'>65</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/81472873cf5eb5148601b059.html'>http://hi.baidu.com/hxzon/blog/item/81472873cf5eb5148601b059.html</a><div id='cnt'><p>帖子置顶代码 -hqlcode -hxzon</p> 
<p>--------------------------------<br /> //hxzon:注意两个 and 的使用。<br /> //java中合并两个list, 用 list.addAll() 而不是 list.add(); <br /> public List getByLike(final String like, final int first, final int num) {<br /> &nbsp;&nbsp; return getHibernateTemplate().executeFind(new HibernateCallback() {<br /> &nbsp;&nbsp;&nbsp; public Object doInHibernate(Session session)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throws HibernateException, SQLException {<br /> &nbsp;&nbsp;&nbsp;&nbsp; String hql = &quot;FROM Post AS p WHERE p.isTop = true AND p.title LIKE ? OR p.isTop =true AND p.content LIKE ? order by p.createTime desc&quot;;<br /> &nbsp;&nbsp;&nbsp;&nbsp; Query query = session.createQuery(hql);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setString(0, &quot;%&quot; + like + &quot;%&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setString(1, &quot;%&quot; + like + &quot;%&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setFirstResult(first);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setMaxResults(num);<br /> &nbsp;&nbsp;&nbsp;&nbsp; List list = query.list();//<br /> &nbsp;&nbsp;&nbsp;&nbsp; hql = &quot;FROM Post AS p WHERE p.isTop = false AND p.title LIKE ? OR p.isTop =false AND p.content LIKE ? order by p.createTime desc&quot;;<br /> &nbsp;&nbsp;&nbsp;&nbsp; query = session.createQuery(hql);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setString(0, &quot;%&quot; + like + &quot;%&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setString(1, &quot;%&quot; + like + &quot;%&quot;);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setFirstResult(first);<br /> &nbsp;&nbsp;&nbsp;&nbsp; query.setMaxResults(num);<br /> &nbsp;&nbsp;&nbsp;&nbsp; list.addAll(query.list());<br /> &nbsp;&nbsp;&nbsp;&nbsp; return list;<br /> &nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp; });<br /> }<br /> -------------------------------------------<br /> //hxzon：被注释部分为旧版本。注意 list2 的 num-list.size(); <br /> //新版的使用 order by p.isTop desc,p.createTime desc; 更正确。<br /> public List getPostsInForum(String forumId, int first, int num) {<br /> //&nbsp;&nbsp; String hql = &quot;from Post as p where p.isTop =true AND p.forumId='&quot; + forumId + &quot;' order by p.createTime desc&quot;;<br /> //&nbsp;&nbsp; List list = postDao.getByHql(hql, first, num);<br /> //&nbsp;&nbsp; hql = &quot;from Post as p where p.isTop =false AND p.forumId='&quot; + forumId + &quot;' order by p.createTime desc&quot;;<br /> //&nbsp;&nbsp; List list2 = postDao.getByHql(hql, first, num-list.size());<br /> //&nbsp;&nbsp; list.addAll(list2);<br /> &nbsp;&nbsp; String hql = &quot;from Post as p where p.forumId='&quot; + forumId + &quot;' order by p.isTop desc,p.createTime desc&quot;;<br /> &nbsp;&nbsp; List list = postDao.getByHql(hql, first, num);<br /> &nbsp;&nbsp; return list;<br /> }<br /> ---------------------------------------------<br /> 转自 学Z-one <a href="http://hi.baidu.com/hxzon/blog/item/81472873cf5eb5148601b059.html">http://hi.baidu.com/hxzon/blog/item/81472873cf5eb5148601b059.html</a></p></div></body></html>