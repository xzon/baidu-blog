<html><head><title><div class="tit">
  JDBC连接SQLServer时出现错误Error establishing socket.的解决。
</div></title></head><body><div id='tit'>JDBC连接SQLServer时出现错误Error establishing socket.的解决。</div><div id='cate'>动手</div><div id='date'>2007年12月05日 星期三 02:26 P.M.</div><div id='page'>197</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/7daa3cf386173353342acc5b.html'>http://hi.baidu.com/hxzon/blog/item/7daa3cf386173353342acc5b.html</a><div id='cnt'><div>
 JDBC连接SQLServer时出现错误Error establishing socket.的解决。
</div> 
<div> 
</div> 
<div>
 一次在重装系统并重新搭建 JAVA 运行环境后，为了测试运行环境是否搭建好，写了一个非常简单的 JDBC 程序测试数据库连接。
</div> 
<div> 
</div> 
<div>
 IDE ： Eclipse3.2
</div> 
<div> 
</div> 
<div>
 DB ： SQLServer2000
</div> 
<div> 
</div> 
<div>
 Driver ： MS 的官方驱动： msbase.jar 、 mssqlserver.jar 、 msutil.jar
</div> 
<div> 
</div> 
<div>
 源程序如下：
</div> 
<div> 
</div> 
<div>
 文件名： SqlServerTest.java
</div> 
<div> 
</div> 
<div>
 package test;
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 import java.sql.*;
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 /**
</div> 
<div> 
</div> 
<div>
  * @author lpeter SQLServer 连接测试
</div> 
<div> 
</div> 
<div>
  */
</div> 
<div> 
</div> 
<div>
 public class SqlServerTest {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; // 驱动类
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; static String driverClass =
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot; ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; // 连接字符串
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; static String url =
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;jdbc:microsoft:sqlserver://127.0.0.1:1433;dataBaseName=Test&quot; ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; // 密码
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; static String password = &quot;peter&quot; ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp; // 用户名
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; static String username = &quot;peter&quot; ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; // 待执行的 SQL 语句
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; static String sql = &quot;SELECT * FROM Test&quot; ;
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; public static void main(String[] args) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Connection conn = null ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PreparedStatement pstmt = null ;
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ResultSet rs = null ;
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Class.forName( driverClass );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conn = DriverManager.getConnection( url , username , password );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pstmt = conn.prepareStatement( sql );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rs = pstmt.executeQuery();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (rs.next()) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System. out .println( &quot;OK.&quot; );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System. out .println( &quot;OK too.&quot; );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rs.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pstmt.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conn.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (ClassNotFoundException e) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System. out .println( &quot; 驱动类没有找到 .&quot; );
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (SQLException e) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } finally {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rs != null ) // 结果集没有关闭时关闭结果集
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rs.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (SQLException e) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pstmt != null ) // 发送对象没有关闭时关闭发送对象
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pstmt.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (SQLException e) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (conn != null ) // 连接没有关闭时关闭连接
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; conn.close();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (SQLException e) {
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; }
</div> 
<div> 
</div> 
<div>
 }
</div> 
<div> 
</div> 
<div>
 执行这段程序时，出现错误：
</div> 
<div> 
</div> 
<div>
 java.sql.SQLException : [Microsoft][SQLServer 2000 Driver for JDBC]Error establishing socket.
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseExceptions.createException(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseExceptions.getException(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseExceptions.getException(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.sqlserver.tds.TDSConnection.&lt;init&gt;(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.sqlserver.SQLServerImplConnection.open(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseConnection.getNewImplConnection(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseConnection.open(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at com.microsoft.jdbc.base.BaseDriver.connect(Unknown Source)
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at java.sql.DriverManager.getConnection( DriverManager.java:523 )
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at java.sql.DriverManager.getConnection( DriverManager.java:171 )
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp; at test.SqlServerTest.main( SqlServerTest.java:29 )
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 出现了这个错误，我马上想到连接字符串有问题。可在网上找了好几个版本都是这样。
</div> 
<div> 
</div> 
<div>
 后来由于某种偶然原因，我知道了 SQLServer 可以设置查看端口号。步骤如下：
</div> 
<div> 
</div> 
<div>
 1． 打开企业管理器，依次在控制台根目录 -&gt;Microsoft SQL Servers-&gt;SQL Server 组，列出一部分数据库服务器。
</div> 
<div> 
</div> 
<div>
 2． 右击我们要连接的数据库服务器，选择属性，在常规选项卡点击网络配置弹出新窗口。
</div> 
<div> 
</div> 
<div>
 3． 在启用的协议区域我们选择 TCP/IP ，点击属性按钮，弹出新窗口。在这个窗口有网络协议默认值设置，我在这里看到我的默认端口是： 4067 。因面在使用 1433 连接数据库时出错。
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 把端口号修改为 4067 即修改：
</div> 
<div> 
</div> 
<div>
 static String url =
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;jdbc:microsoft:sqlserver://127.0.0.1:1433;dataBaseName=Test&quot; ;
</div> 
<div> 
</div> 
<div>
 为：
</div> 
<div> 
</div> 
<div>
 static String url =
</div> 
<div> 
</div> 
<div>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;jdbc:microsoft:sqlserver://127.0.0.1:4067;dataBaseName=Test&quot; ;
</div> 
<div> 
</div> 
<div>
 后，执行程序，输出： OK too.
</div> 
<div> 
</div> 
<div> 
</div> 
<div> 
</div> 
<div>
 测试连接成功。
</div></div></body></html>