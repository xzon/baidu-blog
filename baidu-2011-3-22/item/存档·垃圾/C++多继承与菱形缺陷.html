<html><head><title><div class="tit">
  C++多继承与菱形缺陷
</div></title></head><body><div id='tit'>C++多继承与菱形缺陷</div><div id='cate'>存档&middot;垃圾</div><div id='date'>2008年04月22日 星期二 11:27 A.M.</div><div id='page'>140</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/62468c13226041d5f7039e93.html'>http://hi.baidu.com/hxzon/blog/item/62468c13226041d5f7039e93.html</a><div id='cnt'><p>C++多继承与菱形缺陷</p> 
<p class="1" style="margin: 0cm 0cm 0pt; text-indent: 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">多重继承是<span>C++</span>语言独有的继承方式，其它几乎所有语言都秉承了单一继承的思想。这是因为多重继承致命的缺陷导致的：<span></span></font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; text-indent: -36pt; line-height: 150%; mso-pagination: widow-orphan; mso-list: l1 level3 lfo1; "><strong><span style="mso-fareast-"><span style="mso-list: Ignore"><font face="Times New Roman"></font><font size="3">1.1.1</font><span style="font: 7pt  Times New Roman ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></strong><strong><font size="3"><span style=" mso-hansi- mso-bidi-">菱形缺陷</span><span></span></font></strong></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3"> </font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">当继承基类时，在派生类中就获得了基类所有的数据成员副本。假如类<span>B </span>从<span>A1</span>和<span>A2</span>两个类多重继承而来，这样<span>B</span>类就包含<span>A1</span>、<span>A2</span>类的数据成员副本。<span></span></font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">考虑如果<span>A1</span>、<span>A2</span>都从某基类派生，该基类称为<span>Base</span>，现在继承关系如下：</font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: center; mso-pagination: widow-orphan" align="center"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3"><img src="image/C++多继承与菱形缺陷.html.17143_1197877669703_flash.jpg" /><p class="origImg">http://www.best4c.com/Best4cUserFiles/20071217/17143_1197877669703_flash.jpg</p> </font></span></p> 
<p class="1" style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: justify; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">我们<span>C++</span>语言来描述这种继承关系：<span></span></font></span></p> 
<p class="1" style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: justify; mso-pagination: widow-orphan"><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">class Base{</span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> </span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> }</span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">；<span></span></span></font></p> 
<p class="1" style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: justify; mso-pagination: widow-orphan"><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">class A1 :public Base {</span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> </span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> }</span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">；<span></span></span></font></p> 
<p class="1" style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: justify; mso-pagination: widow-orphan"><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">class A2 :public Base {</span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> </span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> }</span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">；<span></span></span></font></p> 
<p class="1" style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt 36pt; line-height: 150%; text-align: justify; mso-pagination: widow-orphan"><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">class B :public A1,public A2 {</span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> </span><span style="mso-bidi- mso-bidi-font-weight: bold; mso-ascii-"><font face="Times New Roman">…</font></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"> }</span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">；<span></span></span></font></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3"> </font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">那么<span>A1</span>、<span>A2</span>都具有<span>Base</span>的副本。这样<span>B</span>就包含了<span>Base</span>的两个副本，副本发生了重叠，不但增加了存储空间，同时也引入了二义性。这就是菱形缺陷<span>,</span>菱形缺陷时间是两个缺陷：<span></span></font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 54pt; text-indent: -18pt; line-height: 150%; mso-pagination: widow-orphan; mso-list: l0 level1 lfo2; "><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><span style="mso-list: Ignore">1、</span></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">子对象重叠<span></span></span></font></p> 
<p class="1" style="margin: 0cm 0cm 0pt 54pt; text-indent: -18pt; line-height: 150%; mso-pagination: widow-orphan; mso-list: l0 level1 lfo2; "><font size="3"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><span style="mso-list: Ignore">2、</span></span><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold">向上映射的二义性。<span></span></span></font></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">菱形缺陷的其中一种解决办法将<span></span></font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3"> </font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt; text-indent: 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3">在<span>C++</span>世界里最广泛的使用虚拟继承解决菱形缺陷的应用便是标准<span>C++</span>的输入<span>/</span>输出<span>iostream</span>；</font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt; text-indent: 36pt; line-height: 150%; mso-pagination: widow-orphan"><span style=" mso-hansi- mso-bidi- mso-bidi-font-weight: bold"><font size="3"><span><img src="image/C++多继承与菱形缺陷.html.17143_1197878244218_flash.jpg" /><p class="origImg">http://www.best4c.com/Best4cUserFiles/20071217/17143_1197878244218_flash.jpg</p></span></font></span></p> 
<p class="1" style="margin: 0cm 0cm 0pt; text-indent: 36pt; line-height: 150%; mso-pagination: widow-orphan"><strong><span style=" mso-hansi- mso-bidi-"><font size="3"></font></span></strong></p> 
<p class="a0" style="margin: 5.25pt 0cm 0pt; text-indent: 0cm; mso-text-indent-alt: 0cm"><span style="mso-bidi- mso-fareast-"><span style="mso-list: Ignore"><span style="font: 7pt  Times New Roman ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="font-size: 12pt; line-height: 150%;  mso-hansi- mso-ascii-">标准</span><span style="font-size: 12pt; line-height: 150%">C++</span><span style="font-size: 12pt; line-height: 150%;  mso-hansi- mso-ascii-">的输入</span><span style="font-size: 12pt; line-height: 150%">/</span><span style="font-size: 12pt; line-height: 150%;  mso-hansi- mso-ascii-">输出</span></p> 
<p class="a0" style="margin: 5.25pt 0cm 0pt; text-indent: 0cm; mso-text-indent-alt: 0cm"><span style="font-size: 12pt; line-height: 150%"></span></p> 
<p><font size="4">虚继承：无论有几代的继承关系，所有子类都将共享一个基类的副本，节省了空间。</font></p> 
<p>Trackback: http://tb.blog.csdn.net/TrackBack.aspx?PostId=1943813</p></div></body></html>