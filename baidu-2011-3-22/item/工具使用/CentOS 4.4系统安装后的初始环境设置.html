<html><head><title><div class="tit">
  CentOS 4.4系统安装后的初始环境设置
</div></title></head><body><div id='tit'>CentOS 4.4系统安装后的初始环境设置</div><div id='cate'>工具使用</div><div id='date'>2010年03月24日 星期三 03:45 P.M.</div><div id='page'>16</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/890ddf33c0bcca4fad4b5fbb.html'>http://hi.baidu.com/hxzon/blog/item/890ddf33c0bcca4fad4b5fbb.html</a><div id='cnt'><p> </p> 
<p>CentOS 4.4系统安装后的初始环境设置</p> 
<p><a href="http://www.centospub.com/make/newenv.html">http://www.centospub.com/make/newenv.html</a></p> 
<p><strong>&lt; 系统安装后的初始环境设置 &gt;</strong> （最近更新日：2006/12/24）</p> 
<p> </p>
<table width="100%" border="0" class="FCK__ShowTableBorders"> 
 <tbody> 
  <tr> 
   <td bgcolor="#4665a6"> 
    <table border="0" class="FCK__ShowTableBorders"> 
     <tbody> 
      <tr> 
       <td bgcolor="#333333"><span class="table-title">前 言</span></td> 
      </tr> 
     </tbody> 
    </table> </td> 
  </tr> 
 </tbody> 
</table> 
<br /> 在 CentOS 安装好之后，安全性以及对硬件的适应性方面，可能并不完全符合我们的实际情况。在这里，对新的 CentOS 系统进行初始环境设置将以如下方面为原则：
<br /> 
<br /> 1，为了安全，尽最大可能将访问限制限制到可能的最大程度；
<br /> 2，为了节省内存及 CPU 使用率（以及安全方面的考虑），尽最大可能将不需要的服务关闭；
<br /> 3，为了减少误操作可能带来的损失，平时通过 wheel 组用户登录进行系统管理；
<br /> 4，为了让系统变的更加轻便、快速，将内核中不需要的模块卸载；
<br /> …………
<br /> 
<br /> 
<table width="100%" border="0" class="FCK__ShowTableBorders"> 
 <tbody> 
  <tr> 
   <td bgcolor="#4665a6"> 
    <table border="0" class="FCK__ShowTableBorders"> 
     <tbody> 
      <tr> 
       <td bgcolor="#333333" class="table-title">CentOS 4.4 的安装后初始环境设定</td> 
      </tr> 
     </tbody> 
    </table> </td> 
  </tr> 
 </tbody> 
</table> 
<br /> 安装完毕重新启动系统后，出现如下的状态：
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">CentOS release 4.4 (Final)<br /> Kernel 2.6.9-42.EL on an i686<br /> <br /> sample login: </span> <span class="intro">← 根据安装时网络设置的情况的不同，本站以“sample”，其位置显示的是你设置好的主机名。</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [1] 系统的登录与退出
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">sample login: </span><span class="command">root</span><span class="message"> </span><span class="intro">← 用root用户来登录系统，输入用户名root</span><br /> <span class="message">Password:</span> <span class="intro">← 在这里输入安装时设置的root密码，输入时密码不会被显示</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="intro">← root用户登录成功，提示符为“#”。若一般用户登录成功后，提示符为“$”</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">exit</span> <span class="intro">← 退出系统</span><br /> <br /> <span class="message">sample login:</span> <span class="intro">← 退出系统成功</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [2] 一般用户的建立与删除
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">useradd centospub</span> <span class="intro">← 建立用户名为 centospub 的一般用户</span><br /> <span class="message">[root@sample ~]#</span> <span class="command">passwd centospub</span> <span class="intro">← 为用户 centospub 设置密码</span><br /> <span class="message">Changing password for user centospub.</span><br /> <span class="message">New UNIX password:</span> <span class="intro">← 输入密码（密码不会被显示）</span><br /> <span class="message">Retype new UNIX password:</span> <span class="intro">← 再次输入密码确认两次密码一致</span><br /> <span class="message">passwd: all authentication tokens updated successfully.</span> <span class="intro">← 密码设置成功</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">userdel -r centospub</span> <span class="intro">← 删除用户名为 centospub 的一般用户</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [3] 通过一般用户登录为root用户
<br /> 
<br /> 因为root用户对系统具有全权的操作权限，为了避免一些失误的操作，建议在一般情况下，以一般用户登录系统，必要的时候需要root操作权限时，再通过“su -”命令来登录为root用户进行操作。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[centospub@sample ~]</span><span class="att1">$</span> <span class="intro">← 提示符为“$”，说明当前状态为一般用户centospub登录在系统中</span><br /> <br /> <span class="message">[centospub@sample ~]$</span> <span class="command">su -</span> <span class="intro">← 输入登录为root用户的命令</span><br /> <span class="message">Password:</span> <span class="intro">← 输入root密码（密码不会被显示），回车</span><br /> <br /> <span class="message">[root@sample ~]</span><span class="att1">#</span> <span class="intro">← 成功登录为root用户，提示符变为“#”</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">exit</span> <span class="intro">← 回到一般用户的登录状态</span><br /> <br /> <span class="message">[centospub@sample ~]</span><span class="att1">$</span> <span class="intro">← 提示符变为“$”，回到了一般用户centospub登录系统的状态</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [4] 建立管理员组内一般用户
<strong><br /> <br /> </strong>在 一般情况下，一般用户通过执行“su -”命令、输入正确的root密码，可以登录为root用户来对系统进行管理员级别的配置。但是，为了更进一步加强系统的安全性，有必要建立一个管理员的 组，只允许这个组的用户来执行“su -”命令登录为root用户，而让其他组的用户即使执行“su -”、输入了正确的root密码，也无法登录为root用户。在UNIX下，这个组的名称通常为“wheel”。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">usermod -G wheel centospub</span> <span class="intro">← 将一般用户 centospub 加在管理员组wheel组中</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">vi /etc/pam.d/su</span> <span class="intro">← 打开这个配置文件</span><br /> <br /> <span class="before">#auth required /lib/security/$ISA/pam_wheel.so use_uid</span> <span class="intro">← 找到此行，去掉行首的“#”</span><br /> <span class="intro"> ↓</span> <br /> <span class="after">auth required /lib/security/$ISA/pam_wheel.so use_uid</span> <span class="intro">← 变为此状态（大约在第6行的位置）</span> <br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">echo &quot;SU_WHEEL_ONLY yes&quot; &gt;&gt; /etc/login.defs</span> <span class="intro">← 添加语句到行末</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> 以上操作完成后，可以再建立一个新用户，然后用这个新建的用户测试会发现，没有加入到wheel组的用户，执行“su -”命令，即使输入了正确的root密码，也无法登录为root用户。
<strong><br /> <br /> </strong>[5] 建立PPPoE连接（非xDSL接入方式的用户可跳过此步骤）
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]# </span><span class="command">adsl-setup</span> <span class="intro">← 建立ADSL连接</span><br /> <br /> <p class="message">Welcome to the ADSL client setup. First, I will run some checks on<br /> your system to make sure the PPPoE client is installed properly...</p> <p class="message">LOGIN NAME</p> <p><span class="message">Enter your Login Name (default root):</span> <span class="intro">← 填入ADSL连接的用户名</span></p> <p class="message">INTERFACE</p> <p><span class="message">Enter the Ethernet interface connected to the ADSL modem<br /> For Solaris, this is likely to be something like /dev/hme0.<br /> For Linux, it will be ethX, where 'X' is a number.<br /> (default eth0):</span> <span class="intro">← 指定网络接入设备，一块网卡的情况下，一般为默认eth0</span></p> <p><span class="message">Do you want the link to come up on demand, or stay up continuously?<br /> If you want it to come up on demand, enter the idle time in seconds<br /> after which the link should be dropped. If you want the link to<br /> stay up permanently, enter 'no' (two letters, lower-case.)<br /> NOTE: Demand-activated links do not interact well with dynamic IP<br /> addresses. You may have some problems with demand-activated links.<br /> Enter the demand value (default no):</span> <span class="intro">← 直接按回车，接受默认设置</span></p> <p class="message">DNS</p> <p><span class="message">Please enter the IP address of your ISP's primary DNS server.<br /> If your ISP claims that 'the server will provide dynamic DNS addresses',<br /> enter 'server' (all lower-case) here.<br /> If you just press enter, I will assume you know what you are<br /> doing and not modify your DNS setup.<br /> Enter the DNS information here:</span> <span class="intro">← 如果知道DNS服务器的信息在此填入。不知道的情况按回车跳过</span></p> <p class="message">PASSWORD</p> <p><span class="message">Please enter your Password:</span> <span class="intro">← 输入ADSL的连接密码</span><br /> <span class="message">Please re-enter your Password:</span> <span class="intro">← 再次确认输入ADSL的连接密码</span></p> <p class="message">USERCTRL</p> <p><span class="message">Please enter 'yes' (two letters, lower-case.) if you want to allow<br /> normal user to start or stop DSL connection (default yes):</span> <span class="command">no</span> <span class="intro">← 填入no，不允许一般用户控制PPPoE的连接</span></p> <p class="message">FIREWALLING</p> <p class="message">Please choose the firewall rules to use. Note that these rules are<br /> very basic. You are strongly encouraged to use a more sophisticated<br /> firewall setup; however, these will provide basic security. If you<br /> are running any servers on your machine, you must choose 'NONE' and<br /> set up firewalling yourself. Otherwise, the firewall rules will deny<br /> access to all standard servers like Web, e-mail, ftp, etc. If you<br /> are using SSH, the rules will block outgoing SSH connections which<br /> allocate a privileged source port.</p> <p><span class="message">The firewall choices are:<br /> 0 - NONE: This script will not set any firewall rules. You are responsible<br /> for ensuring the security of your machine. You are STRONGLY<br /> recommended to use some kind of firewall rules.<br /> 1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation<br /> 2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway<br /> for a LAN<br /> Choose a type of firewall (0-2):</span> <span class="command">0</span> <span class="intro">← 输入0，不在这里使用防火墙</span></p> <p class="message">Start this connection at boot time</p> <p><span class="message">Do you want to start this connection at boot time?<br /> Please enter no or yes (default no): </span><span class="command">yes</span> <span class="intro">← 填入yes，在系统启动时自动连接ADSL</span></p> <p class="message">** Summary of what you entered **</p> <p><span class="message">Ethernet Interface: eth0<br /> User name: caun870293@ca.dti.ne.jp<br /> Activate-on-demand: No<br /> DNS: Do not adjust<br /> Firewalling: NONE<br /> User Control: no<br /> Accept these settings and adjust configuration files (y/n)?</span> <span class="command">y</span> <span class="intro">← 配置信息确认无误后，键入y同意设置</span><br /> <span class="message">Adjusting /etc/sysconfig/network-scripts/ifcfg-ppp0<br /> Adjusting /etc/ppp/chap-secrets and /etc/ppp/pap-secrets<br /> (But first backing it up to /etc/ppp/chap-secrets.bak)<br /> (But first backing it up to /etc/ppp/pap-secrets.bak)</span></p> <p class="message">?</p> <p class="message">Congratulations, it should be all set up!</p> <p class="message">Type '/sbin/ifup ppp0' to bring up your xDSL link and '/sbin/ifdown ppp0'<br /> to bring it down.<br /> Type '/sbin/adsl-status /etc/sysconfig/network-scripts/ifcfg-ppp0'<br /> to see the link status.</p> </td> 
  </tr> 
 </tbody> 
</table> 
<br /> 然后，启动ADSL连接。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]# </span><span class="command">adsl-start</span> <span class="intro">← 启动ADSL连接</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="intro">← 稍等片刻后若启动成功后出现提示符（无任何提示即意味着连接成功）</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> 这时，通过“ifconfig”命令可以看到各网络接口的信息（IP地址等等）。
<br /> 
<br /> [6] root邮件的转送
<strong><br /> <br /> </strong> 在系统出现错误或有重要通知发送邮件给root的时候，让系统自动转送到我们通常使用的邮箱中，这样方便查阅相关报告和日志。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">vi /etc/aliases</span> <span class="intro">← 编辑aliases，添加如下行到文尾</span><br /> <br /> <span class="after">root: yourname@yourserver.com</span> <span class="intro">← 加入</span><span class="att2">自己的邮箱地址</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">newaliases</span> <span class="intro">← 重建aliasesdb</span><br /> <span class="message">/etc/aliases: 79 aliases, longest 19 bytes, 825 bytes total<br /> <br /> [root@sample ~]#</span> <span class="command">echo test | mail root</span> <span class="intro">← 发送测试邮件给root</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> 如果成功的话，会在刚刚填入的 yourname@yourserver.com 的邮箱中收到测试的邮件。
<br /> 
<br /> [7] locate命令用数据库更新及自动更新设定
<br /> 
<br /> locate命令是Linux下告诉搜索文件用的工具，它的原理和Windows下的“Google桌面搜索”有点类似，是通过事先建立数据库的方式，来达到高速查找目标文件的目的。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]# <span class="command">vi /etc/updatedb.conf</span> <span class="intro">← 编辑locate数据库更新配置文件</span><br /> <br /> <span class="before">DAILY_UPDATE=no</span> <span class="intro">← 找到这一行，将“no”改为“yes”</span><br /> <span class="intro"> ↓</span><br /> <span class="after">DAILY_UPDATE=yes</span> <span class="intro">← 变为此状态后，保存、退出</span><br /> <br /> [root@sample ~]#</span> <span class="command">updatedb</span> <span class="intro">← 运行locate数据库更新命令，稍等片刻…更新成功后出现提示符</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [8] 定义yum的非官方库
<br /> 
<br /> 在服务器构建的过程中，我们将要用到的一些工具不存在于CentOS中yum的官方库中，所以需要定义yum的非官方库文件，让一些必需的工具通过 yum也能够安装。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">vi /etc/yum.repos.d/dag.repo</span> <span class="intro">← 建立dag.repo，定义非官方库</span><br /> <br /> <span class="conffile">[dag]<br /> name=Dag RPM Repository for Red Hat Enterprise Linux<br /> baseurl=http://apt.sw.be/redhat/el$releasever/en/$basearch/dag<br /> gpgcheck=1<br /> enabled=1<br /> </span><br /> <span class="message">[root@sample ~]#</span> <span class="command">rpm --import http://dag.wieers.com/rpm/packages/RPM-GPG-KEY.dag.txt <span class="intro">← 导入非官方库的GPG</span></span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [9] 停止打印服务
<br /> 
<br /> 如果不准备提供打印服务，停止默认被设置为自动启动的打印服务。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">/etc/rc.d/init.d/cups stop</span> <span class="intro">← 停止打印服务</span><br /> <span class="message">Stopping cups: [ </span><span class="after">OK</span><span class="message"> ]</span> <span class="intro">← 停止服务成功，出现“OK”</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">chkconfig cups off</span> <span class="intro">← 禁止打印服务自动启动</span><br /> <br /> <span class="message">[root@sample ~]#</span> <span class="command">chkconfig --list cups</span> <span class="intro">← 确认打印服务自启动设置状态</span><br /> <span class="message">cups</span> <span class="att1">0:off 1:off 2:off 3:off 4:off 5:off 6:off</span> <span class="intro">← 0-6都为off的状态就OK（当前打印服务自启动被禁止中）</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> [10] 停止ipv6
<br /> 
<br /> 在CentOS默认的状态下，ipv6是被启用的状态。因为我们不使用ipv6，所以，停止ipv6，以最大限度保证安全和快速。
<br /> 
<br /> 首先再次确认一下ipv6功能是不是被启动的状态。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">ifconfig -a</span> <span class="intro">← 列出全部网络接口信息</span><br /> <span class="message"><br /> eth0 Link encap:Ethernet HWaddr 00:0C:29:B6:16:A3<br /> inet addr:192.168.0.13 Bcast:192.168.0.255 Mask:255.255.255.0<br /> inet6 addr: fe80::20c:29ff:feb6:16a3/64 Scope:Link<br /> UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br /> RX packets:84 errors:0 dropped:0 overruns:0 frame:0<br /> TX packets:93 errors:0 dropped:0 overruns:0 carrier:0<br /> collisions:0 txqueuelen:1000<br /> RX bytes:10288 (10.0 KiB) TX bytes:9337 (9.1 KiB)<br /> Interrupt:185 Base address:0x1400 </span> <p class="message">lo Link encap:Local Loopback<br /> inet addr:127.0.0.1 Mask:255.0.0.0<br /> inet6 addr: ::1/128 Scope:Host<br /> UP LOOPBACK RUNNING MTU:16436 Metric:1<br /> RX packets:12 errors:0 dropped:0 overruns:0 frame:0<br /> TX packets:12 errors:0 dropped:0 overruns:0 carrier:0<br /> collisions:0 txqueuelen:0<br /> RX bytes:952 (952.0 b) TX bytes:952 (952.0 b)</p> <span class="att1">sit0 Link encap:IPv6-in-IPv4</span> <span class="intro">← 确认ipv6是被启动的状态</span><br /> <span class="att1">NOARP MTU:1480 Metric:1<br /> RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br /> TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br /> collisions:0 txqueuelen:0<br /> RX bytes:0 (0.0 b) TX bytes:0 (0.0 b)</span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> 然后修改相应配置文件，停止ipv6。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">vi /etc/modprobe.conf</span><span class="att1"> <span class="intro">← 修改相应配置文件，添加如下行到文尾：</span></span><br /> <br /> <span class="after">alias net-pf-10 off<br /> alias ipv6 off<br /> <br /> </span><span class="message">[root@sample ~]#</span><span class="command"> shutdown -r now <span class="att1"> <span class="intro">← 重新启动系统，使设置生效</span></span></span></td> 
  </tr> 
 </tbody> 
</table> 
<br /> 最后确认ipv6的功能已经被关闭。
<br /> 
<br /> 
<table width="100%" border="2"> 
 <tbody> 
  <tr> 
   <td bgcolor="#000000"><span class="message">[root@sample ~]#</span> <span class="command">ifconfig -a</span> <span class="intro">← 列出全部网络接口信息</span><br /> <br /> <span class="message">eth0 Link encap:Ethernet HWaddr 00:0C:29:B6:16:A3<br /> inet addr:192.168.0.13 Bcast:192.168.0.255 Mask:255.255.255.0<br /> inet6 addr: fe80::20c:29ff:feb6:16a3/64 Scope:Link<br /> UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br /> RX packets:84 errors:0 dropped:0 overruns:0 frame:0<br /> TX packets:93 errors:0 dropped:0 overruns:0 carrier:0<br /> collisions:0 txqueuelen:1000<br /> RX bytes:10288 (10.0 KiB) TX bytes:9337 (9.1 KiB)<br /> Interrupt:185 Base address:0x1400</span> <span class="message">lo Link encap:Local Loopback<br /> inet addr:127.0.0.1 Mask:255.0.0.0<br /> inet6 addr: ::1/128 Scope:Host<br /> UP LOOPBACK RUNNING MTU:16436 Metric:1<br /> RX packets:12 errors:0 dropped:0 overruns:0 frame:0<br /> TX packets:12 errors:0 dropped:0 overruns:0 carrier:0<br /> collisions:0 txqueuelen:0<br /> RX bytes:952 (952.0 b) TX bytes:952 (952.0 b)<br /> </span><br /> <span class="att1">（确认ipv6的相关信息没有被列出，说明ipv6功能已被关闭。）</span></td> 
  </tr> 
 </tbody> 
</table></div></body></html>