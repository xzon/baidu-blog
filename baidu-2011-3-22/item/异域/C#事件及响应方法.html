<html><head><title><div class="tit">
  C#事件及响应方法
</div></title></head><body><div id='tit'>C#事件及响应方法</div><div id='cate'>异域</div><div id='date'>2008年03月05日 星期三 12:08 P.M.</div><div id='page'>167</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/c8e57ef0885d1ec77831aa7f.html'>http://hi.baidu.com/hxzon/blog/item/c8e57ef0885d1ec77831aa7f.html</a><div id='cnt'><p><strong><font color="#660000" size="3">C#事件及响应方法</font></strong></p> 
<strong><font color="#660000"> <p style="text-indent: 2em"><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; <strong>引言</strong><br /> <br /> C#语言自C/C++演变而来。它是现代、简单、完全面向对象和类型安全的。C#语言是微软公司针对.Net平台才推出来的一门新语言，作为.Net平台的第一语言，它几乎集中了所有关于软件开发和软件工程研究的最新成果。面向对象、类型安全、组件技术、自动内存管理、跨平台异常处理、版本控制、代码安全管理……<br /> <br /> 在.NET应用程序开发中，不管是WEB Forms（ASP.NET）还是Windows Forms，都涉及到大量对象的事件响应及处理，比如客户在线提交一份订单、或是在Windows窗口上移动鼠标等都将有事件发生。那么在C#中，是怎样声明事件并为事件添加响应方法的呢？下面的文章对此为大家作了详细的讲述。<br /> <br /> <strong>原理简介 </strong><br /> <br /> 在C#中，一个类可以有域(Fields)、属性(Properties)、方法(Methods)、索引(Indexs)、事件(Events)等成员，其中事件(Events)成员就是用来声明一个类事件的。在类中声明一个事件成员一般采用如下的语法形式： <br /> <br /> </font><font color="#0000ff">public event 代表名 事件名。 </font><br /> <br /> 如在Control类中声明了一个Click事件成员，其语法如下： <br /> <br /> <font color="#0000ff">public event EventHandler Click;</font> <br /> <br /> 在C#中，增加了一个新的数据类型delegate（代表）来解决事件处理问题。代表数据类型非常类似于C语言中的指针，其与指针不同的是，其是代码是安全的，可管理的。由于C#本身的简易性，对于没有使用过Ｃ及指针的程序来说，理解delegate也是非常容易的。 <br /> <br /> 在C#中，通过使用delegate，你可以通过“+=”（加等于）操作符非常容易地为.Net对象中的一个事件添加一个甚至多个响应方法；还可以通过非常简单的“-=”（减等于）操作符取消这些响应方法。如下面为temp按钮添加Click事件的语句： <br /> <br /> <font color="#0000ff">temp.Click+=new System.EventHandler(this.Test);//为test添加事件处理方法</font> <br /> <br /> 在上面声明事件的语句中，Eventhandler是一个delegate(代表)类型，其在.Net类库中如下声明的： <br /> <br /> <font color="#0000ff">public delegate void EventHandler(object sender,EventArgs e); </font><br /> <br /> <br /> 这样，所有形如:void 函娄名(object 参数名,EventArgs 参数名);的函数都可以作为Control类的Click事件响应方法了。如下面所定义的一个事件响应方法： <br /> <br /> <font color="#0000ff">private void button1_Click(object sender, System.EventArgs e) </font><br /> <br /> 由于是通过delegate（代表类型）来处理事件，因此，可能通过累加使一个事件具有多个响应方法；与此同时，还可以使一个方法作为多个事件的响应方法。（注意：在C#语言类中的event成员后面只能出现“+=”与“-=”两个表示添加与取消事件响应函数的操作符。） <br /> <br /> 不管是ASP.Net还是一般的Windows Forms 编程，在C#中，基本上我们遇到的事件响应方法都是说明成如下的形式： <br /> <br /> <font color="#0000ff">private void button1_Click(object sender, System.EventArgs e) </font><br /> <br /> 那么，一个事件响应方法的存取权限、返回值类型、参数及类型甚至方法名称等是否都必须固定不变呢？答案是：不是！<br /> <br /> 一般情况下，事件的响应方法中都有两个参数，其中一个代表引发事件的对象即sender，由于引发事件的对象不可预知的，因此我们把其声明成为object类型，所有的对象都适用。第二个参数代表引发事件的具体信息，各种类型的事件中可能不同，这要根据类中事件成员的说明决定。 <br /> <br /> 我们知道，事件是通过delegate(代表) 来处理的。假设将要表示事件的代表说明成如下形式： <br /> <br /> <font color="#0000ff">delegate int MyEventHandler(object sender, ToolBarButtonClickEventArgs e); </font><br /> <br /> 则当涉及上面的事件响应函数声明时，就须要声明成如下的形式： <br /> <br /> </p></font><font size="3"></font><font color="#0000ff">private int MyTest(object sender,ToolBarButtonClickEventArgs e) <br /> { <br /> } </font><br /> <br /> 在给对象添加事件响应方法时就可以用如下的代码实现： <br /> <br /> <font color="#0000ff">Control.Event+=new MyEventHandler(MyTest); </font><br /> <br /> <strong>示例程序 </strong><br /> <br /> 下面，我们用Visual Studio .Net开发工具设计了一个简单Windows Forms的程序，向大家展示了C#中具体是怎样实现事件响应处理的。 <br /> <br /> *主要类 <br /> <br /> <font size="3"></font><font color="#0000ff">System.Windows.Forms.Application类：应用程序类。 <br /> System.Windows.Forms.Form类：窗体类。 <br /> System.Windows.Forms.Label类：文字标签类，主要用于在窗口上添加标签信息。 <br /> System.Windows.Forms.Button类：按钮类，生成一个命令按。 <br /> System.EventHandler Delegate(代表)：其是.Net类库中的一个公用代表类型，主要用于说明并初始化一个事件方法，该代表具有两个参数object sender表示引发事件的对象，System.EventArgs e 代表事件的相应信息，如鼠标的x,y值等。 </font><br /> <br /> * 设计简介 <br /> <br /> 在Visual Studio .Net选择新建Windows 应用程序，选择程序地址并输入程序名后，将生成一个非常简单的初始化窗体Form1类；在初始窗体中添加一个标签(Label)及一个按钮(Button)并设置相应的位置大小及属性值等。双击按钮进入代码编辑区，此时系统自动生了一个用于处理按钮Click事件的方法，即button1_Click()。在方法中添如下的代码： <br /> <br /> <font size="3"></font><font color="#0000ff">Button temp=new Button(); <br /> temp.Text=&quot;新增加的按钮&quot;; <br /> temp.Location=new Point(30,80); <br /> temp.Click+=new EventHandler(this.Test); <br /> this.Controls.Add(temp); <br /> label1.Click+=new EventHandler(this.Test); </font><br /> <br /> 完成后，为窗体Form1类添加一个响应事件的方法Test()，如下： <br /> <br /> <font size="3"></font><font color="#0000ff">private void Test(object sender,System.EventArgs e) <br /> { <br /> MessageBox.Show(&quot;这是我自定义的事件响应函数!&quot;,&quot;提示信息&quot;); <br /> } <br /> </font><br /> 完成代码后保存，编译运行即可以看程序中各控件的事件响应情况. <br /> <br /> * 运行效果 <br /> <br /> 程序运行开始时有一个标签及一个按钮，此时点击标签没有任何响应信息，然后点击“为控件添加事件”按钮，将在窗体中增加一个显示为“新增加的按钮”的按钮，此时再点击标签将会看到有响应信息，即弹出一个对话框说明事作已经得到处理。点击一下“新增加的按钮”也将看到有事件响应信息。 <br /> <br /> 再点击“为事件添加按钮”此时添体界面看到不变，其实已经有两个显示为“新增加的按钮”的按钮在窗体上，只是因为重复显示在同一位置看不到而已。非常有趣的是，再点击标签试一下，我们会发现事件响应方法被执行了两次。 <br /> <br /> * 关键代码及注释 <br /> <br /> 下面我们列出了本程序中比较核心的代码，并作了详细的注释，请大家仔细体会。  </strong></div></body></html>