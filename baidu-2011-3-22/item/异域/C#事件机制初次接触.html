<html><head><title><div class="tit">
  C#事件机制初次接触
</div></title></head><body><div id='tit'>C#事件机制初次接触</div><div id='cate'>异域</div><div id='date'>2008年03月05日 星期三 12:27 P.M.</div><div id='page'>167</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/f06d993db2af6004bba16746.html'>http://hi.baidu.com/hxzon/blog/item/f06d993db2af6004bba16746.html</a><div id='cnt'><p><font style="background-color: #ffffff" size="3">C#事件机制初次接触</font></p> 
<div style="text-indent: 18pt">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">C#</span><span style="font-size: 9pt">是微软出品的新一代编程语言是</span><span style="font-size: 9pt">VS.NET</span><span style="font-size: 9pt">工具集中的主打语言，</span><span style="font-size: 9pt">C#</span><span style="font-size: 9pt">的一个重要特性之一就是支持“事件（</span><span style="font-size: 9pt">Event</span><span style="font-size: 9pt">）”。在</span><span style="font-size: 9pt">C#</span><span style="font-size: 9pt">中为一个类添加事件支持是非常简单的：</span></font>
</div> 
<div style="text-indent: 18pt">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">打开</span><span style="font-size: 9pt">VS.NET</span><span style="font-size: 9pt">，新建一个</span><span style="font-size: 9pt">C# Console Application</span><span style="font-size: 9pt">，执行“项目”</span><span style="font-size: 9pt">-&gt;</span><span style="font-size: 9pt">“添加类”菜单功能，添加一个“</span><span style="font-size: 9pt">MyClass</span><span style="font-size: 9pt">”类：</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="color: blue; font-size: 9pt">using</span><span style="font-size: 9pt"> System;</span></font>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="color: blue; font-size: 9pt">namespace</span><span style="font-size: 9pt"> ConsoleApplication1</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">{</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">声明一个delegate</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">delegate</span> <span style="color: blue">void</span> EventHandler();</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span><span style="color: gray">
    <details>
     <summary></summary>
    </details></span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span></span><span style="color: green; font-size: 9pt">测试C#的event机制。</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span></font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> MyClass</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">声明一个成员变量来保存事件句柄（事件被激发时被调用的delegate）</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> EventHandler m_Handler = <span style="color: blue">null</span>;</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">激发事件</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> FireAEvent()</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span>(m_Handler != <span style="color: blue">null</span>)</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Handler();</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">声明事件</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">event</span> EventHandler AEvent</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add<span style="color: green">//</span></span><span style="color: green; font-size: 9pt">添加访问器</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">注意，访问器中实际包含了一个名为value的隐含参数</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">该参数的值即为客户程序调用+=时传递过来的delegate</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;AEvent add </span><span style="font-size: 9pt">被调用，value的HashCode为：&quot; + <span style="color: blue">value.GetHashCode());</span></span></font>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span>(<span style="color: blue">value</span> != <span style="color: blue">null</span>){m_Handler = <span style="color: blue">value</span>;};<span style="color: green">//</span></span><span style="color: green; font-size: 9pt">设置m_Handler域保存新的handler</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remove<span style="color: green">//</span></span><span style="color: green; font-size: 9pt">删除访问器</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;AEvent remove </span><span style="font-size: 9pt">被调用，value的HashCode为：&quot; + <span style="color: blue">value.GetHashCode());</span></span></font>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span>(<span style="color: blue">value</span> == m_Handler){m_Handler = <span style="color: blue">null</span>;}<span style="color: green">//</span></span><span style="color: green; font-size: 9pt">置m_Handler为null，该事件将不再被激发</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> MyClass()</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// TODO: </span></span><span style="color: green; font-size: 9pt">在此处添加构造函数逻辑</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">}</font></span>
</div> 
<div> 
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">然后在主文件</span><span style="font-size: 9pt">Class1.cs</span><span style="font-size: 9pt">中输入如下代码：</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="color: blue; font-size: 9pt">using</span><span style="font-size: 9pt"> System;</span></font>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="color: blue; font-size: 9pt">namespace</span><span style="font-size: 9pt"> ConsoleApplication1</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">{</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span><span style="color: gray">
    <details>
     <summary></summary>
    </details></span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span><span style="color: green"> Class1 </span></span><span style="color: green; font-size: 9pt">的摘要说明。</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span></font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">class</span> Class1</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span><span style="color: gray">
    <details>
     <summary></summary>
    </details></span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span></span><span style="color: green; font-size: 9pt">应用程序的主入口点。</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: gray">///</span></font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [STAThread]</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">static</span> <span style="color: blue">void</span> Main(<span style="color: blue">string</span>[] args)</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// TODO: </span></span><span style="color: green; font-size: 9pt">在此处添加代码以启动应用程序</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">实例化一个MyClass的对象Obj</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClass Obj = <span style="color: blue">new</span> MyClass();</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">基于MyEventHandler()函数定义一个EventHandler</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EventHandler MyHandler = <span style="color: blue">new</span> EventHandler(MyEventHandler);</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;MyHandler</span><span style="font-size: 9pt">的HashCode为：&quot;+MyHandler.GetHashCode());</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine();</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">预定事件</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Obj.AEvent += Myhandler </span><span style="font-size: 9pt">被调用&quot;);</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Obj.AEvent += MyHandler;</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">激发事件</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Main</span><span style="font-size: 9pt">函数激发Obj的AEvent事件！&quot;);</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Obj.FireAEvent();</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">撤消事件</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Obj.AEvent -= Myhandler </span><span style="font-size: 9pt">被调用&quot;);</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Obj.AEvent -= MyHandler;</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine();</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">再次试图激发事件</span></font>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;Main</span><span style="font-size: 9pt">函数试图在撤消事件后激发Obj的AEvent事件！&quot;);</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Obj.FireAEvent();</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;</span><span style="font-size: 9pt">－－－程序运行完毕！－－－&quot;);</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ReadLine();</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//</span></span><span style="color: green; font-size: 9pt">真正的事件处理函数</span></font>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">static</span> <span style="color: blue">void</span> MyEventHandler()</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(&quot;This is a Event!&quot;);</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left"> 
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">&nbsp;&nbsp;&nbsp;&nbsp; }</font></span>
</div> 
<div align="left">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">}</font></span>
</div> 
<div style="text-indent: 18pt">
 <span style="font-size: 9pt"><font style="background-color: #ffffff"></font><font size="3">运行，我们从程序的输出结果中可以看出，<span style="font-size: 9pt">当我们在Main函数中调用</span></font></span>
</div> 
<div style="text-indent: 18pt">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">Obj.FireAEvent();</font></span>
</div> 
<div style="text-indent: 18pt">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">方法后，我们的MyEventHandler事件处理函数被调用，屏幕输出 “This is a Event!”。</font></span>
</div> 
<div style="text-indent: 18pt"> 
</div> 
<div style="text-indent: 18pt">
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">下面我们结合该Console程序的输出结果分析一下这个MyEventHandler是如何被调用的：</font></span>
</div> 
<div>
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">――――――――――――――――――――――――――――</font></span>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">1</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">MyHandler</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">HashCode</span><span style="font-size: 9pt">为：</span><span style="font-size: 9pt">10048139</span></font>
</div> 
<div> 
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">2</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">Obj.AEvent += Myhandler </span><span style="font-size: 9pt">被调用</span></font>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">3</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">AEvent add </span><span style="font-size: 9pt">被调用，</span><span style="font-size: 9pt">value</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">HashCode</span><span style="font-size: 9pt">为：</span><span style="font-size: 9pt">10048139</span></font>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">4</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数激发</span><span style="font-size: 9pt">Obj</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">AEvent</span><span style="font-size: 9pt">事件！</span></font>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">5</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">This is a Event!</span></font>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">6</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">Obj.AEvent -= Myhandler </span><span style="font-size: 9pt">被调用</span></font>
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">7</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">AEvent remove </span><span style="font-size: 9pt">被调用，</span><span style="font-size: 9pt">value</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">HashCode</span><span style="font-size: 9pt">为：</span><span style="font-size: 9pt">10048139</span></font>
</div> 
<div> 
</div> 
<div>
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">（</span><span style="font-size: 9pt">8</span><span style="font-size: 9pt">）</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数试图在撤消事件后激发</span><span style="font-size: 9pt">Obj</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">AEvent</span><span style="font-size: 9pt">事件！</span></font>
</div> 
<div>
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">－－－程序运行完毕！－－－</font></span>
</div> 
<div>
 <span style="font-size: 9pt"><font style="background-color: #ffffff" size="3">――――――――――――――――――――――――――――</font></span>
</div> 
<div style="text-indent: 18pt">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">首先，</span><span style="font-size: 9pt">Obj.AEvent += Myhandler</span><span style="font-size: 9pt">被调用后，</span><span style="font-size: 9pt">MyHandler</span><span style="font-size: 9pt">被作为隐含的</span><span style="font-size: 9pt">value</span><span style="font-size: 9pt">参数传递给</span><span style="font-size: 9pt">MyClass</span><span style="font-size: 9pt">中的事件</span><span style="font-size: 9pt">AEvent</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">add</span><span style="font-size: 9pt">访问器，我们在该访问器中设置</span><span style="font-size: 9pt">m_Handler</span><span style="font-size: 9pt">成员变量为传递过来的</span><span style="font-size: 9pt">value</span><span style="font-size: 9pt">（通过</span><span style="font-size: 9pt">HashCode</span><span style="font-size: 9pt">我们可以知道该参数和</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数中的</span><span style="font-size: 9pt">MyHandler</span><span style="font-size: 9pt">为同一对象）即我们的</span><span style="font-size: 9pt">MyHandler</span><span style="font-size: 9pt">（该代理实际上指向我们的</span><span style="font-size: 9pt">MyEventHandler</span><span style="font-size: 9pt">函数），当</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数调用</span><span style="font-size: 9pt">Obj.FireEvent()</span><span style="font-size: 9pt">时，</span><span style="font-size: 9pt">Obj</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">m_Handler</span><span style="font-size: 9pt">被调用，也就是我们的</span><span style="font-size: 9pt">MyEventHandler</span><span style="font-size: 9pt">被调用。</span></font>
</div> 
<div style="text-indent: 18pt">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">Obj.AEvent -= Myhandler</span><span style="font-size: 9pt">被调用时，</span><span style="font-size: 9pt">AEvent</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">remove</span><span style="font-size: 9pt">访问器被调用，我们在这里置</span><span style="font-size: 9pt">m_Handler</span><span style="font-size: 9pt">为</span><span style="font-size: 9pt">null</span><span style="font-size: 9pt">，撤消该事件，</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数再次</span><span style="font-size: 9pt">FireEvent</span><span style="font-size: 9pt">时，由于</span><span style="font-size: 9pt">Obj</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">m_Handler</span><span style="font-size: 9pt">为</span><span style="font-size: 9pt">null</span><span style="font-size: 9pt">，所以直接返回到</span><span style="font-size: 9pt">Main</span><span style="font-size: 9pt">函数中，事件处理函数不再被调用。</span></font>
</div> 
<div style="text-indent: 18pt"> 
</div> 
<div style="text-indent: 18pt">
 <font style="background-color: #ffffff"></font>
 <font size="3"><span style="font-size: 9pt">通过这个简单的例子，我们可以从整体上了解</span><span style="font-size: 9pt">C#</span><span style="font-size: 9pt">的</span><span style="font-size: 9pt">Event</span><span style="font-size: 9pt">机制的一般用法和浅层原理（深层的原理我还没有弄明白</span><span style="font-size: 9pt">^_^</span><span style="font-size: 9pt">）。可以看到，在</span><span style="font-size: 9pt">C#</span><span style="font-size: 9pt">中事件机制是在语言级通过“函数代理（</span><span style="font-size: 9pt">delegate</span><span style="font-size: 9pt">）”和“</span><span style="font-size: 9pt">event</span><span style="font-size: 9pt">”关键字被直接支持的，而在</span><span style="font-size: 9pt">C++</span><span style="font-size: 9pt">等语言中是必须自己写代码实现的。</span></font>
</div></div></body></html>