<html><head><title><div class="tit">
  C#的关键字 [STAThread]即 single-threaded apartment
</div></title></head><body><div id='tit'>C#的关键字 [STAThread]即 single-threaded apartment</div><div id='cate'>异域</div><div id='date'>2008年03月12日 星期三 02:57 P.M.</div><div id='page'>164</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/b9a40af36ea1bacf0b46e07f.html'>http://hi.baidu.com/hxzon/blog/item/b9a40af36ea1bacf0b46e07f.html</a><div id='cnt'><p><font face="Courier New"><strong style="font-size: 14pt">C#的关键字 [STAThread]即 single-threaded apartment</strong><br /> <span style="font-size: 14pt"><strong>一：<br /> </strong></span><span style="font-size: 12pt">每个Thread都有一个关于ApartmentState的属性，可以把它设置为：STA或者MTA，或者UNKNOWN。<br /> 当你想指定工程的启动窗口的时候，你需要在该窗口类中申明一个Main()方法，并为这个方法设置[STAThread]属性。<br /> 详细信息，清查阅MSDN中关于Threading和COM Interop和COM+ Apartment Model的文章：<br /> <br /> </span>http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpguidnf/html/cpconmanagedunmanagedthreading.asp<br /> http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpguidnf/html/cpconadvancedcominterop.asp<br /> http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cossdk/htm/pgservices_synchronization_8703.asp</font></p> 
<p><font face="Courier New"><span style="font-size: 14pt"><font face="Courier New"><strong>二：</strong></font></span><br /> <span style="font-size: 12pt"><font face="Courier New">[STAThread]是Single Thread Apartment单线程套间的意思，是一种线程模型，用在程序的入口方法上<br /> （在C#和VB.NET里是Main()方法），来指定当前线程的ApartmentState 是STA。用在其他方法上不产生影响。<br /> 在aspx页面上可以使用AspCompat = &quot;true&quot; 来达到同样的效果。这个属性只在 Com Interop 有用，<br /> 如果全部是 managed code 则无用。简单的说法:[STAThread]指示应用程序的默认线程模型是单线程单元 (STA)。<br /> 启动线程模型可设置为单线程单元或多线程单元。如果未对其进行设置，则该线程不被初始化。也就是说如果你用的.NET Framework，<br /> 并且没有使用COM Interop，一般不需要这个Attribute。其它的还有MTA（多线程套间）、Free Thread（自由线程）。<br /> 单线程套间，简单来说所有对于单线程套间中对象的访问都是通过消息来传递的，所以同一时间只有一个线程能够访问单线程套间中的对象。<br /> </font></span></font><font face="Courier New"><span style="font-size: 14pt"><font face="Courier New"><strong><br /> 三：</strong></font></span><br /> <span style="font-size: 12pt">C#中,[STAThread]代表什么意思?如何用?</span><br /> </font><span>Single Thread Apartment</span></p> 
<p><span><span><span style="font-size: 12pt">&gt;Why is STAThread required?</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">it changes the apartment state of the current thread to be single threaded</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">&gt;Single Thread Apartment vs MultiThread Apartment?</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">Correct: With the STAThread attribute, you will be interacting with COM processes in a<br /> &quot;Single Threading Apartment&quot; model. Without it, you will be interacting with COM processes <br /> in the &quot;Multiple Threading Apartment&quot; model.</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">&gt; so why do I need it....or why would I want it at some point?</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">You may want to interact with a COM process in a MTA model for performance reasons. You may<br /> want to interact with a COM process in a STA model because of a design requirement. For example, <br /> to use the Windows clipboard (System.Windows.Forms.Clipboard) you must be calling from a thread <br /> running in a STA. If the calling thread was started by your application you can set the ApartmentState <br /> (System.Threading.ApartmentState) before starting, but if you want to use the clipboard from your a<br /> pplication's main thread, you need to use the System.STAThread attribute on your Main method.</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">&gt; why does Main( ) only function as an entry point when it is declared static?</span></span></span></p> 
<p><span><span><span style="font-size: 12pt">The simple answer is that is just the way that Microsoft designed the language. One way you can look at <br /> this though, is there should only be 1 &quot;instance&quot; of your Main method - the main method has nothing to do<br /> with any specific instances of the class it is defined in, and should therefore be static. In my opinion <br /> it might have been a good idea to give the Main method a property similar to a static contructor where it is <br /> executed once, and only once. Anyway, because the Main method is static, you can execute your program without <br /> having to create any arbitrary objects.</span></span></span></p></div></body></html>