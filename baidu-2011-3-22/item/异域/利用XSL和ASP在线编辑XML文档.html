<html><head><title><div class="tit">
  利用XSL和ASP在线编辑XML文档
</div></title></head><body><div id='tit'>利用XSL和ASP在线编辑XML文档</div><div id='cate'>异域</div><div id='date'>2008年03月27日 星期四 11:09 P.M.</div><div id='page'>153</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/0864c5fdddae7641d7887d38.html'>http://hi.baidu.com/hxzon/blog/item/0864c5fdddae7641d7887d38.html</a><div id='cnt'><p>利用XSL和ASP在线编辑XML文档</p> 
<p><span class="t18">本文通过一个详细的例子，来阐述了在线编辑XML文档数据的方法。由于Netscape对XML的支持比较弱，因此，要实现跨平台的数据交换，数据的处理必须在服务器端进行。要编辑XML文档，首先要做的事情就是怎样把这些数据提取并显示给访问者，XSL为我们显示XML文件提供了一个很好的解决方案。下面的例子就是利用XSL样式单把XML文档显示出来，供用户进行编辑，然后再把编辑后的数据提交到服务器，在服务器端进行数据的更新。这里采用ASP（Active Server Pages）来完成我们的任务。 <br /> 首先，载入我们要进行编辑的XML文档，利用微软的文档对象模型（Microsoft XMLDOM Object）和XSL，XML文档就可以在服务器端转换成可以在客户端显示的HTML文件内容。下面先看看我们使用的XML和XSL文件是什么样子的。 <br /> XML文件：userdata.xml <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;gb2312&quot;?&gt; <br /> &lt;用户资料&gt; <br /> &lt;field id=&quot;姓名&quot; taborder=&quot;1&quot;&gt; <br /> &lt;field_value&gt;孟子&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;field id=&quot;性别&quot; taborder=&quot;2&quot;&gt; <br /> &lt;field_value&gt;男&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;field id=&quot;单位名称&quot; taborder=&quot;3&quot;&gt; <br /> &lt;field_value&gt;中国<a class="wordstyle" target="_blank" href="http://www.newasp.cn/"><font color="#000099">网络</font></a>技术发展公司北京分公司&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;field id=&quot;详细地址&quot; taborder=&quot;4&quot;&gt; <br /> &lt;field_value&gt;北京市嘉里中心102层&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;field id=&quot;电话&quot; taborder=&quot;5&quot;&gt; <br /> &lt;field_value&gt;1391139136*&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;field id=&quot;电子邮件&quot; taborder=&quot;6&quot;&gt; <br /> &lt;field_value&gt;amxh@21cn.com&lt;/field_value&gt; <br /> &lt;/field&gt; <br /> &lt;/用户资料&gt; <br /> 'www.knowsky.com <br /> XSL文件：userdata.xsl <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;gb2312&quot; ?&gt; <br /> &lt;xsl:stylesheet xmlns:xsl=&quot;<a href="http://www.w3.org/TR/WD-xsl"><font color="#000099">http://www.w3.org/TR/WD-xsl</font></a>&quot;&gt; <br /> &lt;xsl:template match=&quot;/&quot;&gt; <br /> &lt;html&gt; <br /> &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=gb2312&quot; /&gt; <br /> &lt;body&gt; <br /> &lt;form method=&quot;post&quot; action=&quot;Edituserdata.asp&quot;&gt; <br /> &lt;h1&gt;用户资料编辑：&lt;/h1&gt; <br /> &lt;table border=&quot;1&quot; cellpadding=&quot;2&quot;&gt; <br /> &lt;xsl:for-each select=&quot;用户资料/field&quot;&gt; <br /> &lt;tr&gt; <br /> &lt;td&gt; <br /> &lt;xsl:value-of select=&quot;@id&quot;/&gt; <br /> &lt;/td&gt; <br /> &lt;td&gt; <br /> &lt;input type=&quot;text&quot;&gt; &lt;xsl:attribute name=&quot;id&quot;&gt; &lt;xsl:value-of select=&quot;@id&quot; /&gt; &lt;/xsl:attribute&gt; &lt;xsl:attribute name=&quot;name&quot;&gt;&lt;xsl:value-of select=&quot;@id&quot; /&gt;&lt;/xsl:attribute&gt; &lt;xsl:attribute name=&quot;value&quot;&gt; &lt;xsl:value-of select=&quot;field_value&quot; /&gt; &lt;/xsl:attribute&gt;&lt;/input&gt; <br /> &lt;/td&gt; <br /> &lt;/tr&gt; <br /> &lt;/xsl:for-each&gt; <br /> &lt;/table&gt; <br /> &lt;br /&gt; <br /> &lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;完成编辑&quot; /&gt; <br /> &lt;/form&gt; <br /> &lt;/body&gt; <br /> &lt;/html&gt; <br /> &lt;/xsl:template&gt; <br /> &lt;/xsl:stylesheet&gt; <br /> XSL文件使用了XSL：for-each元素的来遍历整个XML文件，XML文件里每个“field”元素的“id”属性和HTML表单的文本输入框的“id”和“name”想对应。这样，HTML表单的文本输入框就显示出了XML文件的元素值。此文件负责XML文档在服务器端的转换，以便能在各种浏览器上显示。 <br /> 下面是关键的程序，它实现打开和更新XML文档的功能，并根据表单的提交与否，来决定是否进行更新。它包含了两个函数，loadXMLFile负责载入和转换要显示的XML文件；updateXML函数负责更新XML文件。 <br /> Edituserdata.asp程序如下： <br /> &lt;% <br /> ''----------------------------------------------------------- <br /> ''定义函数 loadXMLFile(),接收二个参数： <br /> ''strXMLFile - XML 文件的路径和文件名字 <br /> ''strXSLFilee - XSL 文件的路径和文件名字 <br /> ''www.knowsky.com <br /> ''----------------------------------------------------------- <br /> Function loadXMLFile(strXMLFile, strXSLFile) <br /> ''Declare local variables <br /> Dim objXML <br /> Dim objXSL <br /> ''实例化 XMLDOM 对象，以便载入 XML 文件。 <br /> set objXML = Server.CreateObject(&quot;Microsoft.XMLDOM&quot;) <br /> ''关掉文件异步载入模式。 <br /> objXML.async = false <br /> ''载入 XML 文件！ <br /> objXML.load(strXMLFile) <br /> ''实例化 XMLDOM 对象，以便载入 XSL 文件。 <br /> set objXSL = Server.CreateObject(&quot;Microsoft.XMLDOM&quot;) <br /> ''关掉文件异步载入模式。 <br /> objXSL.async = false <br /> ''载入 XSL 文件！ <br /> objXSL.load(strXSLFile) <br /> ''利用 XMLDOM 的 transformNode 方法，把 XSL 样式表应用到 XML 文档，然后输出到客户端。 <br /> Response.Write(objXML.transformNode(objXSL)) <br /> End Function <br /> ''------------------------------------------------------------------ <br /> ''函数 updateXML() 接收一个参数：strXMLFile - XML 文件的路径和文件名。 <br /> ''------------------------------------------------------------------ <br /> Function updateXML(strXMLFile) <br /> ''声明局部变量。 <br /> Dim objDom <br /> Dim objRoot <br /> Dim objField <br /> Dim x <br /> ''实例化 XMLDOM 对象。 <br /> set objDOM = Server.CreateObject(&quot;Microsoft.XMLDOM&quot;) <br /> ''关掉文件异步载入模式。 <br /> objDOM.async = false <br /> ''载入 XML 文件。 <br /> objDOM.load strXMLFile <br /> ''设定根元素。 <br /> Set objRoot = objDom.documentElement <br /> ''遍历 FORM 集合，并把提交的数据写入 XML 文件。 <br /> For x = 1 to Request.Form.Count <br /> ''检查提交的数据是否包含按钮。如果是，忽略此数据。 <br /> If instr(1,Request.Form.Key(x),&quot;btn&quot;) = 0 Then <br /> ''按照 XSL 查询模式，建立 objField 变量，把表单的元素对应到 XML 文档里的相应元素[field_value]。 <br /> Set objField = objRoot.selectSingleNode(&quot;field[@id=''&quot; &amp; Request.Form.Key(x) &amp; &quot;'']/field_value&quot;) <br /> ''把表单提交的数据和 XML 文档里的节点值对应起来。 <br /> objField.Text = Request.Form(x) <br /> End If <br /> Next <br /> ''保存编辑过的 XML 文件。 <br /> objDom.save strXMLFile <br /> ''释放所有对对象的引用。 <br /> Set objDom = Nothing <br /> Set objRoot = Nothing <br /> Set objField = Nothing <br /> ''调用 loadXMLFile 函数，把新编辑后的 XML 文件用 updateduserdata.xsl 样式单显示到客户端。 <br /> loadXMLFile strXMLFile,server.MapPath(&quot;updateduserdata.xsl&quot;) <br /> End Function <br /> ''检查表单是否成功提交，如提交，更新 XML 文件；否则，转到编辑状态。 <br /> If Request.Form(&quot;btnSubmit&quot;) = &quot;&quot; Then <br /> loadXMLFile server.MapPath(&quot;userdata.xml&quot;),server.MapPath(&quot;userdata.xsl&quot;) <br /> Else <br /> updateXML server.MapPath(&quot;userdata.xml&quot;) <br /> End If <br /> %&gt; <br /> 当表单提交成功后，我们用updateduserdata.xsl来显示我们刚刚编辑的数据。 <br /> updateduserdata.xsl如下： <br /> &lt;?xml version=&quot;1.0&quot; encoding=&quot;gb2312&quot; ?&gt; <br /> &lt;xsl:stylesheet xmlns:xsl=&quot;<a href="http://www.w3.org/TR/WD-xsl"><font color="#000099">http://www.w3.org/TR/WD-xsl</font></a>&quot;&gt; <br /> &lt;xsl:template match=&quot;/&quot;&gt; <br /> &lt;html&gt; <br /> &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=gb2312&quot; /&gt; <br /> &lt;body&gt; <br /> &lt;h1&gt;更新后的用户资料如下：&lt;/h1&gt; <br /> &lt;table border=&quot;1&quot; cellpadding=&quot;2&quot;&gt; <br /> &lt;xsl:for-each select=&quot;用户资料/field&quot;&gt; <br /> &lt;tr&gt; <br /> &lt;td&gt; <br /> &lt;xsl:value-of select=&quot;@id&quot; /&gt; <br /> &lt;/td&gt; <br /> &lt;td&gt; <br /> &lt;xsl:value-of select=&quot;field_value&quot; /&gt; <br /> &lt;/td&gt; <br /> &lt;/tr&gt; <br /> &lt;/xsl:for-each&gt; <br /> &lt;/table&gt; <br /> &lt;form&gt; <br /> &lt;input type=&quot;button&quot; value=&quot;返回&quot; onclick=&quot;history.go(-1)&quot; /&gt; <br /> &lt;/form&gt; <br /> &lt;/body&gt; <br /> &lt;/html&gt; <br /> &lt;/xsl:template&gt; <br /> &lt;/xsl:stylesheet&gt; <br /> 以上只是XML跨平台应用的一个简单的例子，结合具体的需求，我们可以编写功能更强大的程序来完成我们更负杂的工作。所有程序在WIN98SE+PWS+IE5.5+Netscape 4.75+Netscape 6+MSXML3.DLL环境下调试通过。 <br /> <a href="http://www.maeee.cn/article/it/asp/jiqiao/">http://www.maeee.cn/article/it/asp/jiqiao/</a></span></p></div></body></html>