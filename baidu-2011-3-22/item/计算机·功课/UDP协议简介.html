<html><head><title><div class="tit">
  UDP协议简介
</div></title></head><body><div id='tit'>UDP协议简介</div><div id='cate'>计算机&middot;功课</div><div id='date'>2007年11月13日 星期二 10:10 A.M.</div><div id='page'>213</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/1aa3b5dea02c755bcdbf1a38.html'>http://hi.baidu.com/hxzon/blog/item/1aa3b5dea02c755bcdbf1a38.html</a><div id='cnt'><p>UDP协议简介<br /> <br /> UDP协议是英文UserDatagramProtocol的缩写，即用户数据报协议，主要用来支持那些需要在计算机之间传输数据的网络应用。包括网络视频会议系统在内的众多的客户/服务器模式的网络应用都需要使用UDP协议。UDP协议从问世至今已经被使用了很多年，虽然其最初的光彩已经被一些类似协议所掩盖，但是即使是在今天，UDP仍然不失为一项非常实用和可行的网络传输层协议。<br /> <br /> 与我们所熟知的TCP（传输控制协议）协议一样，UDP协议直接位于IP（网际协议）协议的顶层。根据OSI（开放系统互连）参考模型，UDP和TCP都属于传输层协议。<br /> <br /> UDP协议的主要作用是将网络数据流量压缩成数据报的形式。一个典型的数据报就是一个二进制数据的传输单位。每一个数据报的前8个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。<br /> <br /> UDP报头<br /> <br /> UDP报头由4个域组成，其中每个域各占用2个字节，具体如下：<br /> <br /> 源端口号<br /> <br /> 目标端口号<br /> <br /> 数据报长度<br /> <br /> 校验值<br /> <br /> UDP协议使用端口号为不同的应用保留其各自的数据传输通道。UDP和TCP协议正是采用这一机制实现对同一时刻内多项应用同时发送和接收数据的支持。数据发送一方（可以是客户端或服务器端）将UDP数据报通过源端口发送出去，而数据接收一方则通过目标端口接收数据。有的网络应用只能使用预先为其预留或注册的静态端口；而另外一些网络应用则可以使用未被注册的动态端口。因为UDP报头使用两个字节存放端口号，所以端口号的有效范围是从0到65535。一般来说，大于49151的端口号都代表动态端口。<br /> <br /> 数据报的长度是指包括报头和数据部分在内的总的字节数。因为报头的长度是固定的，所以该域主要被用来计算可变长度的数据部分（又称为数据负载）。数据报的最大长度根据操作环境的不同而各异。从理论上说，包含报头在内的数据报的最大长度为65535字节。不过，一些实际应用往往会限制数据报的大小，有时会降低到8192字节。<br /> <br /> UDP协议使用报头中的校验值来保证数据的安全。校验值首先在数据发送方通过特殊的算法计算得出，在传递到接收方之后，还需要再重新计算。如果某个数据报在传输过程中被第三方篡改或者由于线路噪音等原因受到损坏，发送和接收方的校验计算值将不会相符，由此UDP协议可以检测是否出错。这与TCP协议是不同的，后者要求必须具有校验值。<br /> <br /> UDPvs.TCP<br /> <br /> UDP和TCP协议的主要区别是两者在如何实现信息的可靠传递方面不同。TCP协议中包含了专门的传递保证机制，当数据接收方收到发送方传来的信息时，会自动向发送方发出确认消息；发送方只有在接收到该确认消息之后才继续传送其它信息，否则将一直等待直到收到确认信息为止。<br /> <br /> 与TCP不同，UDP协议并不提供数据传送的保证机制。如果在从发送方到接收方的传递过程中出现数据报的丢失，协议本身并不能做出任何检测或提示。因此，通常人们把UDP协议称为不可靠的传输协议。<br /> <br /> 相对于TCP协议，UDP协议的另外一个不同之处在于如何接收突法性的多个数据报。不同于TCP，UDP并不能确保数据的发送和接收顺序。例如，一个位于客户端的应用程序向服务器发出了以下4个数据报<br /> <br /> D1<br /> <br /> D22<br /> <br /> D333<br /> <br /> D4444<br /> <br /> 但是UDP有可能按照以下顺序将所接收的数据提交到服务端的应用：<br /> <br /> D333<br /> <br /> D1<br /> <br /> D4444<br /> <br /> D22<br /> <br /> 事实上，UDP协议的这种乱序性基本上很少出现，通常只会在网络非常拥挤的情况下才有可能发生。<br /> <br /> UDP协议的应用<br /> <br /> 也许有的读者会问，既然UDP是一种不可靠的网络协议，那么还有什么使用价值或必要呢？其实不然，在有些情况下UDP协议可能会变得非常有用。因为UDP具有TCP所望尘莫及的速度优势。虽然TCP协议中植入了各种安全保障功能，但是在实际执行的过程中会占用大量的系统开销，无疑使速度受到严重的影响。反观UDP由于排除了信息可靠传递机制，将安全和排序等功能移交给上层应用来完成，极大降低了执行时间，使速度得到了保证。<br /> <br /> 关于UDP协议的最早规范是RFC768，1980年发布。尽管时间已经很长，但是UDP协议仍然继续在主流应用中发挥着作用。包括视频电话会议系统在内的许多应用都证明了UDP协议的存在价值。因为相对于可靠性来说，这些应用更加注重实际性能，所以为了获得更好的使用效果（例如，更高的画面帧刷新速率）往往可以牺牲一定的可靠性（例如，会面质量）。这就是UDP和TCP两种协议的权衡之处。根据不同的环境和特点，两种传输协议都将在今后的网络世界中发挥更加重要的作用<br /> ==================================================</p> 
<p>UDP协议的标题结构 <br /> <br /> UDP信息包由UDP标题和数据组成。UDP的标题结构如图15-21所示,它由5个域组成：源端端口(SourcePort)、目的地端口(DestinationPort)、用户数据包的长度(Length)和检查和（Checksum)。其中，前4个域组成UDP标题(UDPheader)，每个域由4个字节组成；检查和域占据2个字节，它用来检测传输过程中是否出现了错误；用户数据包的长度包括所有5个域的字节数。<br /> <br /> <br /> <br /> <br /> UDP信息包的标题结构<br /> <br /> 检查和的详细计算可在RFC1071中找到，现举一例说明使用检查和检测错误的道理。例如，假设从源端A要发送下列3个16位的二进制数：word1，word2和word3到终端B，检查和计算如下： word1<br /> 0110011001100110<br /> <br /> word2<br /> 0101010101010101<br /> <br /> word3<br /> 0000111100001111<br /> <br /> sum=word1+ word2+ word3<br /> 1100101011001010<br /> <br /> 检查和(sum的反码)<br /> 0011010100110101<br /> <br /> 从发送端发出的4个(word1，2，3以及检查和)16位二进制数之和为1111111111111111，如果接收端收到的这4个16位二进制数之和也是全“1”，就认为传输过程中没有出差错。<br /> 许多链路层协议都提供错误检查，包括流行的以太网协议，读者也许想知道为什么UDP也要提供检查和。其原因是链路层以下的协议在源端和终端之间的某些通道可能不提供错误检测。虽然UDP提供有错误检测，但检测到错误时，UDP不做错误校正，只是简单地把损坏的消息段扔掉，或者给应用程序提供警告信息。<br /> 读者也可能会问，收发两端的两个进程是否有可能通过UDP提供可靠的数据传输？答案是可以的。但必需要把确认和重传措施加到应用程序中，应用程序不能指望UDP来提供可靠的数据传输。<br /> ===============================================================</p> 
<p>UDP协议的几个特性 <br /> <br /> <br /> (1) UDP是一个无连接协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。 <br /> <br /> (2) 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。<br /> <br /> (3) UDP信息包的标题很短，只有8个字节，相对于TCP的20个字节信息包的额外开销很小。<br /> <br /> (4) 吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。<br /> <br /> 虽然UDP是一个不可靠的协议，但它是分发信息的一个理想协议。例如，在屏幕上报告股票市场、在屏幕上显示航空信息等等。UDP也用在路由信息协议RIP(Routing Information Protocol)中修改路由表。在这些应用场合下，如果有一个消息丢失，在几秒之后另一个新的消息就会替换它。UDP广泛用在多媒体应用中，例如，Progressive Networks公司开发的RealAudio软件，它是在因特网上把预先录制的或者现场音乐实时传送给客户机的一种软件，该软件使用的RealAudio audio-on-demand protocol协议就是运行在UDP之上的协议，大多数因特网电话软件产品也都运行在UDP之上。<br /> ================================================================</p> 
<p>UDP用户数据报头格式 <br /> <br /> 介绍<br /> <br /> 用户数据报协议是定义用来在互连网络环境中提供包交换的计算机通信的协议。此协议默认认为网路协议（IP）是其下层协议。此协议提供了向另一用户程序发送信息的最简便的协议机制。此协议是面向操作的，未提供提交和复制保护。如果应用程序要求可靠的数据传送应该使用传输控制协议（TCP）。数据报格式如下： <br /> <br /> <br /> <br /> 用户数据报头格式<br /> <br /> 域<br /> <br /> 源端口是可选域，当其有意义时，它指的是发送进程的端口，这也就假定了在没有其它信息的情况下，返回信息应该向什么地方发送。如果不使用它，则在此域中填0。目的端口在有特定的目的网络地址时有意义。长度指的是此用户数据报长度的八进制表示。（这表明最小的数据报长度是8。）校验码有16位，是对IP头，UDP头和数据中信息包头的数位取反之和再取反得到的。<br /> <br /> 包头从概念上说是在UDP头信息之前的，它包括有源地址，目的地地址，所使用的协议和UDP长度。这些信息使信息不能被错误地接收。这个校验过程与TCP中使用的过程一致。<br /> <br /> <br /> <br /> 如果计算出的校验码为零，它将被全零发送。全零的校验值意味着发送者未产生校验码。<br /> <br /> 用户接口<br /> <br /> 用户接口应该允许创建新的接收端口，在接收端口的接收操作有：应该返回一个八进制数说明源端口和源地址，允许数据报传送，指定数据，源和目标端口和目的地地址。<br /> <br /> IP层接口<br /> <br /> UDP模块必须能够决定源和目标的网络地址，而且必须能够从包头中得知所使用的协议。一个可能的接口方式是返回整个数据报，包括接收操作返回的包头。这样的接口还应该允许UDP向IP传送完整的带包头的数据报用于传送。由IP来确定一致性并计算校验码。<br /> <br /> 协议应用<br /> <br /> 此协议的最主要的用途是网际名称服务器和小文件传输协议。<br /> <br /> 协议号<br /> <br /> 在IP中使用它时，它的协议号是17（八进制中是21）。</p></div></body></html>