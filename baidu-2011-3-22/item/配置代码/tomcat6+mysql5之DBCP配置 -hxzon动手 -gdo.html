<html><head><title><div class="tit">
  tomcat6+mysql5之DBCP配置 -hxzon动手 -gdo
</div></title></head><body><div id='tit'>tomcat6+mysql5之DBCP配置 -hxzon动手 -gdo</div><div id='cate'>配置代码</div><div id='date'>2009年04月22日 星期三 05:37 P.M.</div><div id='page'>55</div><a id='url' href='http://hi.baidu.com/hxzon/blog/item/f2ab273f80c404e455e72319.html'>http://hi.baidu.com/hxzon/blog/item/f2ab273f80c404e455e72319.html</a><div id='cnt'><h2>tomcat6+mysql5之DBCP配置 -hxzon动手 -gdo</h2> 
<p>这个配置弄了大概我一个上午。以前用tomcat 5.后来配置还是出了问题，原因是很简单的一个“r”没有写。<br /> 配置方法如下：<br /> 在tomcat安装目录下conf目录下的context.xml加入</p> 
<div style="border-right: rgb(204,204,204) 1px solid; padding-right: 5px; border-top: rgb(204,204,204) 1px solid; padding-left: 4px; font-size: 13px; padding-bottom: 4px; border-left: rgb(204,204,204) 1px solid; width: 98%; padding-top: 4px; border-bottom: rgb(204,204,204) 1px solid; background-color: rgb(238,238,238)">
 <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" />
 <p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">Resource<br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
 <span style="color: rgb(255,0,0)">name</span>
 <span style="color: rgb(0,0,255)">=&quot;jdbc/test&quot;</span>
 <span style="color: rgb(255,0,0)">&nbsp;&nbsp; auth</span>
 <span style="color: rgb(0,0,255)">=&quot;Container&quot;</span>
 <span style="color: rgb(255,0,0)"><br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type</span>
 <span style="color: rgb(0,0,255)">=&quot;javax.sql.DataSource&quot;</span>
 <span style="color: rgb(255,0,0)"><br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; driverClassName</span>
 <span style="color: rgb(0,0,255)">=&quot;com.mysql.jdbc.Driver&quot;</span>
 <span style="color: rgb(255,0,0)"><br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url</span>
 <span style="color: rgb(0,0,255)">=&quot;jdbc:mysql://localhost:3306/hs&quot;</span>
 <span style="color: rgb(255,0,0)"><br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; username</span>
 <span style="color: rgb(0,0,255)">=&quot;root&quot;</span>
 <span style="color: rgb(255,0,0)"> password</span>
 <span style="color: rgb(0,0,255)">=&quot;root&quot;</span>
 <span style="color: rgb(255,0,0)"><br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxActive</span>
 <span style="color: rgb(0,0,255)">=&quot;30&quot;</span>
 <span style="color: rgb(255,0,0)"> maxIdle</span>
 <span style="color: rgb(0,0,255)">=&quot;10&quot;</span>
 <span style="color: rgb(255,0,0)">&nbsp;&nbsp; maxWait</span>
 <span style="color: rgb(0,0,255)">=&quot;-1&quot;</span>
 <span style="color: rgb(0,0,255)">/&gt;</span>
</div> 
<p>第一步好了，然后就是加入dbcp包和mysql驱动包，2个包复制到lib目录下。<br /> 三：修改项目中的web.xml文件<br /> 加入</p> 
<div style="border-right: rgb(204,204,204) 1px solid; padding-right: 5px; border-top: rgb(204,204,204) 1px solid; padding-left: 4px; font-size: 13px; padding-bottom: 4px; border-left: rgb(204,204,204) 1px solid; width: 98%; padding-top: 4px; border-bottom: rgb(204,204,204) 1px solid; background-color: rgb(238,238,238)">
 <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" />
 <p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">resource-ref</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">&nbsp;&nbsp;&nbsp;<br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;</span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">res-ref-name</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">jdbc/test</span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">res-ref-name</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">&nbsp;&nbsp;&nbsp;<br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;</span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">res-type</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">javax.sql.DataSource</span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">res-type</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">&nbsp;&nbsp;&nbsp;<br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>&nbsp;&nbsp;</span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">res-auth</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">Container</span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">res-auth</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">&nbsp;&nbsp;&nbsp;<br /> <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" /><p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p></span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">resource-ref</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"> </span>
</div> 
<p>hxzon：整个文件内容如下：</p> 
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br /> &lt;web-app version=&quot;2.5&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;<br /> xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br /> xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee&nbsp;&nbsp; http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;&gt;<br /> &lt;resource-ref&gt;&nbsp;&nbsp; <br /> &lt;res-ref-name&gt;jdbc/test&lt;/res-ref-name&gt;&nbsp;&nbsp; <br /> &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;&nbsp;&nbsp; <br /> &lt;res-auth&gt;Container&lt;/res-auth&gt;&nbsp;&nbsp; <br /> &lt;/resource-ref&gt; <br /> &lt;/web-app&gt;</p> 
<p>最后就是测试</p> 
<div style="border-right: rgb(204,204,204) 1px solid; padding-right: 5px; border-top: rgb(204,204,204) 1px solid; padding-left: 4px; font-size: 13px; padding-bottom: 4px; border-left: rgb(204,204,204) 1px solid; width: 98%; padding-top: 4px; border-bottom: rgb(204,204,204) 1px solid; background-color: rgb(238,238,238)">
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">&lt;%</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">@page contentType</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">text/html; charset=GBK</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">%&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">&lt;%</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">@page import</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">java.sql.*</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">%&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">&lt;%</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">@page import</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">javax.naming.*</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">%&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">&lt;%</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">@page import</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">javax.sql.DataSource</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">%&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">HTML</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">HEAD</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">TITLE</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)">JNDI测试</span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">TITLE</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">HEAD</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;</span>
 <span style="color: rgb(128,0,0)">BODY</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">&lt;%</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"><br /> try {<br /> &nbsp;&nbsp; Context ctx </span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> </span>
 <span style="color: rgb(0,0,255); background-color: rgb(245,245,245)">new</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> InitialContext();<br /> &nbsp;&nbsp; DataSource ds </span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> (DataSource) ctx.lookup(</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">java:comp/env/jdbc/test</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">&quot;</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">);<br /> &nbsp;&nbsp; Connection conn </span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)">=</span>
 <span style="color: rgb(0,0,0); background-color: rgb(245,245,245)"> ds.getConnection();<br /> &nbsp;&nbsp;&nbsp;&nbsp; out.println(conn.toString());<br /> } catch (NamingException e) {<br /> &nbsp;&nbsp; e.printStackTrace();<br /> } catch (SQLException e) {<br /> &nbsp;&nbsp; e.printStackTrace();<br /> }<br /> </span>
 <span style="color: rgb(0,0,0); background-color: rgb(255,255,0)">%&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">BODY</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
 <span style="color: rgb(0,0,0)"><br /> </span>
 <span style="color: rgb(0,0,255)">&lt;/</span>
 <span style="color: rgb(128,0,0)">HTML</span>
 <span style="color: rgb(0,0,255)">&gt;</span>
</div> 
<p>如果输出:</p> 
<div style="border-right: rgb(204,204,204) 1px solid; padding-right: 5px; border-top: rgb(204,204,204) 1px solid; padding-left: 4px; font-size: 13px; padding-bottom: 4px; border-left: rgb(204,204,204) 1px solid; width: 98%; padding-top: 4px; border-bottom: rgb(204,204,204) 1px solid; background-color: rgb(238,238,238)">
 <img align="top" src="image/tomcat6+mysql5之DBCP配.None.gif" />
 <p class="origImg">http://www.blogjava.net/Images/OutliningIndicators/None.gif</p>
 <span style="color: rgb(0,0,0)">jdbc:mysql:</span>
 <span style="color: rgb(0,128,0)">//</span>
 <span style="color: rgb(0,128,0)">localhost:3306/lucene, UserName=root@localhost, MySQL-AB JDBC Driver </span>
</div> 
<p><br /> 这个测试不能再应用程序中，只能在web容器中才可以。 <br /> <br /> 刚测试了一下，如果想测试多个数据源的话，在context.xml要加入<br /> &nbsp;&nbsp; factory=&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory&quot;<br /> 使得数据源交由dbcpfactory管理。 <br /> 如果想使用dbcp自动回收数据库连接资源的话，<br /> 可以在后面增加一条：<br /> removeAbandoned=&quot;true&quot; removeAbandonedTimeout=&quot;60&quot; logAbandoned=&quot;true&quot;<br /> removeAbandonedTimeout 超时单位为秒，设置是需设置相当才行 。<br /> -----------------------<br /> hxzon：成功。并且发现，不加commons-dbcp.jar也可以运行，也行应为tomcat6有tomcat-dbcp.jar？？？<br /> test.jsp<br /> &lt;%@page contentType=&quot;text/html; charset=GBK&quot;%&gt;<br /> &lt;%@page import=&quot;java.sql.*&quot; %&gt;<br /> &lt;%@page import=&quot;javax.naming.*&quot; %&gt;<br /> &lt;%@page import=&quot;javax.sql.DataSource&quot; %&gt;<br /> &lt;HTML&gt;<br /> &lt;HEAD&gt;<br /> &lt;TITLE&gt;JNDI测试&lt;/TITLE&gt;<br /> &lt;/HEAD&gt;<br /> &lt;BODY&gt;<br /> &lt;%<br /> try {<br /> Context ctx = new InitialContext();<br /> DataSource ds = (DataSource) ctx.lookup(&quot;java:comp/env/jdbc/test&quot;);<br /> Connection conn = ds.getConnection();<br /> out.println(conn.toString());<br /> Statement stmt =conn.createStatement();<br /> String sql=&quot;select * from student&quot;;<br /> ResultSet rs=stmt.executeQuery(sql);<br /> int numcols = rs.getMetaData().getColumnCount();<br /> while(rs.next()) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(int i=1;i&lt;=numcols;i++) {<br /> &nbsp;&nbsp; out.print(&quot;\t&quot; + rs.getString(i));<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; out.println(&quot;&quot;);<br /> }<br /> } catch (NamingException e) {<br /> e.printStackTrace();<br /> } catch (SQLException e) {<br /> e.printStackTrace();<br /> }<br /> %&gt;<br /> &lt;/BODY&gt;<br /> &lt;/HTML&gt;<br /> 打印输出：<br /> jdbc:mysql://localhost:3306/hs, UserName=root@localhost, MySQL-AB JDBC Driver 20052105516 小芸 1 1900-01-01 4.00565 2.71739 15.6 12.4 null 20052105513 小马 1 1900-01-01 12.1 12 13 56 null 20052105515 小黄猫 1 1900-01-01 4.75217 3.8913 12.5 56.5 null</p></div></body></html>