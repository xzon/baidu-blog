<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>RequestDumperFilter.java Tomcat</title></head><body><h1>RequestDumperFilter.java Tomcat</h1><div><p> </p>
<p>RequestDumperFilter.java Tomcat</p>
<p>/*<br>
* Licensed to the Apache Software Foundation (ASF) under one or more<br>
* contributor license agreements. See the NOTICE file distributed with<br>
* this work for additional information regarding copyright ownership.<br>
* The ASF licenses this file to You under the Apache License, Version 2.0<br>
* (the &quot;License&quot;); you may not use this file except in compliance with<br>
* the License. You may obtain a copy of the License at<br>
*<br>
*&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a><br>
*<br>
* Unless required by applicable law or agreed to in writing, software<br>
* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,<br>
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br>
* See the License for the specific language governing permissions and<br>
* limitations under the License.<br>
*/</p>
<p><br>
package filters;</p>
<p><br>
import java.io.IOException;<br>
import java.io.PrintWriter;<br>
import java.io.StringWriter;<br>
import java.sql.Timestamp;<br>
import java.util.Enumeration;<br>
import java.util.Locale;<br>
import javax.servlet.Filter;<br>
import javax.servlet.FilterChain;<br>
import javax.servlet.FilterConfig;<br>
import javax.servlet.ServletException;<br>
import javax.servlet.ServletRequest;<br>
import javax.servlet.ServletResponse;<br>
import javax.servlet.http.Cookie;<br>
import javax.servlet.http.HttpServletRequest;</p>
<p><br>
/**<br>
* Example filter that dumps interesting state information about a request<br>
* to the associated servlet context log file, before allowing the servlet<br>
* to process the request in the usual way. This can be installed as needed<br>
* to assist in debugging problems.<br>
*<br>
* @author Craig McClanahan<br>
* @version $Revision: 500674 $ $Date: 2007-01-28 00:15:00 +0100 (dim., 28 janv. 2007) $<br>
*/</p>
<p>public final class RequestDumperFilter implements Filter {</p>
<p><br>
&nbsp;&nbsp;&nbsp;  // ----------------------------------------------------- Instance Variables</p>
<p><br>
&nbsp;&nbsp;&nbsp;  /**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * The filter configuration object we are associated with. If this value<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * is null, this filter instance is not currently configured.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  private FilterConfig filterConfig = null;</p>
<p><br>
&nbsp;&nbsp;&nbsp;  // --------------------------------------------------------- Public Methods</p>
<p><br>
&nbsp;&nbsp;&nbsp;  /**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Take this filter out of service.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public void destroy() {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  this.filterConfig = null;</p>
<p>&nbsp;&nbsp;&nbsp;  }</p>
<p><br>
&nbsp;&nbsp;&nbsp;  /**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Time the processing that is performed by all subsequent filters in the<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * current filter stack, including the ultimately invoked servlet.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @param request The servlet request we are processing<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @param result The servlet response we are creating<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @param chain The filter chain we are processing<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @exception IOException if an input/output error occurs<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @exception ServletException if a servlet error occurs<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public void doFilter(ServletRequest request, ServletResponse response,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  FilterChain chain)<br>
throws IOException, ServletException {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (filterConfig == null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;  return;</p>
<p>// Render the generic servlet request properties<br>
StringWriter sw = new StringWriter();<br>
PrintWriter writer = new PrintWriter(sw);<br>
writer.println(&quot;Request Received at &quot; +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  (new Timestamp(System.currentTimeMillis())));<br>
writer.println(&quot; characterEncoding=&quot; + request.getCharacterEncoding());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;  contentLength=&quot; + request.getContentLength());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  contentType=&quot; + request.getContentType());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  locale=&quot; + request.getLocale());<br>
writer.print(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  locales=&quot;);<br>
Enumeration locales = request.getLocales();<br>
boolean first = true;<br>
while (locales.hasMoreElements()) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  Locale locale = (Locale) locales.nextElement();<br>
&nbsp;&nbsp;&nbsp;&nbsp;  if (first)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  first = false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  writer.print(&quot;, &quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.print(locale.toString());<br>
}<br>
writer.println();<br>
Enumeration names = request.getParameterNames();<br>
while (names.hasMoreElements()) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  String name = (String) names.nextElement();<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.print(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  parameter=&quot; + name + &quot;=&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  String values[] = request.getParameterValues(name);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  for (int i = 0; i &lt; values.length; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (i &gt; 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  writer.print(&quot;, &quot;);<br>
&nbsp;&nbsp;  writer.print(values[i]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println();<br>
}<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  protocol=&quot; + request.getProtocol());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remoteAddr=&quot; + request.getRemoteAddr());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remoteHost=&quot; + request.getRemoteHost());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  scheme=&quot; + request.getScheme());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  serverName=&quot; + request.getServerName());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  serverPort=&quot; + request.getServerPort());<br>
writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  isSecure=&quot; + request.isSecure());</p>
<p>// Render the HTTP servlet request properties<br>
if (request instanceof HttpServletRequest) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;---------------------------------------------&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  HttpServletRequest hrequest = (HttpServletRequest) request;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  contextPath=&quot; + hrequest.getContextPath());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  Cookie cookies[] = hrequest.getCookies();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (cookies == null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  cookies = new Cookie[0];<br>
&nbsp;&nbsp;&nbsp;&nbsp;  for (int i = 0; i &lt; cookies.length; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  cookie=&quot; + cookies[i].getName() +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;=&quot; + cookies[i].getValue());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;  names = hrequest.getHeaderNames();<br>
&nbsp;&nbsp;&nbsp;&nbsp;  while (names.hasMoreElements()) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  String name = (String) names.nextElement();<br>
&nbsp;&nbsp;  String value = hrequest.getHeader(name);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  header=&quot; + name + &quot;=&quot; + value);<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  method=&quot; + hrequest.getMethod());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pathInfo=&quot; + hrequest.getPathInfo());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  queryString=&quot; + hrequest.getQueryString());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  remoteUser=&quot; + hrequest.getRemoteUser());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;requestedSessionId=&quot; +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hrequest.getRequestedSessionId());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  requestURI=&quot; + hrequest.getRequestURI());<br>
&nbsp;&nbsp;&nbsp;&nbsp;  writer.println(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  servletPath=&quot; + hrequest.getServletPath());<br>
}<br>
writer.println(&quot;=============================================&quot;);</p>
<p>// Log the resulting string<br>
writer.flush();<br>
filterConfig.getServletContext().log(sw.getBuffer().toString());</p>
<p>// Pass control on to the next filter<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  chain.doFilter(request, response);</p>
<p>&nbsp;&nbsp;&nbsp;  }</p>
<p><br>
&nbsp;&nbsp;&nbsp;  /**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Place this filter into service.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @param filterConfig The filter configuration object<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public void init(FilterConfig filterConfig) throws ServletException {</p>
<p>this.filterConfig = filterConfig;</p>
<p>&nbsp;&nbsp;&nbsp;  }</p>
<p><br>
&nbsp;&nbsp;&nbsp;  /**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Return a String representation of this object.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public String toString() {</p>
<p>if (filterConfig == null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;  return (&quot;RequestDumperFilter()&quot;);<br>
StringBuffer sb = new StringBuffer(&quot;RequestDumperFilter(&quot;);<br>
sb.append(filterConfig);<br>
sb.append(&quot;)&quot;);<br>
return (sb.toString());</p>
<p>&nbsp;&nbsp;&nbsp;  }</p>
<p><br>
}</p>
<p> </p></div></body></html>