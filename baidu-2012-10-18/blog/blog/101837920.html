<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>SessionFactoryHelper.java -MyEclipse -v512</title></head><body><h1>SessionFactoryHelper.java -MyEclipse -v512</h1><div><p> </p>
<p>SessionFactoryHelper.java -MyEclipse -v512</p>
<p>package com.v512.demo.hibernate;</p>
<p>import org.hibernate.HibernateException;<br>
import org.hibernate.Session;<br>
import org.hibernate.cfg.Configuration;</p>
<p>/**<br>
* Configures and provides access to Hibernate sessions, tied to the<br>
* current thread of execution. Follows the Thread Local Session<br>
* pattern, see <a href="mailto:{@link">{@link</a> <a href="http://hibernate.org/42.html">http://hibernate.org/42.html</a> }.<br>
*/<br>
public class SessionFactoryHelper { //hxzon 默认名是HibernateSessionFactory</p>
<p>&nbsp;&nbsp;&nbsp;  /** <br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Location of hibernate.cfg.xml file.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Location should be on the classpath as Hibernate uses <br>
&nbsp;&nbsp;&nbsp;&nbsp;  * #resourceAsStream style lookup for its configuration file. <br>
&nbsp;&nbsp;&nbsp;&nbsp;  * The default classpath location of the hibernate config file is <br>
&nbsp;&nbsp;&nbsp;&nbsp;  * in the default package. Use #setConfigFile() to update <br>
&nbsp;&nbsp;&nbsp;&nbsp;  * the location of the configuration file for the current session.&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  private static String CONFIG_FILE_LOCATION = &quot;/hibernate.cfg.xml&quot;;<br>
private static final ThreadLocal&lt;Session&gt; threadLocal = new ThreadLocal&lt;Session&gt;();<br>
&nbsp;&nbsp;&nbsp;  private static Configuration configuration = new Configuration();<br>
&nbsp;&nbsp;&nbsp;  private static org.hibernate.SessionFactory sessionFactory;<br>
&nbsp;&nbsp;&nbsp;  private static String configFile = CONFIG_FILE_LOCATION;</p>
<p>static {<br>
&nbsp;&nbsp;&nbsp;  try {<br>
&nbsp;&nbsp;&nbsp;  configuration.configure(configFile);<br>
&nbsp;&nbsp;&nbsp;  sessionFactory = configuration.buildSessionFactory();<br>
&nbsp;&nbsp;  } catch (Exception e) {<br>
&nbsp;&nbsp;&nbsp;  System.err<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .println(&quot;%%%% Error Creating SessionFactory %%%%&quot;);<br>
&nbsp;&nbsp;&nbsp;  e.printStackTrace();<br>
&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  private SessionFactoryHelper() {<br>
&nbsp;&nbsp;&nbsp;  }<br>
<br>
/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Returns the ThreadLocal Session instance. Lazy initialize<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * the &lt;code&gt;SessionFactory&lt;/code&gt; if needed.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @return Session<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @throws HibernateException<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public static Session getSession() throws HibernateException {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Session session = (Session) threadLocal.get();</p>
<p>&nbsp;&nbsp;  if (session == null || !session.isOpen()) {<br>
&nbsp;&nbsp;&nbsp;  if (sessionFactory == null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  rebuildSessionFactory();<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  session = (sessionFactory != null) ? sessionFactory.openSession()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  : null;<br>
&nbsp;&nbsp;&nbsp;  threadLocal.set(session);<br>
&nbsp;&nbsp;  }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return session;<br>
&nbsp;&nbsp;&nbsp;  }</p>
<p>/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Rebuild hibernate session factory<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
public static void rebuildSessionFactory() {<br>
&nbsp;&nbsp;  try {<br>
&nbsp;&nbsp;&nbsp;  configuration.configure(configFile);<br>
&nbsp;&nbsp;&nbsp;  sessionFactory = configuration.buildSessionFactory();<br>
&nbsp;&nbsp;  } catch (Exception e) {<br>
&nbsp;&nbsp;&nbsp;  System.err<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .println(&quot;%%%% Error Creating SessionFactory %%%%&quot;);<br>
&nbsp;&nbsp;&nbsp;  e.printStackTrace();<br>
&nbsp;&nbsp;  }<br>
}</p>
<p>/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * Close the single hibernate session instance.<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * @throws HibernateException<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
&nbsp;&nbsp;&nbsp;  public static void closeSession() throws HibernateException {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Session session = (Session) threadLocal.get();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  threadLocal.set(null);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (session != null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  session.close();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  }</p>
<p>/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * return session factory<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
public static org.hibernate.SessionFactory getSessionFactory() {<br>
&nbsp;&nbsp;  return sessionFactory;<br>
}</p>
<p>/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * return session factory<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * session factory will be rebuilded in the next call<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
public static void setConfigFile(String configFile) {<br>
&nbsp;&nbsp;  SessionFactoryHelper.configFile = configFile;<br>
&nbsp;&nbsp;  sessionFactory = null;<br>
}</p>
<p>/**<br>
&nbsp;&nbsp;&nbsp;&nbsp;  * return hibernate configuration<br>
&nbsp;&nbsp;&nbsp;&nbsp;  *<br>
&nbsp;&nbsp;&nbsp;&nbsp;  */<br>
public static Configuration getConfiguration() {<br>
&nbsp;&nbsp;  return configuration;<br>
}</p>
<p>}</p></div></body></html>