<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>JSP全局变量定义</title></head><body><h1>JSP全局变量定义</h1><div><p>JSP全局变量定义</p>
<p>这几天等待总部的通知,现在有点时间就看看jsp,当初也写过一些简单不能在简单的jsp程序,昨天用反编译方法写了一篇跟string相关的文章,现在再一次用反编译工具blog一遍jsp变量定义的文章,为了理解jsp变量定义和调用方式,可以想像任何东西知道原理是多么幸福的事呢? 其实这样的反编译工具在.net平台下的FrameworkSDK\Bin 目录中可以找到，相应.net remoting下的服务器功能类的代理类生成工具也可以在这里找到。<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  感悟世界之大，好些东西或工具其实已存在，只是由于诸多原因没有让每一个人知道罢了，现在真有些相识恨晚的领悟！</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  &lt;%! 定义 %&gt;与 &lt;% 定义 %&gt;区别如下，一切尽在代码中。</p>
<p>Jsp:</p>
<p>&lt;%@ page contentType=&quot;text/html; charset=GBK&quot; %&gt;<br>
&lt;!--定义方式1 --&gt;<br>
&lt;%&nbsp;&nbsp;  int j=1;%&gt;<br>
&lt;!--定义方式2 --&gt;<br>
&lt;%! int j=0;%&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;title&gt;<br>
jsp1<br>
&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body bgcolor=&quot;#ffffff&quot;&gt;<br>
&lt;h1&gt;</p>
<p>&lt;!--<br>
调用定义方式1的变量<br>
--&gt;<br>
&lt;%=j%&gt;<br>
&lt;br&gt;<br>
&lt;!--<br>
调用定义方式2的变量<br>
--&gt;<br>
&lt;%=this.j%&gt;<br>
&lt;/h1&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;</p>
<p> </p>
<p>反编译的Java jsp1_0002ejsp_jsp.class:</p>
<p>import java.io.IOException;<br>
import javax.servlet.*;<br>
import javax.servlet.http.*;<br>
import javax.servlet.jsp.*;<br>
import org.apache.jasper.runtime.HttpJspBase;<br>
import org.apache.jasper.runtime.JspException;</p>
<p>public class jsp1_0002ejsp_jsp extends HttpJspBase<br>
{</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  public jsp1_0002ejsp_jsp()<br>
&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  j = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  public final void _jspx_init()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  throws JspException<br>
&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  public void _jspService(HttpServletRequest request, HttpServletResponse response)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  throws ServletException, IOException<br>
&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  JspFactory _jspxFactory = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  PageContext pageContext = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  HttpSession session = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ServletContext application = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ServletConfig config = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  JspWriter out = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Object page = this;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  String _value = null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  try<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(!_jspx_inited)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  synchronized(this)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(!_jspx_inited)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  _jspx_init();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  _jspx_inited = true;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  _jspxFactory = JspFactory.getDefaultFactory();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  response.setContentType(&quot;text/html; charset=GBK&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pageContext = _jspxFactory.getPageContext(this, request, response, &quot;&quot;, true, 8192, true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  application = pageContext.getServletContext();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  config = pageContext.getServletConfig();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  session = pageContext.getSession();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out = pageContext.getOut();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.write(&quot;\r\n&lt;!--\u5B9A\u4E49\u65B9\u5F0F1 --&gt;\r\n&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //定义方式1，这里定义的只能作用在_jspService成员函数的定义之后，如果想引用定<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //义方式2的变量只能用this应用<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  int j = 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.write(&quot;\r\n&lt;!--\u5B9A\u4E49\u65B9\u5F0F2 --&gt;\r\n&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.write(&quot;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&lt;title&gt;\r\njsp1\r\n&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body bgcolor=\&quot;#ffffff\&quot;&gt;\r\n&lt;h1&gt;\r\n\r\n&lt;!--\r\n\u8C03\u7528\u5B9A\u4E49\u65B9\u5F0F1\u7684\u53D8\u91CF\r\n--&gt;\r\n&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.print(j);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.write(&quot;\r\n&lt;br&gt;\r\n&lt;!--\r\n\u8C03\u7528\u5B9A\u4E49\u65B9\u5F0F2\u7684\u53D8\u91CF\r\n--&gt;\r\n&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.print(this.j);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.write(&quot;\r\n&lt;/h1&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  catch(Throwable t)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(out != null &amp;&amp; out.getBufferSize() != 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  out.clearBuffer();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(pageContext != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pageContext.handlePageException(t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  finally<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(_jspxFactory != null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  _jspxFactory.releasePageContext(pageContext);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  //定义方式2 ，&lt;%! xxxx &gt;就是声明一个类的成员变量，如果我们在这个jsp文件定义一个<br>
&nbsp;&nbsp;&nbsp;&nbsp;  //成员函数，那么只能调用此种方式的变量了<br>
&nbsp;&nbsp;&nbsp;&nbsp;  int j;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  private static boolean _jspx_inited = false;</p>
<p>}</p>
<p>哈哈!</p>
<p> </p>
<p>＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝</p>
<p>使用jsp页面中&lt;%! %&gt;全局变量声明遇到的问题<br>
<br>
一般喜欢把页面里多处要用到的变量设置成全局变量，如：<br>
<br>
当把该变量赋值后，再次访问该页面时，该变量的值依然保存。这使得想通过用全局变量接受提交的参数时会受到一些迷惑：<br>
<br>
if(request.getParameter(&quot;operation&quot;)!=null)<br>
&nbsp;&nbsp;  ID = request.getParameter(&quot;operation&quot;).trim();<br>
<br>
<br>
当ID在前一次赋过初值后，因为另一种原因而再次访问该页面但&lsquo;operation'参数为空时，本来希望ID也为空，但实际上ID的值为上次访问该页面时赋的值。当希望通过ID的值做不同的操作时可能引起操作类型的混乱。<br>
<br>
原因：使用&lt;%! %&gt;定义的变量编译成servlet后成为servlet的私有成员变量，在servlet环境中，对于一个JSP页只允许有一个结果servlet的实例在运行和响应所有的页面请求。因此，在结果servlet中所有的成员变量可以被所有的请求所共享，所以只要成员变量没有重新赋值，下次访问该页面时仍然不变。而在&lt;% %&gt;中定义的变量编译成servlet后成为service()方法的一个本地变量，而service()方法中的本地变量只能每响应一次请求就重建一<br>
次。<br>
<br>
解决的办法是将ID用&lt;% %&gt;定义，或在判断ID的操作后重新对ID初始化。</p></div></body></html>