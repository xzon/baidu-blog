<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>hibernate学习笔记(五) 类继承关系映射 集合映射</title></head><body><h1>hibernate学习笔记(五) 类继承关系映射 集合映射</h1><div><p>hibernate学习笔记(五) 类继承关系映射 集合映射</p>
<ol>
    <li class="alt"><span twffan="done"><span twffan="done">一、类继承关系映射 &nbsp;&nbsp;</span></span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">建表策略 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">（</span><span class="number" twffan="done">1</span><span twffan="done">）所有类建一个表 （</span><span class="number" twffan="done">2</span><span twffan="done">）只为具体类建表 （</span><span class="number" twffan="done">3</span><span twffan="done">）每个类建一个表。 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">只为具体类建表，使用于不使用多态的情况下，具体类之间没有继承关系时适用 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">需要针对每个类写映射配置文件，就和普通的单表映射的xml文件相同。 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">也可以使用一个xml文件来进行映射，可以通过写union-subclass标签来表现其关系 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">这里不能使用id生成策略中的</span><span class="keyword" twffan="done"><strong><font color="#7f0055">native</font></strong></span><span twffan="done">，而是要指定特定的生成策略。 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">例： &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;union-subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;notpad&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tpcc_notpad&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/union-subclass&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;union-subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;desktop&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tpcc_desktop&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;LCD&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;isLCD&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;yes_no&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/union-subclass&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">每个类建一个表，可以有效减少数据的冗余，减少字段，查询效率不很高。 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">正对每个类建一个表，只要写一个配置文件来进行类的映射即可 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">映射文件中的子类可以使用join-subclass标签来表示，并且引用父类的主键作为共享主键，就是不需要指定id生成策略 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">例： &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;hibernate-mapping </span><span class="keyword" twffan="done"><strong><font color="#7f0055">package</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;alan.hbn.rel.inherit&quot;</font></span><span twffan="done"> auto-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">import</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;false&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;</span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done"> name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Computer&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tph_computer&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;id name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;comid&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;comid&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;long&quot;</font></span><span twffan="done"> unsaved-value=</span><span class="string" twffan="done"><font color="#0000ff">&quot;0&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;generator </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;identity&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/id&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;price&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;price&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;joined-subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;notpad&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tpc_notpad&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;comid&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/joined-subclass&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;joined-subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Guest&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tpc_guest&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;comid&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;LCD&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;isLCD&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;yes_no&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/joined-subclass&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/</span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/hibernate-mapping&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">所有类只建一个表，查寻效率比较高，但是会产生很多空间浪费，当子类中的非空约束，就不大适用了，这是对于子类可以使用subclass标签表示。 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;hibernate-mapping </span><span class="keyword" twffan="done"><strong><font color="#7f0055">package</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;alan.hbn.rel.inherit&quot;</font></span><span twffan="done"> auto-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">import</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;false&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;</span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done"> name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Computer&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;tph_computer&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;id name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;id&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;id&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;long&quot;</font></span><span twffan="done"> unsaved-value=</span><span class="string" twffan="done"><font color="#0000ff">&quot;0&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;generator </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;identity&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/id&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;discriminator column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;computer_type&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;price&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;price&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Administrator&quot;</font></span><span twffan="done"> discriminator-value=</span><span class="string" twffan="done"><font color="#0000ff">&quot;ad&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;wight&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/subclass&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;subclass name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Guest&quot;</font></span><span twffan="done"> discriminator-value=</span><span class="string" twffan="done"><font color="#0000ff">&quot;gu&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;LCD&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;isLCD&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;yes_no&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/subclass&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/</span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/hibernate-mapping&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">不考虑多态时，最好是用只针对具体类建表(</span><span class="number" twffan="done">2</span><span twffan="done">个表)，而考虑多态时尽量使用所有类建一个表，只有当子类中的属性过多是才考虑每个类建一个表的策略。 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">二、集合映射 &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="number" twffan="done">1</span><span twffan="done">、set映射 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">关联对象的属性除了外键之外，只有</span><span class="number" twffan="done">1</span><span twffan="done">、</span><span class="number" twffan="done">2</span><span twffan="done">个属性，那么就可以使用set映射 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">使用了set标签的element元素，不用创建关联对象就可以实现单向一对多的关联关系 &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">public</font></strong></span><span twffan="done"> </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done"> Room </span><span class="keyword" twffan="done"><strong><font color="#7f0055">implements</font></strong></span><span twffan="done"> Serializable{ &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> </span><span class="keyword" twffan="done"><strong><font color="#7f0055">int</font></strong></span><span twffan="done"> id; &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> String roomNumber; &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> Set&lt;String&gt; equipments = </span><span class="keyword" twffan="done"><strong><font color="#7f0055">new</font></strong></span><span twffan="done"> HashSet&lt;String&gt;(); &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> Set&lt;Image&gt; images = </span><span class="keyword" twffan="done"><strong><font color="#7f0055">new</font></strong></span><span twffan="done"> HashSet&lt;Image&gt;(); &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">} &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;set name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;equipments&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;equipment_set&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;roomid&quot;</font></span><span twffan="done"> foreign-key=</span><span class="string" twffan="done"><font color="#0000ff">&quot;fk_equip_room_set&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;element column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;description&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;128&quot;</font></span><span twffan="done"> not-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;true&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/set&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;set name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;images&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;image_set&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;roomid&quot;</font></span><span twffan="done"> foreign-key=</span><span class="string" twffan="done"><font color="#0000ff">&quot;fk_img_room_set&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;composite-element </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Image&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;path&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;path&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;50&quot;</font></span><span twffan="done"> not-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;true&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;width&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;width&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;height&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;height&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/composite-element&gt; &nbsp;&nbsp;</span></li>
    <li><span class="number" twffan="done">2</span><span twffan="done">、map映射 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">非常有用的一种集合映射 &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">public</font></strong></span><span twffan="done"> </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done"> Room </span><span class="keyword" twffan="done"><strong><font color="#7f0055">implements</font></strong></span><span twffan="done"> Serializable{ &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> </span><span class="keyword" twffan="done"><strong><font color="#7f0055">int</font></strong></span><span twffan="done"> id; &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> String roomNumber; &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> Map&lt;String, String&gt; equipments = </span><span class="keyword" twffan="done"><strong><font color="#7f0055">new</font></strong></span><span twffan="done"> HashMap&lt;String, String&gt;(); &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">private</font></strong></span><span twffan="done"> Map&lt;String, Image&gt; images = </span><span class="keyword" twffan="done"><strong><font color="#7f0055">new</font></strong></span><span twffan="done"> HashMap&lt;String, Image&gt;(); &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">} &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;map name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;equipments&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;equipment_map&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;roomid&quot;</font></span><span twffan="done"> foreign-key=</span><span class="string" twffan="done"><font color="#0000ff">&quot;fk_equip_room_map&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;map-key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;name&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;15&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;element column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;description&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;128&quot;</font></span><span twffan="done"> not-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;true&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/map&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;map name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;images&quot;</font></span><span twffan="done"> table=</span><span class="string" twffan="done"><font color="#0000ff">&quot;image_map&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;roomid&quot;</font></span><span twffan="done"> foreign-key=</span><span class="string" twffan="done"><font color="#0000ff">&quot;fk_img_room_map&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;map-key column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;name&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;15&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;composite-element </span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;Image&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;path&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;path&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;string&quot;</font></span><span twffan="done"> length=</span><span class="string" twffan="done"><font color="#0000ff">&quot;50&quot;</font></span><span twffan="done"> not-</span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">=</span><span class="string" twffan="done"><font color="#0000ff">&quot;true&quot;</font></span><span twffan="done">/&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;width&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;width&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;property name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;height&quot;</font></span><span twffan="done"> column=</span><span class="string" twffan="done"><font color="#0000ff">&quot;height&quot;</font></span><span twffan="done"> type=</span><span class="string" twffan="done"><font color="#0000ff">&quot;integer&quot;</font></span><span twffan="done"> /&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/composite-element&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;/map&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">三、HQL &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="number" twffan="done">1</span><span twffan="done">、query &nbsp;&nbsp;</span></li>
    <li><span twffan="done">(</span><span class="number" twffan="done">1</span><span twffan="done">) session.createQuery(</span><span class="string" twffan="done"><font color="#0000ff">&quot;from User&quot;</font></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">session.createCriteria(User.</span><span class="keyword" twffan="done"><strong><font color="#7f0055">class</font></strong></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">(</span><span class="number" twffan="done">2</span><span twffan="done">)查询的分页显示 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">query.setFirstResult(</span><span class="number" twffan="done">0</span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">query.setMaxResult(</span><span class="number" twffan="done">10</span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li><span twffan="done">(a) MySql &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">select * from student where limite ?,? &nbsp;&nbsp;</span></li>
    <li><span twffan="done">(b) Oracle &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">select * from (select row_.* ,rownum rownum_ &nbsp;&nbsp;</span></li>
    <li><span twffan="done">from (select student0_.id as id0_, &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">from student student0_) row) &nbsp;&nbsp;</span></li>
    <li><span twffan="done">where rownum_ &lt;= ? &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">and rownum_ &gt; ? &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">(</span><span class="number" twffan="done">3</span><span twffan="done">)在配置文件中的query &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&lt;query name=</span><span class="string" twffan="done"><font color="#0000ff">&quot;findByName&quot;</font></span><span twffan="done">&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;![CDATA[ --- 当作字符串看，不做特殊处理 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">from User u where u.namelike :name &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span twffan="done">]]&gt; &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&lt;/query&gt; &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">session.getNamedQuery(</span><span class="string" twffan="done"><font color="#0000ff">&quot;findByName&quot;</font></span><span twffan="done">).setString(</span><span class="string" twffan="done"><font color="#0000ff">&quot;name&quot;</font></span><span twffan="done">,name); &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">from User; 返回对象数组，不可以强转 &nbsp;&nbsp;</span></li>
    <li><span twffan="done">select u from User u; 返回对象集合，对于集合中的每个元素都可以强转成User对象 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">&nbsp;&nbsp;</span></li>
    <li><span class="number" twffan="done">2</span><span twffan="done">、Dynamic query &nbsp;&nbsp;</span></li>
    <li class="alt"><span class="keyword" twffan="done"><strong><font color="#7f0055">public</font></strong></span><span twffan="done"> Collection findStudents(Student student){ &nbsp;&nbsp;</span></li>
    <li><span twffan="done">StringBuffer sb = </span><span class="keyword" twffan="done"><strong><font color="#7f0055">new</font></strong></span><span twffan="done"> StringBuffer(</span><span class="string" twffan="done"><font color="#0000ff">&quot;select student from Student student where student.id&gt;-1 &quot;</font></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">--- student.id&gt;-</span><span class="number" twffan="done">1</span><span twffan="done"> 永远为真，再添加条件的时候都用and即可，避免判断用where还是and &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">if</font></strong></span><span twffan="done">(student.getName() != </span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">) &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">sb.append(</span><span class="string" twffan="done"><font color="#0000ff">&quot;and student.name=:name&quot;</font></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">if</font></strong></span><span twffan="done">(student.getBirthday() != </span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">) &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">sb.append(</span><span class="string" twffan="done"><font color="#0000ff">&quot;and student.birthday=:birthday&quot;</font></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li><span class="keyword" twffan="done"><strong><font color="#7f0055">if</font></strong></span><span twffan="done">(student.getEmail() != </span><span class="keyword" twffan="done"><strong><font color="#7f0055">null</font></strong></span><span twffan="done">) &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">sb.append(</span><span class="string" twffan="done"><font color="#0000ff">&quot;and student.email=:email&quot;</font></span><span twffan="done">); &nbsp;&nbsp;</span></li>
    <li><span twffan="done">…… &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">} &nbsp;&nbsp;</span></li>
    <li><span twffan="done">&nbsp;&nbsp;</span></li>
    <li class="alt"><span class="number" twffan="done">3</span><span twffan="done">、QBE &nbsp;&nbsp;</span></li>
    <li><span twffan="done">属性多时，效率高，语句少 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">忽略主键、version、关系（查询当前对象） &nbsp;&nbsp;</span></li>
    <li><span twffan="done">与QBC结合，弥补id查询 &nbsp;&nbsp;</span></li>
    <li class="alt"><span twffan="done">Example.excludeProperty(</span><span class="string" twffan="done"><font color="#0000ff">&quot;param&quot;</font></span><span twffan="done">); --- 查询时忽略某个属性</span></li>
</ol>
<div class="alt"> </div></div></body></html>