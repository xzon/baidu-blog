<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>jboss下通过配置log4j.xml实现web应用的日志</title></head><body><h1>jboss下通过配置log4j.xml实现web应用的日志</h1><div><p>jboss下通过配置log4j.xml实现web应用的日志</p>
<p class="MsoNormal" style="margin: 0cm 0cm 12pt; text-align: left; mso-pagination: widow-orphan" align="left"><font color="#000080"><span style="font-size: 12pt; mso-bidi-: 0pt" twffan="done">log4j</span><span style="font-size: 12pt; mso-bidi-: 0pt" twffan="done">是一个优秀的开源的<span twffan="done">java</span>日志系统，<span twffan="done">jboss</span>内部也集成了它，在<span twffan="done">jboss</span>下默认的只是对<span twffan="done">server</span>做了每日日志，并没有对你部署的项目进行每日的日志构建，但我们可以通过修改<span twffan="done">log4j.xml</span>文件来实现。<span twffan="done">log4j.xml</span>文件在<span twffan="done">jboss</span>安装目录下的<span twffan="done">server\default\conf</span>下，打开<span twffan="done">log4j.xml</span>文件</span></font></p>
<p>
<table class="MsoNormalTable" style="background: burlywood; width: 760px; height: 1069px; mso-cellspacing: 0cm; mso-padding-alt: 0cm 0cm 0cm 0cm" cellspacing="0" cellpadding="0" width="760" border="1">
    <tbody>
        <tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
            <td style="border-right: #d4d0c8; padding-right: 0cm; border-top: #d4d0c8; padding-left: 0cm; padding-bottom: 0cm; border-left: #d4d0c8; padding-top: 0cm; border-bottom: #d4d0c8; background-color: transparent">
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">这是<span twffan="done">log4j</span>默认的配置，我们先熟悉一下<span twffan="done"><br>
            </span></span><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&lt;!-- ============================== --&gt;<br>
            &lt;!-- Append messages to the console --&gt;<br>
            &lt;!-- ============================== --&gt;<br>
            &nbsp;&nbsp;&nbsp;  <span style="color: navy" twffan="done">&lt;!--</span></span><span style="font-size: 12pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">输出方式：输出到控制台<span twffan="done">--&gt;</span></span><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done"><br>
            &nbsp;&nbsp;&nbsp;  &lt;appender name=&quot;CONSOLE&quot; class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;<br>
            </span><span style="font-size: 12pt; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;  <span style="color: navy" twffan="done">&lt;!-- </span></span><span style="font-size: 12pt; color: navy; mso-bidi-: 0pt" twffan="done">设置通道名称：<span twffan="done">console</span>和输出方式：<span twffan="done">org.apache.log4j.RollingFileAppender <span style="background: burlywood" twffan="done"><br>
            </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>其中输出方式<span style="background: burlywood" twffan="done">appender</span><span style="background: burlywood" twffan="done">有<span twffan="done">5</span>种<span twffan="done">,</span>分别为<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  org.apache.log4j.ConsoleAppender (</span>控制台<span twffan="done">) <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  org.apache.log4j.FileAppender (</span>文件<span twffan="done">)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  org.apache.log4j.DailyRollingFileAppender (</span>每天产生一个日志文件<span twffan="done">)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  org.apache.log4j.WriterAppender (</span>将日志信息以流格式发送到任意指定的地方<span twffan="done">)--&gt;</span></span></span><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done"><br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;Target&quot; value=&quot;System.out&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;Threshold&quot; value=&quot;INFO&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span style="color: navy" twffan="done">&lt;!--Threshold</span></span><span style="font-size: 12pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">是个全局的过滤器，它将把低于所设置的<span twffan="done">level</span>的信息过滤不显示出来<span twffan="done">--&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!--level:</span>是日记记录的优先级，优先级由高到低分为<span twffan="done"> <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  OFF ,FATAL ,ERROR ,WARN ,INFO ,DEBUG ,ALL</span>。<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Log4j</span>建议只使用<span twffan="done">FATAL ,ERROR ,WARN ,INFO ,DEBUG</span>这四个级别。<span twffan="done">--&gt;</span></span></p>
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;  &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;<br>
            <span style="color: navy" twffan="done">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!-- </span></span><span style="font-size: 12pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">配置日志输出的格式<span twffan="done">--&gt;<br>
            </span></span><span style="font-size: 10pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 10pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">参数都以<span twffan="done">%</span>开始后面不同的参数代表不同的格式化信息（参数按字母表顺序列出）：</span><span style="font-size: 10pt; background: burlywood; color: black; mso-bidi-: 0pt" twffan="done"><br>
            </span><span style="font-size: 10pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 10pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done">输出所属类的全名，可在修改为<span twffan="done"> %d{Num} ,Num</span>类名输出的围<span twffan="done">&nbsp;&nbsp;</span>如：<span twffan="done">&quot;org.apache.elathen.ClassName&quot;,<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %C{2}</span>将输出elathen.ClassName<span twffan="done"> <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>输出日志时间其格式为<span twffan="done"> %d{yyyy-MM-dd HH:mm:ss,SSS}</span>，可指定格式 如<span twffan="done"> %d{HH:mm:ss}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>输出日志事件发生位置，包括类目名、发生线程，在代码中的行数<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>换行符<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %m&nbsp;&nbsp;&nbsp;&nbsp;  </span>输出代码指定信息，如<span twffan="done">info(&ldquo;message&rdquo;),</span>输出<span twffan="done">message<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %p&nbsp;&nbsp;&nbsp;&nbsp;  </span>输出优先级，即<span twffan="done"> FATAL ,ERROR </span>等<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>输出从启动到显示该<span twffan="done">log</span>信息所耗费的毫秒数<span twffan="done"><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  %t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>输出产生该日志事件的线程名</span><span style="font-size: 12pt; background: burlywood; color: navy; mso-bidi-: 0pt" twffan="done"><br>
            </span><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!-- The default pattern: Date Priority [Category] Message\n --&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d{ABSOLUTE} %-5p [%c{1}] %m%n&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;/layout&gt;<br>
            &lt;/appender&gt;<br>
            <br>
            <font color="#000080">&lt;!输出方式是：每天一个日志文件&gt;</font><br>
            &lt;!-- A time/date based rolling appender --&gt;<br>
            &lt;appender name=&quot;FILE&quot; class=&quot;org.jboss.logging.appender.DailyRollingFileAppender&quot;&gt;<br>
            <font color="#000080">&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!--设置通道名称是：file，输出方式DailyRollingFileAppender--&gt;</font><br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;File&quot; value=&quot;${jboss.server.home.dir}/log/server.log&quot;/&gt;<br>
            <font color="#000080">&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!--日志文件路径和文件名称 --&gt;<br>
            </font>&nbsp;&nbsp;&nbsp;  &lt;param name=&quot;Append&quot; value=&quot;false&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;<font color="#000080"> <span class="style1" twffan="done">&lt;!-- 设置是否在重新启动服务时，在原有日志的基础添加新日志 --&gt;</span><br>
            </font></span></p>
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;  &lt;!-- Rollover at midnight each day --&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;DatePattern&quot; value=&quot;'.'yyyy-MM-dd&quot;/&gt;<br>
            <br>
            </span></p>
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;  &lt;!-- Rollover at the top of each hour<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;DatePattern&quot; value=&quot;'.'yyyy-MM-dd-HH&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  --&gt;<br>
            <br>
            </span></p>
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;  &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!-- The default pattern: Date Priority [Category] Message\n --&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d %-5p [%c] %m%n&quot;/&gt;</span></p>
            <p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" align="left"><span style="font-size: 12pt; background: burlywood; mso-bidi-: 0pt" twffan="done">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!-- The full pattern: Date MS Priority [Category] (Thread:NDC) Message\n<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d %-5r %-5p [%c] (%t:%x) %m%n&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  --&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;/layout&gt;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
            &lt;/appender&gt;<br>
            </span></p>
            </td>
        </tr>
    </tbody>
</table>
</p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span twffan="done"><br>
<font color="#000080">上面是jboss下log4j的默认配置，对jboss的server进行日志记录，接下来我们添加web项目的日志，在log4j.xml<br>
文件中把下面的配置信息加上去就可以了</font><br>
<br>
<table style="background: burlywood; width: 751px; height: 100px" height="100" cellspacing="0" cellpadding="0" width="751" border="1">
    <tbody>
        <tr>
            <td>
            <p>&lt;!-- A size based file rolling appender--&gt;<br>
            &lt;appender name=&quot;com.szypt.all&quot; class=&quot;org.jboss.logging.appender.RollingFileAppender&quot;&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;File&quot; value=&quot;${jboss.server.home.dir}/log/elathen.log&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;Append&quot; value=&quot;true&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;MaxFileSize&quot; value=&quot;500KB&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;param name=&quot;MaxBackupIndex&quot; value=&quot;1&quot;/&gt;</p>
            <p>&nbsp;&nbsp;&nbsp;  &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d %-5p [%c] %m%n&quot;/&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;/layout&gt;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
            &lt;/appender&gt;<br>
            <br>
            &lt;logger name=&quot;com.szypt&quot;&gt; <br>
            &nbsp;&nbsp;&nbsp;  &lt;level value=&quot;DEBUG&quot; /&gt;<br>
            &nbsp;&nbsp;&nbsp;  &lt;appender-ref ref=&quot;com.szypt.all&quot;/&gt;<br>
            &lt;/logger&gt;</p>
            </td>
        </tr>
    </tbody>
</table>
</span></p></div></body></html>