<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>第9章  WPF开发实例（续）9.3  WPF控件</title></head><body><h1>第9章  WPF开发实例（续）9.3  WPF控件</h1><div><div>
<p> </p>
<div><strong>9.3 WPF控件</strong></div>
<div>作为窗体应用程序，控件是必不可少的重要组成部分，在.NET Framework中同样为开发人员提供了丰富的界面控件，通过这些界面控件可以创建友好、灵活的用户界面。本节将简单介绍在WPF应用程序中如何使用控件。</div>
<div><strong>9.3.1 创建控件</strong></div>
<div>在Windows Presentation Foundation中，控件是指应用程序中的可见元素，.NET 3.5自带的WPF控件库为开发人员提供应用程序开发过程中需要用到的几乎所有界面控件，包括按钮（Button）、标签（Label）、文本框（TextBox）等。</div>
<div>通常有两种方式可将一个控件添加到一个WPF窗体中。一种方式是在窗体设计器中，从工具箱上将控件拖到窗体或容器控件上，这样就会自动生成对应的XAML代码；另外一种方式则是通过编码创建控件，并添加到对应的窗体或容器控件内。</div>
<div>如示例代码9-8所示，窗体wndMain中包括一个Grid控件grid1，grid1包括两行（RowDefinition节点），在 grid1的第0行包含一个Canvas控件canvas1，在canvas1里面增加了15个Button控件，分别是0~9 10个数字和5个运算符。最后，在grid1的第1行，还包括一个TextBox控件textBox1。</div>
<div>示例代码9-8：</div>
<div>
<table bordercolordark="#ffffff" bordercolorlight="#000000" align="center" border="1" cellpadding="2" cellspacing="0" width="400">
    <tbody>
        <tr>
            <td bgcolor="#e6e6e6">
            <pre>&lt;Window x:Class="UseControl.Window1"<br>xmlns="<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</a>"<br>xmlns:x="<a href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</a>"<br>Title="WPF实例--计算器" Height="294" Width="311" Name="wndMain"&gt;<br>&lt;Grid Height="251" Width="282"&gt;<br>&lt;Grid.RowDefinitions&gt;<br>&lt;RowDefinition Height="132" /&gt;<br>&lt;RowDefinition Height="124*" /&gt;<br>&lt;/Grid.RowDefinitions&gt;<br>&lt;Canvas Grid.Row="0" Margin="10,8,11,10" Name="canvas1"&gt;<br>&lt;Button Canvas.Left="10" Canvas.Top="10" Height="23" <br>Name="btnNum1" Width="39"&gt;1&lt;/Button&gt;<br>&lt;Button Canvas.Left="61" Canvas.Top="10" Height="23" <br>Name="btnNum2" Width="39"&gt;2&lt;/Button&gt;<br>&lt;Button Canvas.Left="114" Canvas.Top="10" Height="23" <br>Name="btnNum3" Width="39"&gt;3&lt;/Button&gt;<br>&lt;Button Canvas.Left="168" Canvas.Top="10" Height="23" <br>Name="btnNum4" Width="39"&gt;4&lt;/Button&gt;<br>&lt;Button Canvas.Left="219" Canvas.Top="10" Height="23" <br>Name="btnNum5" Width="39"&gt;5&lt;/Button&gt;<br>&lt;Button Canvas.Left="10" Canvas.Top="42" Height="23" <br>Name="btnNum6" Width="39"&gt;6&lt;/Button&gt;<br>&lt;Button Canvas.Left="61" Canvas.Top="42" Height="23" <br>Name="btnNum7" Width="39"&gt;7&lt;/Button&gt;<br>&lt;Button Canvas.Left="114" Canvas.Top="42" Height="23" <br>Name="btnNum8" Width="39"&gt;8&lt;/Button&gt;<br>&lt;Button Canvas.Left="168" Canvas.Top="42" Height="23" <br>Name="btnNum9" Width="39"&gt;9&lt;/Button&gt;<br>&lt;Button Canvas.Left="219" Canvas.Top="42" Height="23" <br>Name="btnNum0" Width="39"&gt;0&lt;/Button&gt;<br>&lt;Button Canvas.Left="10" Canvas.Top="77" Height="23" Name="btnAdd" <br>Width="39"&gt;+加&lt;/Button&gt;<br>&lt;Button Canvas.Left="61" Canvas.Top="77" Height="23" Name="btnSub" <br>Width="39"&gt;-减&lt;/Button&gt;<br>&lt;Button Canvas.Left="114" Canvas.Top="77" Height="23" Name="btnMulti" <br>Width="39"&gt;*乘&lt;/Button&gt;<br>&lt;Button Canvas.Left="168" Canvas.Top="77" Height="23" Name="btnDiv" <br>Width="39"&gt;/除&lt;/Button&gt;<br>&lt;Button Canvas.Left="219" Canvas.Top="77" Height="23" Name="btnClr" <br>Width="39"&gt;CLR&lt;/Button&gt;<br>&lt;/Canvas&gt;<br>&lt;TextBox Grid.Row="1" Margin="10,0,14,9" Name="tbHint"/&gt;<br>&lt;/Grid&gt;<br>&lt;/Window&gt;</pre>
            </td>
        </tr>
    </tbody>
</table>
示例代码9-8所示的XAML代码所创建的窗体界面如图9-7所示，实际上是一个计算器的效果图，多个按钮按照指定的位置进行排列。界面比较简单，没有任何颜色边框之类的美观可言。<br>
<table bordercolordark="#ffffff" bordercolorlight="#999999" align="center" bgcolor="#ddddd0" border="1" cellspacing="0">
    <tbody>
        <tr>
            <td bgcolor="#ffffff"><a target="_blank" href="http://new.51cto.com/files/uploadimg/20080929/174434818.jpg"><img src="http://hiphotos.baidu.com/hxzon/pic/item/50fa49c2f54e1a63e4dd3b49.jpg" border="0" height="292" width="309"></a></td>
        </tr>
        <tr>
            <td align="center" bgcolor="#dddddd">图9-7 计算器效果（1）</td>
        </tr>
    </tbody>
</table>
</div>
<div><strong>9.3.2 设置控件外观</strong></div>
<div>如图9-7所示的界面比较朴实，有时可能需要更加美观的界面，这就需要对控件的外观属性进行修改，使界面更加美观。设置控件的外观属性与设置窗体的外观一样，既可以通过属性管理器修改，也可以直接修改XAML代码。</div>
<div>一个控件在XAML代码中对应一个元素，从示例代码9-8可以看出，元素的外观属性都是通过节点属性的形式设置的，不同的控件具有不同的外观属性。总的来说，每个空间都有背景画刷、前景画刷、内外边框距、字体等信息可以设置。</div>
<div>如示例代码9-9所示，它在示例代码9-8的基础上修改了窗体和控件的背景色、前景色等属性，使界面更加美观。</div>
<div>示例代码9-9：</div>
<div>
<table bordercolordark="#ffffff" bordercolorlight="#000000" align="center" border="1" cellpadding="2" cellspacing="0" width="400">
    <tbody>
        <tr>
            <td bgcolor="#e6e6e6">
            <pre>&lt;Window x:Class="UseControl.Window1"<br>xmlns="<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation">http://schemas.microsoft.com/winfx/2006/xaml/presentation</a>"<br>xmlns:x="<a href="http://schemas.microsoft.com/winfx/2006/xaml">http://schemas.microsoft.com/winfx/2006/xaml</a>"<br>Title="WPF实例--计算器" Height="294" Width="311" Name="wndMain" Background = "DarkOrange"&gt;<br>&lt;Grid Height="251" Width="282" Background="DarkKhaki"&gt;<br>&lt;Grid.RowDefinitions&gt;<br>&lt;RowDefinition Height="132" /&gt;<br>&lt;RowDefinition Height="124*" /&gt;<br>&lt;/Grid.RowDefinitions&gt;<br>&lt;Canvas Grid.Row="0" Margin="10,8,11,10" Name="canvas1" Background="DarkCyan"&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="10" Canvas.Top="10" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum1" Padding="1" Width="39"&gt;1&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="61" Canvas.Top="10" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum2" Padding="1" Width="39"&gt;2&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="114" Canvas.Top="10" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum3" Padding="1" Width="39"&gt;3&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="168" Canvas.Top="10" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum4" Padding="1" Width="39"&gt;4&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="219" Canvas.Top="10" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum5" Padding="1" Width="39"&gt;5&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="10" Canvas.Top="42" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum6" Padding="1" Width="39"&gt;6&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="61" Canvas.Top="42" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum7" Padding="1" Width="39"&gt;7&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="114" Canvas.Top="42" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum8" Padding="1" Width="39"&gt;8&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="168" Canvas.Top="42" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum9" Padding="1" Width="39"&gt;9&lt;/Button&gt;<br>&lt;Button Background="Coral" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="219" Canvas.Top="42" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="White" Height="23" Name="btnNum0" Padding="1" Width="39"&gt;0&lt;/Button&gt;<br>&lt;Button Background="Khaki" BorderBrush="Teal" BorderThickness="2"<br>Canvas.Left ="10" Canvas.Top="77" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="Red" Height="23" Name="btnAdd" Padding="1" Width="39"&gt;+加&lt;/Button&gt;<br>&lt;Button Background="Khaki" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="61" Canvas.Top="77" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="Red" Height="23" Name="btnSub" Padding="1" Width="39"&gt;-减&lt;/Button&gt;<br>&lt;Button Background="Khaki" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="114" Canvas.Top="77" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="Red" Height="23" Name="btnMulti" Padding="1" Width="39"&gt;*乘&lt;/Button&gt;<br>&lt;Button Background="Khaki" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="168" Canvas.Top="77" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="Red" Height="23" Name="btnDiv" Padding="1" Width="39"&gt;/除&lt;/Button&gt;<br>&lt;Button Background="Khaki" BorderBrush="Teal" BorderThickness="2" <br>Canvas.Left ="219" Canvas.Top="77" FontFamily="curor new" FontSize="15" FontWeight="Bold" <br>Foreground ="Red" Height="23" Name="btnClr" Padding="1" Width="39"&gt;CLR&lt;/Button&gt;<br>&lt;/Canvas&gt;<br>&lt;TextBox Grid.Row="1" Margin="10,0,14,9" Name="tbHint" <br>HorizontalScrollBarVisibility="Visible" VerticalScrollBarVisibility="Visible" /&gt;<br>&lt;/Grid&gt;<br>&lt;/Window&gt;</pre>
            </td>
        </tr>
    </tbody>
</table>
</div>
<div>示例代码9-9所描述的计算器的效果如图9-8所示，和图9-7相比其外观更加美观，只需增加一些简单的背景色、字体之类的属性参数即可实现。</div>
<div>
<table bordercolordark="#ffffff" bordercolorlight="#999999" align="center" bgcolor="#ddddd0" border="1" cellspacing="0">
    <tbody>
        <tr>
            <td bgcolor="#ffffff"><a target="_blank" href="http://new.51cto.com/files/uploadimg/20080929/174723158.jpg"><img src="http://hiphotos.baidu.com/hxzon/pic/item/88bc6b229c61bff24723e849.jpg" border="0" height="293" width="310"></a></td>
        </tr>
        <tr>
            <td align="center" bgcolor="#dddddd">图9-8 计算器效果（2）</td>
        </tr>
    </tbody>
</table>
</div>
<div><strong>9.3.3 使用控件事件</strong></div>
<div>和Windows Form控件一样，WPF的控件同样通过事件的方式与用户进行交互，除了鼠标操作、键盘操作等通用事件外，不同类型的控件还具有自身特有的事件类型。和处理WPF窗体事件一样，要添加WPF中的事件处理函数也有两种办法，一是在XAML中通过属性添加，二是通过代码注册事件添加。</div>
<div>在上面的实例中，需要为15个按钮添加对应的事件处理函数，可以通过示例代码9-10中的两种方式来完成。第一种方式是通过XAML代码为按钮btnNum1添加Click事件处理函数btnNum_Click()，第二种方式是通过C#代码的形式添加事件处理函数。</div>
<div>示例代码9-10：</div>
<div>
<table bordercolordark="#ffffff" bordercolorlight="#000000" align="center" border="1" cellpadding="2" cellspacing="0" width="400">
    <tbody>
        <tr>
            <td bgcolor="#e6e6e6">
            <pre>&lt;Button Background="Coral" BorderBrush="Teal" <br>BorderThickness="2" Canvas.Left="10" <br>Canvas.Top="10" FontFamily="curor new" <br>FontSize="15" FontWeight="Bold" <br>Foreground="White" Click="btnNum_Click"&nbsp;&nbsp;&nbsp;&nbsp;   <br>Height="23" Name="btnNum1" Padding="1" <br>Width="39"&gt;1&lt;/Button&gt;</pre>
            <pre>private void AddHandles( )<br>{<br>this.btnNum1.Click += new RoutedEventHandler(btnNum_Click);<br>}<application></application></pre>
            </td>
        </tr>
    </tbody>
</table>
</div>
<div>示例代码9-11是计算器实例的完整后台代码，这里假设是通过C#代码实现按钮控件的事件绑定，这样XAML代码中就不需要为这些按钮添加事件绑定了。这里将计算器计算的结果通过ShowHint()方法显示到文本框tbHint中，而且tbHint最多显示500行信息。</div>
<div>示例代码9-11：</div>
<div>
<table bordercolordark="#ffffff" bordercolorlight="#000000" align="center" border="1" cellpadding="2" cellspacing="0" width="400">
    <tbody>
        <tr>
            <td bgcolor="#e6e6e6">
            <pre>namespace UseControl<br>{<br>/// &lt;summary&gt;<br>/// Window1.xaml 的交互逻辑<br>/// &lt;/summary&gt;<br>public partial class Window1 : Window<br>{<br>enum Operations<br>{<br>None,&nbsp;&nbsp;  //无操作<br>Add,&nbsp;&nbsp;  //加<br>Sub,&nbsp;&nbsp;  //减<br>Multi,&nbsp;&nbsp;  //乘<br>Dev,&nbsp;&nbsp;  //除<br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   public Window1( )<br>{<br>InitializeComponent( );<br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   //最新结果<br>private int _Result;<br>//当前操作<br>private Operations _Op;</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   private void AddHandles( )<br>{<br>this.btnNum0.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum1.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum2.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum3.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum4.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum5.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum6.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum7.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum8.Click += new RoutedEventHandler(btnNum_Click);<br>this.btnNum9.Click += new RoutedEventHandler(btnNum_Click);</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   this.btnAdd.Click += new RoutedEventHandler(btnAdd_Click);<br>this.btnDiv.Click += new RoutedEventHandler(btnDiv_Click);<br>this.btnMulti.Click += new RoutedEventHandler(btnMulti_Click);<br>this.btnClr.Click += new RoutedEventHandler(btnClr_Click);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   //界面加载<br>private void wndMain_Loaded(object sender, RoutedEventArgs e)<br>{<br>this. AddHandles();<br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   private void ShowHint( string str)<br>{<br>if (this.tbHint.LineCount &gt; 500)<br>{<br>this.tbHint.Clear( );<br>}<br>this.tbHint.Text = str + System.Environment.NewLine + this.tbHint.Text;<br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   //数字按键0~9产生的事件处理函数<br>private void btnNum_Click(object sender, RoutedEventArgs e)<br>{<br>string btnName = ((Button) sender).Name;<br>btnName = btnName.Substring(btnName.Length - 1);<br>int val = int.Parse(btnName);<br>string hint = "";<br>switch (this._Op)<br>{<br>case Operations.None:&nbsp;&nbsp;&nbsp;&nbsp;  //无操作，只是选择数据<br>this._Result = val;<br>hint = "结果是:" + this._Result.ToString( );<br>return; <br>case Operations.Add:&nbsp;&nbsp;&nbsp;&nbsp;  //加法运算<br>hint = this._Result.ToString( ) + " + " + val.ToString( ) + " = ";<br>this._Result += val;<br>hint += this._Result.ToString( );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>break;<br>case Operations.Sub:&nbsp;&nbsp;&nbsp;&nbsp;  //减法运算<br>hint = this._Result.ToString( ) + " - " + val.ToString( ) + " = ";<br>this._Result -= val;<br>hint += this._Result.ToString( );<br>break;<br>case Operations.Multi:&nbsp;&nbsp;&nbsp;&nbsp;  //乘法运算<br>hint = this._Result.ToString( ) + " * " + val.ToString( ) + " = ";<br>this._Result *= val;<br>hint += this._Result.ToString( );<br>break;<br>case Operations.Dev:&nbsp;&nbsp;&nbsp;&nbsp;  //除法运算<br>if (val == 0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //除零检查<br>{<br>this._Result = 0;<br>this._Op = Operations.None;<br>hint = "除数为0，自动重置！";<br>}<br>else<br>{<br>hint = this._Result.ToString( ) + " / " + val.ToString( ) + " = ";<br>this._Result /= val;<br>hint += this._Result.ToString( );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>}<br>break;<br>default:<br>break;<br>}<br>this.ShowHint(hint);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //显示提示信息<br>}</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   //加操作<br>private void btnAdd_Click(object sender, RoutedEventArgs e)<br>{<br>this._Op = Operations.Add;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>}<br>//减操作<br>private void btnSub_Click(object sender, RoutedEventArgs e)<br>{<br>this._Op = Operations.Sub;<br>}<br>//乘操作<br>private void btnMulti_Click(object sender, RoutedEventArgs e)<br>{<br>this._Op = Operations.Multi;<br>}<br>//除操作<br>private void btnDiv_Click(object sender, RoutedEventArgs e)<br>{<br>this._Op = Operations.Dev;<br>}<br>//清除结果操作<br>private void btnClr_Click(object sender, RoutedEventArgs e)<br>{<br>this._Op = Operations.None;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   //清除原有结果<br>this._Result = 0;<br>this.ShowHint("手动重置");<br>}<br>}<br>}<application></application></pre>
            </td>
        </tr>
    </tbody>
</table>
</div>
</div></div></body></html>