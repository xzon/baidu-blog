<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>//swingworker 进度条 -gcode</title></head><body><h1>//swingworker 进度条 -gcode</h1><div><p>//swingworker 进度条 -gcode</p>
<p>package com.xxx.template;</p>
<p>import java.beans.PropertyChangeEvent;<br>
import java.beans.PropertyChangeListener;<br>
import java.util.ArrayList;<br>
import java.util.List;<br>
import java.util.concurrent.ExecutionException;</p>
<p>import javax.swing.JFrame;<br>
import javax.swing.JProgressBar;<br>
import javax.swing.JScrollPane;<br>
import javax.swing.JTextArea;<br>
import javax.swing.SwingWorker;</p>
<p>class NumbersTask extends SwingWorker&lt;List&lt;Integer&gt;, Integer&gt; {<br>
JTextArea textArea;<br>
int n;</p>
<p>NumbersTask(JTextArea textArea, int n) {<br>
&nbsp;&nbsp;  this.textArea = textArea;<br>
&nbsp;&nbsp;  this.n = n;<br>
}</p>
<p>@Override<br>
public List&lt;Integer&gt; doInBackground() {<br>
&nbsp;&nbsp;  List numbers = new ArrayList();<br>
&nbsp;&nbsp;  try {<br>
&nbsp;&nbsp;&nbsp;  for (int i = 0; i &lt; n &amp;&amp; !isCancelled(); i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  if (i % 3 == 0) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  numbers.add(i);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  publish(i);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Thread.sleep(1000);//for slowdown;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;  setProgress(100 * i / n);<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;  } catch (InterruptedException e) {<br>
&nbsp;&nbsp;&nbsp;  e.printStackTrace();<br>
&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;  return numbers;<br>
}</p>
<p>@Override<br>
protected void process(List&lt;Integer&gt; chunks) {<br>
&nbsp;&nbsp;  for (int number : chunks) {<br>
&nbsp;&nbsp;&nbsp;  textArea.append(number + &quot;,&quot;);<br>
&nbsp;&nbsp;  }<br>
}<br>
@Override<br>
protected void done(){<br>
&nbsp;&nbsp;  textArea.setText(&quot;done&quot;);<br>
}</p>
<p>public static void main(String args[]) throws InterruptedException,<br>
&nbsp;&nbsp;&nbsp;  ExecutionException {<br>
&nbsp;&nbsp;  JTextArea textArea = new JTextArea();<br>
&nbsp;&nbsp;  JScrollPane sp = new JScrollPane(textArea);<br>
&nbsp;&nbsp;  sp.setBounds(0, 0, 500, 300);<br>
&nbsp;&nbsp;  int n = 100;<br>
&nbsp;&nbsp;  final JProgressBar progressBar = new JProgressBar(0, 100);<br>
&nbsp;&nbsp;  progressBar.setBounds(0, 300, 500, 100);<br>
&nbsp;&nbsp;  JFrame f = new JFrame(&quot;swing worker&quot;);<br>
&nbsp;&nbsp;  f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);<br>
&nbsp;&nbsp;  f.setBounds(300,300,500, 400);<br>
&nbsp;&nbsp;  f.setLayout(null);<br>
&nbsp;&nbsp;  f.add(sp);<br>
&nbsp;&nbsp;  f.add(progressBar);<br>
&nbsp;&nbsp;  f.setVisible(true);<br>
&nbsp;&nbsp;  NumbersTask task = new NumbersTask(textArea, n);<br>
&nbsp;&nbsp;  task.addPropertyChangeListener(new PropertyChangeListener() {<br>
&nbsp;&nbsp;&nbsp;  public void propertyChange(PropertyChangeEvent evt) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;  if (&quot;progress&quot;.equals(evt.getPropertyName())) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  progressBar.setValue((Integer) evt.getNewValue());<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  progressBar.repaint();//don't need;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;  });</p>
<p>&nbsp;&nbsp;  task.execute();<br>
&nbsp;&nbsp;  System.out.println(task.get()); // get will wait for done;<br>
&nbsp;&nbsp;  progressBar.setVisible(false);<br>
}<br>
}<br>
//----------------------------</p>
<p>swingworker使用说明<br>
<br>
1、创建swingworker实例，并在构造函数中引入任务执行的必要参数<br>
<br>
&nbsp;&nbsp;&nbsp;  PrimeNumbersTask task = new PrimeNumbersTask(textArea, otherParam);<br>
&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  textArea&nbsp;&nbsp;&nbsp;  用来显示动态的处理结果<br>
&nbsp;&nbsp;&nbsp;  otherParam&nbsp;&nbsp;&nbsp;  其他参数，比如要获取一万个素数，就输入10000</p>
<p>&nbsp;&nbsp;&nbsp;  注意：SwingWorker&lt;T, V&gt;, T doInBackground()返回结果类型, V publish()和process() 参数集合中的类型</p>
<p>2、添加task的监听程序<br>
<br>
&nbsp;&nbsp;&nbsp;  task.addPropertyChangeListener(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  new PropertyChangeListener() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  public void propertyChange(PropertyChangeEvent evt) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (&quot;progress&quot;.equals(evt.getPropertyName())) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  progressBar.setIndeterminate(false);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  progressBar.setValue((Integer)evt.getNewValue());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  });<br>
<br>
&nbsp;&nbsp;&nbsp;  swingworker 默认可以监听的事件只有 progress 和 state<br>
&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  progress 事件是由 setProgress()方法执行触发，event.getNewValue()就是<br>
&nbsp;&nbsp;&nbsp;  任务当前的百分比进度，可以直接在 new JProgressBar(0, 100)这样的进度条的<br>
&nbsp;&nbsp;&nbsp;  setValue()方法中使用。<br>
<br>
&nbsp;&nbsp;&nbsp;  state 事件是由 swingworker 自动触发，有PENDING、STARTED、DONE三种状态<br>
&nbsp;&nbsp;&nbsp;  分别表示初始状态、已经开始但是还没有执行doInBackground()方法、doInBackground()<br>
&nbsp;&nbsp;&nbsp;  方法执行结束。<br>
<br>
3、执行task<br>
<br>
&nbsp;&nbsp;&nbsp;  task.execute();<br>
<br>
4、可选操作项<br>
<br>
&nbsp;&nbsp;&nbsp;  4.1、取得阻塞取得 doInBackground() 的执行结果<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  task.get();<br>
<br>
&nbsp;&nbsp;&nbsp;  4.2、取消正在执行的任务<br>
<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  task.cancel(true);<br>
<br>
5、swingworker内部执行流程<br>
<br>
&nbsp;&nbsp;&nbsp;  doInBackground()</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  isCancelled() --检测是否有中断请求<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  setProgress(int progress)<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  firePropertyChange(&quot;progress&quot;,old,new)<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  PropertyChangeListener<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  publish(V... chunks)<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  process(List&lt;V&gt; chunks)<br>
&nbsp;&nbsp;&nbsp;  done()<br>
&nbsp;&nbsp;&nbsp;  <br>
<br>
6、推荐使用检查状态阻塞一个对话框等，不推荐get()阻塞<br>
<br>
&nbsp;&nbsp;&nbsp;  public void propertyChange(PropertyChangeEvent event) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (&quot;state&quot;.equals(event.getPropertyName())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &amp;&amp; SwingWorker.StateValue.DONE == event.getNewValue()) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  dialog.setVisible(false);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  dialog.dispose();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }</p></div></body></html>