<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Enhancements in Java I/O</title></head><body><h1>Enhancements in Java I/O</h1><div><h1 align="center">Enhancements in Java I/O</h1>
<h2><a name="6">Enhancements in Java SE 6</a></h2>
<h3>java.io</h3>
<p>One new class is provided:</p>
<ul>
    <li><a href="http://java.sun.com/javase/6/docs/api/java/io/Console.html"><code><span style=";;font-family:新宋体;">Console</span></code></a> - Contains methods to access a character-based console device. The <code><span style=";;font-family:新宋体;">readPassword()</span></code> methods disable echoing thus they are suitable for retrieval of sensitive data such as passwords. The method <a href="http://java.sun.com/javase/6/docs/api/java/lang/System.html#console%28%29"><code><span style=";;font-family:新宋体;">System.console()</span></code></a> returns the unique console associated with the Java Virtual Machine.</li>
</ul>
<p>The following new methods were added to <a href="http://java.sun.com/javase/6/docs/api/java/io/File.html"><code><span style=";;font-family:新宋体;">File</span></code></a>:</p>
<ul>
    <li>Methods to retrieve disk usage information:
    <ul>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#getTotalSpace%28%29"><code><span style=";;font-family:新宋体;">getTotalSpace()</span></code></a> returns the size of the partition in bytes</li>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#getFreeSpace%28%29"><code><span style=";;font-family:新宋体;">getFreeSpace()</span></code></a> returns the number of unallocated bytes in the partition</li>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#getUsableSpace%28%29"><code><span style=";;font-family:新宋体;">getUsableSpace()</span></code></a> returns the number of bytes available on the partition and includes checks for write permissions and other operating system restrictions</li>
    </ul>
    </li>
    <li>Methods to set or query file permissions:
    <ul>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setWritable%28boolean,%20boolean%29"><code><span style=";;font-family:新宋体;">setWritable(boolean writable, boolean ownerOnly)</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setWritable%28boolean%29"><code><span style=";;font-family:新宋体;">setWritable(boolean writable)</span></code></a> set the owner's or everybody's write permission</li>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setReadable%28boolean,%20boolean%29"><code><span style=";;font-family:新宋体;">setReadable(boolean readable, boolean ownerOnly)</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setReadable%28boolean%29"><code><span style=";;font-family:新宋体;">setReadable(boolean readable)</span></code></a> set the owner's or everybody's read permission</li>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setExecutable%28boolean,%20boolean%29"><code><span style=";;font-family:新宋体;">setExecutable(boolean executable, boolean ownerOnly)</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#setExecutable%28boolean%29"><code><span style=";;font-family:新宋体;">setExecutable(boolean executable)</span></code></a> set the owner's or everybody's execute permission</li>
        <li><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#canExecute%28%29"><code><span style=";;font-family:新宋体;">canExecute()</span></code></a> tests the value of the execute permission</li>
    </ul>
    </li>
</ul>
<p>Constructors were added to the following class:</p>
<ul>
    <li><a href="http://java.sun.com/javase/6/docs/api/java/io/IOException.html"><code><span style=";;font-family:新宋体;">IOException</span></code></a> supports exception chaining via the addition of the new constructors <a href="http://java.sun.com/javase/6/docs/api/java/io/IOException.html#IOException%28java.lang.String,%20java.lang.Throwable%29"><code><span style=";;font-family:新宋体;">IOException(String, Throwable)</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/IOException.html#IOException%28java.lang.Throwable%29"><code><span style=";;font-family:新宋体;">IOException(Throwable)</span></code></a>.</li>
</ul>
<p>The behavior of the following method was modified:</p>
<ul>
    <li>The <a href="http://java.sun.com/javase/6/docs/api/java/io/File.html#isFile%28%29"><code><span style=";;font-family:新宋体;">File.isFile()</span></code></a> Windows implementation has been modified to always return <code><span style=";;font-family:新宋体;">false</span></code> for reserved device names such as CON, NUL, AUX, LPT, etc. Previously it returned <code><span style=";;font-family:新宋体;">true</span></code>, which customers considered a bug because it was inconsistent with behavior for devices on Unix.</li>
</ul>
<h3>java.nio</h3>
<ul>
    <li>A new <a href="http://java.sun.com/javase/6/docs/api/java/nio/channels/spi/SelectorProvider.html"><code><span style=";;font-family:新宋体;">java.nio.channels.SelectorProvider</span></code></a> implementation that is based on the Linux epoll event notification facility is included. The epoll facility is available in the Linux 2.6, and newer, kernels. The new epoll-based <code><span style=";;font-family:新宋体;">SelectorProvider</span></code> implementation is more scalable than the traditional poll-based <code><span style=";;font-family:新宋体;">SelectorProvider</span></code> implementation when there are thousands of <a href="http://java.sun.com/javase/6/docs/api/java/nio/channels/SelectableChannel.html"><code><span style=";;font-family:新宋体;">SelectableChannel</span></code></a>s registered with a <a href="http://java.sun.com/javase/6/docs/api/java/nio/channels/Selector.html"><code><span style=";;font-family:新宋体;">Selector</span></code></a>. The new <code><span style=";;font-family:新宋体;">SelectorProvider</span></code> implementation will be used by default when the 2.6 kernel is detected. The poll-based <code><span style=";;font-family:新宋体;">SelectorProvider</span></code> will be used when a pre-2.6 kernel is detected.</li>
    <li>The system property <code><span style=";;font-family:新宋体;">sun.nio.ch.disableSystemWideOverlappingFileLockCheck</span></code> controls whether <a href="http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html#lock%28%29"><code><span style=";;font-family:新宋体;">java.nio.channels.FileChannel.lock()</span></code></a> checks whether regions are locked by other instances of <code><span style=";;font-family:新宋体;">FileChannel</span></code>. Unless this system property is set to <code><span style=";;font-family:新宋体;">true</span></code>, <code><span style=";;font-family:新宋体;">FileChannel.lock()</span></code> will throw an <a href="http://java.sun.com/javase/6/docs/api/java/nio/channels/OverlappingFileLockException.html"><code><span style=";;font-family:新宋体;">OverlappingFileLockException</span></code></a> if an application attempts to lock a region that overlaps one that is locked by another instance of <code><span style=";;font-family:新宋体;">FileChannel</span></code>. The system property exists to provide compatibility with previous releases which do not implement the JVM-wide overlapping file lock check.</li>
</ul>
<h2><a name="5.0">Enhancements in J2SE 5.0</a></h2>
<h3>java.nio</h3>
<ul>
    <li>Class <a href="http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLEngine.html"><code><span style=";;font-family:新宋体;">javax.net.ssl.SSLEngine</span></code></a> was added. The existing J2SDK 1.4.0 secure communication infrastructure, <a href="http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLSocket.html"><code><span style=";;font-family:新宋体;">javax.net.ssl.SSLSocket</span></code></a>, was based on the I/O model of java.net.Socket. The <code><span style=";;font-family:新宋体;">SSLEngine</span></code> class abstracts away the I/O model, and leaves developers free to secure communication pathways using alternate types of I/O. <code><span style=";;font-family:新宋体;">SSLEngine</span></code> can be combined with the New I/O APIs to create implementations such as secure blocking or non-blocking <code><span style=";;font-family:新宋体;">SocketChannel</span></code>s. For details see the <a href="http://java.sun.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a>.</li>
</ul>
<h2><a name="1.4">Enhancements in Java 2 SDK v1.4</a></h2>
<h3>java.io</h3>
<ul>
    <li>In the <a href="http://java.sun.com/javase/6/docs/api/java/io/FileInputStream.html"><code><span style=";;font-family:新宋体;">FileInputStream</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/FileOutputStream.html"><code><span style=";;font-family:新宋体;">FileOutputStream</span></code></a> classes, <code><span style=";;font-family:新宋体;">getChannel</span></code> methods have been added to return the underlying <code><span style=";;font-family:新宋体;">FileChannel</span></code> object, and the <code><span style=";;font-family:新宋体;">close</span></code> methods have been revised to close the underlying channel.</li>
    <li>Similarly, in the <a href="http://java.sun.com/javase/6/docs/api/java/io/RandomAccessFile.html"><code><span style=";;font-family:新宋体;">RandomAccessFile</span></code></a> class, a <code><span style=";;font-family:新宋体;">getChannel</span></code> method has been added and the <code><span style=";;font-family:新宋体;">close</span></code> method has been revised to close the underlying channel. The <code><span style=";;font-family:新宋体;">RandomAccessFile</span></code> constructors now support the mode characters <tt><span style=";;font-family:新宋体;">"s"</span></tt> and <tt><span style=";;font-family:新宋体;">"d"</span></tt> to allow the specification, at file-open time, of synchronous writes or synchronous-data writes.</li>
    <li>In the <a href="http://java.sun.com/javase/6/docs/api/java/io/InputStreamReader.html"><code><span style=";;font-family:新宋体;">InputStreamReader</span></code></a> and <a href="http://java.sun.com/javase/6/docs/api/java/io/OutputStreamWriter.html"><code><span style=";;font-family:新宋体;">OutputStreamWriter</span></code></a> classes, constructors have been added that take a stream and a <code><span style=";;font-family:新宋体;">Charset</span></code> object, and the <code><span style=";;font-family:新宋体;">getEncoding</span></code> methods have been revised to return the historical name of the encoding being used. Constructors to <code><span style=";;font-family:新宋体;">InputStreamReader</span></code> and <code><span style=";;font-family:新宋体;">OutputStreamWriter</span></code> have been added that take existing <code><span style=";;font-family:新宋体;">CharsetDecoder</span></code> and <code><span style=";;font-family:新宋体;">CharsetEncoder</span></code> objects, respectively.</li>
</ul>
<h3>java.nio</h3>
<ul>
    <li>The nio packages were added to supplement the I/O facilities provided the java.io package.</li>
    <li>Three new functions were added to the Java Native Interface (JNI) to support direct buffers. For information, see <a href="http://java.sun.com/javase/6/docs/technotes/guides/jni/jni-14.html">JNI Enhancements in v 1.4</a>.</li>
</ul>
<a name="pre"></a>
<h2>Previous Enhancements</h2>
<ul>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/io-maj.html">Features of java.io.File</a> describes changes to the <code><span style=";;font-family:新宋体;">java.io.File</span></code> class.</li>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/io-min.html">Other changes</a> describes modifications made to the <code><span style=";;font-family:新宋体;">java.io</span></code> package.</li>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/io.html">Character Streams</a> discusses very early changes to the java.io class package to support character streams.</li>
</ul>
<h2>More Information</h2>
<ul>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/intl/encoding.doc.html">Supported Encodings</a></li>
    <li><a href="http://java.sun.com/docs/books/tutorial/essential/io/index.html">The Java Tutorial</a></li>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/serialization/index.html">Object Serialization</a></li>
    <li><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/troubleshooting.html">Troubleshooting tips</a></li>
</ul>
<p>The examples in the following table show how to use the NIO APIs.</p>
<p>
<table cellspacing="10" summary="source files and descriptions">
    <tbody>
        <tr>
            <th valign="top"><strong>Source File</strong></th>
            <th valign="top"><strong>Description</strong></th>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/Grep.java"><span style=";;font-family:新宋体;">Grep.java</span></a></code></td>
            <td valign="top">Searches a list of files for lines that match a given regular-expression pattern. Demonstrates NIO mapped byte buffers, charsets, and regular expressions.</td>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/Sum.java"><span style=";;font-family:新宋体;">Sum.java</span></a></code></td>
            <td valign="top">Computes 16-bit checksums for a list of files. Uses NIO mapped byte buffers for speed.</td>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/TimeQuery.java"><span style=";;font-family:新宋体;">TimeQuery.java</span></a></code></td>
            <td valign="top">Asks a list of hosts what time it is. Is a simple, blocking program that demonstrates NIO socket channels (connection and reading), buffer handling, charsets, and regular expressions.</td>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/TimeServer.java"><span style=";;font-family:新宋体;">TimeServer.java</span></a></code></td>
            <td valign="top">Listens for connections and tells callers what time it is. Is a simple, blocking program that demonstrates NIO socket channels (accepting and writing), buffer handling, charsets, and regular expressions.</td>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/Ping.java"><span style=";;font-family:新宋体;">Ping.java</span></a></code></td>
            <td valign="top">Connects to each of a list of hosts and measures the time required to complete the connection. Uses a selector and two additional threads to demonstrate non-blocking connects and the multithreaded use of a selector.</td>
        </tr>
        <tr>
            <td valign="top"><code><a href="http://java.sun.com/javase/6/docs/technotes/guides/io/example/NBTimeServer.java"><span style=";;font-family:新宋体;">NBTimeServer.java</span></a></code></td>
            <td valign="top">Implements a non-blocking Internet time server.</td>
        </tr>
    </tbody>
</table>
</p>
<p> </p>
<p>=====================</p>
<h1>Troubleshooting</h1>
<blockquote>
<ul>
    <li>A <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/File.html"><span style=";;font-family:新宋体;">File</span></a></tt> object represents a file name, not an actual file. Such objects are, moreover, immutable. Thus the code
    <pre>File f1 = new File("foo");
    File f2 = new File("bar");
    f1.renameTo(f2);</pre>    will rename the file named <tt><span style=";;font-family:新宋体;">"foo"</span></tt> (if it exists) to <tt><span style=";;font-family:新宋体;">"bar"</span></tt>. It will not change the value of the <tt><span style=";;font-family:新宋体;">File</span></tt> object referred to by <tt><span style=";;font-family:新宋体;">f1</span></tt>; in particular, the expression <tt><span style=";;font-family:新宋体;">f1.getPath()</span></tt> will still evaluate to <tt><span style=";;font-family:新宋体;">"foo"</span></tt>.
    <p> </p>
    </li>
    <li>The <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/InputStream.html#available%28%29"><span style=";;font-family:新宋体;">available</span></a></tt> method of the <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/InputStream.html"><span style=";;font-family:新宋体;">InputStream</span></a></tt> class and its subclasses does not necessarily return the maximum number of bytes that can be read without blocking. In particular, code of the form
    <pre>int n = in.available();
    byte buf = new byte[n];
    in.read(buf);</pre>    is not guaranteed to read all of the remaining bytes from the given input stream. Similarly, the <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/Reader.html#ready%28%29"><span style=";;font-family:新宋体;">ready</span></a></tt> method of <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/Reader.html"><span style=";;font-family:新宋体;">Reader</span></a></tt> and its subclasses may return <tt><span style=";;font-family:新宋体;">false</span></tt> even if the stream is ready to be read.
    <p> </p>
    </li>
    <li>The <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/InputStream.html#read%28byte%5B%5D%29"><span style=";;font-family:新宋体;">read(byte[])</span></a></tt> and <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/InputStream.html#read%28byte%5B%5D,%20int,%20int%29"><span style=";;font-family:新宋体;">read(byte[], int, int)</span></a></tt> methods of <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/InputStream.html"><span style=";;font-family:新宋体;">InputStream</span></a></tt> and its subclasses are not guaranteed to read all available bytes. A loop may be required, for example, in order to read a large file into an array:
    <pre>for (int off = 0; off &lt; size;) {
        int r = in.read(buf, off, buf.length - off);
        if (r == -1) break;
        off += r;
    }</pre>    Alternatively, a <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/BufferedInputStream.html"><span style=";;font-family:新宋体;">BufferedInputStream</span></a></tt> may be used. Similar remarks apply to the <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/Reader.html#read%28char%5B%5D%29"><span style=";;font-family:新宋体;">read(char[])</span></a></tt> and <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/Reader.html#read%28char%5B%5D,%20int,%20int%29"><span style=";;font-family:新宋体;">read(char[], int, int)</span></a></tt> methods of <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/Reader.html"><span style=";;font-family:新宋体;">Reader</span></a></tt> and its subclasses.
    <p> </p>
    </li>
    <li>The <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/PrintStream.html"><span style=";;font-family:新宋体;">PrintStream</span></a></tt> and <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html"><span style=";;font-family:新宋体;">PrintWriter</span></a></tt> classes suppress all I/O errors. To see whether an error has occurred, invoke the <tt><span style=";;font-family:新宋体;">checkError</span></tt> method.
    <p> </p>
    </li>
    <li><tt><a href="http://java.sun.com/javase/6/docs/api/java/io/PrintStream.html"><span style=";;font-family:新宋体;">PrintStream</span></a></tt> and <tt><a href="http://java.sun.com/javase/6/docs/api/java/io/PrintWriter.html"><span style=";;font-family:新宋体;">PrintWriter</span></a></tt> objects do not always flush their output. To arrange for automatic flushing, use the two-argument constructors of these classes and specify <tt><span style=";;font-family:新宋体;">true</span></tt> for the second argument.</li>
</ul>
</blockquote>
<p> </p>
<p>========================</p>
<div>Answers to Questions and Exercises: Basic I/O</div>
<blockquote></blockquote>
<h3>Questions</h3>
<blockquote>
<p><span style=";color:#ff0000;;">Question 1.</span> What class and method would you use to read a few pieces of data that are at known positions near the end of a large file?</p>
<p><span style=";color:#008000;;">Answer 1.</span> <a class="APILink" href="http://openjdk.java.net/projects/nio/javadoc/java/nio/file/Path.html#newByteChannel%28%29" target="_blank"><code><span style=";;font-family:新宋体;">Path.newByteChannel</span></code></a> returns an instance of <code><span style=";;font-family:新宋体;">SeekableByteChannel</span></code> which allows you to read from (or write to) any position in the file.</p>
<p><span style=";color:#ff0000;;">Question 2.</span>When invoking <code><span style=";;font-family:新宋体;">format</span></code>, what is the best way to indicate a new line?</p>
<p><span style=";color:#008000;;">Answer 2.</span> Use the <code><span style=";;font-family:新宋体;">%n</span></code> conversion — the <code><span style=";;font-family:新宋体;">\n</span></code> escape is not platform independent!</p>
<p><span style=";color:#ff0000;;">Question 3.</span> How would you determine the MIME type of a file?</p>
<p><span style=";color:#008000;;">Answer 3.</span> The <a class="APILink" href="http://openjdk.java.net/projects/nio/javadoc/java/nio/file/Files.html#probeContentType%28%29" target="_blank"><code><span style=";;font-family:新宋体;">Files.probeContentType</span></code></a> method uses the platform's underlying file type detector to evaluate and return the MIME type.</p>
<p><span style=";color:#ff0000;;">Question 4.</span> What method(s) would you use to determine whether a file is a symbolic link?</p>
<p><span style=";color:#008000;;">Answer 4.</span> You would use the <a class="APILink" href="http://openjdk.java.net/projects/nio/javadoc/java/nio/file/attribute/BasicFileAttributes.html#isSymbolicLink%28%29" target="_blank"><code><span style=";;font-family:新宋体;">isSymbolicLink</span></code></a> method in the <code><span style=";;font-family:新宋体;">BasicFileAttributes</span></code> class. The code might look like this:</p>
<p> </p>
<blockquote>
<pre>Path file=...;
boolean isSymbolicLink = Attributes.readBasicFileAttributes(file, LinkOption.NOFOLLOWLINKS).isSymbolicLink();</pre></blockquote>
<p>In this example, the <code><span style=";;font-family:新宋体;">isSymbolicLink</span></code> method has been chained to the <code><span style=";;font-family:新宋体;">readBasicFileAttributes</span></code> method which fetches all basic attributes for a <code><span style=";;font-family:新宋体;">Path</span></code> instance.</p>
</blockquote>
<p> </p>
<h3>Exercises</h3>
<blockquote>
<p><span style=";color:#ff0000;;">Exercise 1.</span> Write an example that counts the number of times a particular character, such as <code><span style=";;font-family:新宋体;">e</span></code>, appears in a file. The character can be specified at the command line. You can use <a class="SourceLink" href="http://java.sun.com/docs/books/tutorial/essential/io/examples/xanadu.txt" target="_blank"><code><span style=";;font-family:新宋体;">xanadu.txt</span></code></a> as the input file.</p>
<p><span style=";color:#008000;;">Answer 1.</span> See <a class="SourceLink" href="http://java.sun.com/docs/books/tutorial/essential/io/QandE/CountLetter.java" target="_blank"><code><span style=";;font-family:新宋体;">CountLetter.java</span></code></a> for the solution.</p>
<p><span style=";color:#ff0000;;">Exercise 2.</span> The file <a class="SourceLink" href="http://java.sun.com/docs/books/tutorial/essential/io/QandE/datafile" target="_blank"><code><span style=";;font-family:新宋体;">datafile</span></code></a> begins with a single <code><span style=";;font-family:新宋体;">long</span></code> that tells you the offset of a single <code><span style=";;font-family:新宋体;">int</span></code> piece of data within the same file. Write a program that gets the <code><span style=";;font-family:新宋体;">int</span></code> piece of data. What is the <code><span style=";;font-family:新宋体;">int</span></code> data?</p>
<p><span style=";color:#008000;;">Answer 2.</span> <code><span style=";;font-family:新宋体;">123</span></code>. See <a class="SourceLink" href="http://java.sun.com/docs/books/tutorial/essential/io/QandE/FindInt.java" target="_blank"><code><span style=";;font-family:新宋体;">FindInt.java</span></code></a> for the solution.</p>
</blockquote></div></body></html>