<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Tapestry5.1.0.5的安全问题，注意hibernate.cfg.xml可以被访问</title></head><body><h1>Tapestry5.1.0.5的安全问题，注意hibernate.cfg.xml可以被访问</h1><div><h2>Tapestry5.1.0.5的安全问题，注意hibernate.cfg.xml可以被访问</h2>
<p>http://www.tapestry5.com/?p=36040</p>
<p>http://old.nabble.com/-T5--Security-of-files-in-the-classpath-ts11816097.html</p>
<p>-----------------------------------------</p>
<p>hxzon:输入http://localhost:8080/material3/assets/ctx/3/WEB-INF/applicationContext.xml果然输出了WEB-INF下的重要文件。</p>
<p>-----------------------------------------</p>
<div class="entry">
<p>今天看Tapestry5的邮件列表，注意到关于assets的安全访问的讨论，原帖见<a href="http://www.nabble.com/-T5--Security-of-files-in-the-classpath-ts11816097.html">这里</a>，大体意思是说通过拼写url可以访问到WEB-INF下的文件，例如输入 <a target="_top" href="http://localhost:8080/assets/hibernate.cfg.xml" rel="nofollow">http://localhost:8080/assets/hibernate.cfg.xml</a>，是可以访问到的，看到这个，我的这个汗呀，这样子的话岂不是数据库访问的密码都可以找到，hibernate是明码写在里边的。幸亏讨论里有人给出了临时的解决方案，在你的module文件里，添加如下代码：</p>
<pre>/*<br>  * All the assets that are allowed to be downloaded using the assets service<br>  * (including files without extension and dirs)<br>  */<br> private static final String[] ASSET_WHITE_LIST = { &quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &quot;gif&quot;, &quot;js&quot;, &quot;css&quot;, &quot;ico&quot; };<br><br> /*<br>  * All the assets that are allowed to be downloaded using the assets service<br>  * (including files without extension and dirs)<br>  */<br> private static final Set&lt;String&gt; assetsWhitelist = Collections.synchronizedSet(new HashSet&lt;String&gt;(Arrays<br>   .asList(ASSET_WHITE_LIST)));<br><br> public void contributeHttpServletRequestHandler(OrderedConfiguration&lt;HttpServletRequestFilter&gt; configuration,<br>   @Inject @Value(&quot;${access-denied-page}&quot;) final String accessDeniedPage) {<br>  /*<br>   * Create a filter that will block access to some assets. The asset<br>   * service allows access to some assets we do not want to expose. The<br>   * asset service will show all files in /assets/ directory and allows<br>   * you (by default) to download some files which you do not want to<br>   * expose.<br>   */<br>  HttpServletRequestFilter filter = new HttpServletRequestFilter() {<br>   public boolean service(HttpServletRequest request, HttpServletResponse response,<br>     HttpServletRequestHandler handler) throws IOException {<br>    String path = request.getServletPath();<br><br>    if (path.startsWith(&quot;/assets&quot;) &amp;&amp; (!assetsWhitelist.contains(<br><br>    StringUtils.lowerCase(FilenameUtils.getExtension(path))))) {<br>     response.sendRedirect(request.getContextPath() + &quot;/&quot; + accessDeniedPage);<br><br>     return true;<br>    }<br><br>    return handler.service(request, response);<br>   }<br>  };<br><br>  configuration.add(&quot;AssetProtectionFilter&quot;, filter, &quot;before:*&quot;);<br> }</pre>
<p>这样通过/assets/路径访问限制文件就不太可能了。代码上有解释就不翻译了，这个安全问题一定要引起大家的注意，数据库可是很重要的，不知道什么时候可以修正这个问题，或许这不是bug，只是个hack而已。</p>
</div>
<p>--------------------------------------</p>
<p>hxzon:</p>
<pre>/*<br>  * All the assets that are allowed to be downloaded using the assets service<br>  * (including files without extension and dirs)<br>  */<br> private static final String[] ASSET_WHITE_LIST = { &quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &quot;gif&quot;, &quot;js&quot;, &quot;css&quot;, &quot;ico&quot; };<br><br> /*<br>  * All the assets that are allowed to be downloaded using the assets service<br>  * (including files without extension and dirs)<br>  */<br> private static final Set&lt;String&gt; assetsWhitelist = Collections.synchronizedSet(new HashSet&lt;String&gt;(Arrays<br>   .asList(ASSET_WHITE_LIST)));<br><br> public void contributeHttpServletRequestHandler(OrderedConfiguration&lt;HttpServletRequestFilter&gt; configuration) {<br>  /*<br>   * Create a filter that will block access to some assets. The asset<br>   * service allows access to some assets we do not want to expose. The<br>   * asset service will show all files in /assets/ directory and allows<br>   * you (by default) to download some files which you do not want to<br>   * expose.<br>   */<br>  HttpServletRequestFilter filter = new HttpServletRequestFilter() {<br>   public boolean service(HttpServletRequest request, HttpServletResponse response,<br>     HttpServletRequestHandler handler) throws IOException {<br>    //hxzon:add to lower case and web-inf<br>    String path = request.getServletPath().toLowerCase();<br><br>    if (path.contains(&quot;web-inf&quot;) || path.startsWith(&quot;/assets&quot;)<br>      &amp;&amp; (!assetsWhitelist.contains((FilenameUtils.getExtension(path))))) {<br>     response.sendRedirect(request.getContextPath() + &quot;/&quot;);<br><br>     return true;<br>    }<br><br>    return handler.service(request, response);<br>   }<br>  };<br><br>   configuration.add(&quot;AssetProtectionFilter&quot;, filter, &quot;after:StoreIntoGlobals&quot;);<br> }</pre>
<p> </p></div></body></html>