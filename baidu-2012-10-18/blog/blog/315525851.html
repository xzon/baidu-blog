<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</title></head><body><h1>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</h1><div><p><p>在tapestry5中添加自己的数据类型，如货币，日期等 -hxzon</p><p>tapestry5.2.4</p><p>1，定义自己的数据类型名称，如</p><pre>package org.hxzon.tapestry5.util;<br><br>public class TapestryEx {<br> public static final String DataType_currency = "currency";<br> public static final String DataType_day = "date_day";<br> public static final String DataType_time = "date_time";<br> public static final String DataType_daytime = "date_daytime";<br> public static final String DataType_nanotime = "date_nanotime";<br><br> public static String UnitePattern_day = "yyyy-MM-dd";<br> public static String UnitePattern_minute = "yyyy-MM-dd, HH:mm";<br> public static String UnitePattern_second = "yyyy-MM-dd, HH:mm:ss";<br> public static String UnitePattern_nano = "yyyy-MM-dd, HH:mm:ss.SSS";<br> public static String UnitePattern_time = UnitePattern_nano;<br>}<br></pre><p>2，在对应的域上用注解表明数据类型</p><pre>@DataType(TapestryEx.DataType_currency)
    private BigDecimal totalPrice = BigDecimalUtil.Int0;// 总价

    @DataType(TapestryEx.DataType_currency)
    private BigDecimal accountPaid = BigDecimalUtil.Int0;// 已付款

    @DataType(TapestryEx.DataType_currency)
    private BigDecimal invoicePaid = BigDecimalUtil.Int0;
</pre><p>3，注册自己的数据类型，在AppModule.java中添加如下代码</p><p>&nbsp;&nbsp;&nbsp; @Contribute(BeanBlockSource.class)<br>&nbsp;&nbsp;&nbsp; public static void provideDefaultBeanBlocks(Configuration&lt;BeanBlockContribution&gt; configuration) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_currency);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_day);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_time);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_daytime);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; addExDisplayBlock(configuration, TapestryEx.DataType_nanotime);<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; private static void addExDisplayBlock(Configuration&lt;BeanBlockContribution&gt; configuration, String name) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; configuration.add(new DisplayBlockContribution(name, ExPropertyDisplayBlocks.class.getSimpleName(), name));<br>&nbsp;&nbsp;&nbsp; }</p><p>4，页面类，只是作为一个block的容器而已。</p><pre>package org.hxzon.tapestry5.pages;<br><br>import java.math.BigDecimal;<br><br>import org.apache.tapestry5.annotations.Environmental;<br>import org.apache.tapestry5.annotations.Property;<br>import org.apache.tapestry5.services.PropertyOutputContext;<br>import org.hxzon.tapestry5.util.TapestryEx;<br><br>public class ExPropertyDisplayBlocks {<br> @Property<br> @Environmental<br> private PropertyOutputContext context;<br><br> public BigDecimal getCurrencyValue() {<br>  return (BigDecimal) context.getPropertyValue();<br> }<br><br> private String subStringValue(int start, int end) {<br>  try {<br>   String value = (String) context.getPropertyValue();<br>   value = value.substring(start, end);<br>   return value;<br>  } catch (Exception e) {<br>   return "";<br>  }<br> }<br><br> public String getDayValue() {<br>  return subStringValue(0, TapestryEx.UnitePattern_day.length());<br> }<br><br> public String getTimeValue() {<br>  return subStringValue(TapestryEx.UnitePattern_day.length() + 1, TapestryEx.UnitePattern_second.length());<br> }<br><br> public String getDaytimeValue() {<br>  return subStringValue(0, TapestryEx.UnitePattern_second.length());<br> }<br><br> public String getNanotimeValue() {<br>  return (String) context.getPropertyValue();<br> }<br>}<br><br>
</pre><pre>&lt;t:container<br>&nbsp;&nbsp;&nbsp; xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"&gt;<br><br>&nbsp;&nbsp;&nbsp; &lt;t:block id="currency"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;span class="red"&gt; &lt;t:numberFormatter value="currencyValue" /&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/span&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br><br>&nbsp;&nbsp;&nbsp; &lt;t:block id="date_day"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;t:textoutput value="dayValue"/&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br><br>&nbsp;&nbsp;&nbsp; &lt;t:block id="date_time"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value="timeValue"/&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br><br>&nbsp;&nbsp;&nbsp; &lt;t:block id="date_daytime"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value="daytimeValue"/&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br><br>&nbsp;&nbsp;&nbsp; &lt;t:block id="date_nanotime"&gt;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;t:textoutput value="nanotimeValue"/&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/t:block&gt;<br><br>&lt;/t:container&gt;

</pre><p>&nbsp;</p><p>&nbsp;</p></p></div></body></html>