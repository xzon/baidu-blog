<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>打造专业外观-九宫图</title></head><body><h1>打造专业外观-九宫图</h1><div><p><h1>打造专业外观-九宫图</h1>
<p>&nbsp;</p>
<p>http://www.blogjava.net/javagui/archive/2007/11/03/157948.html 本文</p>
<p>posted on 2007-11-03 17:56</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;长久以来，Java被认为是服务器端的佼佼者，而在客户端方面不被看好，特别地MicroSoft的Windows系列几乎垄断了桌面应
用。所以在大多数人看来只要一提起开发客户端，首先想到的是VB、Delph。拒绝Java的原因无非是速度慢、Swing外观丑陋这2点。对于前者已经
成为历史了，而对于后者，抱怨Java设计的界面丑陋的那些人一定桌面开发经验浅显、或者只会依赖VB那种托拽生成组件的那些非高手。再有可能就是传统桌
面开发员中的VB忠实fans，他们不愿意接受新东西。其实目前而言，Java开发桌面应用不仅能将上述缺点消除，Java最重要的是能够跨平台运行，这
是其他语言不能达到的，如果客户端使用VB开发的话，那么还可能要考虑系统其他部分的开发是否也要用VB或者微软支持的产品。目前用Java语言开发的客
户端已不少见，IBM 
Lotus旗下的Sametime系列就是很好的例子，虽然其7.5已经将界面全部改为SWT实现而不再是AWT，但至少能说明Java作为桌面开发绝不
是弱者。而且调查显示Visual Basic开发用户直线下降。详见<a href="http://blog.sina.com.cn/s/blog_4b6047bc010006v9.html">http://blog.sina.com.cn/s/blog_4b6047bc010006v9.html</a></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;对于一般界面需求而言，简单的桌面组件完全可以满足用户的需求，这些简单至极的组件已经被集成进组件托盘中了，如果你用netbeans或
者安装Eclipse的VE插件，完全可以只通过托拽的方式将组件生成并放置在指定的地方。至多需要你对常用布局管理器有少许了解。但是单凭这些现有的玩
意很难打造出专业的外观。比如一个顶层窗口，如果你用swing组件库中的JFrame或SWT中的Shell，那么它的外观充其量和本地的外观一致，这
个本地化外观有窗口的标题栏，标题栏文字出现的位置，Windows是图标左对齐，Solaris是居中，和默认的最小化、最大化、关闭等按钮。另外还有
固定尺寸和外观的边框，尽管在Windows 
Vista中这些元素已经很美观，但是某些软件如即时通讯类软件，美工一定会单独设计出一套截然不同的外观叫你去实现。就拿一个窗口来说，如下图：<br><img src="http://hiphotos.baidu.com/hxzon/pic/item/ae920ad784f2198ba044dfb6.jpg" height="400" width="500"><br>
我从事Java桌面相关的工作有1年半了，起初我依赖JButton、JScroll等基础组件，BorderLayout、FlowLayout等现成
的布局管理器企图能实现类似MSN的外观效果，但是实际看来是完全不可能的，所以我当时就下了这样的结论，哪怕现在我依然认为是正确的：“抛弃所有的外观
设计工具和一切现有的桌面组件及布局管理器，一切的一切必须自定义实现，设计工具最多能替你完成一半”。所以当时界面部分的代码是我一行一行写出来的，为
了不做重复的劳动，定义了不少组件如Button，CheckBox，ComboBox（参见<a href="http://www.blogjava.net/javagui/archive/2007/10/23/155266.html">用SWT实现MSN风格的下拉框</a>）、Slider(参见<a href="http://www.blogjava.net/javagui/archive/2007/10/23/155271.html">SWT自定义组件之Slider</a>)。<br>
布局管理器完全不用，因为它会给你的组件布局带来很大限制。取而代之的是为容器组件添加ComponentListener监听器（SWT的实现是ControlListener）。<br>
下列是我基于这个理念开发的界面截图。</p>
<p><img src="http://hiphotos.baidu.com/hxzon/pic/item/5a8991ddb69523625882ddb6.jpg" height="464" width="607"></p>
<p><img src="http://hiphotos.baidu.com/hxzon/pic/item/6aeeab3440533ce1d1a2d3b6.jpg"><br><br><img src="http://hiphotos.baidu.com/hxzon/pic/item/05b19b16c72b2107f2de32b6.jpg"><br><br><img src="http://hiphotos.baidu.com/hxzon/pic/item/3650a951cf0f3ad98d5430b6.jpg" height="438" width="272">&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://hiphotos.baidu.com/hxzon/pic/item/9228b4b7cb7382a230add1b6.jpg" height="438" width="272"><br><img src="http://hiphotos.baidu.com/hxzon/pic/item/3874b28fb2851ab8f11f36b6.jpg" height="435" width="152">&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://hiphotos.baidu.com/hxzon/pic/item/3bb53c296f246ea898250ab6.jpg" height="438" width="273"><br><br><img src="http://hiphotos.baidu.com/hxzon/pic/item/1b080af42c7c45b97709d7b6.jpg" height="496" width="503"><br><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;作为打造专业外观的第一步，应该学会如何去分解。介绍一种常见的分解方法——九宫格。如下图所示</p>
<p><img src="http://hiphotos.baidu.com/hxzon/pic/item/bda34d368d7ea08ba2cc2bb6.jpg" height="628" width="680"><br>
九宫格的设计思想是将组件分成9个组成部分，四个边、四个角、中心部分作为内容放置其他组件。为了叙述方便，这9个部分依次取名为northwest（左
上）、northeast（右上）、north（北）、southwest（左下）、southeast（右下）、south（南）、west（西）、
east（东）、content（中心内容窗格）。<br>
这9个部分的布局不难理解，例如northwest始终位于左上，无论窗口大小如何变动northwest都不会改变大小和位置；同理northeast
始终位于右上位置；而north的左边紧贴northwest的右端、右边紧贴northeast的左边，所以north的长度计算应该是窗口的长度减去
northwest和northeast的长度之和。同理，剩下几部分的布局不难计算。<br>
&nbsp;&nbsp;&nbsp;&nbsp;还有一点是很重要的，如果你是用SWT组件，务必把Shell的样式设置成SWT.NO_TRIM，也就是说这样的顶层窗口没有标题栏和边框，一些由你来修饰。如果你用Swing，请使用JWindow而不是JFrame，道理同上。<br>
&nbsp;&nbsp;&nbsp;&nbsp;虽然上述实现界面程序是用SWT编写的，但是不代表SWT很强大，Swing才是王者，你可以这样理解，SWT这样的怪胎都能做出如此效果，Swing更没问题了。<br>
&nbsp;&nbsp;&nbsp;&nbsp;参考程序<a href="http://www.blogjava.net/Files/javagui/nine_grid_demo.rar">这里</a>下载</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;本文只是介绍了九宫格的概念，在实际开发中可能需要对九宫格分解法进行扩展，比如在九宫格的基础上再分解，粒度由你来掌握。演示程序窗口只
是简单地实现了边框和内容窗格的渲染，不能拖拽移动和改变尺寸、没有标题和功能按钮，如果你仔细看还会发现边角没有被抹去，也就是说被有实现圆角窗口，这
些功能会在后续的文章中一一介绍如何实现。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;至于上面所说UI代码一行一行写出来，是有些费事，对于这个问题我的看法是这样的：某些界面是不需要花大力气渲染的，比如说配置界面，没有
哪些客户端要求那种界面也强调很酷的外观，所以对于简单的界面，可以借助工具生成代码，必定工具还是可以帮你做50%的事情。第二就积累一些组件库，比如
自定义一些可重用组件，就像前面介绍的ComboBox和Slider，如果不能完全重用，至少可以将代码作为模板，少许改动就可变成另一套外观风格，研
读前面介绍的ComboBox和Slider你会发现替换里面的图片或颜色常量就可轻松换肤，如果你的UI是基于swing的，那么你可以自定义
L&amp;F来实现基本的外观，关于L&amp;F后面定会花大量时间整理出完整教程。第三就是利用配置的方式将UI组件的生成和布局从.java中移
出来，这样不仅可以省去大部分代码量，而且配置文件简短易读的特点是众所周知的，Java 
Web项目的web.xml就是很好的例子，Spring就更不用说了。配置方式后面也会介绍。第四点，如果你只会VB、VC那种拖拽式开发，那你永远算
不上高手，我曾经用MFC写程序时抱怨过“有那么多按钮却看不见一行CButton声明”，那会使你永远不了解底层是如何实现的，所以我不喜欢那种方式，
如果你有能力，完全可以写一个Framework封装你的UI组件，配置生成的方式就是一例。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;今后还会写大量关于Java GUI方面的帖子，并且会和Sun工程研究院的陈维雷先生合作发布L&amp;F技术贴，他的博客<a href="http://blogs.sun.com/Swing/">http://blogs.sun.com/Swing/</a>想
必大家很熟悉了。虽然当今的web2.0时代人们很少关注C/S应用，但是一些高端应用仍旧采用C/S模式，浏览器这个通用客户端能做的事还很有限。而且
Sun也开始向桌面进军，JDK1.6的进步就能很好地说明这一点，更另人兴奋的是Java桌面技术有添加了一个新成员——JavaFX，又有好消息称
JDK7.0中的AWT将加入不规则窗体和半透明窗体的支持，希望有一天Swing能垄断桌面。
</p><h1>swing专业外观</h1>
<p>http://www.blogjava.net/javagui/archive/2007/11/07/158849.html</p>
<p>前3篇文章使用SWT组件实现了专业外观窗口，现在给出一个swing实现版本。运行的效果如下：<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://hiphotos.baidu.com/hxzon/pic/item/97ca32a8160e03e7ca130cb6.jpg" height="301" width="403"><br>

用Swing实现不足的地方在于顶层窗口，截至到JDK1.6发布，AWT尚未支持不规则矩形窗体和窗口半透明。有好消息称，JDK1.7中将实现。本程
序需要在JDK1.6下编译，因为用了一些新增的API，如果要改成1.6以前版本实现也不难。但是在JRE1.6下运行，性能会明显提高。<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>

源代码<a href="http://www.blogjava.net/Files/javagui/Swing-win-demo.rar">这里</a>下载。</p>
<br>
<pre>package demo.swing;<br><br>import java.awt.Color;<br>import java.awt.Cursor;<br>import java.awt.Dimension;<br>import java.awt.FontMetrics;<br>import java.awt.GradientPaint;<br>import java.awt.Graphics;<br>import java.awt.Graphics2D;<br>import java.awt.Point;<br>import java.awt.event.ActionEvent;<br>import java.awt.event.ActionListener;<br>import java.awt.event.ComponentEvent;<br>import java.awt.event.ComponentListener;<br>import java.awt.event.MouseEvent;<br>import java.awt.event.MouseListener;<br>import java.awt.event.MouseMotionListener;<br><br>import javax.swing.BorderFactory;<br>import javax.swing.Icon;<br>import javax.swing.ImageIcon;<br>import javax.swing.JButton;<br>import javax.swing.JComponent;<br>import javax.swing.JFrame;<br>import javax.swing.JTextField;<br>import javax.swing.SwingUtilities;<br><br>public class DemoWindow extends JFrame implements MouseListener, MouseMotionListener, ComponentListener, ActionListener {<br> private static final long serialVersionUID = 1L;<br><br> private Icon northwestIcon;<br><br> private Icon northeastIcon;<br><br> private Icon northIcon;<br><br> private Icon southwestIcon;<br><br> private Icon southeastIcon;<br><br> private Icon southIcon;<br><br> private Icon westIcon;<br><br> private Icon eastIcon;<br><br> private Icon closeIcon;<br><br> private Icon closeoverIcon;<br><br> private Icon closedownIcon;<br><br> // point<br><br> private Point location;<br><br> private Point size;<br><br> // cursor<br> private Cursor sizeCursor = new Cursor(Cursor.SE_RESIZE_CURSOR);<br><br> private Cursor moveCursor = new Cursor(Cursor.MOVE_CURSOR);<br><br> private Cursor defaultCursor = new Cursor(Cursor.DEFAULT_CURSOR);<br><br> //<br> private ContentPane contentPane;<br><br> private JButton closeButton;<br><br> private JTextField textField;<br><br> // color<br><br> private Color color1 = new Color(254, 254, 254);<br><br> private Color color2 = new Color(204, 220, 247);<br><br> private Color titleColor = new Color(128, 128, 128);<br><br> // title bar<br> private String title;<br><br> private Icon icon;<br><br> /**<br>  * Create the frame<br>  */<br> public DemoWindow() {<br>  super();<br>  setUndecorated(true);<br>  initIcon();<br>  initComponent();<br>  contentPane.addComponentListener(this);<br>  contentPane.addMouseListener(this);<br>  contentPane.addMouseMotionListener(this);<br>  //<br> }<br><br> public void setTitle(String title) {<br>  this.title = title;<br>  contentPane.repaint();<br> }<br><br> public void setIcon(Icon icon) {<br>  this.icon = icon;<br> }<br><br> private void initComponent() {<br>  contentPane = new ContentPane();<br>  setContentPane(contentPane);<br>  closeButton = new JButton();<br>  closeButton.setBorder(BorderFactory.createEmptyBorder());<br>  closeButton.setIcon(closeIcon);<br>  closeButton.setRolloverIcon(closeoverIcon);<br>  closeButton.setPressedIcon(closedownIcon);<br>  closeButton.addActionListener(this);<br>  contentPane.add(closeButton);<br>  textField = new JTextField();<br>  contentPane.add(textField);<br> }<br><br> private void initIcon() {<br>  northwestIcon = new ImageIcon(DemoWindow.class.getResource("northwest.png"));<br>  northeastIcon = new ImageIcon(DemoWindow.class.getResource("northeast.png"));<br>  northIcon = new ImageIcon(DemoWindow.class.getResource("north.png"));<br>  southwestIcon = new ImageIcon(DemoWindow.class.getResource("southwest.png"));<br>  southeastIcon = new ImageIcon(DemoWindow.class.getResource("southeast.png"));<br>  southIcon = new ImageIcon(DemoWindow.class.getResource("south.png"));<br>  westIcon = new ImageIcon(DemoWindow.class.getResource("west.png"));<br>  eastIcon = new ImageIcon(DemoWindow.class.getResource("east.png"));<br>  closeIcon = new ImageIcon(DemoWindow.class.getResource("close.png"));<br>  closeoverIcon = new ImageIcon(DemoWindow.class.getResource("closeover.png"));<br>  closedownIcon = new ImageIcon(DemoWindow.class.getResource("closedown.png"));<br> }<br><br> private class ContentPane extends JComponent {<br>  private static final long serialVersionUID = 1L;<br><br>  @Override<br>  protected void paintComponent(Graphics g) {<br>   int w = getWidth();<br>   int h = getHeight();<br>   northwestIcon.paintIcon(this, g, 0, 0);<br>   northeastIcon.paintIcon(this, g, w - northeastIcon.getIconWidth(), 0);<br>   g.drawImage(((ImageIcon) northIcon).getImage(), northwestIcon.getIconWidth(), 0, w - northeastIcon.getIconWidth(), northIcon.getIconHeight(), 0, 0, northIcon.getIconWidth(),<br>     northIcon.getIconHeight(), this);<br>   southwestIcon.paintIcon(this, g, 0, h - southwestIcon.getIconHeight());<br>   southeastIcon.paintIcon(this, g, w - southeastIcon.getIconWidth(), h - southeastIcon.getIconHeight());<br>   g.drawImage(((ImageIcon) southIcon).getImage(), southwestIcon.getIconWidth(), h - southIcon.getIconHeight(), w - southeastIcon.getIconWidth(), h, 0, 0, southIcon.getIconWidth(),<br>     southIcon.getIconHeight(), this);<br>   g.drawImage(((ImageIcon) westIcon).getImage(), 0, northeastIcon.getIconHeight(), westIcon.getIconWidth(), h - southwestIcon.getIconHeight(), 0, 0, westIcon.getIconWidth(),<br>     westIcon.getIconHeight(), this);<br>   g.drawImage(((ImageIcon) eastIcon).getImage(), w - eastIcon.getIconWidth(), northeastIcon.getIconHeight(), w, h - southeastIcon.getIconHeight(), 0, 0, eastIcon.getIconWidth(),<br>     eastIcon.getIconHeight(), this);<br>   GradientPaint gp = new GradientPaint(0, 0, color1, 0, h - 1, color2);<br>   ((Graphics2D) g).setPaint(gp);<br>   g.fillRect(westIcon.getIconWidth(), northIcon.getIconHeight(), w - westIcon.getIconWidth() - eastIcon.getIconWidth(), h - northIcon.getIconHeight() - southIcon.getIconHeight());<br>   // title<br>   if (title == null) {<br>    title = "";<br>   }<br>   g.setColor(titleColor);<br>   FontMetrics fm = getFontMetrics(getFont());<br>   g.drawString(title, (getWidth() - fm.stringWidth(title)) / 2, northIcon.getIconHeight() / 2 + fm.getHeight() / 4);<br>   if (icon != null) {<br>    icon.paintIcon(contentPane, g, getWidth() / 2 - fm.stringWidth(title) / 2 - icon.getIconWidth() - 10, northIcon.getIconHeight() / 2 - icon.getIconHeight() / 2);<br>   }<br>  }<br> }<br><br> public void mouseClicked(MouseEvent e) {<br><br> }<br><br> public void mouseEntered(MouseEvent e) {<br><br> }<br><br> public void mouseExited(MouseEvent e) {<br><br> }<br><br> public void mousePressed(MouseEvent e) {<br>  int x = e.getX();<br>  int y = e.getY();<br>  int w = contentPane.getWidth();<br>  int h = contentPane.getHeight();<br>  if (x &gt; northwestIcon.getIconWidth() &amp;&amp; x &lt; contentPane.getWidth() - northeastIcon.getIconWidth() &amp;&amp; y &gt; 0 &amp;&amp; y &lt; northIcon.getIconHeight()) {<br>   location = e.getLocationOnScreen();<br>  } else if (x &gt; w - southeastIcon.getIconWidth() &amp;&amp; x &lt; w &amp;&amp; y &gt; h - southeastIcon.getIconHeight() &amp;&amp; y &lt; h) {<br>   size = e.getLocationOnScreen();<br>  }<br><br> }<br><br> public void mouseReleased(MouseEvent e) {<br>  location = null;<br>  if (size != null) {<br>   try {<br>    Point newPoint = e.getLocationOnScreen();<br>    Dimension d = new Dimension(getSize().width + newPoint.x - size.x, getSize().height + newPoint.y - size.y);<br>    if (d.width &gt; 100 &amp;&amp; d.height &gt; 50) {<br>     setSize(d);<br>    }<br>   } finally {<br>    size = null;<br>   }<br>  }<br> }<br><br> public void mouseDragged(MouseEvent e) {<br>  if (location != null) {<br>   Point newPoint = e.getLocationOnScreen();<br>   setLocation(getLocation().x + newPoint.x - location.x, getLocation().y + newPoint.y - location.y);<br>   location = newPoint;<br>  }<br> }<br><br> public void mouseMoved(MouseEvent e) {<br>  int x = e.getX();<br>  int y = e.getY();<br>  int w = contentPane.getWidth();<br>  int h = contentPane.getHeight();<br>  Cursor newCursor = null;<br>  if (x &gt; w - southeastIcon.getIconWidth() &amp;&amp; x &lt; w &amp;&amp; y &gt; h - southeastIcon.getIconHeight() &amp;&amp; y &lt; h) {<br>   newCursor = sizeCursor;<br>  } else if (x &gt; northwestIcon.getIconWidth() &amp;&amp; x &lt; w-northeastIcon.getIconWidth()-30 &amp;&amp; y &gt; 0 &amp;&amp; y &lt; northIcon.getIconHeight()) {<br>   newCursor = moveCursor;<br>  } else {<br>   newCursor = defaultCursor;<br>  }<br>  if (contentPane.getCursor() != newCursor) {<br>   contentPane.setCursor(newCursor);<br>  }<br> }<br><br> //<br> public void componentHidden(ComponentEvent e) {<br><br> }<br><br> public void componentMoved(ComponentEvent e) {<br><br> }<br><br> public void componentResized(ComponentEvent e) {<br>  closeButton.setBounds(contentPane.getWidth() - northeastIcon.getIconWidth() - closeIcon.getIconWidth(), 0, closeIcon.getIconWidth(), closeIcon.getIconHeight());<br>  textField.setBounds(contentPane.getWidth() / 2 - 50, contentPane.getHeight() / 2 - 12, 100, 24);<br> }<br><br> public void componentShown(ComponentEvent e) {<br><br> }<br><br> public void actionPerformed(ActionEvent e) {<br>  dispose();<br> }<br> <br> /**<br>  * Launch the application<br>  * <br>  * @param args<br>  */<br> public static void main(String args[]) {<br>  try {<br>   SwingUtilities.invokeLater(new Runnable() {<br>    public void run() {<br>     DemoWindow win = new DemoWindow();<br>     win.setBounds(100, 100, 400, 300);<br>     win.setTitle("打造专业外观-Swing");<br>     win.setIcon(new ImageIcon(DemoWindow.class.getResource("title.png")));<br>     win.setVisible(true);<br>    }<br>   });<br>  } catch (Exception e) {<br>   e.printStackTrace();<br>  }<br> }<br>}<br> </pre><p>&nbsp;</p>
<p>&nbsp;</p></p></div></body></html>