<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>为什么我喜欢Smalltalk？</title></head><body><h1>为什么我喜欢Smalltalk？</h1><div><p></p><div style="font-family: Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); "><p></p><p>&nbsp;为什么我喜欢Smalltalk？</p><p>&nbsp;<span>本文是从&nbsp;</span><a href="http://pupeno.com/2011/07/28/why-i-love-smalltalk/">Why I love Smalltalk</a><span>&nbsp;这篇文章翻译而来。</span></p><p>&nbsp;<a href="http://www.aqee.net/why-i-love-smalltalk/">http://www.aqee.net/why-i-love-smalltalk/</a></p><p>&nbsp;<span>C，C++，Python等，这些算是传统的语言吧，我从这些语言上学会了基本的编程技术。这之后，又有四种语言，它们让我学到了一些新的东西。这些语言改变了我思考的模式，虽然我从来没有使用过它们，但它们都是绝对值得你学习一下的。它们是：</span></p>Smalltalk<br><p>Lisp<br>Erlang<br>Haskell</p><p>你也许还会把Prolog加入这个列表中，但我没有学过Prolog。本文是关于Smalltalk这种语言的。</p><p>&nbsp;</p><p>我
的目的并不是教大家怎么使用Smalltalk，而是向你展示一些Smalltalk能做到、而其它语言做不到的一些事情(声明：有些语言也能做到，它们
都是Smalltalk的一些方言)。不用说，我需要向你先介绍一下这种语言的一些基本知识，之后我才能向你展示更有价值的东西，那么就开始吧，第一个程
序：</p><p>1 + 1</p><p>很显然，计算的结果是2.如果你想把它存到一个变量里，这样做：</p><p>m := 1 + 1</p><p>句子都要以点号(句号)结尾，像这样：</p><p>m := 1.<br>m := m + 1</p><p>在<a href="http://squeak.org/" style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; vertical-align: baseline; color: rgb(0, 102, 204); ">Squeak</a>——这是Smalltalk语言的一种版本实现——里，有一个对象叫做Transcript，你把消息发送给它，它能把消息显示到屏幕上。它很像一个Log窗口。你要这样去用它：</p><p>Transcript show: 'Hello world'</p><p>运行的效果会是这样：</p><p><img class="aligncenter size-full wp-image-2515" src="http://hiphotos.baidu.com/hxzon/pic/item/7cef45a93ba9b0921f17a2cd.jpg" height="329" width="388"></p><p>Smalltalk的这种语法非常的独特。消息(message)——这在其它语言里也叫做“方法”——是show:&nbsp;(包括冒号)，它接受一个参数。我们用下面的写法可以让这个句子运行10遍：</p><p>10 timesRepeat: [<br>&nbsp; Transcript show: 'Hello world'<br>]</p><p>现在你开始能看出Smalltalk的独特之处了。我把消息timesRepeat:发送到对象“10”——一个Integer类。这N次的循环操作是由这个Integer来执行的，你认真想想，其实很有道理。</p><p>第二个有趣的部分是代码段落(block)，是在方括号里面的部分。你可能认为它跟其他种语言里的代码段落语法是同样的道理，比如Java的：</p><p>for(int i=1; i&lt;11; i++) {<br>&nbsp; System.out.println("Hello world");<br>}</p><p>但你要是从Smalltalk的视角来看，你会发现它强大的多。它实际上是个<a href="http://www.aqee.net/what-is-a-closure/" style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; vertical-align: baseline; color: rgb(0, 102, 204); ">闭包(closure)</a>。看这段：</p><p>t := [<br>&nbsp; Transcript show: 'Hello world'<br>]</p><p>现在，我有了一个叫做t的变量，它的类型是BlockClosure，通过这个变量，我可以做我想做的任何事情。如果我向它发送class消息，它会返回它的class类型：</p><p>t class</p><p>如果我向它发送value消息，它会运行，会在Transcript里留下“Hello World”字符：</p><p>t value</p><p>让我们多看几段程序。一个没有任何参数的消息：</p><p>10 printString</p><p>带有一个参数的消息：</p><p>10 printStringBase: 2</p><p>带有两个参数的消息：</p><p>10 printStringBase: 2 nDigits: 10</p><p>很可爱，不是吗？这个方法叫做printStringBase:nDigits:。我没在其它地方见过这样的语法；只有Objective-C是个例外，因为它是从Smalltalk承袭过来的。</p><p>小玩意已经说的不少了，现在说点复杂点儿的东西。我们来创建一个类：</p><p>Object subclass: #MyClass<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instanceVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; classVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; poolDictionaries: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; category: 'Pupeno'</p><p>注意，一个类的创建是通过向其它类发送消息—包括名字和一些参数，告诉它我要继承它。这是一个消息，跟其它类型的方法调用一样。对象是类，类也是对象。Smalltalk的对象模式非常的优雅，但这是另外一个 话题。</p><p>现在我们有了一个类，我们来创建一个方法，叫做greet：就在这个类里。</p><p>greet: name<br>&nbsp; "Greets the&nbsp;user named name"</p><p>&nbsp; | message |</p><p>&nbsp; message := 'Hello ', name.<br>&nbsp; Transcript show: message.</p><p>在方法定义里，首先我们给这个方法加了一个注释，然后是管道 (“|”)包着的本地变量，然后是方法的实现，我把”Hello“放到了变量message里，然后用逗号符把它和变量name连接起来。然后我把它发送到Transcript里。</p><p>运行起来的结果像这样：</p><p><img class="aligncenter size-full wp-image-2523" src="http://hiphotos.baidu.com/hxzon/pic/item/8d890ff7672ee74c730eecf2.jpg" height="372" width="589"></p><p>好了，我们来用一用它：</p><p>m := MyClass new.<br>m greet: 'Pupeno'</p><p>为了创建一个类MyClass的对象，我们向这个类发送new消息。这个new并不是像Java里的关键字。new是一个方法。你可以看它的源代码，覆盖它，等等。不要动它，除非你十分清楚你在做什么。</p><p>事实上，如果你想一下，你会发现我们没有看到任何的关键字。看看我们写过的这些代码，没有什么要记住的关键字！更重要的，目前为止，你已经基本的认识Smalltalk了。Smalltalk就是这些，但就像是一个小积木块，这些小块能让你搭建出你想要的任何东西。</p><p>不错，就这些，我要说的就这些。我们看到了，Smalltalk里没有循环，它有整数类，这个类里实现了timesRepeat:消息，可以用来把事情重复执行N次。像这样用于循环操作的方法到处都是。</p><p>你会问，有没有if这个关键字？Smalltalk里肯定有一个if关键字，不是吗？不，没有。你所谓的if语法在Smalltalk里可以用你刚才看到的类和消息传递的机制实现。为了好玩，我们来实现一个。</p><p>我们从创建一个PBoolean类开始，然后两个继承它的类——PTrue&nbsp;和&nbsp;PFalse。</p><p>Object subclass: #PBoolean<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instanceVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; classVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; poolDictionaries: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; category: 'Pupeno'</p><p>PBoolean subclass: #PTrue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instanceVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; classVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; poolDictionaries: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; category: 'Pupeno'</p><p>PBoolean subclass: #PFalse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instanceVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; classVariableNames: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; poolDictionaries: ''<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; category: 'Pupeno'</p><p>我们之前创建了一个类，MyClass，我们要给它定义一个equals:方法，它能返回true和false，也就是我们的PTrue&nbsp;和&nbsp;PFalse。</p><p>equals: other<br>&nbsp; ^ PTrue new</p><p>这个小帽子，^，是返回的意思。我写的是硬编码让它返回true。现在我们可以在程序来用它了：</p><p>m1 := MyClass new.<br>m2 := MyClass new.<br>m1 equals: m2</p><p>得到的是true。我们已经接近目标了，但还不是if。if应该是个什么样子？它的样子应该是这样：</p><p>m1 := MyClass new.<br>m2 := MyClass new.<br>(m1 equals: m2) ifTrue: [<br>&nbsp; Transcript show: 'They are equal'; cr<br>] else: [<br>&nbsp; Transcript show: 'They are false'; cr<br>]</p><p>估计你在想，怎么才能实现这样的效果。我在PTrue里加入了一个方法：</p><p>ifTrue: do else: notdo<br>&nbsp; ^ do value</p><p>这个方法看上去是接受2个参数，但执行时接受第一个，忽略第二个。对于PFalse，正好相反：</p><p>ifTrue: notdo else: do<br>&nbsp; ^ do value</p><p>这就可以了。一个可以用的if！如果让我说，我觉得这真的很神奇。如果你去检查Squeak了的代码，你会发现它里面的if就是这样实现的：</p><p><img class="aligncenter size-full wp-image-2531" src="http://hiphotos.baidu.com/hxzon/pic/item/88038426757361798b82a1cd.jpg" height="407" width="609"></p><p>&nbsp;</p><p>&nbsp;</p><p></p></div><p></p><p></p></div></body></html>