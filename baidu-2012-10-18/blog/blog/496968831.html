<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Tapestry 5.3+ New Features : Part 2</title></head><body><h1>Tapestry 5.3+ New Features : Part 2</h1><div><h1>Tapestry 5.3+ New Features : Part 2</h1><p></p><p><a href="http://tawus.wordpress.com/2011/10/01/tapestry-5-3-new-features-part-2/" target="_blank">http://tawus.wordpress.com/2011/10/01/tapestry-5-3-new-features-part-2/</a></p><p>POSTED BY&nbsp;<a href="http://vqqx.com/browse.php?u=f6cd194e3bb2Oi8vdGF3dXMud29yZHByZXNzLmNvbS9hdXRob3IvdGF3dXMv&amp;b=1" rel="author" target="_blank" title="Posts by tawus">TAWUS</a>&nbsp;&nbsp;&nbsp;OCTOBER 1, 2011</p><p></p><h2>AjaxResponseRender</h2><p>This is one of the most useful feature of Tapestry 5.3. There is already a concept of Zone in&nbsp;<a href="http://vqqx.com/browse.php?u=f6cd194e3bb2Oi8vdGFwZXN0cnkuYXBhY2hlLm9yZw%3D%3D&amp;b=1" target="_blank">Tapestry</a>&nbsp;for Ajax but now it is complimented byAjaxResponseRenderer. This fills a lot of gaps at least for people coming from&nbsp;<a href="http://vqqx.com/browse.php?u=f6cd194e3bb2Oi8vd2lja2V0LmFwYWNoZS5vcmc%3D&amp;b=1" target="_blank">Wicket</a>. It is a bit similar to AjaxRequestTarget but empowered with Zones and JSON. I have compiled a small example demonstrating most of the features.<br /><br />Please Note : This is only a demonstration of how AjaxResponseRenderer is used. Obviously you should always prefer the&nbsp;‘Zone way’&nbsp;of doing things. Only when you need a combination of zone updates(multiple), small JavaScript callbacks and JSON callbacks, you can use this service. Also when you want to do different things(explained below) in different event handlers (may be belonging to different components), this service can be of great help.</p><p></p><p>@Import(library = &quot;testJSON.js&quot;)<br />public class NewAjax {<br />&nbsp;&nbsp;&nbsp; @Inject<br />&nbsp;&nbsp;&nbsp; private AjaxResponseRenderer ajaxResponseRenderer;</p><p>&nbsp;&nbsp;&nbsp; @InjectComponent<br />&nbsp;&nbsp;&nbsp; private Zone topZone;</p><p>&nbsp;&nbsp;&nbsp; @InjectComponent<br />&nbsp;&nbsp;&nbsp; private Zone bottomZone;</p><p>&nbsp;&nbsp;&nbsp; @Inject<br />&nbsp;&nbsp;&nbsp; private JavaScriptSupport javaScriptSupport;</p><p>&nbsp;&nbsp;&nbsp; @InjectComponent<br />&nbsp;&nbsp;&nbsp; private EventLink jsonCallbackLink;</p><p>&nbsp;&nbsp;&nbsp; @Inject<br />&nbsp;&nbsp;&nbsp; private Messages messages;</p><p>&nbsp;&nbsp;&nbsp; @AfterRender<br />&nbsp;&nbsp;&nbsp; void addJavaScript(){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; javaScriptSupport.addInitializerCall(&quot;testJSON&quot;, jsonCallbackLink.getClientId());<br />&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp; @OnEvent(&quot;serverAlert&quot;)<br />&nbsp;&nbsp;&nbsp; void showAlert() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ajaxResponseRenderer.addCallback(new JavaScriptCallback() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void run(JavaScriptSupport javascriptSupport) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; javascriptSupport.addScript(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String.format(&quot;alert('%s');&quot;, messages.get(&quot;server.hello&quot;)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp; @OnEvent(&quot;sendJSON&quot;)<br />&nbsp;&nbsp;&nbsp; void sendJSON() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ajaxResponseRenderer.addCallback(new JSONCallback() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void run(JSONObject reply) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reply.put(&quot;message&quot;, messages.get(&quot;server.message&quot;));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp; @OnEvent(&quot;multipleZoneUpdate&quot;)<br />&nbsp;&nbsp;&nbsp; void showZones() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ajaxResponseRenderer.addRender(&quot;topZone&quot;, topZone).<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addRender(&quot;bottomZone&quot;, bottomZone);<br />&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp; public Date getDate() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new Date();<br />&nbsp;&nbsp;&nbsp; }</p><p>}</p><p></p><p></p><p></p><p>&lt;html xmlns:t='<br />&nbsp;&nbsp;&nbsp; &lt;head&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;New Ajax Features&lt;/title&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/head&gt;</p><p>&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div t:type='zone' t:id='topZone'&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Zone ${date}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a href='#' t:type='eventLink'&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t:event='multipleZoneUpdate' t:zone='topZone' t:id='multipleZoneLink'&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Multiple Zone Update<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/a&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div t:type='zone' t:id='bottomZone'&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bottom Zone ${date}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;br/&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a t:type='eventLink' t:zone='topZone'&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t:id='javaScriptCallbackLink' t:event='serverAlert'&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Show Feedback alert<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/a&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;br/&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a t:type='eventLink' t:id='jsonCallbackLink' t:event='sendJSON'&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get alert message from server!<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/a&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p><p></p><p>Tapestry.Initializer.testJSON = function(elementId){<br />&nbsp;&nbsp;&nbsp; $(elementId).observe(&quot;click&quot;, function(event){</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tapestry.ajaxRequest($(elementId).href, function(response){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(response.responseJSON.message);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; event.preventDefault();<br />&nbsp;&nbsp;&nbsp; });<br />};</p><p></p><p></p><p>server.hello=Hello from Server!<br />server.message=Message from Server!!</p><p></p><h3>For Multiple Zone Update</h3><p>Instead of using MultiZoneUpdate, you can use AjaxRequestRenderer. The advantage is that it is now a service. You can call it from multiple event handlers present in different components handling the same event. Or imagine an event handler in a component which triggers another event that is handled by the container component. Now the component can add its internal zone and then trigger an event to which the container can respond by adding its own zone!!.</p><h3>Using JavaScript callback</h3><p>You can now do something on server-side and return an alert message !!</p><h3>Using JSON callback</h3><p>You can send a JSON response in addition to updating multiple zones !!</p><h1></h1><p></p></div></body></html>