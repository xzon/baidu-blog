<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>(ms sql server)sql语句导入导出大全--详解</title></head><body><h1>(ms sql server)sql语句导入导出大全--详解</h1><div><div>
<p>(ms sql server)sql语句导入导出大全--详解</p>
<p><br>
******* 导出到excel <br>
exec master..xp_cmdshell &rsquo;bcp settledb.dbo.shanghu out c:\temp1.xls -c -q -s&quot;gnetdata/gnetdata&quot; -u&quot;sa&quot; -p&quot;&quot;&rsquo;</p>
</div>
<div> </div>
<div>/*********** 导入excel</div>
<div> </div>
<div>select * <br>
from opendatasource( &rsquo;microsoft.jet.oledb.4.0&rsquo;, <br>
&rsquo;data source=&quot;c:\test.xls&quot;;user id=admin;password=;extended properties=excel 5.0&rsquo;)...xactions</div>
<div> </div>
<div>select cast(cast(科目编号 as numeric(10,2)) as nvarchar(255))+&rsquo;　&rsquo; 转换后的别名 <br>
from opendatasource( &rsquo;microsoft.jet.oledb.4.0&rsquo;, <br>
&rsquo;data source=&quot;c:\test.xls&quot;;user id=admin;password=;extended properties=excel 5.0&rsquo;)...xactions</div>
<div> </div>
<div>/** 导入文本文件</div>
<div> </div>
<div>exec master..xp_cmdshell &rsquo;bcp &quot;dbname..tablename&quot; in c:\dt.txt -c -sservername -usa -ppassword&rsquo;</div>
<div> </div>
<div>/** 导出文本文件</div>
<div> </div>
<div>exec master..xp_cmdshell &rsquo;bcp &quot;dbname..tablename&quot; out c:\dt.txt -c -sservername -usa -ppassword&rsquo;</div>
<div> </div>
<div>或</div>
<div> </div>
<div>exec master..xp_cmdshell &rsquo;bcp &quot;select * from dbname..tablename&quot; queryout c:\dt.txt -c -sservername -usa -ppassword&rsquo;</div>
<div> </div>
<div>导出到txt文本，用逗号分开</div>
<div> </div>
<div>exec master..xp_cmdshell &rsquo;bcp &quot;库名..表名&quot; out &quot;d:\tt.txt&quot; -c -t ,-u sa -p password&rsquo;</div>
<div> </div>
<div>bulk insert 库名..表名 <br>
from &rsquo;c:\test.txt&rsquo; <br>
with ( <br>
&nbsp;&nbsp;&nbsp;  fieldterminator = &rsquo;;&rsquo;, <br>
&nbsp;&nbsp;&nbsp;  rowterminator = &rsquo;\n&rsquo; <br>
)</div>
<div> </div>
<div>--/* dbase iv文件 <br>
select * from <br>
openrowset(&rsquo;microsoft.jet.oledb.4.0&rsquo; <br>
,&rsquo;dbase iv;hdr=no;imex=2;database=c:\&rsquo;,&rsquo;select * from &rsquo;) <br>
--*/</div>
<div> </div>
<div>--/* dbase iii文件 <br>
select * from <br>
openrowset(&rsquo;microsoft.jet.oledb.4.0&rsquo; <br>
,&rsquo;dbase iii;hdr=no;imex=2;database=c:\&rsquo;,&rsquo;select * from &rsquo;) <br>
--*/</div>
<div> </div>
<div>--/* foxpro &lt;a class=&quot;vLink1&quot; id=&quot;vad_10&quot; onmouseover=&quot;if(typeof(showTitle)!='undefined'){this.title='';window.clearTimeout(hideTO);showTitle(event, this, 10,'');}&quot; title=&quot;北京企业名录大全 @Vogate.com&quot; style=&quot;font-size: 1em&quot; onclick=&quot;&quot; onmouseout=&quot;if(typeof(showTitle)!='undefined'){mouseIsOverLayer = false; mouseOverWhileLoad = false; hideTO = window.setTimeout('checkIfMouseOverLayer()',500);}&quot; href=&quot;&lt;a href=&quot;http://action.vogate.com/click/click.php?r=http%3A//www.baidu.com/s%3Flm%3D0%26si%3D%26rn%3D10%26ie%3Dgb2312%26ct%3D0%26wd%3D%25CF%25B5%25CD%25B3%25B4%25A5%25B7%25A2%25D0%25DE%25B8%25C4sqlserver%25CA%25FD%25BE%25DD%26pn%3D10%26ver%3D0%26cn%3Dbaidu06%26cl%3D3&amp;ads_id=4546&amp;site_id=6235007045037850&amp;click=1&amp;url=http%3A//www.febay.com.cn/fyp/bj/%7C%u514D%u8D39%u4E3A%u60A8%u63D0%u4F9B%u5728%u7EBF%u5317%u4EAC%u540D%u5F55%u67E5%u8BE2%21%21%3Bhttp%3A//www.febay.com.cn/fyp/gd/%7C%u5E7F%u4E1C%u7701%u4F01%u4E1A%u9EC4%u9875%u5BFC%u822A%2C%u6D77%u91CF%u514D%u8D39%3Bhttp%3A//www.febay.com.cn/fyp/js/%7C%u6D77%u91CF%u5BFC%u822A%2C%u6C5F%u82CF%u7701%u4F01%u4E1A%u540D%u5F55%u4E0B%u8F7D%21%3Bhttp%3A//www.febay.com.cn/fyp/sh/%7C%u4E0A%u6D77%u4F01%u4E1A%u5927%u5168%2C%u5728%u7EBF%u67E5%u8BE2%2C%u591A%u8054%u7CFB%u4EBA%21%3Bhttp%3A//www.febay.com.cn/fyp/sh/%7C1300%u4E07%u4F01%u4E1A%u9EC4%u9875%u5BFC%u822A%2C%u627E%u5230%u51C6%u5BA2%u6237&amp;v=0&amp;k=%u6570%u636E&amp;s=http%3A//www.readygo.com.cn/SQLServer/070129/180026fB4V.htm&amp;rn=238058&quot;&gt;http://action.vogate.com/click/click.php?r=http%3A//www.baidu.com/s%3Flm%3D0%26si%3D%26rn%3D10%26ie%3Dgb2312%26ct%3D0%26wd%3D%25CF%25B5%25CD%25B3%25B4%25A5%25B7%25A2%25D0%25DE%25B8%25C4sqlserver%25CA%25FD%25BE%25DD%26pn%3D10%26ver%3D0%26cn%3Dbaidu06%26cl%3D3&amp;ads_id=4546&amp;site_id=6235007045037850&amp;click=1&amp;url=http%3A//www.febay.com.cn/fyp/bj/%7C%u514D%u8D39%u4E3A%u60A8%u63D0%u4F9B%u5728%u7EBF%u5317%u4EAC%u540D%u5F55%u67E5%u8BE2%21%21%3Bhttp%3A//www.febay.com.cn/fyp/gd/%7C%u5E7F%u4E1C%u7701%u4F01%u4E1A%u9EC4%u9875%u5BFC%u822A%2C%u6D77%u91CF%u514D%u8D39%3Bhttp%3A//www.febay.com.cn/fyp/js/%7C%u6D77%u91CF%u5BFC%u822A%2C%u6C5F%u82CF%u7701%u4F01%u4E1A%u540D%u5F55%u4E0B%u8F7D%21%3Bhttp%3A//www.febay.com.cn/fyp/sh/%7C%u4E0A%u6D77%u4F01%u4E1A%u5927%u5168%2C%u5728%u7EBF%u67E5%u8BE2%2C%u591A%u8054%u7CFB%u4EBA%21%3Bhttp%3A//www.febay.com.cn/fyp/sh/%7C1300%u4E07%u4F01%u4E1A%u9EC4%u9875%u5BFC%u822A%2C%u627E%u5230%u51C6%u5BA2%u6237&amp;v=0&amp;k=%u6570%u636E&amp;s=http%3A//www.readygo.com.cn/SQLServer/070129/180026fB4V.htm&amp;rn=238058&quot; target=&quot;_blank&quot;&gt;数据库 <br>
select * from openrowset(&rsquo;msdasql&rsquo;, <br>
&rsquo;driver=microsoft visual foxpro driver;sourcetype=dbf;sourcedb=c:\&rsquo;, <br>
&rsquo;select * from &rsquo;) <br>
--*/</div>
<div> </div>
<div>/**************导入dbf文件****************/ <br>
select * from openrowset(&rsquo;msdasql&rsquo;, <br>
&rsquo;driver=microsoft visual foxpro driver; <br>
sourcedb=e:\vfp98\data; <br>
sourcetype=dbf&rsquo;, <br>
&rsquo;select * from customer where country != &quot;usa&quot; order by country&rsquo;) <br>
go <br>
/***************** 导出到dbf ***************/ <br>
如果要导出数据到已经生成结构(即现存的)foxpro表中,&lt;a class=&quot;vLink1&quot; id=&quot;vad_2&quot; onmouseover=&quot;if(typeof(showTitle)!='undefined'){this.title='';window.clearTimeout(hideTO);showTitle(event, this, 2,'');}&quot; title=&quot;上海市东亚进修学院培训系列 @Vogate.com&quot; style=&quot;font-size: 1em&quot; onclick=&quot;&quot; onmouseout=&quot;if(typeof(showTitle)!='undefined'){mouseIsOverLayer = false; mouseOverWhileLoad = false; hideTO = window.setTimeout('checkIfMouseOverLayer()',500);}&quot; href=&quot;&lt;a href=&quot;http://action.vogate.com/click/click.php?r=http%3A//www.baidu.com/s%3Flm%3D0%26si%3D%26rn%3D10%26ie%3Dgb2312%26ct%3D0%26wd%3D%25CF%25B5%25CD%25B3%25B4%25A5%25B7%25A2%25D0%25DE%25B8%25C4sqlserver%25CA%25FD%25BE%25DD%26pn%3D10%26ver%3D0%26cn%3Dbaidu06%26cl%3D3&amp;ads_id=4715&amp;site_id=6235007045037850&amp;click=1&amp;url=http%3A//www.dy001.com/details.asp%3Fid%3D16%26id2%3D373%7C%u653F%u5E9C%u514D%u8D39%u57F9%u8BAD%uFF1A%u8425%u517B%u6307%u5BFC%u5E08%u4E2D%u7EA7%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D16%26id2%3D376%7C%u5916%u6765%u52A1%u5DE5%u4EBA%u5458%u514D%u8D39%u57F9%u8BAD%u7CFB%u5217%3Bhttp%3A//www.dy001.com/category.asp%3Fid%3D17%7C%u4F1A%u8BA1%u4E0A%u5C97%u8BC1%u3001%u7535%u7B97%u5316%u3001%u4F1A%u8BA1%u804C%u79F0%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D21%26id2%3D377%7C%u5916%u8D38%u7C7B%u8003%u8BC1%uFF1A%u5355%u8BC1%u3001%u62A5%u5173%u5458%u3001%u8D27%u4EE3%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D1%26id2%3D372%7C%u4E1C%u4E9A%u5B66%u9662%u62DB%u8058%u4EBA%u624D&amp;v=0&amp;k=%u53EF%u4EE5&amp;s=http%3A//www.readygo.com.cn/SQLServer/070129/180026fB4V.htm&amp;rn=558805&quot;&gt;http://action.vogate.com/click/click.php?r=http%3A//www.baidu.com/s%3Flm%3D0%26si%3D%26rn%3D10%26ie%3Dgb2312%26ct%3D0%26wd%3D%25CF%25B5%25CD%25B3%25B4%25A5%25B7%25A2%25D0%25DE%25B8%25C4sqlserver%25CA%25FD%25BE%25DD%26pn%3D10%26ver%3D0%26cn%3Dbaidu06%26cl%3D3&amp;ads_id=4715&amp;site_id=6235007045037850&amp;click=1&amp;url=http%3A//www.dy001.com/details.asp%3Fid%3D16%26id2%3D373%7C%u653F%u5E9C%u514D%u8D39%u57F9%u8BAD%uFF1A%u8425%u517B%u6307%u5BFC%u5E08%u4E2D%u7EA7%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D16%26id2%3D376%7C%u5916%u6765%u52A1%u5DE5%u4EBA%u5458%u514D%u8D39%u57F9%u8BAD%u7CFB%u5217%3Bhttp%3A//www.dy001.com/category.asp%3Fid%3D17%7C%u4F1A%u8BA1%u4E0A%u5C97%u8BC1%u3001%u7535%u7B97%u5316%u3001%u4F1A%u8BA1%u804C%u79F0%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D21%26id2%3D377%7C%u5916%u8D38%u7C7B%u8003%u8BC1%uFF1A%u5355%u8BC1%u3001%u62A5%u5173%u5458%u3001%u8D27%u4EE3%3Bhttp%3A//www.dy001.com/details.asp%3Fid%3D1%26id2%3D372%7C%u4E1C%u4E9A%u5B66%u9662%u62DB%u8058%u4EBA%u624D&amp;v=0&amp;k=%u53EF%u4EE5&amp;s=http%3A//www.readygo.com.cn/SQLServer/070129/180026fB4V.htm&amp;rn=558805&quot; target=&quot;_blank&quot;&gt;可以直接用下面的sql语句</div>
<div> </div>
<div>insert into openrowset(&rsquo;msdasql&rsquo;, <br>
&rsquo;driver=microsoft visual foxpro driver;sourcetype=dbf;sourcedb=c:\&rsquo;, <br>
&rsquo;select * from &rsquo;) <br>
select * from 表</div>
<div> </div>
<div>说明: <br>
sourcedb=c:\ 指定foxpro表所在的文件夹 <br>
aa.dbf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  指定foxpro表的文件名.</div>
<div> </div>
<div>/*************导出到access********************/ <br>
insert into openrowset(&rsquo;microsoft.jet.oledb.4.0&rsquo;, <br>
&nbsp;&nbsp;  &rsquo;x:\a.mdb&rsquo;;&rsquo;admin&rsquo;;&rsquo;&rsquo;,a表) select * from 数据库名..b表</div>
<div> </div>
<div>/*************导入access********************/ <br>
insert into b表 selet * from openrowset(&rsquo;microsoft.jet.oledb.4.0&rsquo;, <br>
&nbsp;&nbsp;  &rsquo;x:\a.mdb&rsquo;;&rsquo;admin&rsquo;;&rsquo;&rsquo;,a表)</div>
<div> </div>
<div>********************* 导入 xml　文件</div>
<div> </div>
<div>declare @idoc int <br>
declare @doc varchar(1000) <br>
--sample xml document <br>
set @doc =&rsquo; <br>
&lt;root&gt; <br>
&lt;customer cid= &quot;c1&quot; name=&quot;janine&quot; city=&quot;issaquah&quot;&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;order oid=&quot;o1&quot; date=&quot;1/20/1996&quot; amount=&quot;3.5&quot; /&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;order oid=&quot;o2&quot; date=&quot;4/30/1997&quot; amount=&quot;13.4&quot;&gt;customer was very satisfied <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/order&gt; <br>
&nbsp;&nbsp;  &lt;/customer&gt; <br>
&nbsp;&nbsp;  &lt;customer cid=&quot;c2&quot; name=&quot;ursula&quot; city=&quot;oelde&quot; &gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;order oid=&quot;o3&quot; date=&quot;7/14/1999&quot; amount=&quot;100&quot; note=&quot;wrap it blue <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  white red&quot;&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;urgency&gt;important&lt;/urgency&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  happy customer. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/order&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;order oid=&quot;o4&quot; date=&quot;1/20/1996&quot; amount=&quot;10000&quot;/&gt; <br>
&nbsp;&nbsp;  &lt;/customer&gt; <br>
&lt;/root&gt; <br>
&rsquo; <br>
-- create an internal representation of the xml document. <br>
exec sp_xml_preparedocument @idoc output, @doc</div>
<div> </div>
<div>-- execute a select statement using openxml rowset provider. <br>
select * <br>
from openxml (@idoc, &rsquo;/root/customer/order&rsquo;, 1) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  with (oid&nbsp;&nbsp;&nbsp;&nbsp;  char(5), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  amount float, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  comment ntext &rsquo;text()&rsquo;) <br>
exec sp_xml_removedocument @idoc</div>
<div> </div>
<div><br>
/********************导整个数据库*********************************************/</div>
<div> </div>
<div>用bcp实现的存储过程</div>
<div> </div>
<div><br>
/* <br>
实现数据导入/导出的存储过程 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  根据不同的参数,可以实现导入/导出整个数据库/单个表 <br>
调用示例: <br>
--导出调用示例 <br>
----导出单个表 <br>
exec file2table &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;xzkh_sa..地区资料&rsquo;,&rsquo;c:\zj.txt&rsquo;,1 <br>
----导出整个数据库 <br>
exec file2table &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;xzkh_sa&rsquo;,&rsquo;c:\docman&rsquo;,1</div>
<div> </div>
<div>--导入调用示例 <br>
----导入单个表 <br>
exec file2table &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;xzkh_sa..地区资料&rsquo;,&rsquo;c:\zj.txt&rsquo;,0 <br>
----导入整个数据库 <br>
exec file2table &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;xzkh_sa&rsquo;,&rsquo;c:\docman&rsquo;,0</div>
<div> </div>
<div>*/</div>
<div> </div>
<div>if exists(select 1 from sysobjects where name=&rsquo;file2table&rsquo; and objectproperty(id,&rsquo;isprocedure&rsquo;)=1) <br>
drop procedure file2table <br>
go <br>
create procedure file2table <br>
@servername varchar(200) --服务器名 <br>
,@username varchar(200)&nbsp;&nbsp;  --用户名,如果用nt验证方式,则为空&rsquo;&rsquo; <br>
,@password varchar(200)&nbsp;&nbsp;  --密码 <br>
,@tbname varchar(500)&nbsp;&nbsp;  --数据库.dbo.表名,如果不指定:.dbo.表名,则导出数据库的所有用户表 <br>
,@filename varchar(1000) --导入/导出路径/文件名,如果@tbname参数指明是导出整个数据库,则这个参数是文件存放路径,文件名自动用表名.txt <br>
,@isout bit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  --1为导出,0为导入 <br>
as <br>
declare @sql varchar(8000)</div>
<div> </div>
<div>if @tbname like &rsquo;%.%.%&rsquo; --如果指定了表名,则直接导出单个表 <br>
begin <br>
set @sql=&rsquo;bcp <a href="mailto:&rsquo;+@tbname">&rsquo;+@tbname</a> <br>
+case when @isout=1 then &rsquo; out &rsquo; else &rsquo; in &rsquo; end <br>
+&rsquo; &quot;<a href="mailto:&rsquo;+@filename+&rsquo;">&rsquo;+@filename+&rsquo;</a>&quot; /w&rsquo; <br>
+&rsquo; /s <a href="mailto:&rsquo;+@servername">&rsquo;+@servername</a> <br>
+case when isnull(@username,&rsquo;&rsquo;)=&rsquo;&rsquo; then &rsquo;&rsquo; else &rsquo; /u <a href="mailto:&rsquo;+@username">&rsquo;+@username</a> end <br>
+&rsquo; /p &rsquo;+isnull(@password,&rsquo;&rsquo;) <br>
exec master..xp_cmdshell @sql <br>
end <br>
else <br>
begin --导出整个数据库,定义游标,取出所有的用户表 <br>
declare @m_tbname varchar(250) <br>
if right(@filename,1)&lt;&gt;&rsquo;\&rsquo; set @filename=@filename+&rsquo;\&rsquo;</div>
<div> </div>
<div>set @m_tbname=&rsquo;declare #tb cursor for select name from <a href="mailto:&rsquo;+@tbname+&rsquo;..sysobjects">&rsquo;+@tbname+&rsquo;..sysobjects</a> where xtype=&rsquo;&rsquo;u&rsquo;&rsquo;&rsquo; <br>
exec(@m_tbname) <br>
open #tb <br>
fetch next from #tb into @m_tbname <br>
while @@fetch_status=0 <br>
begin <br>
set @sql=&rsquo;bcp <a href="mailto:&rsquo;+@tbname+&rsquo;..&rsquo;+@m_tbname">&rsquo;+@tbname+&rsquo;..&rsquo;+@m_tbname</a> <br>
&nbsp;&nbsp;  +case when @isout=1 then &rsquo; out &rsquo; else &rsquo; in &rsquo; end <br>
&nbsp;&nbsp;  +&rsquo; &quot;<a href="mailto:&rsquo;+@filename+@m_tbname+&rsquo;.txt">&rsquo;+@filename+@m_tbname+&rsquo;.txt</a> &quot; /w&rsquo; <br>
&nbsp;&nbsp;  +&rsquo; /s <a href="mailto:&rsquo;+@servername">&rsquo;+@servername</a> <br>
&nbsp;&nbsp;  +case when isnull(@username,&rsquo;&rsquo;)=&rsquo;&rsquo; then &rsquo;&rsquo; else &rsquo; /u <a href="mailto:&rsquo;+@username">&rsquo;+@username</a> end <br>
&nbsp;&nbsp;  +&rsquo; /p &rsquo;+isnull(@password,&rsquo;&rsquo;) <br>
exec master..xp_cmdshell @sql <br>
fetch next from #tb into @m_tbname <br>
end <br>
close #tb <br>
deallocate #tb <br>
end <br>
go</div>
<div> </div>
<div><br>
/**********************excel导到txt****************************************/ <br>
想用 <br>
select * into opendatasource(...) from opendatasource(...) <br>
实现将一个excel文件内容导入到一个文本文件</div>
<div> </div>
<div>假设excel中有两列，第一列为姓名，第二列为很行帐号(16位) <br>
且银行帐号导出到文本文件后分两部分，前8位和后8位分开。</div>
<div> </div>
<div><br>
如果要用你上面的语句插入的话,文本文件必须存在,而且有一行:姓名,银行账号1,银行账号2 <br>
然后就可以用下面的语句进行插入 <br>
注意文件名和目录根据你的实际情况进行修改.</div>
<div> </div>
<div><br>
insert into <br>
opendatasource(&rsquo;microsoft.jet.oledb.4.0&rsquo; <br>
,&rsquo;text;hdr=yes;database=c:\&rsquo; <br>
)... <br>
--,aa#txt) <br>
--*/ <br>
select 姓名,银行账号1=left(银行账号,8),银行账号2=right(银行账号,8) <br>
from <br>
opendatasource(&rsquo;microsoft.jet.oledb.4.0&rsquo; <br>
,&rsquo;excel 5.0;hdr=yes;imex=2;database=c:\a.xls&rsquo; <br>
--,sheet1$) <br>
)...</div>
<div> </div>
<div>如果你想直接插入并生成文本文件,就要用bcp</div>
<div> </div>
<div>declare @sql varchar(8000),@tbname varchar(50)</div>
<div> </div>
<div>--首先将excel表内容导入到一个全局临时表 <br>
select @tbname=&rsquo;&rsquo; <br>
,@sql=&rsquo;select 姓名,银行账号1=left(银行账号,8),银行账号2=right(银行账号,8) <br>
into <a href="mailto:&rsquo;+@tbname+&rsquo;">&rsquo;+@tbname+&rsquo;</a> from <br>
opendatasource(&rsquo;&rsquo;microsoft.jet.oledb.4.0&rsquo;&rsquo; <br>
,&rsquo;&rsquo;excel 5.0;hdr=yes;imex=2;database=c:\a.xls&rsquo;&rsquo; <br>
)...&rsquo; <br>
exec(@sql)</div>
<div> </div>
<div>--然后用bcp从全局临时表导出到文本文件 <br>
set @sql=&rsquo;bcp &quot;<a href="mailto:&rsquo;+@tbname+&rsquo;">&rsquo;+@tbname+&rsquo;</a>&quot; out &quot;c:\aa.txt&quot; /s&quot;(local)&quot; /p&quot;&quot; /c&rsquo; <br>
exec master..xp_cmdshell @sql</div>
<div> </div>
<div>--删除临时表 <br>
exec(&rsquo;drop table <a href="mailto:&rsquo;+@tbname">&rsquo;+@tbname</a>)</div>
<div> </div>
<div><br>
用bcp将文件导入导出到数据库的存储过程:</div>
<div> </div>
<div><br>
/*--bcp-二进制文件的导入导出</div>
<div> </div>
<div>支持image,text,ntext字段的导入/导出 <br>
image适合于二进制文件;text,ntext适合于文本数据文件</div>
<div> </div>
<div>注意:导入时,将覆盖满足条件的所有行 <br>
导出时,将把所有满足条件的行也出到指定文件中</div>
<div> </div>
<div>此存储过程仅用bcp实现 <br>
邹建 2003.08-----------------*/</div>
<div> </div>
<div>/*--调用示例 <br>
--数据导出 <br>
exec p_binaryio &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;acc_演示数据..tb&rsquo;,&rsquo;img&rsquo;,&rsquo;c:\zj1.dat&rsquo;</div>
<div> </div>
<div>--数据导出 <br>
exec p_binaryio &rsquo;zj&rsquo;,&rsquo;&rsquo;,&rsquo;&rsquo;,&rsquo;acc_演示数据..tb&rsquo;,&rsquo;img&rsquo;,&rsquo;c:\zj1.dat&rsquo;,&rsquo;&rsquo;,0 <br>
--*/ <br>
if exists (select * from dbo.sysobjects where id = object_id(n&rsquo;.&rsquo;) and objectproperty(id, n&rsquo;isprocedure&rsquo;) = 1) <br>
drop procedure . <br>
go</div>
<div> </div>
<div>create proc p_binaryio <br>
@servename varchar (30),--服务器名称 <br>
@username varchar (30), --用户名 <br>
@password varchar (30), --密码 <br>
@tbname varchar (500), --数据库..表名 <br>
@fdname varchar (30), --字段名 <br>
@fname varchar (1000), --目录+文件名,处理过程中要使用/覆盖:@filename+.bak <br>
@tj varchar (1000)=&rsquo;&rsquo;, --处理条件.对于数据导入,如果条件中包含@fdname,请指定表名前缀 <br>
@isout bit=1&nbsp;&nbsp;  --1导出((默认),0导入 <br>
as <br>
declare @fname_in varchar(1000) --bcp处理应答文件名 <br>
,@fsize varchar(20)&nbsp;&nbsp;  --要处理的文件的大小 <br>
,@m_tbname varchar(50) --临时表名 <br>
,@sql varchar(8000)</div>
<div> </div>
<div>--则取得导入文件的大小 <br>
if @isout=1 <br>
set @fsize=&rsquo;0&rsquo; <br>
else <br>
begin <br>
create table #tb(可选名 varchar(20),大小 int <br>
,创建日期 varchar(10),创建时间 varchar(20) <br>
,上次写操作日期 varchar(10),上次写操作时间 varchar(20) <br>
,上次访问日期 varchar(10),上次访问时间 varchar(20),特性 int) <br>
insert into #tb <br>
exec master..xp_getfiledetails @fname <br>
select @fsize=大小 from #tb <br>
drop table #tb <br>
if @fsize is null <br>
begin <br>
print &rsquo;文件未找到&rsquo; <br>
return <br>
end</div>
<div> </div>
<div>end</div>
<div> </div>
<div>--生成数据处理应答文件 <br>
set @m_tbname=&rsquo;&rsquo; <br>
set @sql=&rsquo;select * into <a href="mailto:&rsquo;+@m_tbname+&rsquo;">&rsquo;+@m_tbname+&rsquo;</a> from( <br>
select null as 类型 <br>
union all select 0 as 前缀 <br>
union all select <a href="mailto:&rsquo;+@fsize+&rsquo;">&rsquo;+@fsize+&rsquo;</a> as 长度 <br>
union all select null as 结束 <br>
union all select null as 格式 <br>
) a&rsquo; <br>
exec(@sql) <br>
select @fname_in=@fname+&rsquo;_temp&rsquo; <br>
,@sql=&rsquo;bcp &quot;<a href="mailto:&rsquo;+@m_tbname+&rsquo;">&rsquo;+@m_tbname+&rsquo;</a>&quot; out &quot;<a href="mailto:&rsquo;+@fname_in">&rsquo;+@fname_in</a> <br>
+&rsquo;&quot; /s&quot;<a href="mailto:&rsquo;+@servename">&rsquo;+@servename</a> <br>
+case when isnull(@username,&rsquo;&rsquo;)=&rsquo;&rsquo; then &rsquo;&rsquo; <br>
else &rsquo;&quot; /u&quot;<a href="mailto:&rsquo;+@username">&rsquo;+@username</a> end <br>
+&rsquo;&quot; /p&quot;&rsquo;+isnull(@password,&rsquo;&rsquo;)+&rsquo;&quot; /c&rsquo; <br>
exec master..xp_cmdshell @sql <br>
--删除临时表 <br>
set @sql=&rsquo;drop table <a href="mailto:&rsquo;+@m_tbname">&rsquo;+@m_tbname</a> <br>
exec(@sql)</div>
<div> </div>
<div>if @isout=1 <br>
begin <br>
set @sql=&rsquo;bcp &quot;select top 1 <a href="mailto:&rsquo;+@fdname+&rsquo;">&rsquo;+@fdname+&rsquo;</a> from &rsquo; <br>
<a href="mailto:+@tbname+case">+@tbname+case</a> isnull(@tj,&rsquo;&rsquo;) when &rsquo;&rsquo; then &rsquo;&rsquo; <br>
&nbsp;&nbsp;  else &rsquo; where <a href="mailto:&rsquo;+@tj">&rsquo;+@tj</a> end <br>
+&rsquo;&quot; queryout &quot;<a href="mailto:&rsquo;+@fname">&rsquo;+@fname</a> <br>
+&rsquo;&quot; /s&quot;<a href="mailto:&rsquo;+@servename">&rsquo;+@servename</a> <br>
+case when isnull(@username,&rsquo;&rsquo;)=&rsquo;&rsquo; then &rsquo;&rsquo; <br>
&nbsp;&nbsp;  else &rsquo;&quot; /u&quot;<a href="mailto:&rsquo;+@username">&rsquo;+@username</a> end <br>
+&rsquo;&quot; /p&quot;&rsquo;+isnull(@password,&rsquo;&rsquo;) <br>
+&rsquo;&quot; /i&quot;<a href="mailto:&rsquo;+@fname_in+&rsquo;%22&rsquo;">&rsquo;+@fname_in+&rsquo;&quot;&rsquo;</a> <br>
exec master..xp_cmdshell @sql <br>
end <br>
else <br>
begin <br>
--为数据导入准备临时表 <br>
set @sql=&rsquo;select top 0 <a href="mailto:&rsquo;+@fdname+&rsquo;">&rsquo;+@fdname+&rsquo;</a> into &rsquo; <br>
<a href="mailto:+@m_tbname+&rsquo;">+@m_tbname+&rsquo;</a> from &rsquo; <a href="mailto:+@tbname">+@tbname</a> <br>
exec(@sql)</div>
<div> </div>
<div><br>
--将数据导入到临时表 <br>
set @sql=&rsquo;bcp &quot;<a href="mailto:&rsquo;+@m_tbname+&rsquo;">&rsquo;+@m_tbname+&rsquo;</a>&quot; in &quot;<a href="mailto:&rsquo;+@fname">&rsquo;+@fname</a> <br>
+&rsquo;&quot; /s&quot;<a href="mailto:&rsquo;+@servename">&rsquo;+@servename</a> <br>
+case when isnull(@username,&rsquo;&rsquo;)=&rsquo;&rsquo; then &rsquo;&rsquo; <br>
&nbsp;&nbsp;  else &rsquo;&quot; /u&quot;<a href="mailto:&rsquo;+@username">&rsquo;+@username</a> end <br>
+&rsquo;&quot; /p&quot;&rsquo;+isnull(@password,&rsquo;&rsquo;) <br>
+&rsquo;&quot; /i&quot;<a href="mailto:&rsquo;+@fname_in+&rsquo;%22&rsquo;">&rsquo;+@fname_in+&rsquo;&quot;&rsquo;</a> <br>
exec master..xp_cmdshell @sql</div>
<div> </div>
<div>--将数据导入到正式表中 <br>
set @sql=&rsquo;update <a href="mailto:&rsquo;+@tbname">&rsquo;+@tbname</a> <br>
+&rsquo; set <a href="mailto:&rsquo;+@fdname+&rsquo;=b.&rsquo;+@fdname">&rsquo;+@fdname+&rsquo;=b.&rsquo;+@fdname</a> <br>
+&rsquo; from <a href="mailto:&rsquo;+@tbname+&rsquo;">&rsquo;+@tbname+&rsquo;</a> a,&rsquo; <br>
<a href="mailto:+@m_tbname+&rsquo;">+@m_tbname+&rsquo;</a> b&rsquo; <br>
+case isnull(@tj,&rsquo;&rsquo;) when &rsquo;&rsquo; then &rsquo;&rsquo; <br>
&nbsp;&nbsp;  else &rsquo; where <a href="mailto:&rsquo;+@tj">&rsquo;+@tj</a> end <br>
exec(@sql)</div>
<div> </div>
<div>--删除数据处理临时表 <br>
set @sql=&rsquo;drop table <a href="mailto:&rsquo;+@m_tbname">&rsquo;+@m_tbname</a> <br>
end</div>
<div> </div>
<div>--删除数据处理应答文件 <br>
set @sql=&rsquo;del <a href="mailto:&rsquo;+@fname_in">&rsquo;+@fname_in</a> <br>
exec master..xp_cmdshell @sql</div>
<div> </div>
<div>go</div>
<div> </div>
<div><br>
/** 导入文本文件 <br>
exec master..xp_cmdshell &rsquo;bcp &quot;dbname..tablename&quot; in c:\dt.txt -c -sservername -usa -ppassword&rsquo;</div>
<div> </div>
<div>改为如下，不需引号 <br>
exec master..xp_cmdshell &rsquo;bcp dbname..tablename in c:\dt.txt -c -sservername -usa -ppassword&rsquo;</div>
<div> </div>
<div>/** 导出文本文件 <br>
exec master..xp_cmdshell &rsquo;bcp &quot;dbname..tablename&quot; out c:\dt.txt -c -sservername -usa -ppassword&rsquo; <br>
此句需加引号</div>
<div> </div>
<div> </div></div></body></html>