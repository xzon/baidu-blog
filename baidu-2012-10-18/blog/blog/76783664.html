<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Windows API一日一练(62)GetDiskFreeSpaceEx函数</title></head><body><h1>Windows API一日一练(62)GetDiskFreeSpaceEx函数</h1><div><div style="margin: 0cm 0cm 0pt 36pt">
<p> </p>
<p><span style="font-size: 10.5pt"><u><font color="#810081">Windows API一日一练(62)GetDiskFreeSpaceEx函数</font></u> </span></p>
<p><span style="font-size: 10.5pt">有一次客户给我打来了投诉电话，说我的软件太不好用了，导致他们丢失了很多数据。后来我仔细地查看</span><span style="font-size: 10.5pt">LOG</span><span style="font-size: 10.5pt">，分析出来的原因，其实是很简单的，就是磁盘的空间不够了。我给客户说他们的电脑磁盘空间不够了导致出错的问题，但客户反问我为什么不提示磁盘空间不足。是啊，为什么不提示磁盘的空间不足呢？为了解决这个需求，就需要使用到这个函数</span><span style="font-size: 10.5pt">GetDiskFreeSpaceEx</span><span style="font-size: 10.5pt">。</span></p>
</div>
<div style="margin: 0cm 0cm 0pt 36pt"> </div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">函数</span><span style="font-size: 10.5pt">GetDiskFreeSpaceEx</span><span style="font-size: 10.5pt">声明如下：</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"> </div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">WINBASEAPI</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">BOOL</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">WINAPI</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">GetDiskFreeSpaceExA(</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __in_opt LPCSTR lpDirectoryName,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpFreeBytesAvailableToCaller,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpTotalNumberOfBytes,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpTotalNumberOfFreeBytes</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  );</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">WINBASEAPI</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">BOOL</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">WINAPI</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">GetDiskFreeSpaceExW(</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __in_opt LPCWSTR lpDirectoryName,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpFreeBytesAvailableToCaller,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpTotalNumberOfBytes,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  __out_opt PULARGE_INTEGER lpTotalNumberOfFreeBytes</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">&nbsp;&nbsp;&nbsp;  );</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#ifdef UNICODE</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#define GetDiskFreeSpaceEx GetDiskFreeSpaceExW</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#else</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#define GetDiskFreeSpaceEx GetDiskFreeSpaceExA</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#endif // !UNICODE</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"> </div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">lpDirectoryName</span><span style="font-size: 10.5pt">是驱动器的名称。</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">lpFreeBytesAvailableToCaller</span><span style="font-size: 10.5pt">是用户可用的磁盘空间。</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">lpTotalNumberOfBytes</span><span style="font-size: 10.5pt">是磁盘总共的空间。</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">lpTotalNumberOfFreeBytes</span><span style="font-size: 10.5pt">是磁盘空闲的空间。以上都是字节为单位。</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"> </div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">调用函数的例子如下：</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#001&nbsp;&nbsp;  //</span><span style="font-size: 10.5pt">获取磁盘剩余空间。</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#002&nbsp;&nbsp;  //</span><span style="font-size: 10.5pt">蔡军生</span><span style="font-size: 10.5pt"> 2007/11/01 QQ:9073204 </span><span style="font-size: 10.5pt">深圳</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#003&nbsp;&nbsp;  void DiskFree(void)</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#004&nbsp;&nbsp;  {</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ULARGE_INTEGER nFreeBytesAvailable;</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ULARGE_INTEGER nTotalNumberOfBytes;</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ULARGE_INTEGER nTotalNumberOfFreeBytes;</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (GetDiskFreeSpaceEx(_T(&quot;C:&quot;),</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &amp;nFreeBytesAvailable,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#012&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &amp;nTotalNumberOfBytes,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#013&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &amp;nTotalNumberOfFreeBytes))</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  TCHAR chBuf[256];</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#016&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  wsprintf(chBuf,_T(&quot;Av=%I64d,Total=%I64d,Free=%I64d\r\n&quot;),</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#017&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  nFreeBytesAvailable,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#018&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  nTotalNumberOfBytes,</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  nTotalNumberOfFreeBytes);</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  OutputDebugString(chBuf);</span></div>
<div style="margin: 0cm 0cm 0pt 36pt"><span style="font-size: 10.5pt">#021&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }</span></div>
<div style="margin: 0cm 0cm 0pt 36pt">
<p><span style="font-size: 10.5pt">#022&nbsp;&nbsp;  }</span></p>
<p><span style="font-size: 10.5pt"><a href="http://blog.csdn.net/caimouse/archive/2007/11/01/1861966.aspx">http://blog.csdn.net/caimouse/archive/2007/11/01/1861966.aspx</a></span></p>
</div></div></body></html>