<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>评C#事件处理</title></head><body><h1>评C#事件处理</h1><div><p><u><font color="#810081">评C#事件处理</font></u></p>
<p>前几天学了一点C#，没当真的。因为要搞《MSDN开发精选》的缘故，完全不懂也说不过去。没看什么语言方面的书。也就是把Jefferey Richter的《Applied .NET Framework》（李建忠译本）找来翻翻。看到event那一部分就烦了，原来C#的delegate和event只是表面光，下面的实现还是非常笨重。一个长长的链表，里面放着闭包指针，类型是够安全了，付出的空间和时间效率都不小。对我我这种从C语言爬过来的人，就是觉得不爽。</p>
<p>事件处理机制是C++及其后继者（Java、C#）的最大软肋之一。本质上是因为C++当年的选择，把对象之间的普通消息传递用成员函数调用给解决了。成员函数调用快是够快，但是导致了消息发送者与接受者之间的紧耦合。大多数情况下这倒也并不是什么大不了的事，偏偏在事件处理上，实践中需要松耦合，于是C++的问题就暴露出来了。君不见，所有用C++写的GUI Framework都在event这件事情上大做文章。比较笨的如MFC的全局映射表，比较聪明的如Qt的Signal/Slot，一个例外是VCL，Borland实现了closure指针，把caller context跟指针绑到一起发送给callee，Java比较中规中矩，按照最OO的方式实现了事件处理机制，但是可扩充性不好。C#的delegate其实就是VCL中closure指针的新版。总之是八仙过海，各显其能。但是我觉得，都是在C++已经走歪的老路上徒然努力。只要这个思路还在，事件处理就不可能非常elegant。C#可以让整件事情在表面上看起来很漂亮，可是骨子里还是邋遢的。</p>
<p>就个人而言，我还是比较欣赏C的办法：规定一个协议，我把event数据准备好放在一个地方，然后就不管了，事件的接受者自己去取数据，自己解析，自己决定如何处理。</p>
<p>这样的接受者，在对象分类中，叫做主动对象&mdash;&mdash;active object。这两年在embedded system programming中间，大家越来越发现主动对象的种种优势。我个人觉得主流编程领域也应该考虑一下这个问题。</p>
<p>主动对象的问题可能是类型不安全，但实际上类型安全没有那么重要, 没必要死抱住不放。原来C语言里:<br>
int (*compare)(); <br>
声明的指针可以指向任何返回整数的函数，不管其参数列表如何。在C++里面，这个指针只能指向一个返回整数的无参函数了，灵活性大大降低。也难怪open source人士还是偏爱C。虽然安全性和灵活性同等重要，但是真正的黑客可以用自己的技术来保障安全性，却无法接受灵活性的缺失。</p>
<p>扯远了。</p>
<p>总之，看得越多，越觉得C真是一种伟大的语言，大概只有Fortran和LISP跟它处于同一级别。</p>
<p>附带提一句，李建忠翻译的质量极高，令我辈叹服。</p>
<p> </p></div></body></html>