<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>飞鸽传书 g2ipmsg-0.9.5.ebuild 基于GTK+，本人初学ebuild第一个练手作品</title></head><body><h1>飞鸽传书 g2ipmsg-0.9.5.ebuild 基于GTK+，本人初学ebuild第一个练手作品</h1><div><p> </p>
<p><strong>飞鸽传书 g2ipmsg-0.9.5.ebuild 基于GTK+，本人初学ebuild第一个练手作品</strong></p>
<div style="text-align: left" dir="ltr">
<p># Copyright 1999-2008 Gentoo Foundation<br>
# Distributed under the terms of the GNU General Public License v2<br>
# $Header: $<br>
<br>
inherit eutils<br>
<br>
#g2ipmsg 是基于GTK+的局域网聊天工具 可以跟Windows版的飞鸽传书一起使用<br>
#可聊天及传输文件等 <br>
#http://www.lanqq.com/soft/lanqq/setup.rar 发布正式版懒QQ(LanQQ) V3.1版本<br>
#(飞鸽传书的升级版本 for windows)<br>
#http://www.azhi.net/IPMsg/ 飞鸽传书windows版最新版下载地址<br>
DESCRIPTION=&quot;This is a pop up style LAN Messenger for multi platforms.&quot; # 这是对你的软件包进行的简短说明<br>
HOMEPAGE=&quot;http://www.ipmsg.org/index.html.en&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # 这个就没什么好说的了,如果你在某个站点发布你的软件,那在这里加上网站的链接就是了<br>
SRC_URI=&quot;http://www.ipmsg.org/archive/${P}.tar.gz&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # 这个地址应该指向该软件包可以下载的链接,由于我们把它放入树中了,这里就留空<br>
#http://www.ipmsg.org/archive/g2ipmsg-0.9.5.tar.gz<br>
<br>
SLOT=&quot;0&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # 通常这里写成0就可以了,这主要用于GCC,emacs这类可以多版本共存的软件包<br>
#IUSE=&quot;ext-charcode ssl applet systray doc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # 这里设置USE标记,较为复杂,这里就只加一个doc作例子了<br>
IUSE=&quot;linguas_zh_CN ssl applet systray doc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # 这里设置USE标记,较为复杂,这里就只加一个doc作例子了<br>
LICENSE=&quot;GPL-2&quot; # 我们痛恨但又不可避免的软件许可<br>
KEYWORDS=&quot;x86 amd64&quot; #这只是个简单的脚本,所以在各种架构上都应该是可以正常运行的,不过,我们只想在x86上测试它<br>
#并且所有起始的ebuild都应该先进行测试，所以只写上~x86<br>
DEPEND=&quot;gnome-base/libgnomeui \<br>
dev-libs/glib \<br>
ssl? ( dev-libs/openssl ) \<br>
applet? ( &gt;=gnome-base/gnome-panel-2 ) \<br>
dev-util/pkgconfig \<br>
&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &gt;=dev-util/intltool-0.33 \<br>
&gt;=x11-libs/gtk+-2.10.14&quot;<br>
<br>
#RDEPEND=&quot;&quot;<br>
<br>
RESTRICT=&quot;mirror&quot; #for local overlay<br>
<br>
src_unpack() # 这个函数用于解压源代码 <br>
{<br>
#当前ebuild可以不用声明此函数 但为了学习而显示一些变量而用的<br>
# ${S}是src_unpack函数起始执行的地方，由emerge系统自动创建<br>
#cp ${FILESDIR}/unmask.gz ${S}<br>
#FILESDIR这个变量指明了我们存放该包的路径也就是<br>
#/usr/portage/local/myebuilds/app-portage/unmask/files<br>
#gzip -d ${S}/unmask.gz<br>
einfo &quot;Start src_unpack()&quot;<br>
einfo &quot;${P}&quot;<br>
einfo &quot;\$\{S\}=${S}&quot;<br>
einfo &quot;\$\{D\}=${D}&quot;<br>
einfo &quot;\$\{FILESDIR\}=${FILESDIR}&quot;<br>
unpack ${A}<br>
cd &quot;${S}&quot;<br>
#epatch &quot;${FILESDIR}/${P}.diff&quot; #暂时不用留着吧<br>
#以下几行主要应对0.9.5版本 configure --with-ext-charcode=CP936无效的问题<br>
sed -i 's/CP932/CP936/g' configure.in<br>
sed -i 's/CP932/CP936/g' configure<br>
#sed -i 's/CP932/CP936/g' config.h&nbsp;&nbsp;  #多此一举 这个文件是configure生成的<br>
#反正不考虑其他字符集所以全改为CP936<br>
}<br>
<br>
#show_econf_err()<br>
#{<br>
# einfo &quot;econf faile by show_econf_err()&quot;<br>
# if use applet; then<br>
# einfo &quot;try to use USE=&quot;-applet&quot; emerge foo&quot;<br>
# fi<br>
#}<br>
#<br>
src_compile()<br>
{<br>
#if !use systray; then<br>
# econf --disable-systray || die &quot;econf failed&quot;<br>
#else<br>
# econf --enable-systray || die &quot;econf failed&quot;<br>
#fi<br>
#econf $(use_enable systray) \<br>
# $(use_enable applet) \<br>
# $(use_with&nbsp;&nbsp;  ext-charcode) \<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  $(use_with&nbsp;&nbsp;  ssl)&nbsp;&nbsp;  || die &quot;econf failed&quot;<br>
<br>
local myconf<br>
myconf=&quot;`use_enable systray` \<br>
`use_enable applet` \<br>
`use_with&nbsp;&nbsp;  ssl`&quot;<br>
<br>
if use linguas_zh_CN ; then <br>
myconf=&quot;$myconf --with-ext-charcode=CP936&quot;<br>
fi<br>
einfo &quot; myconf = ${myconf}&quot;<br>
econf ${myconf} || die &quot;=================econf failed=============&quot;<br>
emake || die &quot;emake failed&quot;<br>
# --with-ext-charcode&nbsp;&nbsp;&nbsp;&nbsp;  External character code setting(CP936(Simplified<br>
}<br>
<br>
# src_compile() { } #如果你需要编译什么东西,就在这个函数中完成.<br>
src_install()<br>
{<br>
einfo &quot;Start src_install()&quot;<br>
#dosbin unmask <br>
# 使用dosbin将目标程序安装到/usr/sbin/目录，相应的，如果要安装到/usr/bin，可以使用dobin，这是ebuild本身提供的几个简单的安装函数，可以在man 5 ebuild中查到它们<br>
if use doc; then<br>
einfo &quot;the USE=&quot;doc&quot;&quot;<br>
einfo &quot;cp `ls ${FILESDIR}` to ${D}&quot;<br>
#如果使用doc这个USE标记,我们就把readme也复制进去.<br>
#dodoc ${FILESDIR}/readme.gz <br>
# dodoc也是ebuild脚本所提供的一个安装文档的函数，它会自动创建/usr/share/doc/${PF}并且将文档安装进去<br>
else<br>
einfo &quot;the USE=&quot;-doc&quot;&quot;<br>
einfo &quot;show files === `ls ${FILESDIR}` ====&quot;<br>
fi<br>
GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 emake DESTDIR=&quot;${D}&quot; install || die &quot;emake install failed&quot; #<br>
#推荐使用 make DESTDIR=&quot;${D}&quot; install 方式<br>
#GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 #解决sandbox出错的题，之前要FEATURES=-sandbox emerge g2ipmsg的问题<br>
#GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 einstall || die &quot;einstall failed&quot;<br>
#einstall用于对付不正常Makefile<br>
}<br>
#------------------ 一个使用第三方ebuild的示例---------------------------<br>
#sudo mkdir /usr/local/myportage/net-misc/g2ipmsg/files -p<br>
#cd /usr/local/myportage/net-misc/g2ipmsg/files<br>
#--------------------<br>
#add PORTDIR_OVERLAY to /etc/make.conf<br>
#PORTDIR_OVERLAY=&quot;/usr/local/myportage&quot; <br>
#PORTDIR_OVERLAY=&quot;${PORTDIR_OVERLAY} /usr/portage/local/layman/gentoo-china&quot;<br>
#sudo sh -c &quot;echo net-misc/g2ipmsg &gt;&gt; /etc/portage/package.keywords&quot;<br>
#sudo sh -c 'echo &quot;net-misc/g2ipmsg ssl applet doc systray &gt;&gt; /etc/portage/package.use'<br>
#不用这一步<br>
#sudo ebuild ./g2ipmsg-0.9.5.ebuild digest<br>
#sudo sh -c &quot;USE=doc emerge g2ipmsg&quot;<br>
#cat /var/lib/portage/world | grep g2ipmsg<br>
#---------------------------------------------<br>
#test for ebuild<br>
#repoman scan<br>
#repoman full<br>
#---------------------------------------------<br>
#==========联系方式==========<br>
# mailto: 3444542@163.com<br>
# QQ: 3444542<br>
# gmail: zlbgps@gmail.com<br>
# irc: irc.freenode.org/#gentoo-cn&nbsp;&nbsp;  GunsNRose<br>
# blog: http://hi.baidu.com/3444542/blog<br>
#============================<br>
<br>
<br>
#--------------------------------------------------------------------------------<br>
#========== g2ipmsg configure --help的一些参数==================<br>
#Optional Features:<br>
# --disable-FEATURE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  do not include FEATURE (same as --enable-FEATURE=no)<br>
# --enable-FEATURE[=ARG] include FEATURE [ARG=yes]<br>
# --enable-maintainer-mode enable make rules and dependencies not useful<br>
# (and sometimes confusing) to the casual installer<br>
# --disable-dependency-tracking speeds up one-time build<br>
# --enable-dependency-tracking&nbsp;&nbsp;  do not reject slow dependency extractors<br>
# --enable-systray build g2ipmsg application as systray support [default yes]<br>
# --disable-schemas-install Disable the schemas installation<br>
# --enable-applet trun on building applet version [default yes]<br>
#<br>
#Optional Packages:<br>
# --with-PACKAGE[=ARG]&nbsp;&nbsp;&nbsp;  use PACKAGE [ARG=yes]<br>
# --without-PACKAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  do not use PACKAGE (same as --with-PACKAGE=no)<br>
# --with-ssl=PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  where to look for OpenSSL, PATH points to the<br>
# OpenSSL installation (default: /usr/local/ssl)<br>
# --without-ssl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  disable OpenSSL<br>
# --with-ext-charcode&nbsp;&nbsp;&nbsp;&nbsp;  External character code setting(CP936(Simplified<br>
# Chinese), CP932(Japanese Windows ShiftJIS))<br>
# [default=CP932]<br>
# --with-gconf-source=sourceaddress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Config database for installing schema files.<br>
# --with-gconf-schema-file-dir=dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Directory for installing schema files.<br>
#--------------------------------------------------------------------------------</p>
<p> </p>
</div></div></body></html>