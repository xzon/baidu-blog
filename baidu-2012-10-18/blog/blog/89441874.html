<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>一键搞定Java桌面应用安装部署 —— exe4j + Inno Setup 带着JRE, 8M起飞</title></head><body><h1>一键搞定Java桌面应用安装部署 —— exe4j + Inno Setup 带着JRE, 8M起飞</h1><div><div class="postTitle"><a href="http://www.blogjava.net/huliqing/archive/2008/04/18/193907.html" class="postTitle2"><font color="#4371a6">一键搞定Java桌面应用安装部署 —— exe4j + Inno Setup 带着JRE, 8M起飞</font></a></div>
对于作Java桌面应用来说，比较烦人的就是安装部署问题，客户端是否安装有jre、jre版本问题、jre去哪下载、如何用jre启动你的Java应用？不要说刚接触电脑的人，就算是比较熟悉电脑，如果没有接触过Java,面对一个Java应用，如何在Windows下启动它，估计都会折腾半天。如果不是因为这个问题，Java在我的眼里算是最完美的语言了，也是我最喜爱的语言。<br>
所以我认为这个是导致Java桌面应用被一些人所讨厌的最大原因，Java的优势是“一次编写，随处运行”,跨平台特性确实很好，但并不是每个人都需要或都想要跨平台,而且有时候JVM平台或版本问题也会造成“一次编写，到处测试”的尴尬。<br>
最好的方式莫过于带着JRE,让用户轻松点击就能运行。下面我们来解决这样的问题，有什么好的建议或方法请其他朋友多多指教或补充！<br>
针对windows平台，让用户一键式安装，双击使用, 使用工具exe4j + Inno Setup, 这两个工具都可以在网上找到，不熟悉的可以多搜搜，使用起来也不难。<br>
带着JRE运行，JRE的大小应该是最让人头疼的，我默认安装的jre6大小达到80M，而程序只有200-300k左右，感觉非常不合理，分发与网络传输过程也会大受影响！为了解决这个问题我一直在网络上搜索“瘦身版”的JRE，无意中搜到了Beansoft老师介绍的一篇关于迷你JRE的文章，相关的JRE下载后解压约14M左右，试用了一下，相对于我的应用缺少了一些类文件，关于部分xml操作类，及swing桌面应用框架相关连的部分类也找不到，最后借鉴了一下，自己把一个完整的JRE从80M瘦到了38M，去除了很多不需要的类文件，当然，如果耐心一点还可以再瘦下去，再抽掉一些类文件。<br>
在这个基础上再配合Inno Setup这个安装包制作工具，最后把整个程序从40M压到了8M,下面看看关于整个操作过程，关于JRE的瘦身有些烦琐就不写了，而且SUN的JRE瘦身计划也在进行，相信很快会有更小的瘦身版JRE推出,自己没有必要再去费神。<br>
<br>
下面是我的一个完整的Java程序 —— MyLoading<br>
<div align="center"><img width="336" height="400" src="http://hiphotos.baidu.com/hxzon/pic/item/c25d96522ff9b24f0df3e3ac.jpg"></div>
<br>
可以看到已经附带了jre1.6 , 下面先使用exe4j给它制作一个exe执行文件(即上图的MyLoading.exe)，并指定我们自带的jre1.6 。以下是exe4j的启动界面，点击下一步开始创建配置文件。<br>
<br>
<div align="center"><img width="697" height="516" src="http://hiphotos.baidu.com/hxzon/pic/item/b04652e7cc0aef6fb83820ac.jpg"></div>
<br>
接着选择类型，我们选择第一个，这样可以保证程序仍具有跨平台的特性。如果选择第二个，可以把程序完全编译成exe文件，可以更好的保护你的程序不被反编译。<br>
<div align="center"><img width="697" height="517" src="http://hiphotos.baidu.com/hxzon/pic/item/fd7b292e45e35b114ec226ac.jpg"></div>
<br>
接下来设置你的程序的短文件名，源文件夹路径（如我的：E:\MyLoading),以及要生成的exe文件的存放目录，exe存放目录必须指定到源文件夹下，这里我把它指定为E:\Myloading的根目录下。<br>
<div align="center"><img width="696" height="515" src="http://hiphotos.baidu.com/hxzon/pic/item/72929d50b1191523843524ac.jpg"></div>
<br>
接下来，可以给我们即将生成的exe文件起一个名字，如我的“MyLoading”，还可以给它指定一个ico类型的图标，其它按默认就可以了,如图:<br>
<div align="center"><img width="698" height="517" src="http://hiphotos.baidu.com/hxzon/pic/item/8468d36285e9259ce6113aac.jpg"></div>
<br>
接下来的这一步，我们需要把程序中所用到的类路径添加上去。然后指定程序的启动类，其它如果没有必要的话，则按默认即可，点击+号添加类路径：<br>
<div align="center"><img width="698" height="517" src="http://hiphotos.baidu.com/hxzon/pic/item/2cbb96ef721a67aecf1b3eac.jpg"></div>
<br>
基本上你所需要用到的Jar文件都要添加上去，可以逐个添加上去，也可以添加整个文件夹或者使用系统环境变量，为了使你的程序能够随处运行，所以还是强列建议你使用相对路径，并且不要使用环境变量。添加好你的类路径之后回到上一步去选择好你的&quot;Main Class&quot;即可。<br>
<div align="center"><img width="699" height="516" src="http://hiphotos.baidu.com/hxzon/pic/item/bd6ca1efc8c75d57fcfa3cac.jpg"></div>
<br>
接下来先选择我们的程序所需要的jre版本， 然后便是选择我们自带的jre了,这一步不是必须，但是为了更好的分发程序，我们自带了jre, 所以必须把我们自带的jre指定为首选的运行环境，如图选择：<br>
Search sequence<br>
<div align="center"><img width="699" height="514" src="http://hiphotos.baidu.com/hxzon/pic/item/05b19b16f5266f10f2de32ac.jpg"></div>
<br>
默认情况下程序会去系统的注册表，环境变量及相关的目录查找jre,因为我们只需要自带的jre,所以这里我把默认的选项移除了，然后添加我们自己的jre所在的目录路径，点+号开始：<br>
<div align="center"><img width="698" height="520" src="http://hiphotos.baidu.com/hxzon/pic/item/c759d1cac010ca07f31fe7ac.jpg"></div>
<br>
这里还是建议使用相对的目录路径：<br>
<div align="center"><img width="701" height="548" src="http://hiphotos.baidu.com/hxzon/pic/item/3650a951f90274ce8d5430ac.jpg"></div>
<br>
指定jre所在的目录，如图：<br>
<div align="center"><img width="699" height="549" src="http://hiphotos.baidu.com/hxzon/pic/item/3874b28f808854aff11f36ac.jpg"></div>
<br>
最后我的jre目录路径就是这样的：.\jre1.6<br>
<div align="center"><img width="699" height="517" src="http://hiphotos.baidu.com/hxzon/pic/item/3bb53c293d2920bf98250aac.jpg"></div>
<br>
下面这一步只是简单的给程序添加一个启动画面，然后按默认下一步下一步就可以了。<br>
<div align="center"><img width="699" height="519" src="http://hiphotos.baidu.com/hxzon/pic/item/528fba3148bcf4e95fdf0eac.jpg"></div>
<br>
程序最终生成了这个执行文件: MyLoading.exe<br>
现在使用它，已经可以正常利用我们自带的jre启动程序了，但是整个程序仍有40M的大小.<br>
现在我们使用Inno Setup进行压缩并制作一个安装包。<br>
<div align="center"><img width="609" height="451" src="http://hiphotos.baidu.com/hxzon/pic/item/97ca32a848034df0ca130cac.jpg"></div>
<br>
Inno Setup的下载安装请到网上搜索，安装后启动脚本向导，如图所示：
<div align="center"><img width="549" height="506" src="http://hiphotos.baidu.com/hxzon/pic/item/95758bb1d3cf8915082302ac.jpg"></div>
<br>
整个过程很简单：<br>
<div align="center"><img width="546" height="507" src="http://hiphotos.baidu.com/hxzon/pic/item/00b94f5413ff1d15574e00ac.jpg"></div>
<br>
这里指定你的程序的启动文件，即刚才用exe4j创建的exe文件，并将你的整个程序目录都包含进去就可以了，接下来的基本上一直按下一步就可以了，直到脚本向导完成，<br>
<div align="center"><img width="549" height="506" src="http://hiphotos.baidu.com/hxzon/pic/item/c289db544a925219d00906ac.jpg"><br>
<br>
<img width="549" height="506" src="http://hiphotos.baidu.com/hxzon/pic/item/a0ca0a33449f2bb91b4cffac.jpg"></div>
<br>
然后执行该脚本即可：<br>
<br>
<div align="center"><img width="616" height="508" src="http://hiphotos.baidu.com/hxzon/pic/item/1aa3b5debc5e1119cdbf1aac.jpg"><br>
<br>
<img width="550" height="508" src="http://hiphotos.baidu.com/hxzon/pic/item/5728d758ee63acc0810a18ac.jpg"></div>
<br>
然后找到Inno Setup的默认输出目录，就可以看到编译输出后的安装包了，如下图：MyLoading安装.exe<br>
大小已经压到了8.86M。<br>
<div align="center"><img width="626" height="475" src="http://hiphotos.baidu.com/hxzon/pic/item/07156a81a4d6d999bd3e1eac.jpg"></div>
<br>
利用这个就可以快速轻松的安装你的Java桌面应用了。<br>
<div align="center"><img width="500" height="361" src="http://hiphotos.baidu.com/hxzon/pic/item/d1e6570f1e22176b6159f3ac.jpg"></div>
<br>
huliqing<br>
Email:huliqing@live.com<br>
QQ: 31703299<br>
学习永无止境，欢迎一起交流研究...<br>
<br>
<br>
<br>
<br>
huliqing<br>
huliqing@live.com<br>
<a href="http://www.blogjava.net/huliqing/archive/2008/04/18/193907.html">http://www.blogjava.net/huliqing/archive/2008/04/18/193907.html</a></div></body></html>